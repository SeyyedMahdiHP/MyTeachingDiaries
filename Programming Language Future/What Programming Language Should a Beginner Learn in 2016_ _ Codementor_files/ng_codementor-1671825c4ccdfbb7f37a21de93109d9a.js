function fbCamelizedOn(ref,$fbInstance,methodName){return methodName=methodName||"on",function(type,callback){return ref[methodName](type,function(response){response.snapshot={value:humps.camelizeKeys(response.val()),name:response.key()},callback(response)}),$fbInstance}}function nullify(obj){if("undefined"==typeof obj)return null;if("object"==typeof obj)for(var key in obj)obj[key]=nullify(obj[key]);return obj}!function(window,angular){"use strict";function $RouteProvider(){function inherit(parent,extra){return angular.extend(Object.create(parent),extra)}function pathRegExp(path,opts){var insensitive=opts.caseInsensitiveMatch,ret={originalPath:path,regexp:path},keys=ret.keys=[];return path=path.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)([\?\*])?/g,function(_,slash,key,option){var optional="?"===option?option:null,star="*"===option?option:null;return keys.push({name:key,optional:!!optional}),slash=slash||"",""+(optional?"":slash)+"(?:"+(optional?slash:"")+(star&&"(.+?)"||"([^/]+)")+(optional||"")+")"+(optional||"")}).replace(/([\/$\*])/g,"\\$1"),ret.regexp=new RegExp("^"+path+"$",insensitive?"i":""),ret}var routes={};this.when=function(path,route){var routeCopy=angular.copy(route);if(angular.isUndefined(routeCopy.reloadOnSearch)&&(routeCopy.reloadOnSearch=!0),angular.isUndefined(routeCopy.caseInsensitiveMatch)&&(routeCopy.caseInsensitiveMatch=this.caseInsensitiveMatch),routes[path]=angular.extend(routeCopy,path&&pathRegExp(path,routeCopy)),path){var redirectPath="/"==path[path.length-1]?path.substr(0,path.length-1):path+"/";routes[redirectPath]=angular.extend({redirectTo:path},pathRegExp(redirectPath,routeCopy))}return this},this.caseInsensitiveMatch=!1,this.otherwise=function(params){return"string"==typeof params&&(params={redirectTo:params}),this.when(null,params),this},this.$get=["$rootScope","$location","$routeParams","$q","$injector","$templateRequest","$sce",function($rootScope,$location,$routeParams,$q,$injector,$templateRequest,$sce){function switchRouteMatcher(on,route){var keys=route.keys,params={};if(!route.regexp)return null;var m=route.regexp.exec(on);if(!m)return null;for(var i=1,len=m.length;len>i;++i){var key=keys[i-1],val=m[i];key&&val&&(params[key.name]=val)}return params}function prepareRoute($locationEvent){var lastRoute=$route.current;preparedRoute=parseRoute(),preparedRouteIsUpdateOnly=preparedRoute&&lastRoute&&preparedRoute.$$route===lastRoute.$$route&&angular.equals(preparedRoute.pathParams,lastRoute.pathParams)&&!preparedRoute.reloadOnSearch&&!forceReload,preparedRouteIsUpdateOnly||!lastRoute&&!preparedRoute||$rootScope.$broadcast("$routeChangeStart",preparedRoute,lastRoute).defaultPrevented&&$locationEvent&&$locationEvent.preventDefault()}function commitRoute(){var lastRoute=$route.current,nextRoute=preparedRoute;preparedRouteIsUpdateOnly?(lastRoute.params=nextRoute.params,angular.copy(lastRoute.params,$routeParams),$rootScope.$broadcast("$routeUpdate",lastRoute)):(nextRoute||lastRoute)&&(forceReload=!1,$route.current=nextRoute,nextRoute&&nextRoute.redirectTo&&(angular.isString(nextRoute.redirectTo)?$location.path(interpolate(nextRoute.redirectTo,nextRoute.params)).search(nextRoute.params).replace():$location.url(nextRoute.redirectTo(nextRoute.pathParams,$location.path(),$location.search())).replace()),$q.when(nextRoute).then(function(){if(nextRoute){var template,templateUrl,locals=angular.extend({},nextRoute.resolve);return angular.forEach(locals,function(value,key){locals[key]=angular.isString(value)?$injector.get(value):$injector.invoke(value,null,null,key)}),angular.isDefined(template=nextRoute.template)?angular.isFunction(template)&&(template=template(nextRoute.params)):angular.isDefined(templateUrl=nextRoute.templateUrl)&&(angular.isFunction(templateUrl)&&(templateUrl=templateUrl(nextRoute.params)),angular.isDefined(templateUrl)&&(nextRoute.loadedTemplateUrl=$sce.valueOf(templateUrl),template=$templateRequest(templateUrl))),angular.isDefined(template)&&(locals.$template=template),$q.all(locals)}}).then(function(locals){nextRoute==$route.current&&(nextRoute&&(nextRoute.locals=locals,angular.copy(nextRoute.params,$routeParams)),$rootScope.$broadcast("$routeChangeSuccess",nextRoute,lastRoute))},function(error){nextRoute==$route.current&&$rootScope.$broadcast("$routeChangeError",nextRoute,lastRoute,error)}))}function parseRoute(){var params,match;return angular.forEach(routes,function(route){!match&&(params=switchRouteMatcher($location.path(),route))&&(match=inherit(route,{params:angular.extend({},$location.search(),params),pathParams:params}),match.$$route=route)}),match||routes[null]&&inherit(routes[null],{params:{},pathParams:{}})}function interpolate(string,params){var result=[];return angular.forEach((string||"").split(":"),function(segment,i){if(0===i)result.push(segment);else{var segmentMatch=segment.match(/(\w+)(?:[?*])?(.*)/),key=segmentMatch[1];result.push(params[key]),result.push(segmentMatch[2]||""),delete params[key]}}),result.join("")}var preparedRoute,preparedRouteIsUpdateOnly,forceReload=!1,$route={routes:routes,reload:function(){forceReload=!0,$rootScope.$evalAsync(function(){prepareRoute(),commitRoute()})},updateParams:function(newParams){if(!this.current||!this.current.$$route)throw $routeMinErr("norout","Tried updating route when with no current route");newParams=angular.extend({},this.current.params,newParams),$location.path(interpolate(this.current.$$route.originalPath,newParams)),$location.search(newParams)}};return $rootScope.$on("$locationChangeStart",prepareRoute),$rootScope.$on("$locationChangeSuccess",commitRoute),$route}]}function $RouteParamsProvider(){this.$get=function(){return{}}}function ngViewFactory($route,$anchorScroll,$animate){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(scope,$element,attr,ctrl,$transclude){function cleanupLastView(){previousLeaveAnimation&&($animate.cancel(previousLeaveAnimation),previousLeaveAnimation=null),currentScope&&(currentScope.$destroy(),currentScope=null),currentElement&&(previousLeaveAnimation=$animate.leave(currentElement),previousLeaveAnimation.then(function(){previousLeaveAnimation=null}),currentElement=null)}function update(){var locals=$route.current&&$route.current.locals,template=locals&&locals.$template;if(angular.isDefined(template)){var newScope=scope.$new(),current=$route.current,clone=$transclude(newScope,function(clone){$animate.enter(clone,null,currentElement||$element).then(function(){!angular.isDefined(autoScrollExp)||autoScrollExp&&!scope.$eval(autoScrollExp)||$anchorScroll()}),cleanupLastView()});currentElement=clone,currentScope=current.scope=newScope,currentScope.$emit("$viewContentLoaded"),currentScope.$eval(onloadExp)}else cleanupLastView()}var currentScope,currentElement,previousLeaveAnimation,autoScrollExp=attr.autoscroll,onloadExp=attr.onload||"";scope.$on("$routeChangeSuccess",update),update()}}}function ngViewFillContentFactory($compile,$controller,$route){return{restrict:"ECA",priority:-400,link:function(scope,$element){var current=$route.current,locals=current.locals;$element.html(locals.$template);var link=$compile($element.contents());if(current.controller){locals.$scope=scope;var controller=$controller(current.controller,locals);current.controllerAs&&(scope[current.controllerAs]=controller),$element.data("$ngControllerController",controller),$element.children().data("$ngControllerController",controller)}link(scope)}}}var ngRouteModule=angular.module("ngRoute",["ng"]).provider("$route",$RouteProvider),$routeMinErr=angular.$$minErr("ngRoute");ngRouteModule.provider("$routeParams",$RouteParamsProvider),ngRouteModule.directive("ngView",ngViewFactory),ngRouteModule.directive("ngView",ngViewFillContentFactory),ngViewFactory.$inject=["$route","$anchorScroll","$animate"],ngViewFillContentFactory.$inject=["$compile","$controller","$route"]}(window,window.angular),function(window,angular){"use strict";function $SanitizeProvider(){this.$get=["$$sanitizeUri",function($$sanitizeUri){return function(html){var buf=[];return htmlParser(html,htmlSanitizeWriter(buf,function(uri,isImage){return!/^unsafe/.test($$sanitizeUri(uri,isImage))})),buf.join("")}}]}function sanitizeText(chars){var buf=[],writer=htmlSanitizeWriter(buf,angular.noop);return writer.chars(chars),buf.join("")}function makeMap(str){var i,obj={},items=str.split(",");for(i=0;i<items.length;i++)obj[items[i]]=!0;return obj}function htmlParser(html,handler){function parseStartTag(tag,tagName,rest,unary){if(tagName=angular.lowercase(tagName),blockElements[tagName])for(;stack.last()&&inlineElements[stack.last()];)parseEndTag("",stack.last());optionalEndTagElements[tagName]&&stack.last()==tagName&&parseEndTag("",tagName),unary=voidElements[tagName]||!!unary,unary||stack.push(tagName);var attrs={};rest.replace(ATTR_REGEXP,function(match,name,doubleQuotedValue,singleQuotedValue,unquotedValue){var value=doubleQuotedValue||singleQuotedValue||unquotedValue||"";attrs[name]=decodeEntities(value)}),handler.start&&handler.start(tagName,attrs,unary)}function parseEndTag(tag,tagName){var i,pos=0;if(tagName=angular.lowercase(tagName))for(pos=stack.length-1;pos>=0&&stack[pos]!=tagName;pos--);if(pos>=0){for(i=stack.length-1;i>=pos;i--)handler.end&&handler.end(stack[i]);stack.length=pos}}"string"!=typeof html&&(html=null===html||"undefined"==typeof html?"":""+html);var index,chars,match,text,stack=[],last=html;for(stack.last=function(){return stack[stack.length-1]};html;){if(text="",chars=!0,stack.last()&&specialElements[stack.last()]?(html=html.replace(new RegExp("([\\W\\w]*)<\\s*\\/\\s*"+stack.last()+"[^>]*>","i"),function(all,text){return text=text.replace(COMMENT_REGEXP,"$1").replace(CDATA_REGEXP,"$1"),handler.chars&&handler.chars(decodeEntities(text)),""}),parseEndTag("",stack.last())):(0===html.indexOf("<!--")?(index=html.indexOf("--",4),index>=0&&html.lastIndexOf("-->",index)===index&&(handler.comment&&handler.comment(html.substring(4,index)),html=html.substring(index+3),chars=!1)):DOCTYPE_REGEXP.test(html)?(match=html.match(DOCTYPE_REGEXP),match&&(html=html.replace(match[0],""),chars=!1)):BEGING_END_TAGE_REGEXP.test(html)?(match=html.match(END_TAG_REGEXP),match&&(html=html.substring(match[0].length),match[0].replace(END_TAG_REGEXP,parseEndTag),chars=!1)):BEGIN_TAG_REGEXP.test(html)&&(match=html.match(START_TAG_REGEXP),match?(match[4]&&(html=html.substring(match[0].length),match[0].replace(START_TAG_REGEXP,parseStartTag)),chars=!1):(text+="<",html=html.substring(1))),chars&&(index=html.indexOf("<"),text+=0>index?html:html.substring(0,index),html=0>index?"":html.substring(index),handler.chars&&handler.chars(decodeEntities(text)))),html==last)throw $sanitizeMinErr("badparse","The sanitizer was unable to parse the following block of html: {0}",html);last=html}parseEndTag()}function decodeEntities(value){return value?(hiddenPre.innerHTML=value.replace(/</g,"&lt;"),hiddenPre.textContent):""}function encodeEntities(value){return value.replace(/&/g,"&amp;").replace(SURROGATE_PAIR_REGEXP,function(value){var hi=value.charCodeAt(0),low=value.charCodeAt(1);return"&#"+(1024*(hi-55296)+(low-56320)+65536)+";"}).replace(NON_ALPHANUMERIC_REGEXP,function(value){return"&#"+value.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function htmlSanitizeWriter(buf,uriValidator){var ignore=!1,out=angular.bind(buf,buf.push);return{start:function(tag,attrs,unary){tag=angular.lowercase(tag),!ignore&&specialElements[tag]&&(ignore=tag),ignore||validElements[tag]!==!0||(out("<"),out(tag),angular.forEach(attrs,function(value,key){var lkey=angular.lowercase(key),isImage="img"===tag&&"src"===lkey||"background"===lkey;validAttrs[lkey]!==!0||uriAttrs[lkey]===!0&&!uriValidator(value,isImage)||(out(" "),out(key),out('="'),out(encodeEntities(value)),out('"'))}),out(unary?"/>":">"))},end:function(tag){tag=angular.lowercase(tag),ignore||validElements[tag]!==!0||(out("</"),out(tag),out(">")),tag==ignore&&(ignore=!1)},chars:function(chars){ignore||out(encodeEntities(chars))}}}var $sanitizeMinErr=angular.$$minErr("$sanitize"),START_TAG_REGEXP=/^<((?:[a-zA-Z])[\w:-]*)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*(>?)/,END_TAG_REGEXP=/^<\/\s*([\w:-]+)[^>]*>/,ATTR_REGEXP=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,BEGIN_TAG_REGEXP=/^</,BEGING_END_TAGE_REGEXP=/^<\//,COMMENT_REGEXP=/<!--(.*?)-->/g,DOCTYPE_REGEXP=/<!DOCTYPE([^>]*?)>/i,CDATA_REGEXP=/<!\[CDATA\[(.*?)]]>/g,SURROGATE_PAIR_REGEXP=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,NON_ALPHANUMERIC_REGEXP=/([^\#-~| |!])/g,voidElements=makeMap("area,br,col,hr,img,wbr"),optionalEndTagBlockElements=makeMap("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),optionalEndTagInlineElements=makeMap("rp,rt"),optionalEndTagElements=angular.extend({},optionalEndTagInlineElements,optionalEndTagBlockElements),blockElements=angular.extend({},optionalEndTagBlockElements,makeMap("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),inlineElements=angular.extend({},optionalEndTagInlineElements,makeMap("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),svgElements=makeMap("animate,animateColor,animateMotion,animateTransform,circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,radialGradient,rect,set,stop,svg,switch,text,title,tspan,use"),specialElements=makeMap("script,style"),validElements=angular.extend({},voidElements,blockElements,inlineElements,optionalEndTagElements,svgElements),uriAttrs=makeMap("background,cite,href,longdesc,src,usemap,xlink:href"),htmlAttrs=makeMap("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width"),svgAttrs=makeMap("accent-height,accumulate,additive,alphabetic,arabic-form,ascent,attributeName,attributeType,baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan"),validAttrs=angular.extend({},uriAttrs,svgAttrs,htmlAttrs),hiddenPre=document.createElement("pre");angular.module("ngSanitize",[]).provider("$sanitize",$SanitizeProvider),angular.module("ngSanitize").filter("linky",["$sanitize",function($sanitize){var LINKY_URL_REGEXP=/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"\u201d\u2019]/i,MAILTO_REGEXP=/^mailto:/i;return function(text,target){function addText(text){text&&html.push(sanitizeText(text))}function addLink(url,text){html.push("<a "),angular.isDefined(target)&&html.push('target="',target,'" '),html.push('href="',url.replace(/"/g,"&quot;"),'">'),addText(text),html.push("</a>")}if(!text)return text;for(var match,url,i,raw=text,html=[];match=raw.match(LINKY_URL_REGEXP);)url=match[0],match[2]||match[4]||(url=(match[3]?"http://":"mailto:")+url),i=match.index,addText(raw.substr(0,i)),addLink(url,match[0].replace(MAILTO_REGEXP,"")),raw=raw.substring(i+match[0].length);return addText(raw),$sanitize(html.join(""))}}])}(window,window.angular),angular.module("ui.alias",[]).config(["$compileProvider","uiAliasConfig",function($compileProvider,uiAliasConfig){uiAliasConfig=uiAliasConfig||{},angular.forEach(uiAliasConfig,function(config,alias){angular.isString(config)&&(config={replace:!0,template:config}),$compileProvider.directive(alias,function(){return config})})}]),angular.module("ui.event",[]).directive("uiEvent",["$parse",function($parse){return function($scope,elm,attrs){var events=$scope.$eval(attrs.uiEvent);angular.forEach(events,function(uiEvent,eventName){var fn=$parse(uiEvent);elm.bind(eventName,function(evt){var params=Array.prototype.slice.call(arguments);params=params.splice(1),fn($scope,{$event:evt,$params:params}),$scope.$$phase||$scope.$apply()})})}}]),angular.module("ui.format",[]).filter("format",function(){return function(value,replace){var target=value;if(angular.isString(target)&&void 0!==replace)if(angular.isArray(replace)||angular.isObject(replace)||(replace=[replace]),angular.isArray(replace)){var rlen=replace.length,rfx=function(str,i){return i=parseInt(i,10),i>=0&&rlen>i?replace[i]:str};target=target.replace(/\$([0-9]+)/g,rfx)}else angular.forEach(replace,function(value,key){target=target.split(":"+key).join(value)});return target}}),angular.module("ui.highlight",[]).filter("highlight",function(){return function(text,search,caseSensitive){return search||angular.isNumber(search)?(text=text.toString(),search=search.toString(),caseSensitive?text.split(search).join('<span class="ui-match">'+search+"</span>"):text.replace(new RegExp(search,"gi"),'<span class="ui-match">$&</span>')):text}}),angular.module("ui.include",[]).directive("uiInclude",["$http","$templateCache","$anchorScroll","$compile",function($http,$templateCache,$anchorScroll,$compile){return{restrict:"ECA",terminal:!0,compile:function(element,attr){var srcExp=attr.uiInclude||attr.src,fragExp=attr.fragment||"",onloadExp=attr.onload||"",autoScrollExp=attr.autoscroll;return function(scope,element){function ngIncludeWatchAction(){var thisChangeId=++changeCounter,src=scope.$eval(srcExp),fragment=scope.$eval(fragExp);src?$http.get(src,{cache:$templateCache}).success(function(response){if(thisChangeId===changeCounter){childScope&&childScope.$destroy(),childScope=scope.$new();var contents;contents=fragment?angular.element("<div/>").html(response).find(fragment):angular.element("<div/>").html(response).contents(),element.html(contents),$compile(contents)(childScope),!angular.isDefined(autoScrollExp)||autoScrollExp&&!scope.$eval(autoScrollExp)||$anchorScroll(),childScope.$emit("$includeContentLoaded"),scope.$eval(onloadExp)}}).error(function(){thisChangeId===changeCounter&&clearContent()}):clearContent()}var childScope,changeCounter=0,clearContent=function(){childScope&&(childScope.$destroy(),childScope=null),element.html("")};scope.$watch(fragExp,ngIncludeWatchAction),scope.$watch(srcExp,ngIncludeWatchAction)}}}}]),angular.module("ui.indeterminate",[]).directive("uiIndeterminate",[function(){return{compile:function(tElm,tAttrs){return tAttrs.type&&"checkbox"===tAttrs.type.toLowerCase()?function($scope,elm,attrs){$scope.$watch(attrs.uiIndeterminate,function(newVal){elm[0].indeterminate=!!newVal})}:angular.noop}}}]),angular.module("ui.inflector",[]).filter("inflector",function(){function ucwords(text){return text.replace(/^([a-z])|\s+([a-z])/g,function($1){return $1.toUpperCase()})}function breakup(text,separator){return text.replace(/[A-Z]/g,function(match){return separator+match})}var inflectors={humanize:function(value){return ucwords(breakup(value," ").split("_").join(" "))},underscore:function(value){return value.substr(0,1).toLowerCase()+breakup(value.substr(1),"_").toLowerCase().split(" ").join("_")},variable:function(value){return value=value.substr(0,1).toLowerCase()+ucwords(value.split("_").join(" ")).substr(1).split(" ").join("")}};return function(text,inflector){return inflector!==!1&&angular.isString(text)?(inflector=inflector||"humanize",inflectors[inflector](text)):text}}),angular.module("ui.jq",[]).value("uiJqConfig",{}).directive("uiJq",["uiJqConfig","$timeout",function(uiJqConfig,$timeout){return{restrict:"A",compile:function(tElm,tAttrs){if(!angular.isFunction(tElm[tAttrs.uiJq]))throw new Error('ui-jq: The "'+tAttrs.uiJq+'" function does not exist');var options=uiJqConfig&&uiJqConfig[tAttrs.uiJq];return function(scope,elm,attrs){function callPlugin(){$timeout(function(){elm[attrs.uiJq].apply(elm,linkOptions)},0,!1)}var linkOptions=[];attrs.uiOptions?(linkOptions=scope.$eval("["+attrs.uiOptions+"]"),angular.isObject(options)&&angular.isObject(linkOptions[0])&&(linkOptions[0]=angular.extend({},options,linkOptions[0]))):options&&(linkOptions=[options]),attrs.ngModel&&elm.is("select,input,textarea")&&elm.bind("change",function(){elm.trigger("input")}),attrs.uiRefresh&&scope.$watch(attrs.uiRefresh,function(){callPlugin()}),callPlugin()}}}}]),angular.module("ui.keypress",[]).factory("keypressHelper",["$parse",function($parse){var keysByCode={8:"backspace",9:"tab",13:"enter",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete"},capitaliseFirstLetter=function(string){return string.charAt(0).toUpperCase()+string.slice(1)};return function(mode,scope,elm,attrs){var params,combinations=[];params=scope.$eval(attrs["ui"+capitaliseFirstLetter(mode)]),angular.forEach(params,function(v,k){var combination,expression;expression=$parse(v),angular.forEach(k.split(" "),function(variation){combination={expression:expression,keys:{}},angular.forEach(variation.split("-"),function(value){combination.keys[value]=!0}),combinations.push(combination)})}),elm.bind(mode,function(event){var metaPressed=!(!event.metaKey||event.ctrlKey),altPressed=!!event.altKey,ctrlPressed=!!event.ctrlKey,shiftPressed=!!event.shiftKey,keyCode=event.keyCode;"keypress"===mode&&!shiftPressed&&keyCode>=97&&122>=keyCode&&(keyCode-=32),angular.forEach(combinations,function(combination){var mainKeyPressed=combination.keys[keysByCode[keyCode]]||combination.keys[keyCode.toString()],metaRequired=!!combination.keys.meta,altRequired=!!combination.keys.alt,ctrlRequired=!!combination.keys.ctrl,shiftRequired=!!combination.keys.shift;mainKeyPressed&&metaRequired===metaPressed&&altRequired===altPressed&&ctrlRequired===ctrlPressed&&shiftRequired===shiftPressed&&scope.$apply(function(){combination.expression(scope,{$event:event})})})})}}]),angular.module("ui.keypress").directive("uiKeydown",["keypressHelper",function(keypressHelper){return{link:function(scope,elm,attrs){keypressHelper("keydown",scope,elm,attrs)}}}]),angular.module("ui.keypress").directive("uiKeypress",["keypressHelper",function(keypressHelper){return{link:function(scope,elm,attrs){keypressHelper("keypress",scope,elm,attrs)}}}]),angular.module("ui.keypress").directive("uiKeyup",["keypressHelper",function(keypressHelper){return{link:function(scope,elm,attrs){keypressHelper("keyup",scope,elm,attrs)}}}]),angular.module("ui.mask",[]).value("uiMaskConfig",{maskDefinitions:{9:/\d/,A:/[a-zA-Z]/,"*":/[a-zA-Z0-9]/}}).directive("uiMask",["uiMaskConfig",function(maskConfig){return{priority:100,require:"ngModel",restrict:"A",compile:function(){var options=maskConfig;return function(scope,iElement,iAttrs,controller){function initialize(maskAttr){return angular.isDefined(maskAttr)?(processRawMask(maskAttr),maskProcessed?(initializeElement(),bindEventListeners(),!0):uninitialize()):uninitialize()}function initPlaceholder(placeholderAttr){angular.isDefined(placeholderAttr)&&(maskPlaceholder=placeholderAttr,maskProcessed&&eventHandler())}function formatter(fromModelValue){return maskProcessed?(value=unmaskValue(fromModelValue||""),isValid=validateValue(value),controller.$setValidity("mask",isValid),isValid&&value.length?maskValue(value):void 0):fromModelValue}function parser(fromViewValue){return maskProcessed?(value=unmaskValue(fromViewValue||""),isValid=validateValue(value),controller.$viewValue=value.length?maskValue(value):"",controller.$setValidity("mask",isValid),""===value&&void 0!==controller.$error.required&&controller.$setValidity("required",!1),isValid?value:void 0):fromViewValue}function uninitialize(){return maskProcessed=!1,unbindEventListeners(),angular.isDefined(originalPlaceholder)?iElement.attr("placeholder",originalPlaceholder):iElement.removeAttr("placeholder"),angular.isDefined(originalMaxlength)?iElement.attr("maxlength",originalMaxlength):iElement.removeAttr("maxlength"),iElement.val(controller.$modelValue),controller.$viewValue=controller.$modelValue,!1}function initializeElement(){value=oldValueUnmasked=unmaskValue(controller.$modelValue||""),valueMasked=oldValue=maskValue(value),isValid=validateValue(value);var viewValue=isValid&&value.length?valueMasked:"";iAttrs.maxlength&&iElement.attr("maxlength",2*maskCaretMap[maskCaretMap.length-1]),iElement.attr("placeholder",maskPlaceholder),iElement.val(viewValue),controller.$viewValue=viewValue}function bindEventListeners(){eventsBound||(iElement.bind("blur",blurHandler),iElement.bind("mousedown mouseup",mouseDownUpHandler),iElement.bind("input keyup click focus",eventHandler),eventsBound=!0)}function unbindEventListeners(){eventsBound&&(iElement.unbind("blur",blurHandler),iElement.unbind("mousedown",mouseDownUpHandler),iElement.unbind("mouseup",mouseDownUpHandler),iElement.unbind("input",eventHandler),iElement.unbind("keyup",eventHandler),iElement.unbind("click",eventHandler),iElement.unbind("focus",eventHandler),eventsBound=!1)}function validateValue(value){return value.length?value.length>=minRequiredLength:!0}function unmaskValue(value){var valueUnmasked="",maskPatternsCopy=maskPatterns.slice();return value=value.toString(),angular.forEach(maskComponents,function(component){value=value.replace(component,"")}),angular.forEach(value.split(""),function(chr){maskPatternsCopy.length&&maskPatternsCopy[0].test(chr)&&(valueUnmasked+=chr,maskPatternsCopy.shift())}),valueUnmasked}function maskValue(unmaskedValue){var valueMasked="",maskCaretMapCopy=maskCaretMap.slice();return angular.forEach(maskPlaceholder.split(""),function(chr,i){unmaskedValue.length&&i===maskCaretMapCopy[0]?(valueMasked+=unmaskedValue.charAt(0)||"_",unmaskedValue=unmaskedValue.substr(1),maskCaretMapCopy.shift()):valueMasked+=chr}),valueMasked}function getPlaceholderChar(i){var placeholder=iAttrs.placeholder;return"undefined"!=typeof placeholder&&placeholder[i]?placeholder[i]:"_"}function getMaskComponents(){return maskPlaceholder.replace(/[_]+/g,"_").replace(/([^_]+)([a-zA-Z0-9])([^_])/g,"$1$2_$3").split("_")}function processRawMask(mask){var characterCount=0;if(maskCaretMap=[],maskPatterns=[],maskPlaceholder="","string"==typeof mask){minRequiredLength=0;var isOptional=!1,splitMask=mask.split("");angular.forEach(splitMask,function(chr,i){linkOptions.maskDefinitions[chr]?(maskCaretMap.push(characterCount),maskPlaceholder+=getPlaceholderChar(i),maskPatterns.push(linkOptions.maskDefinitions[chr]),characterCount++,isOptional||minRequiredLength++):"?"===chr?isOptional=!0:(maskPlaceholder+=chr,characterCount++)})}maskCaretMap.push(maskCaretMap.slice().pop()+1),maskComponents=getMaskComponents(),maskProcessed=maskCaretMap.length>1}function blurHandler(){oldCaretPosition=0,oldSelectionLength=0,isValid&&0!==value.length||(valueMasked="",iElement.val(""),scope.$apply(function(){controller.$setViewValue("")}))}function mouseDownUpHandler(e){"mousedown"===e.type?iElement.bind("mouseout",mouseoutHandler):iElement.unbind("mouseout",mouseoutHandler)}function mouseoutHandler(){oldSelectionLength=getSelectionLength(this),iElement.unbind("mouseout",mouseoutHandler)}function eventHandler(e){e=e||{};var eventWhich=e.which,eventType=e.type;if(16!==eventWhich&&91!==eventWhich){var valMasked,val=iElement.val(),valOld=oldValue,valUnmasked=unmaskValue(val),valUnmaskedOld=oldValueUnmasked,valAltered=!1,caretPos=getCaretPosition(this)||0,caretPosOld=oldCaretPosition||0,caretPosDelta=caretPos-caretPosOld,caretPosMin=maskCaretMap[0],caretPosMax=maskCaretMap[valUnmasked.length]||maskCaretMap.slice().shift(),selectionLenOld=oldSelectionLength||0,isSelected=getSelectionLength(this)>0,wasSelected=selectionLenOld>0,isAddition=val.length>valOld.length||selectionLenOld&&val.length>valOld.length-selectionLenOld,isDeletion=val.length<valOld.length||selectionLenOld&&val.length===valOld.length-selectionLenOld,isSelection=eventWhich>=37&&40>=eventWhich&&e.shiftKey,isKeyLeftArrow=37===eventWhich,isKeyBackspace=8===eventWhich||"keyup"!==eventType&&isDeletion&&-1===caretPosDelta,isKeyDelete=46===eventWhich||"keyup"!==eventType&&isDeletion&&0===caretPosDelta&&!wasSelected,caretBumpBack=(isKeyLeftArrow||isKeyBackspace||"click"===eventType)&&caretPos>caretPosMin;if(oldSelectionLength=getSelectionLength(this),!isSelection&&(!isSelected||"click"!==eventType&&"keyup"!==eventType)){if("input"===eventType&&isDeletion&&!wasSelected&&valUnmasked===valUnmaskedOld){for(;isKeyBackspace&&caretPos>caretPosMin&&!isValidCaretPosition(caretPos);)caretPos--;for(;isKeyDelete&&caretPosMax>caretPos&&-1===maskCaretMap.indexOf(caretPos);)caretPos++;var charIndex=maskCaretMap.indexOf(caretPos);valUnmasked=valUnmasked.substring(0,charIndex)+valUnmasked.substring(charIndex+1),valAltered=!0}for(valMasked=maskValue(valUnmasked),oldValue=valMasked,oldValueUnmasked=valUnmasked,iElement.val(valMasked),valAltered&&scope.$apply(function(){controller.$setViewValue(valUnmasked)}),isAddition&&caretPosMin>=caretPos&&(caretPos=caretPosMin+1),caretBumpBack&&caretPos--,caretPos=caretPos>caretPosMax?caretPosMax:caretPosMin>caretPos?caretPosMin:caretPos;!isValidCaretPosition(caretPos)&&caretPos>caretPosMin&&caretPosMax>caretPos;)caretPos+=caretBumpBack?-1:1;(caretBumpBack&&caretPosMax>caretPos||isAddition&&!isValidCaretPosition(caretPosOld))&&caretPos++,oldCaretPosition=caretPos,setCaretPosition(this,caretPos)}}}function isValidCaretPosition(pos){return maskCaretMap.indexOf(pos)>-1}function getCaretPosition(input){if(!input)return 0;if(void 0!==input.selectionStart)return input.selectionStart;if(document.selection){input.focus();var selection=document.selection.createRange();return selection.moveStart("character",-input.value.length),selection.text.length}return 0}function setCaretPosition(input,pos){if(!input)return 0;if(0!==input.offsetWidth&&0!==input.offsetHeight)if(input.setSelectionRange)input.focus(),input.setSelectionRange(pos,pos);else if(input.createTextRange){var range=input.createTextRange();range.collapse(!0),range.moveEnd("character",pos),range.moveStart("character",pos),range.select()}}function getSelectionLength(input){return input?void 0!==input.selectionStart?input.selectionEnd-input.selectionStart:document.selection?document.selection.createRange().text.length:0:0}var maskCaretMap,maskPatterns,maskPlaceholder,maskComponents,minRequiredLength,value,valueMasked,isValid,oldValue,oldValueUnmasked,oldCaretPosition,oldSelectionLength,maskProcessed=!1,eventsBound=!1,originalPlaceholder=iAttrs.placeholder,originalMaxlength=iAttrs.maxlength,linkOptions={};iAttrs.uiOptions?(linkOptions=scope.$eval("["+iAttrs.uiOptions+"]"),angular.isObject(linkOptions[0])&&(linkOptions=function(original,current){for(var i in original)Object.prototype.hasOwnProperty.call(original,i)&&(current[i]?angular.extend(current[i],original[i]):current[i]=angular.copy(original[i]));return current}(options,linkOptions[0]))):linkOptions=options,iAttrs.$observe("uiMask",initialize),iAttrs.$observe("placeholder",initPlaceholder),controller.$formatters.push(formatter),controller.$parsers.push(parser),iElement.bind("mousedown mouseup",mouseDownUpHandler),Array.prototype.indexOf||(Array.prototype.indexOf=function(searchElement){if(null===this)throw new TypeError;var t=Object(this),len=t.length>>>0;if(0===len)return-1;var n=0;if(arguments.length>1&&(n=Number(arguments[1]),n!==n?n=0:0!==n&&n!==1/0&&n!==-(1/0)&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=len)return-1;for(var k=n>=0?n:Math.max(len-Math.abs(n),0);len>k;k++)if(k in t&&t[k]===searchElement)return k;return-1})}}}}]),angular.module("ui.reset",[]).value("uiResetConfig",null).directive("uiReset",["uiResetConfig",function(uiResetConfig){var resetValue=null;return void 0!==uiResetConfig&&(resetValue=uiResetConfig),{require:"ngModel",link:function(scope,elm,attrs,ctrl){var aElement;aElement=angular.element('<a class="ui-reset" />'),elm.wrap('<span class="ui-resetwrap" />').after(aElement),
aElement.bind("click",function(e){e.preventDefault(),scope.$apply(function(){attrs.uiReset?ctrl.$setViewValue(scope.$eval(attrs.uiReset)):ctrl.$setViewValue(resetValue),ctrl.$render()})})}}}]),angular.module("ui.route",[]).directive("uiRoute",["$location","$parse",function($location,$parse){return{restrict:"AC",scope:!0,compile:function(tElement,tAttrs){var useProperty;if(tAttrs.uiRoute)useProperty="uiRoute";else if(tAttrs.ngHref)useProperty="ngHref";else{if(!tAttrs.href)throw new Error("uiRoute missing a route or href property on "+tElement[0]);useProperty="href"}return function($scope,elm,attrs){function staticWatcher(newVal){var hash=newVal.indexOf("#");hash>-1&&(newVal=newVal.substr(hash+1)),(watcher=function(){modelSetter($scope,$location.path().indexOf(newVal)>-1)})()}function regexWatcher(newVal){var hash=newVal.indexOf("#");hash>-1&&(newVal=newVal.substr(hash+1)),(watcher=function(){var regexp=new RegExp("^"+newVal+"$",["i"]);modelSetter($scope,regexp.test($location.path()))})()}var modelSetter=$parse(attrs.ngModel||attrs.routeModel||"$uiRoute").assign,watcher=angular.noop;switch(useProperty){case"uiRoute":attrs.uiRoute?regexWatcher(attrs.uiRoute):attrs.$observe("uiRoute",regexWatcher);break;case"ngHref":attrs.ngHref?staticWatcher(attrs.ngHref):attrs.$observe("ngHref",staticWatcher);break;case"href":staticWatcher(attrs.href)}$scope.$on("$routeChangeSuccess",function(){watcher()}),$scope.$on("$stateChangeSuccess",function(){watcher()})}}}}]),angular.module("ui.scroll.jqlite",["ui.scroll"]).service("jqLiteExtras",["$log","$window",function(console,window){return{registerFor:function(element){var convertToPx,css,getMeasurements,getStyle,getWidthHeight,isWindow,scrollTo;return css=angular.element.prototype.css,element.prototype.css=function(name,value){var elem,self;return self=this,elem=self[0],elem&&3!==elem.nodeType&&8!==elem.nodeType&&elem.style?css.call(self,name,value):void 0},isWindow=function(obj){return obj&&obj.document&&obj.location&&obj.alert&&obj.setInterval},scrollTo=function(self,direction,value){var elem,method,preserve,prop,_ref;return elem=self[0],_ref={top:["scrollTop","pageYOffset","scrollLeft"],left:["scrollLeft","pageXOffset","scrollTop"]}[direction],method=_ref[0],prop=_ref[1],preserve=_ref[2],isWindow(elem)?angular.isDefined(value)?elem.scrollTo(self[preserve].call(self),value):prop in elem?elem[prop]:elem.document.documentElement[method]:angular.isDefined(value)?elem[method]=value:elem[method]},window.getComputedStyle?(getStyle=function(elem){return window.getComputedStyle(elem,null)},convertToPx=function(elem,value){return parseFloat(value)}):(getStyle=function(elem){return elem.currentStyle},convertToPx=function(elem,value){var core_pnum,left,result,rnumnonpx,rs,rsLeft,style;return core_pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rnumnonpx.test(value)?(style=elem.style,left=style.left,rs=elem.runtimeStyle,rsLeft=rs&&rs.left,rs&&(rs.left=style.left),style.left=value,result=style.pixelLeft,style.left=left,rsLeft&&(rs.left=rsLeft),result):parseFloat(value)}),getMeasurements=function(elem,measure){var base,borderA,borderB,computedMarginA,computedMarginB,computedStyle,dirA,dirB,marginA,marginB,paddingA,paddingB,_ref;return isWindow(elem)?(base=document.documentElement[{height:"clientHeight",width:"clientWidth"}[measure]],{base:base,padding:0,border:0,margin:0}):(_ref={width:[elem.offsetWidth,"Left","Right"],height:[elem.offsetHeight,"Top","Bottom"]}[measure],base=_ref[0],dirA=_ref[1],dirB=_ref[2],computedStyle=getStyle(elem),paddingA=convertToPx(elem,computedStyle["padding"+dirA])||0,paddingB=convertToPx(elem,computedStyle["padding"+dirB])||0,borderA=convertToPx(elem,computedStyle["border"+dirA+"Width"])||0,borderB=convertToPx(elem,computedStyle["border"+dirB+"Width"])||0,computedMarginA=computedStyle["margin"+dirA],computedMarginB=computedStyle["margin"+dirB],marginA=convertToPx(elem,computedMarginA)||0,marginB=convertToPx(elem,computedMarginB)||0,{base:base,padding:paddingA+paddingB,border:borderA+borderB,margin:marginA+marginB})},getWidthHeight=function(elem,direction,measure){var computedStyle,measurements,result;return measurements=getMeasurements(elem,direction),measurements.base>0?{base:measurements.base-measurements.padding-measurements.border,outer:measurements.base,outerfull:measurements.base+measurements.margin}[measure]:(computedStyle=getStyle(elem),result=computedStyle[direction],(0>result||null===result)&&(result=elem.style[direction]||0),result=parseFloat(result)||0,{base:result-measurements.padding-measurements.border,outer:result,outerfull:result+measurements.padding+measurements.border+measurements.margin}[measure])},angular.forEach({before:function(newElem){var children,elem,i,parent,self,_i,_ref;if(self=this,elem=self[0],parent=self.parent(),children=parent.contents(),children[0]===elem)return parent.prepend(newElem);for(i=_i=1,_ref=children.length-1;_ref>=1?_ref>=_i:_i>=_ref;i=_ref>=1?++_i:--_i)if(children[i]===elem)return void angular.element(children[i-1]).after(newElem);throw new Error("invalid DOM structure "+elem.outerHTML)},height:function(value){var self;return self=this,angular.isDefined(value)?(angular.isNumber(value)&&(value+="px"),css.call(self,"height",value)):getWidthHeight(this[0],"height","base")},outerHeight:function(option){return getWidthHeight(this[0],"height",option?"outerfull":"outer")},offset:function(value){var box,doc,docElem,elem,self,win;return self=this,arguments.length?void 0===value?self:value:(box={top:0,left:0},elem=self[0],(doc=elem&&elem.ownerDocument)?(docElem=doc.documentElement,elem.getBoundingClientRect&&(box=elem.getBoundingClientRect()),win=doc.defaultView||doc.parentWindow,{top:box.top+(win.pageYOffset||docElem.scrollTop)-(docElem.clientTop||0),left:box.left+(win.pageXOffset||docElem.scrollLeft)-(docElem.clientLeft||0)}):void 0)},scrollTop:function(value){return scrollTo(this,"top",value)},scrollLeft:function(value){return scrollTo(this,"left",value)}},function(value,key){return element.prototype[key]?void 0:element.prototype[key]=value})}}}]).run(["$log","$window","jqLiteExtras",function(console,window,jqLiteExtras){return window.jQuery?void 0:jqLiteExtras.registerFor(angular.element)}]),angular.module("ui.scroll",[]).directive("ngScrollViewport",["$log",function(){return{controller:["$scope","$element",function(scope,element){return element}]}}]).directive("ngScroll",["$log","$injector","$rootScope","$timeout",function(console,$injector,$rootScope,$timeout){return{require:["?^ngScrollViewport"],transclude:"element",priority:1e3,terminal:!0,compile:function(element,attr,linker){return function($scope,$element,$attr,controllers){var adapter,adjustBuffer,adjustRowHeight,bof,bottomVisiblePos,buffer,bufferPadding,bufferSize,clipBottom,clipTop,datasource,datasourceName,enqueueFetch,eof,eventListener,fetch,finalize,first,insert,isDatasource,isLoading,itemName,loading,match,next,pending,reload,removeFromBuffer,resizeHandler,scrollHandler,scrollHeight,shouldLoadBottom,shouldLoadTop,tempScope,topVisiblePos,viewport;if(match=$attr.ngScroll.match(/^\s*(\w+)\s+in\s+(\w+)\s*$/),!match)throw new Error('Expected ngScroll in form of "item_ in _datasource_" but got "'+$attr.ngScroll+'"');if(itemName=match[1],datasourceName=match[2],isDatasource=function(datasource){return angular.isObject(datasource)&&datasource.get&&angular.isFunction(datasource.get)},datasource=$scope[datasourceName],!isDatasource(datasource)&&(datasource=$injector.get(datasourceName),!isDatasource(datasource)))throw new Error(datasourceName+" is not a valid datasource");return bufferSize=Math.max(3,+$attr.bufferSize||10),bufferPadding=function(){return viewport.height()*Math.max(.1,+$attr.padding||.1)},scrollHeight=function(elem){return elem[0].scrollHeight||elem[0].document.documentElement.scrollHeight},adapter=null,linker(tempScope=$scope.$new(),function(template){var bottomPadding,createPadding,padding,repeaterType,topPadding,viewport;if(repeaterType=template[0].localName,"dl"===repeaterType)throw new Error("ng-scroll directive does not support <"+template[0].localName+"> as a repeating tag: "+template[0].outerHTML);return"li"!==repeaterType&&"tr"!==repeaterType&&(repeaterType="div"),viewport=controllers[0]||angular.element(window),viewport.css({"overflow-y":"auto",display:"block"}),padding=function(repeaterType){var div,result,table;switch(repeaterType){case"tr":return table=angular.element("<table><tr><td><div></div></td></tr></table>"),div=table.find("div"),result=table.find("tr"),result.paddingHeight=function(){return div.height.apply(div,arguments)},result;default:return result=angular.element("<"+repeaterType+"></"+repeaterType+">"),result.paddingHeight=result.height,result}},createPadding=function(padding,element,direction){return element[{top:"before",bottom:"after"}[direction]](padding),{paddingHeight:function(){return padding.paddingHeight.apply(padding,arguments)},insert:function(element){return padding[{top:"after",bottom:"before"}[direction]](element)}}},topPadding=createPadding(padding(repeaterType),element,"top"),bottomPadding=createPadding(padding(repeaterType),element,"bottom"),tempScope.$destroy(),adapter={viewport:viewport,topPadding:topPadding.paddingHeight,bottomPadding:bottomPadding.paddingHeight,append:bottomPadding.insert,prepend:topPadding.insert,bottomDataPos:function(){return scrollHeight(viewport)-bottomPadding.paddingHeight()},topDataPos:function(){return topPadding.paddingHeight()}}}),viewport=adapter.viewport,first=1,next=1,buffer=[],pending=[],eof=!1,bof=!1,loading=datasource.loading||function(){},isLoading=!1,removeFromBuffer=function(start,stop){var i,_i;for(i=_i=start;stop>=start?stop>_i:_i>stop;i=stop>=start?++_i:--_i)buffer[i].scope.$destroy(),buffer[i].element.remove();return buffer.splice(start,stop-start)},reload=function(){return first=1,next=1,removeFromBuffer(0,buffer.length),adapter.topPadding(0),adapter.bottomPadding(0),pending=[],eof=!1,bof=!1,adjustBuffer(!1)},bottomVisiblePos=function(){return viewport.scrollTop()+viewport.height()},topVisiblePos=function(){return viewport.scrollTop()},shouldLoadBottom=function(){return!eof&&adapter.bottomDataPos()<bottomVisiblePos()+bufferPadding()},clipBottom=function(){var bottomHeight,i,itemHeight,overage,_i,_ref;for(bottomHeight=0,overage=0,i=_i=_ref=buffer.length-1;(0>=_ref?0>=_i:_i>=0)&&(itemHeight=buffer[i].element.outerHeight(!0),adapter.bottomDataPos()-bottomHeight-itemHeight>bottomVisiblePos()+bufferPadding());i=0>=_ref?++_i:--_i)bottomHeight+=itemHeight,overage++,eof=!1;return overage>0?(adapter.bottomPadding(adapter.bottomPadding()+bottomHeight),removeFromBuffer(buffer.length-overage,buffer.length),next-=overage,console.log("clipped off bottom "+overage+" bottom padding "+adapter.bottomPadding())):void 0},shouldLoadTop=function(){return!bof&&adapter.topDataPos()>topVisiblePos()-bufferPadding()},clipTop=function(){var item,itemHeight,overage,topHeight,_i,_len;for(topHeight=0,overage=0,_i=0,_len=buffer.length;_len>_i&&(item=buffer[_i],itemHeight=item.element.outerHeight(!0),adapter.topDataPos()+topHeight+itemHeight<topVisiblePos()-bufferPadding());_i++)topHeight+=itemHeight,overage++,bof=!1;return overage>0?(adapter.topPadding(adapter.topPadding()+topHeight),removeFromBuffer(0,overage),first+=overage,console.log("clipped off top "+overage+" top padding "+adapter.topPadding())):void 0},enqueueFetch=function(direction,scrolling){return isLoading||(isLoading=!0,loading(!0)),1===pending.push(direction)?fetch(scrolling):void 0},insert=function(index,item){var itemScope,toBeAppended,wrapper;return itemScope=$scope.$new(),itemScope[itemName]=item,toBeAppended=index>first,itemScope.$index=index,toBeAppended&&itemScope.$index--,wrapper={scope:itemScope},linker(itemScope,function(clone){return wrapper.element=clone,toBeAppended?index===next?(adapter.append(clone),buffer.push(wrapper)):(buffer[index-first].element.after(clone),buffer.splice(index-first+1,0,wrapper)):(adapter.prepend(clone),buffer.unshift(wrapper))}),{appended:toBeAppended,wrapper:wrapper}},adjustRowHeight=function(appended,wrapper){var newHeight;return appended?adapter.bottomPadding(Math.max(0,adapter.bottomPadding()-wrapper.element.outerHeight(!0))):(newHeight=adapter.topPadding()-wrapper.element.outerHeight(!0),newHeight>=0?adapter.topPadding(newHeight):viewport.scrollTop(viewport.scrollTop()+wrapper.element.outerHeight(!0)))},adjustBuffer=function(scrolling,newItems,finalize){var doAdjustment;return doAdjustment=function(){return console.log("top {actual="+adapter.topDataPos()+" visible from="+topVisiblePos()+" bottom {visible through="+bottomVisiblePos()+" actual="+adapter.bottomDataPos()+"}"),shouldLoadBottom()?enqueueFetch(!0,scrolling):shouldLoadTop()&&enqueueFetch(!1,scrolling),finalize?finalize():void 0},newItems?$timeout(function(){var row,_i,_len;for(_i=0,_len=newItems.length;_len>_i;_i++)row=newItems[_i],adjustRowHeight(row.appended,row.wrapper);return doAdjustment()}):doAdjustment()},finalize=function(scrolling,newItems){return adjustBuffer(scrolling,newItems,function(){return pending.shift(),0===pending.length?(isLoading=!1,loading(!1)):fetch(scrolling)})},fetch=function(scrolling){var direction;return direction=pending[0],direction?buffer.length&&!shouldLoadBottom()?finalize(scrolling):datasource.get(next,bufferSize,function(result){var item,newItems,_i,_len;if(newItems=[],0===result.length)eof=!0,adapter.bottomPadding(0),console.log("appended: requested "+bufferSize+" records starting from "+next+" recieved: eof");else{for(clipTop(),_i=0,_len=result.length;_len>_i;_i++)item=result[_i],newItems.push(insert(++next,item));console.log("appended: requested "+bufferSize+" received "+result.length+" buffer size "+buffer.length+" first "+first+" next "+next)}return finalize(scrolling,newItems)}):buffer.length&&!shouldLoadTop()?finalize(scrolling):datasource.get(first-bufferSize,bufferSize,function(result){var i,newItems,_i,_ref;if(newItems=[],0===result.length)bof=!0,adapter.topPadding(0),console.log("prepended: requested "+bufferSize+" records starting from "+(first-bufferSize)+" recieved: bof");else{for(clipBottom(),i=_i=_ref=result.length-1;0>=_ref?0>=_i:_i>=0;i=0>=_ref?++_i:--_i)newItems.unshift(insert(--first,result[i]));console.log("prepended: requested "+bufferSize+" received "+result.length+" buffer size "+buffer.length+" first "+first+" next "+next)}return finalize(scrolling,newItems)})},resizeHandler=function(){return $rootScope.$$phase||isLoading?void 0:(adjustBuffer(!1),$scope.$apply())},viewport.bind("resize",resizeHandler),scrollHandler=function(){return $rootScope.$$phase||isLoading?void 0:(adjustBuffer(!0),$scope.$apply())},viewport.bind("scroll",scrollHandler),$scope.$watch(datasource.revision,function(){return reload()}),eventListener=datasource.scope?datasource.scope.$new():$scope.$new(),$scope.$on("$destroy",function(){return eventListener.$destroy(),viewport.unbind("resize",resizeHandler),viewport.unbind("scroll",scrollHandler)}),eventListener.$on("update.items",function(event,locator,newItem){var wrapper,_fn,_i,_len,_ref;if(angular.isFunction(locator))for(_fn=function(wrapper){return locator(wrapper.scope)},_i=0,_len=buffer.length;_len>_i;_i++)wrapper=buffer[_i],_fn(wrapper);else 0<=(_ref=locator-first-1)&&_ref<buffer.length&&(buffer[locator-first-1].scope[itemName]=newItem);return null}),eventListener.$on("delete.items",function(event,locator){var i,item,temp,wrapper,_fn,_i,_j,_k,_len,_len1,_len2,_ref;if(angular.isFunction(locator)){for(temp=[],_i=0,_len=buffer.length;_len>_i;_i++)item=buffer[_i],temp.unshift(item);for(_fn=function(wrapper){return locator(wrapper.scope)?(removeFromBuffer(temp.length-1-i,temp.length-i),next--):void 0},i=_j=0,_len1=temp.length;_len1>_j;i=++_j)wrapper=temp[i],_fn(wrapper)}else 0<=(_ref=locator-first-1)&&_ref<buffer.length&&(removeFromBuffer(locator-first-1,locator-first),next--);for(i=_k=0,_len2=buffer.length;_len2>_k;i=++_k)item=buffer[i],item.scope.$index=first+i;return adjustBuffer(!1)}),eventListener.$on("insert.item",function(event,locator,item){var i,inserted,temp,wrapper,_fn,_i,_j,_k,_len,_len1,_len2,_ref;if(inserted=[],angular.isFunction(locator)){for(temp=[],_i=0,_len=buffer.length;_len>_i;_i++)item=buffer[_i],temp.unshift(item);for(_fn=function(wrapper){var j,newItems,_k,_len2,_results;if(newItems=locator(wrapper.scope)){if(insert=function(index,newItem){return insert(index,newItem),next++},angular.isArray(newItems)){for(_results=[],j=_k=0,_len2=newItems.length;_len2>_k;j=++_k)item=newItems[j],_results.push(inserted.push(insert(i+j,item)));return _results}return inserted.push(insert(i,newItems))}},i=_j=0,_len1=temp.length;_len1>_j;i=++_j)wrapper=temp[i],_fn(wrapper)}else 0<=(_ref=locator-first-1)&&_ref<buffer.length&&(inserted.push(insert(locator,item)),next++);for(i=_k=0,_len2=buffer.length;_len2>_k;i=++_k)item=buffer[i],item.scope.$index=first+i;return adjustBuffer(!1,inserted)})}}}}]),angular.module("ui.scrollfix",[]).directive("uiScrollfix",["$window",function($window){return{require:"^?uiScrollfixTarget",link:function(scope,elm,attrs,uiScrollfixTarget){function onScroll(){var offset;if(angular.isDefined($window.pageYOffset))offset=$window.pageYOffset;else{var iebody=document.compatMode&&"BackCompat"!==document.compatMode?document.documentElement:document.body;offset=iebody.scrollTop}!elm.hasClass("ui-scrollfix")&&offset>attrs.uiScrollfix?elm.addClass("ui-scrollfix"):elm.hasClass("ui-scrollfix")&&offset<attrs.uiScrollfix&&elm.removeClass("ui-scrollfix")}var top=elm[0].offsetTop,$target=uiScrollfixTarget&&uiScrollfixTarget.$element||angular.element($window);attrs.uiScrollfix?"string"==typeof attrs.uiScrollfix&&("-"===attrs.uiScrollfix.charAt(0)?attrs.uiScrollfix=top-parseFloat(attrs.uiScrollfix.substr(1)):"+"===attrs.uiScrollfix.charAt(0)&&(attrs.uiScrollfix=top+parseFloat(attrs.uiScrollfix.substr(1)))):attrs.uiScrollfix=top,$target.on("scroll",onScroll),scope.$on("$destroy",function(){$target.off("scroll",onScroll)})}}}]).directive("uiScrollfixTarget",[function(){return{controller:["$element",function($element){this.$element=$element}]}}]),angular.module("ui.showhide",[]).directive("uiShow",[function(){return function(scope,elm,attrs){scope.$watch(attrs.uiShow,function(newVal){newVal?elm.addClass("ui-show"):elm.removeClass("ui-show")})}}]).directive("uiHide",[function(){return function(scope,elm,attrs){scope.$watch(attrs.uiHide,function(newVal){newVal?elm.addClass("ui-hide"):elm.removeClass("ui-hide")})}}]).directive("uiToggle",[function(){return function(scope,elm,attrs){scope.$watch(attrs.uiToggle,function(newVal){newVal?elm.removeClass("ui-hide").addClass("ui-show"):elm.removeClass("ui-show").addClass("ui-hide")})}}]),angular.module("ui.unique",[]).filter("unique",["$parse",function($parse){return function(items,filterOn){if(filterOn===!1)return items;if((filterOn||angular.isUndefined(filterOn))&&angular.isArray(items)){var newItems=[],get=angular.isString(filterOn)?$parse(filterOn):function(item){return item},extractValueToCompare=function(item){return angular.isObject(item)?get(item):item};angular.forEach(items,function(item){for(var isDuplicate=!1,i=0;i<newItems.length;i++)if(angular.equals(extractValueToCompare(newItems[i]),extractValueToCompare(item))){isDuplicate=!0;break}isDuplicate||newItems.push(item)}),items=newItems}return items}}]),angular.module("ui.validate",[]).directive("uiValidate",function(){return{restrict:"A",require:"ngModel",link:function(scope,elm,attrs,ctrl){function apply_watch(watch){return angular.isString(watch)?void scope.$watch(watch,function(){angular.forEach(validators,function(validatorFn){validatorFn(ctrl.$modelValue)})}):angular.isArray(watch)?void angular.forEach(watch,function(expression){scope.$watch(expression,function(){angular.forEach(validators,function(validatorFn){validatorFn(ctrl.$modelValue)})})}):void(angular.isObject(watch)&&angular.forEach(watch,function(expression,validatorKey){angular.isString(expression)&&scope.$watch(expression,function(){validators[validatorKey](ctrl.$modelValue)}),angular.isArray(expression)&&angular.forEach(expression,function(intExpression){scope.$watch(intExpression,function(){validators[validatorKey](ctrl.$modelValue)})})}))}var validateFn,validators={},validateExpr=scope.$eval(attrs.uiValidate);validateExpr&&(angular.isString(validateExpr)&&(validateExpr={validator:validateExpr}),angular.forEach(validateExpr,function(exprssn,key){validateFn=function(valueToValidate){var expression=scope.$eval(exprssn,{$value:valueToValidate});return angular.isObject(expression)&&angular.isFunction(expression.then)?(expression.then(function(){ctrl.$setValidity(key,!0)},function(){ctrl.$setValidity(key,!1)}),valueToValidate):expression?(ctrl.$setValidity(key,!0),valueToValidate):(ctrl.$setValidity(key,!1),valueToValidate)},validators[key]=validateFn,ctrl.$formatters.push(validateFn),ctrl.$parsers.push(validateFn)}),attrs.uiValidateWatch&&apply_watch(scope.$eval(attrs.uiValidateWatch)))}}}),angular.module("ui.utils",["ui.event","ui.format","ui.highlight","ui.include","ui.indeterminate","ui.inflector","ui.jq","ui.keypress","ui.mask","ui.reset","ui.route","ui.scrollfix","ui.scroll","ui.scroll.jqlite","ui.showhide","ui.unique","ui.validate"]),angular.module("ui.calendar",[]).constant("uiCalendarConfig",{}).controller("uiCalendarCtrl",["$scope","$timeout",function($scope,$timeout){var sourceSerialId=1,eventSerialId=1,sources=$scope.eventSources,extraEventSignature=$scope.calendarWatchEvent?$scope.calendarWatchEvent:angular.noop,wrapFunctionWithScopeApply=function(functionToWrap){var wrapper;return functionToWrap&&(wrapper=function(){var args=arguments;$timeout(function(){functionToWrap.apply(this,args)})}),wrapper};this.eventsFingerprint=function(e){return e.__uiCalId||(e.__uiCalId=eventSerialId++),""+e.__uiCalId+(e.id||"")+(e.title||"")+(e.url||"")+(+e.start||"")+(+e.end||"")+(e.allDay||"")+(e.className||"")+extraEventSignature(e)||""},this.sourcesFingerprint=function(source){return source.__id||(source.__id=sourceSerialId++)},this.allEvents=function(){for(var arraySources=[],i=0,srcLen=sources.length;srcLen>i;i++){var source=sources[i];if(angular.isArray(source))arraySources.push(source);else if(angular.isObject(source)&&angular.isArray(source.events)){var extEvent={};for(var key in source)"_uiCalId"!==key&&"events"!==key&&(extEvent[key]=source[key]);for(var eI=0;eI<source.events.length;eI++)angular.extend(source.events[eI],extEvent);arraySources.push(source.events)}}return Array.prototype.concat.apply([],arraySources)},this.changeWatcher=function(arraySource,tokenFn){var self,getTokens=function(){for(var token,el,array=angular.isFunction(arraySource)?arraySource():arraySource,result=[],i=0,n=array.length;n>i;i++)el=array[i],token=tokenFn(el),map[token]=el,result.push(token);return result},subtractAsSets=function(a,b){var i,n,result=[],inB={};for(i=0,n=b.length;n>i;i++)inB[b[i]]=!0;for(i=0,n=a.length;n>i;i++)inB[a[i]]||result.push(a[i]);return result},map={},applyChanges=function(newTokens,oldTokens){var i,n,el,token,replacedTokens={},removedTokens=subtractAsSets(oldTokens,newTokens);for(i=0,n=removedTokens.length;n>i;i++){var removedToken=removedTokens[i];el=map[removedToken],delete map[removedToken];var newToken=tokenFn(el);newToken===removedToken?self.onRemoved(el):(replacedTokens[newToken]=removedToken,self.onChanged(el))}var addedTokens=subtractAsSets(newTokens,oldTokens);for(i=0,n=addedTokens.length;n>i;i++)token=addedTokens[i],el=map[token],replacedTokens[token]||self.onAdded(el)};return self={subscribe:function(scope,onChanged){scope.$watch(getTokens,function(newTokens,oldTokens){onChanged&&onChanged(newTokens,oldTokens)===!1||applyChanges(newTokens,oldTokens)},!0)},onAdded:angular.noop,onChanged:angular.noop,onRemoved:angular.noop}},this.getFullCalendarConfig=function(calendarSettings,uiCalendarConfig){var config={};return angular.extend(config,uiCalendarConfig),angular.extend(config,calendarSettings),angular.forEach(config,function(value,key){"function"==typeof value&&(config[key]=wrapFunctionWithScopeApply(config[key]))}),config}}]).directive("uiCalendar",["uiCalendarConfig","$locale",function(uiCalendarConfig,$locale){var tValues=function(data){var r,k;r=[];for(k in data)r[k]=data[k];return r},dtf=$locale.DATETIME_FORMATS;return uiCalendarConfig=angular.extend({monthNames:tValues(dtf.MONTH),monthNamesShort:tValues(dtf.SHORTMONTH),dayNames:tValues(dtf.DAY),dayNamesShort:tValues(dtf.SHORTDAY)},uiCalendarConfig||{}),{restrict:"A",scope:{eventSources:"=ngModel",calendarWatchEvent:"&"},controller:"uiCalendarCtrl",link:function(scope,elm,attrs,controller){function getOptions(){var fullCalendarConfig,calendarSettings=attrs.uiCalendar?scope.$parent.$eval(attrs.uiCalendar):{};fullCalendarConfig=controller.getFullCalendarConfig(calendarSettings,uiCalendarConfig),options={eventSources:sources},angular.extend(options,fullCalendarConfig);var options2={};for(var o in options)"eventSources"!==o&&(options2[o]=options[o]);return JSON.stringify(options2)}var sources=scope.eventSources,sourcesChanged=!1,eventSourcesWatcher=controller.changeWatcher(sources,controller.sourcesFingerprint),eventsWatcher=controller.changeWatcher(controller.allEvents,controller.eventsFingerprint),options=null;scope.destroy=function(){attrs.calendar?scope.calendar=scope.$parent[attrs.calendar]=elm.html(""):scope.calendar=elm.html("")},scope.init=function(){scope.calendar.fullCalendar(options)},eventSourcesWatcher.onAdded=function(source){scope.calendar.fullCalendar("addEventSource",source),sourcesChanged=!0},eventSourcesWatcher.onRemoved=function(source){scope.calendar.fullCalendar("removeEventSource",source),sourcesChanged=!0},eventsWatcher.onAdded=function(event){scope.calendar.fullCalendar("renderEvent",event)},eventsWatcher.onRemoved=function(event){scope.calendar.fullCalendar("removeEvents",function(e){return e===event})},eventsWatcher.onChanged=function(event){scope.calendar.fullCalendar("updateEvent",event)},eventSourcesWatcher.subscribe(scope),eventsWatcher.subscribe(scope,function(){return sourcesChanged===!0?(sourcesChanged=!1,!1):void 0}),scope.$watch(getOptions,function(){scope.destroy(),scope.init()})}}}]),angular.module("mm.foundation",["mm.foundation.tpls","mm.foundation.accordion","mm.foundation.alert","mm.foundation.bindHtml","mm.foundation.buttons","mm.foundation.position","mm.foundation.dropdownToggle","mm.foundation.transition","mm.foundation.modal","mm.foundation.pagination","mm.foundation.tooltip","mm.foundation.popover","mm.foundation.progressbar","mm.foundation.rating","mm.foundation.tabs","mm.foundation.tour","mm.foundation.typeahead"]),angular.module("mm.foundation.tpls",["template/accordion/accordion-group.html","template/accordion/accordion.html","template/alert/alert.html","template/modal/backdrop.html","template/modal/window.html","template/pagination/pager.html","template/pagination/pagination.html","template/tooltip/tooltip-html-unsafe-popup.html","template/tooltip/tooltip-popup.html","template/popover/popover.html","template/progressbar/bar.html","template/progressbar/progress.html","template/progressbar/progressbar.html","template/rating/rating.html","template/tabs/tab.html","template/tabs/tabset.html","template/tour/tour.html","template/typeahead/typeahead-match.html","template/typeahead/typeahead-popup.html"]),angular.module("mm.foundation.accordion",[]).constant("accordionConfig",{closeOthers:!0}).controller("AccordionController",["$scope","$attrs","accordionConfig",function($scope,$attrs,accordionConfig){this.groups=[],this.closeOthers=function(openGroup){var closeOthers=angular.isDefined($attrs.closeOthers)?$scope.$eval($attrs.closeOthers):accordionConfig.closeOthers;closeOthers&&angular.forEach(this.groups,function(group){group!==openGroup&&(group.isOpen=!1)})},this.addGroup=function(groupScope){var that=this;this.groups.push(groupScope),groupScope.$on("$destroy",function(){that.removeGroup(groupScope)})},this.removeGroup=function(group){var index=this.groups.indexOf(group);-1!==index&&this.groups.splice(this.groups.indexOf(group),1)}}]).directive("accordion",function(){return{restrict:"EA",controller:"AccordionController",transclude:!0,replace:!1,templateUrl:"template/accordion/accordion.html"}}).directive("accordionGroup",["$parse",function($parse){return{require:"^accordion",restrict:"EA",transclude:!0,replace:!0,templateUrl:"template/accordion/accordion-group.html",scope:{heading:"@"},controller:function(){this.setHeading=function(element){this.heading=element}},link:function(scope,element,attrs,accordionCtrl){var getIsOpen,setIsOpen;accordionCtrl.addGroup(scope),scope.isOpen=!1,attrs.isOpen&&(getIsOpen=$parse(attrs.isOpen),setIsOpen=getIsOpen.assign,scope.$parent.$watch(getIsOpen,function(value){scope.isOpen=!!value})),scope.$watch("isOpen",function(value){value&&accordionCtrl.closeOthers(scope),setIsOpen&&setIsOpen(scope.$parent,value)})}}}]).directive("accordionHeading",function(){return{restrict:"EA",transclude:!0,template:"",replace:!0,require:"^accordionGroup",compile:function(element,attr,transclude){return function(scope,element,attr,accordionGroupCtrl){accordionGroupCtrl.setHeading(transclude(scope,function(){}))}}}}).directive("accordionTransclude",function(){return{require:"^accordionGroup",link:function(scope,element,attr,controller){scope.$watch(function(){return controller[attr.accordionTransclude]},function(heading){heading&&(element.html(""),element.append(heading))})}}}),angular.module("mm.foundation.alert",[]).controller("AlertController",["$scope","$attrs",function($scope,$attrs){$scope.closeable="close"in $attrs}]).directive("alert",function(){return{restrict:"EA",controller:"AlertController",templateUrl:"template/alert/alert.html",transclude:!0,replace:!0,scope:{type:"=",close:"&"}}}),angular.module("mm.foundation.bindHtml",[]).directive("bindHtmlUnsafe",function(){return function(scope,element,attr){element.addClass("ng-binding").data("$binding",attr.bindHtmlUnsafe),scope.$watch(attr.bindHtmlUnsafe,function(value){element.html(value||"")})}}),angular.module("mm.foundation.buttons",[]).constant("buttonConfig",{activeClass:"active",toggleEvent:"click"}).controller("ButtonsController",["buttonConfig",function(buttonConfig){this.activeClass=buttonConfig.activeClass,this.toggleEvent=buttonConfig.toggleEvent}]).directive("btnRadio",function(){return{require:["btnRadio","ngModel"],controller:"ButtonsController",link:function(scope,element,attrs,ctrls){var buttonsCtrl=ctrls[0],ngModelCtrl=ctrls[1];ngModelCtrl.$render=function(){element.toggleClass(buttonsCtrl.activeClass,angular.equals(ngModelCtrl.$modelValue,scope.$eval(attrs.btnRadio)))},element.bind(buttonsCtrl.toggleEvent,function(){element.hasClass(buttonsCtrl.activeClass)||scope.$apply(function(){ngModelCtrl.$setViewValue(scope.$eval(attrs.btnRadio)),ngModelCtrl.$render()})})}}}).directive("btnCheckbox",function(){return{require:["btnCheckbox","ngModel"],controller:"ButtonsController",link:function(scope,element,attrs,ctrls){function getTrueValue(){return getCheckboxValue(attrs.btnCheckboxTrue,!0)}function getFalseValue(){return getCheckboxValue(attrs.btnCheckboxFalse,!1)}function getCheckboxValue(attributeValue,defaultValue){var val=scope.$eval(attributeValue);return angular.isDefined(val)?val:defaultValue}var buttonsCtrl=ctrls[0],ngModelCtrl=ctrls[1];ngModelCtrl.$render=function(){element.toggleClass(buttonsCtrl.activeClass,angular.equals(ngModelCtrl.$modelValue,getTrueValue()))},element.bind(buttonsCtrl.toggleEvent,function(){scope.$apply(function(){ngModelCtrl.$setViewValue(element.hasClass(buttonsCtrl.activeClass)?getFalseValue():getTrueValue()),ngModelCtrl.$render()})})}}}),angular.module("mm.foundation.position",[]).factory("$position",["$document","$window",function($document,$window){function getStyle(el,cssprop){return el.currentStyle?el.currentStyle[cssprop]:$window.getComputedStyle?$window.getComputedStyle(el)[cssprop]:el.style[cssprop]}function isStaticPositioned(element){return"static"===(getStyle(element,"position")||"static")}var parentOffsetEl=function(element){for(var docDomEl=$document[0],offsetParent=element.offsetParent||docDomEl;offsetParent&&offsetParent!==docDomEl&&isStaticPositioned(offsetParent);)offsetParent=offsetParent.offsetParent;return offsetParent||docDomEl};return{position:function(element){var elBCR=this.offset(element),offsetParentBCR={top:0,left:0},offsetParentEl=parentOffsetEl(element[0]);offsetParentEl!=$document[0]&&(offsetParentBCR=this.offset(angular.element(offsetParentEl)),offsetParentBCR.top+=offsetParentEl.clientTop-offsetParentEl.scrollTop,offsetParentBCR.left+=offsetParentEl.clientLeft-offsetParentEl.scrollLeft);var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),
height:boundingClientRect.height||element.prop("offsetHeight"),top:elBCR.top-offsetParentBCR.top,left:elBCR.left-offsetParentBCR.left}},offset:function(element){var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:boundingClientRect.top+($window.pageYOffset||$document[0].body.scrollTop||$document[0].documentElement.scrollTop),left:boundingClientRect.left+($window.pageXOffset||$document[0].body.scrollLeft||$document[0].documentElement.scrollLeft)}}}}]),angular.module("mm.foundation.dropdownToggle",["mm.foundation.position"]).directive("dropdownToggle",["$document","$location","$position",function($document,$location,$position){var openElement=null,closeMenu=angular.noop;return{restrict:"CA",scope:{dropdownToggle:"@"},link:function(scope,element){var dropdown=angular.element($document[0].querySelector(scope.dropdownToggle));scope.$watch("$location.path",function(){closeMenu()}),dropdown.css("display","none").bind("click",function(){closeMenu()}),element.bind("click",function(event){var elementWasOpen=element===openElement;if(event.preventDefault(),event.stopPropagation(),openElement&&closeMenu(),!elementWasOpen&&!element.hasClass("disabled")&&!element.prop("disabled")){dropdown.css("display","block");var offset=$position.offset(element),parentOffset=$position.offset(angular.element(dropdown[0].offsetParent));dropdown.css({left:offset.left-parentOffset.left+"px",top:offset.top-parentOffset.top+offset.height+"px"}),openElement=element,closeMenu=function(event){event&&(event.preventDefault(),event.stopPropagation()),$document.unbind("click",closeMenu),dropdown.css("display","none"),closeMenu=angular.noop,openElement=null},$document.bind("click",closeMenu)}})}}}]),angular.module("mm.foundation.transition",[]).factory("$transition",["$q","$timeout","$rootScope",function($q,$timeout,$rootScope){function findEndEventName(endEventNames){for(var name in endEventNames)if(void 0!==transElement.style[name])return endEventNames[name]}var $transition=function(element,trigger,options){options=options||{};var deferred=$q.defer(),endEventName=$transition[options.animation?"animationEndEventName":"transitionEndEventName"],transitionEndHandler=function(){$rootScope.$apply(function(){element.unbind(endEventName,transitionEndHandler),deferred.resolve(element)})};return endEventName&&element.bind(endEventName,transitionEndHandler),$timeout(function(){angular.isString(trigger)?element.addClass(trigger):angular.isFunction(trigger)?trigger(element):angular.isObject(trigger)&&element.css(trigger),endEventName||deferred.resolve(element)}),deferred.promise.cancel=function(){endEventName&&element.unbind(endEventName,transitionEndHandler),deferred.reject("Transition cancelled")},deferred.promise},transElement=document.createElement("trans"),transitionEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"},animationEndEventNames={WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd",transition:"animationend"};return $transition.transitionEndEventName=findEndEventName(transitionEndEventNames),$transition.animationEndEventName=findEndEventName(animationEndEventNames),$transition}]),angular.module("mm.foundation.modal",["mm.foundation.transition"]).factory("$$stackedMap",function(){return{createNew:function(){var stack=[];return{add:function(key,value){stack.push({key:key,value:value})},get:function(key){for(var i=0;i<stack.length;i++)if(key==stack[i].key)return stack[i]},keys:function(){for(var keys=[],i=0;i<stack.length;i++)keys.push(stack[i].key);return keys},top:function(){return stack[stack.length-1]},remove:function(key){for(var idx=-1,i=0;i<stack.length;i++)if(key==stack[i].key){idx=i;break}return stack.splice(idx,1)[0]},removeTop:function(){return stack.splice(stack.length-1,1)[0]},length:function(){return stack.length}}}}}).directive("modalBackdrop",["$modalStack","$timeout",function($modalStack,$timeout){return{restrict:"EA",replace:!0,templateUrl:"template/modal/backdrop.html",link:function(scope){scope.animate=!1,$timeout(function(){scope.animate=!0}),scope.close=function(evt){var modal=$modalStack.getTop();modal&&modal.value.backdrop&&"static"!=modal.value.backdrop&&evt.target===evt.currentTarget&&(evt.preventDefault(),evt.stopPropagation(),$modalStack.dismiss(modal.key,"backdrop click"))}}}}]).directive("modalWindow",["$modalStack","$timeout",function($modalStack,$timeout){return{restrict:"EA",scope:{index:"@",animate:"="},replace:!0,transclude:!0,templateUrl:"template/modal/window.html",link:function(scope,element,attrs){scope.windowClass=attrs.windowClass||"",$timeout(function(){scope.animate=!0,element[0].focus()})}}}]).factory("$modalStack",["$transition","$timeout","$document","$compile","$rootScope","$$stackedMap",function($transition,$timeout,$document,$compile,$rootScope,$$stackedMap){function backdropIndex(){for(var topBackdropIndex=-1,opened=openedWindows.keys(),i=0;i<opened.length;i++)openedWindows.get(opened[i]).value.backdrop&&(topBackdropIndex=i);return topBackdropIndex}function removeModalWindow(modalInstance){var body=$document.find("body").eq(0),modalWindow=openedWindows.get(modalInstance).value;openedWindows.remove(modalInstance),removeAfterAnimate(modalWindow.modalDomEl,modalWindow.modalScope,300,checkRemoveBackdrop),body.toggleClass(OPENED_MODAL_CLASS,openedWindows.length()>0)}function checkRemoveBackdrop(){if(backdropDomEl&&-1==backdropIndex()){var backdropScopeRef=backdropScope;removeAfterAnimate(backdropDomEl,backdropScope,150,function(){backdropScopeRef.$destroy(),backdropScopeRef=null}),backdropDomEl=void 0,backdropScope=void 0}}function removeAfterAnimate(domEl,scope,emulateTime,done){function afterAnimating(){afterAnimating.done||(afterAnimating.done=!0,domEl.remove(),done&&done())}scope.animate=!1;var transitionEndEventName=$transition.transitionEndEventName;if(transitionEndEventName){var timeout=$timeout(afterAnimating,emulateTime);domEl.bind(transitionEndEventName,function(){$timeout.cancel(timeout),afterAnimating(),scope.$apply()})}else $timeout(afterAnimating,0)}var backdropDomEl,backdropScope,OPENED_MODAL_CLASS="modal-open",openedWindows=$$stackedMap.createNew(),$modalStack={};return $rootScope.$watch(backdropIndex,function(newBackdropIndex){backdropScope&&(backdropScope.index=newBackdropIndex)}),$document.bind("keydown",function(evt){var modal;27===evt.which&&(modal=openedWindows.top(),modal&&modal.value.keyboard&&$rootScope.$apply(function(){$modalStack.dismiss(modal.key)}))}),$modalStack.open=function(modalInstance,modal){openedWindows.add(modalInstance,{deferred:modal.deferred,modalScope:modal.scope,backdrop:modal.backdrop,keyboard:modal.keyboard});var body=$document.find("body").eq(0),currBackdropIndex=backdropIndex();currBackdropIndex>=0&&!backdropDomEl&&(backdropScope=$rootScope.$new(!0),backdropScope.index=currBackdropIndex,backdropDomEl=$compile("<div modal-backdrop></div>")(backdropScope),body.append(backdropDomEl));var angularDomEl=angular.element("<div modal-window></div>");angularDomEl.attr("window-class",modal.windowClass),angularDomEl.attr("index",openedWindows.length()-1),angularDomEl.attr("animate","animate"),angularDomEl.html(modal.content);var modalDomEl=$compile(angularDomEl)(modal.scope);openedWindows.top().value.modalDomEl=modalDomEl,body.append(modalDomEl),body.addClass(OPENED_MODAL_CLASS)},$modalStack.close=function(modalInstance,result){var modalWindow=openedWindows.get(modalInstance).value;modalWindow&&(modalWindow.deferred.resolve(result),removeModalWindow(modalInstance))},$modalStack.dismiss=function(modalInstance,reason){var modalWindow=openedWindows.get(modalInstance).value;modalWindow&&(modalWindow.deferred.reject(reason),removeModalWindow(modalInstance))},$modalStack.dismissAll=function(reason){for(var topModal=this.getTop();topModal;)this.dismiss(topModal.key,reason),topModal=this.getTop()},$modalStack.getTop=function(){return openedWindows.top()},$modalStack}]).provider("$modal",function(){var $modalProvider={options:{backdrop:!0,keyboard:!0},$get:["$injector","$rootScope","$q","$http","$templateCache","$controller","$modalStack",function($injector,$rootScope,$q,$http,$templateCache,$controller,$modalStack){function getTemplatePromise(options){return options.template?$q.when(options.template):$http.get(options.templateUrl,{cache:$templateCache}).then(function(result){return result.data})}function getResolvePromises(resolves){var promisesArr=[];return angular.forEach(resolves,function(value){(angular.isFunction(value)||angular.isArray(value))&&promisesArr.push($q.when($injector.invoke(value)))}),promisesArr}var $modal={};return $modal.open=function(modalOptions){var modalResultDeferred=$q.defer(),modalOpenedDeferred=$q.defer(),modalInstance={result:modalResultDeferred.promise,opened:modalOpenedDeferred.promise,close:function(result){$modalStack.close(modalInstance,result)},dismiss:function(reason){$modalStack.dismiss(modalInstance,reason)}};if(modalOptions=angular.extend({},$modalProvider.options,modalOptions),modalOptions.resolve=modalOptions.resolve||{},!modalOptions.template&&!modalOptions.templateUrl)throw new Error("One of template or templateUrl options is required.");var templateAndResolvePromise=$q.all([getTemplatePromise(modalOptions)].concat(getResolvePromises(modalOptions.resolve)));return templateAndResolvePromise.then(function(tplAndVars){var modalScope=(modalOptions.scope||$rootScope).$new();modalScope.$close=modalInstance.close,modalScope.$dismiss=modalInstance.dismiss;var ctrlInstance,ctrlLocals={},resolveIter=1;modalOptions.controller&&(ctrlLocals.$scope=modalScope,ctrlLocals.$modalInstance=modalInstance,angular.forEach(modalOptions.resolve,function(value,key){ctrlLocals[key]=tplAndVars[resolveIter++]}),ctrlInstance=$controller(modalOptions.controller,ctrlLocals)),$modalStack.open(modalInstance,{scope:modalScope,deferred:modalResultDeferred,content:tplAndVars[0],backdrop:modalOptions.backdrop,keyboard:modalOptions.keyboard,windowClass:modalOptions.windowClass})},function(reason){modalResultDeferred.reject(reason)}),templateAndResolvePromise.then(function(){modalOpenedDeferred.resolve(!0)},function(){modalOpenedDeferred.reject(!1)}),modalInstance},$modal}]};return $modalProvider}),angular.module("mm.foundation.pagination",[]).controller("PaginationController",["$scope","$attrs","$parse","$interpolate",function($scope,$attrs,$parse,$interpolate){var self=this,setNumPages=$attrs.numPages?$parse($attrs.numPages).assign:angular.noop;this.init=function(defaultItemsPerPage){$attrs.itemsPerPage?$scope.$parent.$watch($parse($attrs.itemsPerPage),function(value){self.itemsPerPage=parseInt(value,10),$scope.totalPages=self.calculateTotalPages()}):this.itemsPerPage=defaultItemsPerPage},this.noPrevious=function(){return 1===this.page},this.noNext=function(){return this.page===$scope.totalPages},this.isActive=function(page){return this.page===page},this.calculateTotalPages=function(){var totalPages=this.itemsPerPage<1?1:Math.ceil($scope.totalItems/this.itemsPerPage);return Math.max(totalPages||0,1)},this.getAttributeValue=function(attribute,defaultValue,interpolate){return angular.isDefined(attribute)?interpolate?$interpolate(attribute)($scope.$parent):$scope.$parent.$eval(attribute):defaultValue},this.render=function(){this.page=parseInt($scope.page,10)||1,this.page>0&&this.page<=$scope.totalPages&&($scope.pages=this.getPages(this.page,$scope.totalPages))},$scope.selectPage=function(page){!self.isActive(page)&&page>0&&page<=$scope.totalPages&&($scope.page=page,$scope.onSelectPage({page:page}))},$scope.$watch("page",function(){self.render()}),$scope.$watch("totalItems",function(){$scope.totalPages=self.calculateTotalPages()}),$scope.$watch("totalPages",function(value){setNumPages($scope.$parent,value),self.page>value?$scope.selectPage(value):self.render()})}]).constant("paginationConfig",{itemsPerPage:10,boundaryLinks:!1,directionLinks:!0,firstText:"First",previousText:"Previous",nextText:"Next",lastText:"Last",rotate:!0}).directive("pagination",["$parse","paginationConfig",function($parse,config){return{restrict:"EA",scope:{page:"=",totalItems:"=",onSelectPage:" &"},controller:"PaginationController",templateUrl:"template/pagination/pagination.html",replace:!0,link:function(scope,element,attrs,paginationCtrl){function makePage(number,text,isActive,isDisabled){return{number:number,text:text,active:isActive,disabled:isDisabled}}var maxSize,boundaryLinks=paginationCtrl.getAttributeValue(attrs.boundaryLinks,config.boundaryLinks),directionLinks=paginationCtrl.getAttributeValue(attrs.directionLinks,config.directionLinks),firstText=paginationCtrl.getAttributeValue(attrs.firstText,config.firstText,!0),previousText=paginationCtrl.getAttributeValue(attrs.previousText,config.previousText,!0),nextText=paginationCtrl.getAttributeValue(attrs.nextText,config.nextText,!0),lastText=paginationCtrl.getAttributeValue(attrs.lastText,config.lastText,!0),rotate=paginationCtrl.getAttributeValue(attrs.rotate,config.rotate);paginationCtrl.init(config.itemsPerPage),attrs.maxSize&&scope.$parent.$watch($parse(attrs.maxSize),function(value){maxSize=parseInt(value,10),paginationCtrl.render()}),paginationCtrl.getPages=function(currentPage,totalPages){var pages=[],startPage=1,endPage=totalPages,isMaxSized=angular.isDefined(maxSize)&&totalPages>maxSize;isMaxSized&&(rotate?(startPage=Math.max(currentPage-Math.floor(maxSize/2),1),endPage=startPage+maxSize-1,endPage>totalPages&&(endPage=totalPages,startPage=endPage-maxSize+1)):(startPage=(Math.ceil(currentPage/maxSize)-1)*maxSize+1,endPage=Math.min(startPage+maxSize-1,totalPages)));for(var number=startPage;endPage>=number;number++){var page=makePage(number,number,paginationCtrl.isActive(number),!1);pages.push(page)}if(isMaxSized&&!rotate){if(startPage>1){var previousPageSet=makePage(startPage-1,"...",!1,!1);pages.unshift(previousPageSet)}if(totalPages>endPage){var nextPageSet=makePage(endPage+1,"...",!1,!1);pages.push(nextPageSet)}}if(directionLinks){var previousPage=makePage(currentPage-1,previousText,!1,paginationCtrl.noPrevious());pages.unshift(previousPage);var nextPage=makePage(currentPage+1,nextText,!1,paginationCtrl.noNext());pages.push(nextPage)}if(boundaryLinks){var firstPage=makePage(1,firstText,!1,paginationCtrl.noPrevious());pages.unshift(firstPage);var lastPage=makePage(totalPages,lastText,!1,paginationCtrl.noNext());pages.push(lastPage)}return pages}}}}]).constant("pagerConfig",{itemsPerPage:10,previousText:"\xab Previous",nextText:"Next \xbb",align:!0}).directive("pager",["pagerConfig",function(config){return{restrict:"EA",scope:{page:"=",totalItems:"=",onSelectPage:" &"},controller:"PaginationController",templateUrl:"template/pagination/pager.html",replace:!0,link:function(scope,element,attrs,paginationCtrl){function makePage(number,text,isDisabled,isPrevious,isNext){return{number:number,text:text,disabled:isDisabled,previous:align&&isPrevious,next:align&&isNext}}var previousText=paginationCtrl.getAttributeValue(attrs.previousText,config.previousText,!0),nextText=paginationCtrl.getAttributeValue(attrs.nextText,config.nextText,!0),align=paginationCtrl.getAttributeValue(attrs.align,config.align);paginationCtrl.init(config.itemsPerPage),paginationCtrl.getPages=function(currentPage){return[makePage(currentPage-1,previousText,paginationCtrl.noPrevious(),!0,!1),makePage(currentPage+1,nextText,paginationCtrl.noNext(),!1,!0)]}}}}]),angular.module("mm.foundation.tooltip",["mm.foundation.position","mm.foundation.bindHtml"]).provider("$tooltip",function(){function snake_case(name){var regexp=/[A-Z]/g,separator="-";return name.replace(regexp,function(letter,pos){return(pos?separator:"")+letter.toLowerCase()})}var defaultOptions={placement:"top",animation:!0,popupDelay:0},triggerMap={mouseenter:"mouseleave",click:"click",focus:"blur"},globalOptions={};this.options=function(value){angular.extend(globalOptions,value)},this.setTriggers=function(triggers){angular.extend(triggerMap,triggers)},this.$get=["$window","$compile","$timeout","$parse","$document","$position","$interpolate",function($window,$compile,$timeout,$parse,$document,$position,$interpolate){return function(type,prefix,defaultTriggerShow){function getTriggers(trigger){var show=trigger||options.trigger||defaultTriggerShow,hide=triggerMap[show]||show;return{show:show,hide:hide}}var options=angular.extend({},defaultOptions,globalOptions),directiveName=snake_case(type),startSym=$interpolate.startSymbol(),endSym=$interpolate.endSymbol(),template="<div "+directiveName+'-popup title="'+startSym+"tt_title"+endSym+'" content="'+startSym+"tt_content"+endSym+'" placement="'+startSym+"tt_placement"+endSym+'" animation="tt_animation" is-open="tt_isOpen"></div>';return{restrict:"EA",scope:!0,compile:function(){var tooltipLinker=$compile(template);return function(scope,element,attrs){function toggleTooltipBind(){scope.tt_isOpen?hideTooltipBind():showTooltipBind()}function showTooltipBind(){hasEnableExp&&!scope.$eval(attrs[prefix+"Enable"])||(scope.tt_popupDelay?(popupTimeout=$timeout(show,scope.tt_popupDelay,!1),popupTimeout.then(function(reposition){reposition()})):show()())}function hideTooltipBind(){scope.$apply(function(){hide()})}function show(){return scope.tt_content?(createTooltip(),transitionTimeout&&$timeout.cancel(transitionTimeout),tooltip.css({top:0,left:0,display:"block"}),appendToBody?$document.find("body").append(tooltip):element.after(tooltip),positionTooltip(),scope.tt_isOpen=!0,scope.$digest(),positionTooltip):angular.noop}function hide(){scope.tt_isOpen=!1,$timeout.cancel(popupTimeout),scope.tt_animation?transitionTimeout=$timeout(removeTooltip,500):removeTooltip()}function createTooltip(){tooltip&&removeTooltip(),tooltip=tooltipLinker(scope,function(){}),scope.$digest()}function removeTooltip(){tooltip&&(tooltip.remove(),tooltip=null)}var tooltip,transitionTimeout,popupTimeout,appendToBody=angular.isDefined(options.appendToBody)?options.appendToBody:!1,triggers=getTriggers(void 0),hasRegisteredTriggers=!1,hasEnableExp=angular.isDefined(attrs[prefix+"Enable"]),positionTooltip=function(){var position,ttWidth,ttHeight,ttPosition;switch(position=appendToBody?$position.offset(element):$position.position(element),ttWidth=tooltip.prop("offsetWidth"),ttHeight=tooltip.prop("offsetHeight"),scope.tt_placement){case"right":ttPosition={top:position.top+position.height/2-ttHeight/2,left:position.left+position.width+10};break;case"bottom":ttPosition={top:position.top+position.height+10,left:position.left};break;case"left":ttPosition={top:position.top+position.height/2-ttHeight/2,left:position.left-ttWidth-10};break;default:ttPosition={top:position.top-ttHeight-10,left:position.left}}ttPosition.top+="px",ttPosition.left+="px",tooltip.css(ttPosition)};scope.tt_isOpen=!1,attrs.$observe(type,function(val){scope.tt_content=val,!val&&scope.tt_isOpen&&hide()}),attrs.$observe(prefix+"Title",function(val){scope.tt_title=val}),attrs.$observe(prefix+"Placement",function(val){scope.tt_placement=angular.isDefined(val)?val:options.placement}),attrs.$observe(prefix+"PopupDelay",function(val){var delay=parseInt(val,10);scope.tt_popupDelay=isNaN(delay)?options.popupDelay:delay});var unregisterTriggers=function(){hasRegisteredTriggers&&(element.unbind(triggers.show,showTooltipBind),element.unbind(triggers.hide,hideTooltipBind))},unregisterTriggerFunction=function(){};attrs.$observe(prefix+"Trigger",function(val){unregisterTriggers(),unregisterTriggerFunction(),triggers=getTriggers(val),angular.isFunction(triggers.show)?unregisterTriggerFunction=scope.$watch(function(){return triggers.show(scope,element,attrs)},function(val){return $timeout(val?show:hide)}):triggers.show===triggers.hide?element.bind(triggers.show,toggleTooltipBind):(element.bind(triggers.show,showTooltipBind),element.bind(triggers.hide,hideTooltipBind)),hasRegisteredTriggers=!0});var animation=scope.$eval(attrs[prefix+"Animation"]);scope.tt_animation=angular.isDefined(animation)?!!animation:options.animation,attrs.$observe(prefix+"AppendToBody",function(val){appendToBody=angular.isDefined(val)?$parse(val)(scope):appendToBody}),appendToBody&&scope.$on("$locationChangeSuccess",function(){scope.tt_isOpen&&hide()}),scope.$on("$destroy",function(){$timeout.cancel(transitionTimeout),$timeout.cancel(popupTimeout),unregisterTriggers(),unregisterTriggerFunction(),removeTooltip()})}}}}}]}).directive("tooltipPopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-popup.html"}}).directive("tooltip",["$tooltip",function($tooltip){return $tooltip("tooltip","tooltip","mouseenter")}]).directive("tooltipHtmlUnsafePopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-html-unsafe-popup.html"}}).directive("tooltipHtmlUnsafe",["$tooltip",function($tooltip){return $tooltip("tooltipHtmlUnsafe","tooltip","mouseenter")}]),angular.module("mm.foundation.popover",["mm.foundation.tooltip"]).directive("popoverPopup",function(){return{restrict:"EA",replace:!0,scope:{title:"@",content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/popover/popover.html"}}).directive("popover",["$tooltip",function($tooltip){return $tooltip("popover","popover","click")}]),angular.module("mm.foundation.progressbar",["mm.foundation.transition"]).constant("progressConfig",{animate:!0,max:100}).controller("ProgressController",["$scope","$attrs","progressConfig","$transition",function($scope,$attrs,progressConfig,$transition){var self=this,bars=[],max=angular.isDefined($attrs.max)?$scope.$parent.$eval($attrs.max):progressConfig.max,animate=angular.isDefined($attrs.animate)?$scope.$parent.$eval($attrs.animate):progressConfig.animate;this.addBar=function(bar,element){var oldValue=0,index=bar.$parent.$index;angular.isDefined(index)&&bars[index]&&(oldValue=bars[index].value),bars.push(bar),this.update(element,bar.value,oldValue),bar.$watch("value",function(value,oldValue){value!==oldValue&&self.update(element,value,oldValue)}),bar.$on("$destroy",function(){self.removeBar(bar)})},this.update=function(element,newValue,oldValue){var percent=this.getPercentage(newValue);animate?(element.css("width",this.getPercentage(oldValue)+"%"),$transition(element,{width:percent+"%"})):element.css({transition:"none",width:percent+"%"})},this.removeBar=function(bar){bars.splice(bars.indexOf(bar),1)},this.getPercentage=function(value){return Math.round(100*value/max)}}]).directive("progress",function(){return{restrict:"EA",replace:!0,transclude:!0,controller:"ProgressController",require:"progress",scope:{},template:'<div class="progress" ng-transclude></div>'}}).directive("bar",function(){return{restrict:"EA",replace:!0,transclude:!0,require:"^progress",scope:{value:"=",type:"@"},templateUrl:"template/progressbar/bar.html",link:function(scope,element,attrs,progressCtrl){progressCtrl.addBar(scope,element)}}}).directive("progressbar",function(){return{restrict:"EA",replace:!0,transclude:!0,controller:"ProgressController",scope:{value:"=",type:"@"},templateUrl:"template/progressbar/progressbar.html",link:function(scope,element,attrs,progressCtrl){progressCtrl.addBar(scope,angular.element(element.children()[0]))}}}),angular.module("mm.foundation.rating",[]).constant("ratingConfig",{max:5,stateOn:null,stateOff:null}).controller("RatingController",["$scope","$attrs","$parse","ratingConfig",function($scope,$attrs,$parse,ratingConfig){this.maxRange=angular.isDefined($attrs.max)?$scope.$parent.$eval($attrs.max):ratingConfig.max,this.stateOn=angular.isDefined($attrs.stateOn)?$scope.$parent.$eval($attrs.stateOn):ratingConfig.stateOn,this.stateOff=angular.isDefined($attrs.stateOff)?$scope.$parent.$eval($attrs.stateOff):ratingConfig.stateOff,this.createRateObjects=function(states){for(var defaultOptions={stateOn:this.stateOn,stateOff:this.stateOff},i=0,n=states.length;n>i;i++)states[i]=angular.extend({index:i},defaultOptions,states[i]);return states},$scope.range=angular.isDefined($attrs.ratingStates)?this.createRateObjects(angular.copy($scope.$parent.$eval($attrs.ratingStates))):this.createRateObjects(new Array(this.maxRange)),$scope.rate=function(value){$scope.value===value||$scope.readonly||($scope.value=value)},$scope.enter=function(value){$scope.readonly||($scope.val=value),$scope.onHover({value:value})},$scope.reset=function(){$scope.val=angular.copy($scope.value),$scope.onLeave()},$scope.$watch("value",function(value){$scope.val=value}),$scope.readonly=!1,$attrs.readonly&&$scope.$parent.$watch($parse($attrs.readonly),function(value){$scope.readonly=!!value})}]).directive("rating",function(){return{restrict:"EA",scope:{value:"=",onHover:"&",onLeave:"&"},controller:"RatingController",templateUrl:"template/rating/rating.html",replace:!0}}),angular.module("mm.foundation.tabs",[]).controller("TabsetController",["$scope",function($scope){var ctrl=this,tabs=ctrl.tabs=$scope.tabs=[];ctrl.select=function(tab){angular.forEach(tabs,function(tab){tab.active=!1}),tab.active=!0},ctrl.addTab=function(tab){tabs.push(tab),(1===tabs.length||tab.active)&&ctrl.select(tab)},ctrl.removeTab=function(tab){var index=tabs.indexOf(tab);if(tab.active&&tabs.length>1){var newActiveIndex=index==tabs.length-1?index-1:index+1;ctrl.select(tabs[newActiveIndex])}tabs.splice(index,1)}}]).directive("tabset",function(){return{restrict:"EA",transclude:!0,replace:!0,scope:{},controller:"TabsetController",templateUrl:"template/tabs/tabset.html",link:function(scope,element,attrs){scope.vertical=angular.isDefined(attrs.vertical)?scope.$parent.$eval(attrs.vertical):!1,scope.justified=angular.isDefined(attrs.justified)?scope.$parent.$eval(attrs.justified):!1,scope.type=angular.isDefined(attrs.type)?scope.$parent.$eval(attrs.type):"tabs"}}}).directive("tab",["$parse",function($parse){return{require:"^tabset",restrict:"EA",replace:!0,templateUrl:"template/tabs/tab.html",transclude:!0,scope:{heading:"@",onSelect:"&select",onDeselect:"&deselect"},controller:function(){},compile:function(elm,attrs,transclude){return function(scope,elm,attrs,tabsetCtrl){var getActive,setActive;attrs.active?(getActive=$parse(attrs.active),setActive=getActive.assign,scope.$parent.$watch(getActive,function(value,oldVal){value!==oldVal&&(scope.active=!!value)}),scope.active=getActive(scope.$parent)):setActive=getActive=angular.noop,scope.$watch("active",function(active){setActive(scope.$parent,active),active?(tabsetCtrl.select(scope),scope.onSelect()):scope.onDeselect()}),scope.disabled=!1,attrs.disabled&&scope.$parent.$watch($parse(attrs.disabled),function(value){scope.disabled=!!value}),scope.select=function(){scope.disabled||(scope.active=!0)},tabsetCtrl.addTab(scope),scope.$on("$destroy",function(){tabsetCtrl.removeTab(scope)}),scope.$transcludeFn=transclude}}}}]).directive("tabHeadingTransclude",[function(){return{restrict:"A",require:"^tab",link:function(scope,elm){scope.$watch("headingElement",function(heading){heading&&(elm.html(""),elm.append(heading))})}}}]).directive("tabContentTransclude",function(){function isTabHeading(node){return node.tagName&&(node.hasAttribute("tab-heading")||node.hasAttribute("data-tab-heading")||"tab-heading"===node.tagName.toLowerCase()||"data-tab-heading"===node.tagName.toLowerCase())}return{restrict:"A",require:"^tabset",link:function(scope,elm,attrs){var tab=scope.$eval(attrs.tabContentTransclude);tab.$transcludeFn(tab.$parent,function(contents){angular.forEach(contents,function(node){isTabHeading(node)?tab.headingElement=node:elm.append(node)})})}}}),angular.module("mm.foundation.tour",["mm.foundation.position","mm.foundation.tooltip"]).service("$tour",["$window",function($window){function getCurrentStep(){return parseInt($window.localStorage.getItem("mm.tour.step"),10)}function setCurrentStep(step){currentIndex=step,$window.localStorage.setItem("mm.tour.step",step)}var currentIndex=getCurrentStep(),steps={};this.add=function(index,attrs){steps[index]=attrs},this.has=function(index){return!!steps[index]},this.isActive=function(){return currentIndex>0},this.current=function(index){return index?void setCurrentStep(currentIndex):currentIndex},this.start=function(){setCurrentStep(1)},this.next=function(){setCurrentStep(currentIndex+1)},this.end=function(){setCurrentStep(0)}}]).directive("stepPopup",["$tour",function($tour){return{restrict:"EA",replace:!0,scope:{title:"@",content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tour/tour.html",link:function(scope,element){scope.isLastStep=function(){return!$tour.has($tour.current()+1)},scope.endTour=function(){element.remove(),$tour.end()},scope.nextStep=function(){element.remove(),$tour.next()}}}}]).directive("step",["$position","$tooltip","$tour","$window",function($position,$tooltip,$tour,$window){function isElementInViewport(element){var rect=element[0].getBoundingClientRect();return rect.top>=0&&rect.left>=0&&rect.bottom<=$window.innerHeight-80&&rect.right<=$window.innerWidth}function show(scope,element,attrs){var index=parseInt(attrs.stepIndex,10);if($tour.isActive()&&index&&($tour.add(index,attrs),index===$tour.current())){if(!isElementInViewport(element)){var offset=$position.offset(element);$window.scrollTo(0,offset.top-$window.innerHeight/2)}return!0}return!1}return $tooltip("step","step",show)}]),angular.module("mm.foundation.typeahead",["mm.foundation.position","mm.foundation.bindHtml"]).factory("typeaheadParser",["$parse",function($parse){var TYPEAHEAD_REGEXP=/^\s*(.*?)(?:\s+as\s+(.*?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+(.*)$/;return{parse:function(input){var match=input.match(TYPEAHEAD_REGEXP);if(!match)throw new Error("Expected typeahead specification in form of '_modelValue_ (as _label_)? for _item_ in _collection_' but got '"+input+"'.");return{itemName:match[3],source:$parse(match[4]),viewMapper:$parse(match[2]||match[1]),modelMapper:$parse(match[1])}}}}]).directive("typeahead",["$compile","$parse","$q","$timeout","$document","$position","typeaheadParser",function($compile,$parse,$q,$timeout,$document,$position,typeaheadParser){var HOT_KEYS=[9,13,27,38,40];return{require:"ngModel",link:function(originalScope,element,attrs,modelCtrl){var hasFocus,minSearch=originalScope.$eval(attrs.typeaheadMinLength)||1,waitTime=originalScope.$eval(attrs.typeaheadWaitMs)||0,isEditable=originalScope.$eval(attrs.typeaheadEditable)!==!1,isLoadingSetter=$parse(attrs.typeaheadLoading).assign||angular.noop,onSelectCallback=$parse(attrs.typeaheadOnSelect),inputFormatter=attrs.typeaheadInputFormatter?$parse(attrs.typeaheadInputFormatter):void 0,appendToBody=attrs.typeaheadAppendToBody?$parse(attrs.typeaheadAppendToBody):!1,$setModelValue=$parse(attrs.ngModel).assign,parserResult=typeaheadParser.parse(attrs.typeahead),popUpEl=angular.element("<div typeahead-popup></div>");popUpEl.attr({matches:"matches",active:"activeIdx",select:"select(activeIdx)",query:"query",position:"position"}),angular.isDefined(attrs.typeaheadTemplateUrl)&&popUpEl.attr("template-url",attrs.typeaheadTemplateUrl);var scope=originalScope.$new();originalScope.$on("$destroy",function(){scope.$destroy()});var resetMatches=function(){scope.matches=[],scope.activeIdx=-1},getMatchesAsync=function(inputValue){var locals={$viewValue:inputValue};isLoadingSetter(originalScope,!0),$q.when(parserResult.source(originalScope,locals)).then(function(matches){if(inputValue===modelCtrl.$viewValue&&hasFocus){if(matches.length>0){scope.activeIdx=0,scope.matches.length=0;for(var i=0;i<matches.length;i++)locals[parserResult.itemName]=matches[i],scope.matches.push({label:parserResult.viewMapper(scope,locals),model:matches[i]});scope.query=inputValue,scope.position=appendToBody?$position.offset(element):$position.position(element),scope.position.top=scope.position.top+element.prop("offsetHeight")}else resetMatches();isLoadingSetter(originalScope,!1)}},function(){resetMatches(),isLoadingSetter(originalScope,!1)})};resetMatches(),scope.query=void 0;var timeoutPromise;modelCtrl.$parsers.unshift(function(inputValue){return hasFocus=!0,inputValue&&inputValue.length>=minSearch?waitTime>0?(timeoutPromise&&$timeout.cancel(timeoutPromise),timeoutPromise=$timeout(function(){getMatchesAsync(inputValue)},waitTime)):getMatchesAsync(inputValue):(isLoadingSetter(originalScope,!1),resetMatches()),isEditable?inputValue:inputValue?void modelCtrl.$setValidity("editable",!1):(modelCtrl.$setValidity("editable",!0),inputValue)}),modelCtrl.$formatters.push(function(modelValue){var candidateViewValue,emptyViewValue,locals={};return inputFormatter?(locals.$model=modelValue,inputFormatter(originalScope,locals)):(locals[parserResult.itemName]=modelValue,
candidateViewValue=parserResult.viewMapper(originalScope,locals),locals[parserResult.itemName]=void 0,emptyViewValue=parserResult.viewMapper(originalScope,locals),candidateViewValue!==emptyViewValue?candidateViewValue:modelValue)}),scope.select=function(activeIdx){var model,item,locals={};locals[parserResult.itemName]=item=scope.matches[activeIdx].model,model=parserResult.modelMapper(originalScope,locals),$setModelValue(originalScope,model),modelCtrl.$setValidity("editable",!0),onSelectCallback(originalScope,{$item:item,$model:model,$label:parserResult.viewMapper(originalScope,locals)}),resetMatches(),element[0].focus()},element.bind("keydown",function(evt){0!==scope.matches.length&&-1!==HOT_KEYS.indexOf(evt.which)&&(evt.preventDefault(),40===evt.which?(scope.activeIdx=(scope.activeIdx+1)%scope.matches.length,scope.$digest()):38===evt.which?(scope.activeIdx=(scope.activeIdx?scope.activeIdx:scope.matches.length)-1,scope.$digest()):13===evt.which||9===evt.which?scope.$apply(function(){scope.select(scope.activeIdx)}):27===evt.which&&(evt.stopPropagation(),resetMatches(),scope.$digest()))}),element.bind("blur",function(){hasFocus=!1});var dismissClickHandler=function(evt){element[0]!==evt.target&&(resetMatches(),scope.$digest())};$document.bind("click",dismissClickHandler),originalScope.$on("$destroy",function(){$document.unbind("click",dismissClickHandler)});var $popup=$compile(popUpEl)(scope);appendToBody?$document.find("body").append($popup):element.after($popup)}}}]).directive("typeaheadPopup",function(){return{restrict:"EA",scope:{matches:"=",query:"=",active:"=",position:"=",select:"&"},replace:!0,templateUrl:"template/typeahead/typeahead-popup.html",link:function(scope,element,attrs){scope.templateUrl=attrs.templateUrl,scope.isOpen=function(){return scope.matches.length>0},scope.isActive=function(matchIdx){return scope.active==matchIdx},scope.selectActive=function(matchIdx){scope.active=matchIdx},scope.selectMatch=function(activeIdx){scope.select({activeIdx:activeIdx})}}}}).directive("typeaheadMatch",["$http","$templateCache","$compile","$parse",function($http,$templateCache,$compile,$parse){return{restrict:"EA",scope:{index:"=",match:"=",query:"="},link:function(scope,element,attrs){var tplUrl=$parse(attrs.templateUrl)(scope.$parent)||"template/typeahead/typeahead-match.html";$http.get(tplUrl,{cache:$templateCache}).success(function(tplContent){element.replaceWith($compile(tplContent.trim())(scope))})}}}]).filter("typeaheadHighlight",function(){function escapeRegexp(queryToEscape){return queryToEscape.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(matchItem,query){return query?matchItem.replace(new RegExp(escapeRegexp(query),"gi"),"<strong>$&</strong>"):matchItem}}),angular.module("template/accordion/accordion-group.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/accordion/accordion-group.html",'<dd>\n  <a ng-click="isOpen = !isOpen" accordion-transclude="heading">{{heading}}</a>\n  <div class="content" ng-style="isOpen ? {display: \'block\'} : {}" ng-transclude></div>\n</dd>\n')}]),angular.module("template/accordion/accordion.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/accordion/accordion.html",'<dl class="accordion" ng-transclude></div>\n')}]),angular.module("template/alert/alert.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/alert/alert.html","<div class='alert-box' ng-class='(type || \"\")'>\n  <span ng-transclude></span>\n  <a ng-show='closeable' class='close' ng-click='close()'>&times;</a>\n</div>\n")}]),angular.module("template/modal/backdrop.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/modal/backdrop.html",'<div class="reveal-modal-bg fade" ng-class="{in: animate}" ng-click="close($event)" style="display: block"></div>\n')}]),angular.module("template/modal/window.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/modal/window.html",'<div tabindex="-1" class="reveal-modal fade {{ windowClass }}"\n  ng-class="{in: animate}" ng-click="close($event)"\n  style="display: block; position: fixed; visibility: visible">\n  <div ng-transclude></div>\n</div>\n')}]),angular.module("template/pagination/pager.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/pagination/pager.html",'<ul class="pagination">\n  <li ng-repeat="page in pages" class="arrow" ng-class="{unavailable: page.disabled, left: page.previous, right: page.next}"><a ng-click="selectPage(page.number)">{{page.text}}</a></li>\n</ul>\n')}]),angular.module("template/pagination/pagination.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/pagination/pagination.html",'<ul class="pagination">\n  <li ng-repeat="page in pages" ng-class="{arrow: $first || $last, current: page.active, unavailable: page.disabled}"><a ng-click="selectPage(page.number)">{{page.text}}</a></li>\n</ul>\n')}]),angular.module("template/tooltip/tooltip-html-unsafe-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-html-unsafe-popup.html",'<span class="tooltip tip-{{placement}}"\n  ng-class="{ in: isOpen(), fade: animation() }"\n  style="width: auto">\n  <span bind-html-unsafe="content"></span>\n  <span class="nub"></span>\n</span>\n')}]),angular.module("template/tooltip/tooltip-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-popup.html",'<span class="tooltip tip-{{placement}}"\n  ng-class="{ in: isOpen(), fade: animation() }"\n  style="width: auto">\n  <span ng-bind="content"></span>\n  <span class="nub"></span>\n</span>\n')}]),angular.module("template/popover/popover.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/popover/popover.html",'<div class="joyride-tip-guide" ng-class="{ in: isOpen(), fade: animation() }">\n  <span class="joyride-nub" ng-class="{\n    bottom: placement === \'top\',\n    left: placement === \'right\',\n    right: placement === \'left\',\n    top: placement === \'bottom\'\n  }"></span>\n  <div class="joyride-content-wrapper">\n    <h4 ng-bind="title" ng-show="title"></h4>\n    <p ng-bind="content"></p>\n  </div>\n</div>\n')}]),angular.module("template/progressbar/bar.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/progressbar/bar.html",'<span class="meter" ng-transclude></span>\n')}]),angular.module("template/progressbar/progress.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/progressbar/progress.html",'<div class="progress" ng-class="type" ng-transclude></div>\n')}]),angular.module("template/progressbar/progressbar.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/progressbar/progressbar.html",'<div class="progress" ng-class="type">\n  <span class="meter" ng-transclude></span>\n</div>\n')}]),angular.module("template/rating/rating.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/rating/rating.html",'<span ng-mouseleave="reset()">\n  <i ng-repeat="r in range" ng-mouseenter="enter($index + 1)" ng-click="rate($index + 1)" class="fa"\n    ng-class="$index < val && (r.stateOn || \'fa-star\') || (r.stateOff || \'fa-star-o\')"></i>\n</span>\n')}]),angular.module("template/tabs/tab.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tabs/tab.html",'<dd ng-class="{active: active}">\n  <a ng-click="select()" tab-heading-transclude>{{heading}}</a>\n</dd>\n')}]),angular.module("template/tabs/tabset.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tabs/tabset.html",'<div class="tabbable">\n  <dl class="tabs" ng-class="{\'vertical\': vertical}" ng-transclude></dl>\n  <div class="tabs-content">\n    <div class="content" \n      ng-repeat="tab in tabs" \n      ng-class="{active: tab.active}">\n      <div tab-content-transclude="tab"></div>\n    </div>\n  </div>\n</div>\n')}]),angular.module("template/tour/tour.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tour/tour.html",'<div class="joyride-tip-guide" ng-class="{ in: isOpen(), fade: animation() }">\n  <span class="joyride-nub" ng-class="{\n    bottom: placement === \'top\',\n    left: placement === \'right\',\n    right: placement === \'left\',\n    top: placement === \'bottom\'\n  }"></span>\n  <div class="joyride-content-wrapper">\n    <h4 ng-bind="title" ng-show="title"></h4>\n    <p ng-bind="content"></p>\n    <a class="small button joyride-next-tip" ng-show="!isLastStep()" ng-click="nextStep()">Next</a>\n    <a class="small button joyride-next-tip" ng-show="isLastStep()" ng-click="endTour()">End</a>\n    <a class="joyride-close-tip" ng-click="endTour()">&times;</a>\n  </div>\n</div>\n')}]),angular.module("template/typeahead/typeahead-match.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/typeahead/typeahead-match.html",'<a tabindex="-1" bind-html-unsafe="match.label | typeaheadHighlight:query"></a>')}]),angular.module("template/typeahead/typeahead-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/typeahead/typeahead-popup.html","<ul class=\"f-dropdown\" ng-style=\"{display: isOpen()&&'block' || 'none', top: position.top+'px', left: position.left+'px'}\">\n"+'    <li ng-repeat="match in matches" ng-class="{active: isActive($index) }" ng-mouseenter="selectActive($index)" ng-click="selectMatch($index)">\n        <div typeahead-match index="$index" match="match" query="query" template-url="templateUrl"></div>\n    </li>\n</ul>\n')}]),function(angular,factory){"use strict";return"function"==typeof define&&define.amd?void define("ngStorage",["angular"],function(angular){return factory(angular)}):factory(angular)}("undefined"==typeof angular?null:angular,function(angular){"use strict";function _storageFactory(storageType){return["$rootScope","$window","$log","$timeout",function($rootScope,$window,$log,$timeout){function isStorageSupported(storageType){var supported;try{supported=$window[storageType]}catch(err){supported=!1}if(supported&&"localStorage"===storageType){var key="__"+Math.round(1e7*Math.random());try{localStorage.setItem(key,key),localStorage.removeItem(key)}catch(err){supported=!1}}return supported}var _last$storage,_debounce,webStorage=isStorageSupported(storageType)||($log.warn("This browser does not support Web Storage!"),{setItem:function(){},getItem:function(){}}),$storage={$default:function(items){for(var k in items)angular.isDefined($storage[k])||($storage[k]=items[k]);return $storage},$reset:function(items){for(var k in $storage)"$"===k[0]||delete $storage[k]&&webStorage.removeItem("ngStorage-"+k);return $storage.$default(items)}};try{webStorage=$window[storageType],webStorage.length}catch(e){$log.warn("This browser does not support Web Storage!"),webStorage={}}for(var k,i=0,l=webStorage.length;l>i;i++)(k=webStorage.key(i))&&"ngStorage-"===k.slice(0,10)&&($storage[k.slice(10)]=angular.fromJson(webStorage.getItem(k)));return _last$storage=angular.copy($storage),$rootScope.$watch(function(){var temp$storage;_debounce||(_debounce=$timeout(function(){if(_debounce=null,!angular.equals($storage,_last$storage)){temp$storage=angular.copy(_last$storage),angular.forEach($storage,function(v,k){angular.isDefined(v)&&"$"!==k[0]&&webStorage.setItem("ngStorage-"+k,angular.toJson(v)),delete temp$storage[k]});for(var k in temp$storage)webStorage.removeItem("ngStorage-"+k);_last$storage=angular.copy($storage)}},100,!1))}),"localStorage"===storageType&&$window.addEventListener&&$window.addEventListener("storage",function(event){"ngStorage-"===event.key.slice(0,10)&&(event.newValue?$storage[event.key.slice(10)]=angular.fromJson(event.newValue):delete $storage[event.key.slice(10)],_last$storage=angular.copy($storage),$rootScope.$apply())}),$storage}]}angular.module("ngStorage",[]).factory("$localStorage",_storageFactory("localStorage")).factory("$sessionStorage",_storageFactory("sessionStorage"))}),/*!
 * AngularFire is the officially supported AngularJS binding for Firebase. Firebase
 * is a full backend so you don't need servers to build your Angular app. AngularFire
 * provides you with the $firebase service which allows you to easily keep your $scope
 * variables in sync with your Firebase backend.
 *
 * AngularFire 1.2.0
 * https://github.com/firebase/angularfire/
 * Date: 03/28/2016
 * License: MIT
 */
function(exports){"use strict";angular.module("firebase",[]).value("Firebase",exports.Firebase)}(window),function(){"use strict";angular.module("firebase").factory("$firebaseArray",["$log","$firebaseUtils","$q",function($log,$firebaseUtils,$q){function FirebaseArray(ref){if(!(this instanceof FirebaseArray))return new FirebaseArray(ref);var self=this;return this._observers=[],this.$list=[],this._ref=ref,this._sync=new ArraySyncManager(this),$firebaseUtils.assertValidRef(ref,"Must pass a valid Firebase reference to $firebaseArray (not a string or URL)"),this._indexCache={},$firebaseUtils.getPublicMethods(self,function(fn,key){self.$list[key]=fn.bind(self)}),this._sync.init(this.$list),this.$list}function ArraySyncManager(firebaseArray){function destroy(err){if(!sync.isDestroyed){sync.isDestroyed=!0;var ref=firebaseArray.$ref();ref.off("child_added",created),ref.off("child_moved",moved),ref.off("child_changed",updated),ref.off("child_removed",removed),firebaseArray=null,initComplete(err||"destroyed")}}function init($list){var ref=firebaseArray.$ref();ref.on("child_added",created,error),ref.on("child_moved",moved,error),ref.on("child_changed",updated,error),ref.on("child_removed",removed,error),ref.once("value",function(snap){angular.isArray(snap.val())&&$log.warn("Storing data using array indices in Firebase can result in unexpected behavior. See https://www.firebase.com/docs/web/guide/understanding-data.html#section-arrays-in-firebase for more information."),initComplete(null,$list)},initComplete)}function _initComplete(err,result){isResolved||(isResolved=!0,err?def.reject(err):def.resolve(result))}function waitForResolution(maybePromise,callback){var promise=$q.when(maybePromise);promise.then(function(result){result&&callback(result)}),isResolved||resolutionPromises.push(promise)}var def=$firebaseUtils.defer(),created=function(snap,prevChild){waitForResolution(firebaseArray.$$added(snap,prevChild),function(rec){firebaseArray.$$process("child_added",rec,prevChild)})},updated=function(snap){var rec=firebaseArray.$getRecord($firebaseUtils.getKey(snap));rec&&waitForResolution(firebaseArray.$$updated(snap),function(){firebaseArray.$$process("child_changed",rec)})},moved=function(snap,prevChild){var rec=firebaseArray.$getRecord($firebaseUtils.getKey(snap));rec&&waitForResolution(firebaseArray.$$moved(snap,prevChild),function(){firebaseArray.$$process("child_moved",rec,prevChild)})},removed=function(snap){var rec=firebaseArray.$getRecord($firebaseUtils.getKey(snap));rec&&waitForResolution(firebaseArray.$$removed(snap),function(){firebaseArray.$$process("child_removed",rec)})},resolutionPromises=[],isResolved=!1,error=$firebaseUtils.batch(function(err){_initComplete(err),firebaseArray&&firebaseArray.$$error(err)}),initComplete=$firebaseUtils.batch(_initComplete),sync={destroy:destroy,isDestroyed:!1,init:init,ready:function(){return def.promise.then(function(result){return $q.all(resolutionPromises).then(function(){return result})})}};return sync}return FirebaseArray.prototype={$add:function(data){this._assertNotDestroyed("$add");var def=$firebaseUtils.defer(),ref=this.$ref().ref().push();return ref.set($firebaseUtils.toJSON(data),$firebaseUtils.makeNodeResolver(def)),def.promise.then(function(){return ref})},$save:function(indexOrItem){this._assertNotDestroyed("$save");var self=this,item=self._resolveItem(indexOrItem),key=self.$keyAt(item);if(null!==key){var ref=self.$ref().ref().child(key),data=$firebaseUtils.toJSON(item);return $firebaseUtils.doSet(ref,data).then(function(){return self.$$notify("child_changed",key),ref})}return $firebaseUtils.reject("Invalid record; could determine key for "+indexOrItem)},$remove:function(indexOrItem){this._assertNotDestroyed("$remove");var key=this.$keyAt(indexOrItem);if(null!==key){var ref=this.$ref().ref().child(key);return $firebaseUtils.doRemove(ref).then(function(){return ref})}return $firebaseUtils.reject("Invalid record; could not determine key for "+indexOrItem)},$keyAt:function(indexOrItem){var item=this._resolveItem(indexOrItem);return this.$$getKey(item)},$indexFor:function(key){var self=this,cache=self._indexCache;if(!cache.hasOwnProperty(key)||self.$keyAt(cache[key])!==key){var pos=self.$list.findIndex(function(rec){return self.$$getKey(rec)===key});-1!==pos&&(cache[key]=pos)}return cache.hasOwnProperty(key)?cache[key]:-1},$loaded:function(resolve,reject){var promise=this._sync.ready();return arguments.length&&(promise=promise.then.call(promise,resolve,reject)),promise},$ref:function(){return this._ref},$watch:function(cb,context){var list=this._observers;return list.push([cb,context]),function(){var i=list.findIndex(function(parts){return parts[0]===cb&&parts[1]===context});i>-1&&list.splice(i,1)}},$destroy:function(err){this._isDestroyed||(this._isDestroyed=!0,this._sync.destroy(err),this.$list.length=0)},$getRecord:function(key){var i=this.$indexFor(key);return i>-1?this.$list[i]:null},$$added:function(snap){var i=this.$indexFor($firebaseUtils.getKey(snap));if(-1===i){var rec=snap.val();return angular.isObject(rec)||(rec={$value:rec}),rec.$id=$firebaseUtils.getKey(snap),rec.$priority=snap.getPriority(),$firebaseUtils.applyDefaults(rec,this.$$defaults),rec}return!1},$$removed:function(snap){return this.$indexFor($firebaseUtils.getKey(snap))>-1},$$updated:function(snap){var changed=!1,rec=this.$getRecord($firebaseUtils.getKey(snap));return angular.isObject(rec)&&(changed=$firebaseUtils.updateRec(rec,snap),$firebaseUtils.applyDefaults(rec,this.$$defaults)),changed},$$moved:function(snap){var rec=this.$getRecord($firebaseUtils.getKey(snap));return angular.isObject(rec)?(rec.$priority=snap.getPriority(),!0):!1},$$error:function(err){$log.error(err),this.$destroy(err)},$$getKey:function(rec){return angular.isObject(rec)?rec.$id:null},$$process:function(event,rec,prevChild){var curPos,key=this.$$getKey(rec),changed=!1;switch(event){case"child_added":curPos=this.$indexFor(key);break;case"child_moved":curPos=this.$indexFor(key),this._spliceOut(key);break;case"child_removed":changed=null!==this._spliceOut(key);break;case"child_changed":changed=!0;break;default:throw new Error("Invalid event type: "+event)}return angular.isDefined(curPos)&&(changed=this._addAfter(rec,prevChild)!==curPos),changed&&this.$$notify(event,key,prevChild),changed},$$notify:function(event,key,prevChild){var eventData={event:event,key:key};angular.isDefined(prevChild)&&(eventData.prevChild=prevChild),angular.forEach(this._observers,function(parts){parts[0].call(parts[1],eventData)})},_addAfter:function(rec,prevChild){var i;return null===prevChild?i=0:(i=this.$indexFor(prevChild)+1,0===i&&(i=this.$list.length)),this.$list.splice(i,0,rec),this._indexCache[this.$$getKey(rec)]=i,i},_spliceOut:function(key){var i=this.$indexFor(key);return i>-1?(delete this._indexCache[key],this.$list.splice(i,1)[0]):null},_resolveItem:function(indexOrItem){var list=this.$list;if(angular.isNumber(indexOrItem)&&indexOrItem>=0&&list.length>=indexOrItem)return list[indexOrItem];if(angular.isObject(indexOrItem)){var key=this.$$getKey(indexOrItem),rec=this.$getRecord(key);return rec===indexOrItem?rec:null}return null},_assertNotDestroyed:function(method){if(this._isDestroyed)throw new Error("Cannot call "+method+" method on a destroyed $firebaseArray object")}},FirebaseArray.$extend=function(ChildClass,methods){return 1===arguments.length&&angular.isObject(ChildClass)&&(methods=ChildClass,ChildClass=function(ref){return this instanceof ChildClass?(FirebaseArray.apply(this,arguments),this.$list):new ChildClass(ref)}),$firebaseUtils.inherit(ChildClass,FirebaseArray,methods)},FirebaseArray}]),angular.module("firebase").factory("$FirebaseArray",["$log","$firebaseArray",function($log,$firebaseArray){return function(){return $log.warn("$FirebaseArray has been renamed. Use $firebaseArray instead."),$firebaseArray.apply(null,arguments)}}])}(),function(){"use strict";var FirebaseAuth;angular.module("firebase").factory("$firebaseAuth",["$q","$firebaseUtils",function($q,$firebaseUtils){return function(ref){var auth=new FirebaseAuth($q,$firebaseUtils,ref);return auth.construct()}}]),FirebaseAuth=function($q,$firebaseUtils,ref){if(this._q=$q,this._utils=$firebaseUtils,"string"==typeof ref)throw new Error("Please provide a Firebase reference instead of a URL when creating a `$firebaseAuth` object.");this._ref=ref,this._initialAuthResolver=this._initAuthResolver()},FirebaseAuth.prototype={construct:function(){return this._object={$authWithCustomToken:this.authWithCustomToken.bind(this),$authAnonymously:this.authAnonymously.bind(this),$authWithPassword:this.authWithPassword.bind(this),$authWithOAuthPopup:this.authWithOAuthPopup.bind(this),$authWithOAuthRedirect:this.authWithOAuthRedirect.bind(this),$authWithOAuthToken:this.authWithOAuthToken.bind(this),$unauth:this.unauth.bind(this),$onAuth:this.onAuth.bind(this),$getAuth:this.getAuth.bind(this),$requireAuth:this.requireAuth.bind(this),$waitForAuth:this.waitForAuth.bind(this),$createUser:this.createUser.bind(this),$changePassword:this.changePassword.bind(this),$changeEmail:this.changeEmail.bind(this),$removeUser:this.removeUser.bind(this),$resetPassword:this.resetPassword.bind(this)},this._object},authWithCustomToken:function(authToken,options){var deferred=this._q.defer();try{this._ref.authWithCustomToken(authToken,this._utils.makeNodeResolver(deferred),options)}catch(error){deferred.reject(error)}return deferred.promise},authAnonymously:function(options){var deferred=this._q.defer();try{this._ref.authAnonymously(this._utils.makeNodeResolver(deferred),options)}catch(error){deferred.reject(error)}return deferred.promise},authWithPassword:function(credentials,options){var deferred=this._q.defer();try{this._ref.authWithPassword(credentials,this._utils.makeNodeResolver(deferred),options)}catch(error){deferred.reject(error)}return deferred.promise},authWithOAuthPopup:function(provider,options){var deferred=this._q.defer();try{this._ref.authWithOAuthPopup(provider,this._utils.makeNodeResolver(deferred),options)}catch(error){deferred.reject(error)}return deferred.promise},authWithOAuthRedirect:function(provider,options){var deferred=this._q.defer();try{this._ref.authWithOAuthRedirect(provider,this._utils.makeNodeResolver(deferred),options)}catch(error){deferred.reject(error)}return deferred.promise},authWithOAuthToken:function(provider,credentials,options){var deferred=this._q.defer();try{this._ref.authWithOAuthToken(provider,credentials,this._utils.makeNodeResolver(deferred),options)}catch(error){deferred.reject(error)}return deferred.promise},unauth:function(){null!==this.getAuth()&&this._ref.unauth()},onAuth:function(callback,context){var self=this,fn=this._utils.debounce(callback,context,0);return this._ref.onAuth(fn),function(){self._ref.offAuth(fn)}},getAuth:function(){return this._ref.getAuth()},_routerMethodOnAuthPromise:function(rejectIfAuthDataIsNull){var ref=this._ref,utils=this._utils;return this._initialAuthResolver.then(function(){var authData=ref.getAuth(),res=null;return res=rejectIfAuthDataIsNull&&null===authData?utils.reject("AUTH_REQUIRED"):utils.resolve(authData)})},_initAuthResolver:function(){var ref=this._ref;return this._utils.promise(function(resolve){function callback(){ref.offAuth(callback),resolve()}ref.onAuth(callback)})},requireAuth:function(){return this._routerMethodOnAuthPromise(!0)},waitForAuth:function(){return this._routerMethodOnAuthPromise(!1)},createUser:function(credentials){var deferred=this._q.defer();if("string"==typeof credentials)throw new Error("$createUser() expects an object containing 'email' and 'password', but got a string.");try{this._ref.createUser(credentials,this._utils.makeNodeResolver(deferred))}catch(error){deferred.reject(error)}return deferred.promise},changePassword:function(credentials){var deferred=this._q.defer();if("string"==typeof credentials)throw new Error("$changePassword() expects an object containing 'email', 'oldPassword', and 'newPassword', but got a string.");try{this._ref.changePassword(credentials,this._utils.makeNodeResolver(deferred))}catch(error){deferred.reject(error)}return deferred.promise},changeEmail:function(credentials){var deferred=this._q.defer();if("function"!=typeof this._ref.changeEmail)throw new Error("$firebaseAuth.$changeEmail() requires Firebase version 2.1.0 or greater.");if("string"==typeof credentials)throw new Error("$changeEmail() expects an object containing 'oldEmail', 'newEmail', and 'password', but got a string.");try{this._ref.changeEmail(credentials,this._utils.makeNodeResolver(deferred))}catch(error){deferred.reject(error)}return deferred.promise},removeUser:function(credentials){var deferred=this._q.defer();if("string"==typeof credentials)throw new Error("$removeUser() expects an object containing 'email' and 'password', but got a string.");try{this._ref.removeUser(credentials,this._utils.makeNodeResolver(deferred))}catch(error){deferred.reject(error)}return deferred.promise},resetPassword:function(credentials){var deferred=this._q.defer();if("string"==typeof credentials)throw new Error("$resetPassword() expects an object containing 'email', but got a string.");try{this._ref.resetPassword(credentials,this._utils.makeNodeResolver(deferred))}catch(error){deferred.reject(error)}return deferred.promise}}}(),function(){"use strict";angular.module("firebase").factory("$firebaseObject",["$parse","$firebaseUtils","$log",function($parse,$firebaseUtils,$log){function FirebaseObject(ref){return this instanceof FirebaseObject?(this.$$conf={sync:new ObjectSyncManager(this,ref),ref:ref,binding:new ThreeWayBinding(this),listeners:[]},Object.defineProperty(this,"$$conf",{value:this.$$conf}),this.$id=$firebaseUtils.getKey(ref.ref()),this.$priority=null,$firebaseUtils.applyDefaults(this,this.$$defaults),void this.$$conf.sync.init()):new FirebaseObject(ref)}function ThreeWayBinding(rec){this.subs=[],this.scope=null,this.key=null,this.rec=rec}function ObjectSyncManager(firebaseObject,ref){function destroy(err){sync.isDestroyed||(sync.isDestroyed=!0,ref.off("value",applyUpdate),firebaseObject=null,initComplete(err||"destroyed"))}function init(){ref.on("value",applyUpdate,error),ref.once("value",function(snap){angular.isArray(snap.val())&&$log.warn("Storing data using array indices in Firebase can result in unexpected behavior. See https://www.firebase.com/docs/web/guide/understanding-data.html#section-arrays-in-firebase for more information. Also note that you probably wanted $firebaseArray and not $firebaseObject."),initComplete(null)},initComplete)}function _initComplete(err){isResolved||(isResolved=!0,err?def.reject(err):def.resolve(firebaseObject))}var isResolved=!1,def=$firebaseUtils.defer(),applyUpdate=$firebaseUtils.batch(function(snap){var changed=firebaseObject.$$updated(snap);changed&&firebaseObject.$$notify()}),error=$firebaseUtils.batch(function(err){_initComplete(err),firebaseObject&&firebaseObject.$$error(err)}),initComplete=$firebaseUtils.batch(_initComplete),sync={isDestroyed:!1,destroy:destroy,init:init,ready:function(){return def.promise}};return sync}return FirebaseObject.prototype={$save:function(){var self=this,ref=self.$ref(),data=$firebaseUtils.toJSON(self);return $firebaseUtils.doSet(ref,data).then(function(){return self.$$notify(),self.$ref()})},$remove:function(){var self=this;return $firebaseUtils.trimKeys(self,{}),self.$value=null,$firebaseUtils.doRemove(self.$ref()).then(function(){return self.$$notify(),self.$ref()})},$loaded:function(resolve,reject){var promise=this.$$conf.sync.ready();return arguments.length&&(promise=promise.then.call(promise,resolve,reject)),promise},$ref:function(){return this.$$conf.ref},$bindTo:function(scope,varName){var self=this;return self.$loaded().then(function(){return self.$$conf.binding.bindTo(scope,varName)})},$watch:function(cb,context){var list=this.$$conf.listeners;return list.push([cb,context]),function(){var i=list.findIndex(function(parts){return parts[0]===cb&&parts[1]===context});i>-1&&list.splice(i,1)}},$destroy:function(err){var self=this;self.$isDestroyed||(self.$isDestroyed=!0,self.$$conf.sync.destroy(err),self.$$conf.binding.destroy(),$firebaseUtils.each(self,function(v,k){delete self[k]}))},$$updated:function(snap){var changed=$firebaseUtils.updateRec(this,snap);return $firebaseUtils.applyDefaults(this,this.$$defaults),changed},$$error:function(err){$log.error(err),this.$destroy(err)},$$scopeUpdated:function(newData){var def=$firebaseUtils.defer();return this.$ref().set($firebaseUtils.toJSON(newData),$firebaseUtils.makeNodeResolver(def)),def.promise},$$notify:function(){var self=this,list=this.$$conf.listeners.slice();angular.forEach(list,function(parts){parts[0].call(parts[1],{event:"value",key:self.$id})})},forEach:function(iterator,context){return $firebaseUtils.each(this,iterator,context)}},FirebaseObject.$extend=function(ChildClass,methods){return 1===arguments.length&&angular.isObject(ChildClass)&&(methods=ChildClass,ChildClass=function(ref){return this instanceof ChildClass?void FirebaseObject.apply(this,arguments):new ChildClass(ref)}),$firebaseUtils.inherit(ChildClass,FirebaseObject,methods)},ThreeWayBinding.prototype={assertNotBound:function(varName){if(this.scope){var msg="Cannot bind to "+varName+" because this instance is already bound to "+this.key+"; one binding per instance (call unbind method or create another FirebaseObject instance)";return $log.error(msg),$firebaseUtils.reject(msg)}},bindTo:function(scope,varName){function _bind(self){function equals(scopeValue){return angular.equals(scopeValue,rec)&&scopeValue.$priority===rec.$priority&&scopeValue.$value===rec.$value}function setScope(rec){parsed.assign(scope,$firebaseUtils.scopeData(rec))}function watchExp(){var obj=parsed(scope);return[obj,obj.$priority,obj.$value]}var sending=!1,parsed=$parse(varName),rec=self.rec;self.scope=scope,self.varName=varName;var send=$firebaseUtils.debounce(function(val){var scopeData=$firebaseUtils.scopeData(val);rec.$$scopeUpdated(scopeData)["finally"](function(){sending=!1,scopeData.hasOwnProperty("$value")||(delete rec.$value,delete parsed(scope).$value),setScope(rec)})},50,500),scopeUpdated=function(newVal){newVal=newVal[0],equals(newVal)||(sending=!0,send(newVal))},recUpdated=function(){sending||equals(parsed(scope))||setScope(rec)};return setScope(rec),self.subs.push(scope.$on("$destroy",self.unbind.bind(self))),self.subs.push(scope.$watch(watchExp,scopeUpdated,!0)),self.subs.push(rec.$watch(recUpdated)),self.unbind.bind(self)}return this.assertNotBound(varName)||_bind(this)},unbind:function(){this.scope&&(angular.forEach(this.subs,function(unbind){unbind()}),this.subs=[],this.scope=null,this.key=null)},destroy:function(){this.unbind(),this.rec=null}},FirebaseObject}]),angular.module("firebase").factory("$FirebaseObject",["$log","$firebaseObject",function($log,$firebaseObject){return function(){return $log.warn("$FirebaseObject has been renamed. Use $firebaseObject instead."),$firebaseObject.apply(null,arguments)}}])}(),function(){"use strict";angular.module("firebase").factory("$firebase",function(){return function(){throw new Error("$firebase has been removed. You may instantiate $firebaseArray and $firebaseObject directly now. For simple write operations, just use the Firebase ref directly. See the AngularFire 1.0.0 changelog for details: https://www.firebase.com/docs/web/libraries/angular/changelog.html")}})}(),function(){"use strict";function FirebaseAuthService($firebaseAuth,$firebaseRef){return $firebaseAuth($firebaseRef["default"])}FirebaseAuthService.$inject=["$firebaseAuth","$firebaseRef"],angular.module("firebase").factory("$firebaseAuthService",FirebaseAuthService)}(),function(){"use strict";function FirebaseRef(){this.urls=null,this.registerUrl=function(urlOrConfig){"string"==typeof urlOrConfig&&(this.urls={},this.urls["default"]=urlOrConfig),angular.isObject(urlOrConfig)&&(this.urls=urlOrConfig)},this.$$checkUrls=function(urlConfig){return urlConfig?urlConfig["default"]?void 0:new Error('No default Firebase URL registered. Use firebaseRefProvider.registerUrl({ default: "https://<my-firebase-app>.firebaseio.com/"}).'):new Error("No Firebase URL registered. Use firebaseRefProvider.registerUrl() in the config phase. This is required if you are using $firebaseAuthService.")},this.$$createRefsFromUrlConfig=function(urlConfig){var refs={},error=this.$$checkUrls(urlConfig);if(error)throw error;return angular.forEach(urlConfig,function(value,key){refs[key]=new Firebase(value)}),refs},this.$get=function(){return this.$$createRefsFromUrlConfig(this.urls)}}angular.module("firebase").provider("$firebaseRef",FirebaseRef)}(),Array.prototype.indexOf||(Array.prototype.indexOf=function(searchElement,fromIndex){if(void 0===this||null===this)throw new TypeError("'this' is null or not defined");var length=this.length>>>0;for(fromIndex=+fromIndex||0,Math.abs(fromIndex)===1/0&&(fromIndex=0),0>fromIndex&&(fromIndex+=length,0>fromIndex&&(fromIndex=0));length>fromIndex;fromIndex++)if(this[fromIndex]===searchElement)return fromIndex;return-1}),Function.prototype.bind||(Function.prototype.bind=function(oThis){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};return fNOP.prototype=this.prototype,fBound.prototype=new fNOP,fBound}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{enumerable:!1,configurable:!0,writable:!0,value:function(predicate){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof predicate)throw new TypeError("predicate must be a function");for(var value,list=Object(this),length=list.length>>>0,thisArg=arguments[1],i=0;length>i;i++)if(i in list&&(value=list[i],predicate.call(thisArg,value,i,list)))return i;return-1}}),"function"!=typeof Object.create&&!function(){var F=function(){};Object.create=function(o){if(arguments.length>1)throw new Error("Second argument not supported");if(null===o)throw new Error("Cannot set a null [[Prototype]]");if("object"!=typeof o)throw new TypeError("Argument must be an object");return F.prototype=o,new F}}(),Object.keys||(Object.keys=function(){"use strict";var hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;return function(obj){if("object"!=typeof obj&&("function"!=typeof obj||null===obj))throw new TypeError("Object.keys called on non-object");var prop,i,result=[];for(prop in obj)hasOwnProperty.call(obj,prop)&&result.push(prop);if(hasDontEnumBug)for(i=0;dontEnumsLength>i;i++)hasOwnProperty.call(obj,dontEnums[i])&&result.push(dontEnums[i]);return result}}()),"function"!=typeof Object.getPrototypeOf&&("object"==typeof"test".__proto__?Object.getPrototypeOf=function(object){return object.__proto__}:Object.getPrototypeOf=function(object){return object.constructor.prototype}),function(){"use strict";function stripDollarPrefixedKeys(data){if(!angular.isObject(data))return data;var out=angular.isArray(data)?[]:{};return angular.forEach(data,function(v,k){"string"==typeof k&&"$"===k.charAt(0)||(out[k]=stripDollarPrefixedKeys(v))}),out}angular.module("firebase").factory("$firebaseConfig",["$firebaseArray","$firebaseObject","$injector",function($firebaseArray,$firebaseObject,$injector){return function(configOpts){var opts=angular.extend({},configOpts);return"string"==typeof opts.objectFactory&&(opts.objectFactory=$injector.get(opts.objectFactory)),"string"==typeof opts.arrayFactory&&(opts.arrayFactory=$injector.get(opts.arrayFactory)),angular.extend({arrayFactory:$firebaseArray,objectFactory:$firebaseObject},opts)}}]).factory("$firebaseUtils",["$q","$timeout","$rootScope",function($q,$timeout,$rootScope){function Q(resolver){function resolveFn(value){deferred.resolve(value)}function rejectFn(reason){deferred.reject(reason)}if(!angular.isFunction(resolver))throw new Error("missing resolver function");var deferred=$q.defer();return resolver(resolveFn,rejectFn),deferred.promise}var utils={batch:function(action,context){return function(){var args=Array.prototype.slice.call(arguments,0);utils.compile(function(){action.apply(context,args)})}},debounce:function(fn,ctx,wait,maxWait){function resetTimer(){cancelTimer&&(cancelTimer(),cancelTimer=null),start&&Date.now()-start>maxWait?runScheduledForNextTick||(runScheduledForNextTick=!0,utils.compile(runNow)):(start||(start=Date.now()),cancelTimer=utils.wait(runNow,wait))}function runNow(){cancelTimer=null,start=null,runScheduledForNextTick=!1,fn.apply(ctx,args)}function debounced(){args=Array.prototype.slice.call(arguments,0),resetTimer()}var start,cancelTimer,args,runScheduledForNextTick;if("number"==typeof ctx&&(maxWait=wait,wait=ctx,ctx=null),"number"!=typeof wait)throw new Error("Must provide a valid integer for wait. Try 0 for a default");if("function"!=typeof fn)throw new Error("Must provide a valid function to debounce");return maxWait||(maxWait=10*wait||100),debounced.running=function(){return start>0},debounced},assertValidRef:function(ref,msg){if(!angular.isObject(ref)||"function"!=typeof ref.ref||"function"!=typeof ref.ref().transaction)throw new Error(msg||"Invalid Firebase reference")},inherit:function(ChildClass,ParentClass,methods){var childMethods=ChildClass.prototype;return ChildClass.prototype=Object.create(ParentClass.prototype),ChildClass.prototype.constructor=ChildClass,angular.forEach(Object.keys(childMethods),function(k){ChildClass.prototype[k]=childMethods[k]}),angular.isObject(methods)&&angular.extend(ChildClass.prototype,methods),ChildClass},getPrototypeMethods:function(inst,iterator,context){for(var methods={},objProto=Object.getPrototypeOf({}),proto=angular.isFunction(inst)&&angular.isObject(inst.prototype)?inst.prototype:Object.getPrototypeOf(inst);proto&&proto!==objProto;){for(var key in proto)proto.hasOwnProperty(key)&&!methods.hasOwnProperty(key)&&(methods[key]=!0,iterator.call(context,proto[key],key,proto));proto=Object.getPrototypeOf(proto)}},getPublicMethods:function(inst,iterator,context){utils.getPrototypeMethods(inst,function(m,k){"function"==typeof m&&"_"!==k.charAt(0)&&iterator.call(context,m,k)})},defer:$q.defer,reject:$q.reject,resolve:$q.when,promise:angular.isFunction($q)?$q:Q,makeNodeResolver:function(deferred){return function(err,result){null===err?(arguments.length>2&&(result=Array.prototype.slice.call(arguments,1)),deferred.resolve(result)):deferred.reject(err)}},wait:function(fn,wait){var to=$timeout(fn,wait||0);return function(){to&&($timeout.cancel(to),to=null)}},compile:function(fn){return $rootScope.$evalAsync(fn||function(){})},deepCopy:function(obj){if(!angular.isObject(obj))return obj;var newCopy=angular.isArray(obj)?obj.slice():angular.extend({},obj);for(var key in newCopy)newCopy.hasOwnProperty(key)&&angular.isObject(newCopy[key])&&(newCopy[key]=utils.deepCopy(newCopy[key]));return newCopy},trimKeys:function(dest,source){utils.each(dest,function(v,k){source.hasOwnProperty(k)||delete dest[k]})},scopeData:function(dataOrRec){var data={$id:dataOrRec.$id,$priority:dataOrRec.$priority},hasPublicProp=!1;return utils.each(dataOrRec,function(v,k){hasPublicProp=!0,data[k]=utils.deepCopy(v)}),!hasPublicProp&&dataOrRec.hasOwnProperty("$value")&&(data.$value=dataOrRec.$value),data},updateRec:function(rec,snap){var data=snap.val(),oldData=angular.extend({},rec);return angular.isObject(data)?delete rec.$value:(rec.$value=data,data={}),utils.trimKeys(rec,data),angular.extend(rec,data),rec.$priority=snap.getPriority(),!angular.equals(oldData,rec)||oldData.$value!==rec.$value||oldData.$priority!==rec.$priority},applyDefaults:function(rec,defaults){return angular.isObject(defaults)&&angular.forEach(defaults,function(v,k){rec.hasOwnProperty(k)||(rec[k]=v)}),rec},dataKeys:function(obj){var out=[];return utils.each(obj,function(v,k){out.push(k)}),out},each:function(obj,iterator,context){if(angular.isObject(obj)){for(var k in obj)if(obj.hasOwnProperty(k)){var c=k.charAt(0);"_"!==c&&"$"!==c&&"."!==c&&iterator.call(context,obj[k],k,obj)}}else if(angular.isArray(obj))for(var i=0,len=obj.length;len>i;i++)iterator.call(context,obj[i],i,obj);return obj},getKey:function(refOrSnapshot){return"function"==typeof refOrSnapshot.key?refOrSnapshot.key():refOrSnapshot.name()},toJSON:function(rec){var dat;return angular.isObject(rec)||(rec={$value:rec}),angular.isFunction(rec.toJSON)?dat=rec.toJSON():(dat={},utils.each(rec,function(v,k){dat[k]=stripDollarPrefixedKeys(v)})),angular.isDefined(rec.$value)&&0===Object.keys(dat).length&&null!==rec.$value&&(dat[".value"]=rec.$value),angular.isDefined(rec.$priority)&&Object.keys(dat).length>0&&null!==rec.$priority&&(dat[".priority"]=rec.$priority),angular.forEach(dat,function(v,k){if(k.match(/[.$\[\]#\/]/)&&".value"!==k&&".priority"!==k)throw new Error("Invalid key "+k+" (cannot contain .$[]#)");if(angular.isUndefined(v))throw new Error("Key "+k+" was undefined. Cannot pass undefined in JSON. Use null instead.")}),dat},doSet:function(ref,data){var def=utils.defer();if(angular.isFunction(ref.set)||!angular.isObject(data))ref.set(data,utils.makeNodeResolver(def));else{var dataCopy=angular.extend({},data);ref.once("value",function(snap){snap.forEach(function(ss){dataCopy.hasOwnProperty(utils.getKey(ss))||(dataCopy[utils.getKey(ss)]=null)}),ref.ref().update(dataCopy,utils.makeNodeResolver(def))},function(err){def.reject(err)})}return def.promise},doRemove:function(ref){var def=utils.defer();return angular.isFunction(ref.remove)?ref.remove(utils.makeNodeResolver(def)):ref.once("value",function(snap){var promises=[];snap.forEach(function(ss){var d=utils.defer();promises.push(d.promise),ss.ref().remove(utils.makeNodeResolver(def))}),utils.allPromises(promises).then(function(){def.resolve(ref)},function(err){def.reject(err)})},function(err){def.reject(err)}),def.promise},VERSION:"1.2.0",allPromises:$q.all.bind($q)};return utils}])}(),function(){"use strict";function angularMoment(angular,moment){return angular.module("angularMoment",[]).constant("angularMomentConfig",{preprocess:null,timezone:""}).constant("moment",moment).constant("amTimeAgoConfig",{withoutSuffix:!1}).directive("amTimeAgo",["$window","moment","amMoment","amTimeAgoConfig","angularMomentConfig",function($window,moment,amMoment,amTimeAgoConfig,angularMomentConfig){return function(scope,element,attr){function cancelTimer(){activeTimeout&&($window.clearTimeout(activeTimeout),activeTimeout=null)}function updateTime(momentInstance){element.text(momentInstance.fromNow(withoutSuffix));var howOld=moment().diff(momentInstance,"minute"),secondsUntilUpdate=3600;1>howOld?secondsUntilUpdate=1:60>howOld?secondsUntilUpdate=30:180>howOld&&(secondsUntilUpdate=300),activeTimeout=$window.setTimeout(function(){updateTime(momentInstance)},1e3*secondsUntilUpdate)}function updateMoment(){cancelTimer(),currentValue&&updateTime(amMoment.preprocessDate(currentValue,preprocess,currentFormat))}var currentValue,currentFormat,activeTimeout=null,withoutSuffix=amTimeAgoConfig.withoutSuffix,preprocess=angularMomentConfig.preprocess;scope.$watch(attr.amTimeAgo,function(value){return"undefined"==typeof value||null===value||""===value?(cancelTimer(),void(currentValue&&(element.text(""),currentValue=null))):(currentValue=value,void updateMoment())}),angular.isDefined(attr.amWithoutSuffix)&&scope.$watch(attr.amWithoutSuffix,function(value){"boolean"==typeof value?(withoutSuffix=value,updateMoment()):withoutSuffix=amTimeAgoConfig.withoutSuffix}),attr.$observe("amFormat",function(format){currentFormat=format,updateMoment()}),attr.$observe("amPreprocess",function(newValue){preprocess=newValue,updateMoment()}),scope.$on("$destroy",function(){cancelTimer()}),scope.$on("amMoment:languageChange",function(){updateMoment()})}}]).service("amMoment",["moment","$rootScope","$log","angularMomentConfig",function(moment,$rootScope,$log,angularMomentConfig){this.preprocessors={utc:moment.utc,unix:moment.unix},this.changeLanguage=function(lang){var result=moment.lang(lang);return angular.isDefined(lang)&&$rootScope.$broadcast("amMoment:languageChange"),result},this.preprocessDate=function(value,preprocess,format){return angular.isUndefined(preprocess)&&(preprocess=angularMomentConfig.preprocess),this.preprocessors[preprocess]?this.preprocessors[preprocess](value,format):(preprocess&&$log.warn("angular-moment: Ignoring unsupported value for preprocess: "+preprocess),!isNaN(parseFloat(value))&&isFinite(value)?moment(parseInt(value,10)):moment(value,format));
},this.applyTimezone=function(aMoment){var timezone=angularMomentConfig.timezone;return aMoment&&timezone&&(aMoment.tz?aMoment=aMoment.tz(timezone):$log.warn("angular-moment: timezone specified but moment.tz() is undefined. Did you forget to include moment-timezone.js?")),aMoment}}]).filter("amCalendar",["moment","amMoment",function(moment,amMoment){return function(value,preprocess){if("undefined"==typeof value||null===value)return"";value=amMoment.preprocessDate(value,preprocess);var date=moment(value);return date.isValid()?amMoment.applyTimezone(date).calendar():""}}]).filter("amDateFormat",["moment","amMoment",function(moment,amMoment){return function(value,format,preprocess){if("undefined"==typeof value||null===value)return"";value=amMoment.preprocessDate(value,preprocess);var date=moment(value);return date.isValid()?amMoment.applyTimezone(date).format(format):""}}]).filter("amDurationFormat",["moment",function(moment){return function(value,format,suffix){return"undefined"==typeof value||null===value?"":moment.duration(value,format).humanize(suffix)}}])}"function"==typeof define&&define.amd?define("angular-moment",["angular","moment"],angularMoment):angularMoment(angular,window.moment)}(),/**
 * @license angular-bootstrap-datetimepicker  version: 0.3.15
 * Copyright 2015 Knight Rider Consulting, Inc. http://www.knightrider.com
 * License: MIT
 */
function(factory){"use strict";"function"==typeof define&&define.amd?define(["angular","moment"],factory):"object"==typeof exports?module.exports=factory(require("angular"),require("moment")):factory(window.angular,window.moment)}(function(angular,moment){"use strict";angular.module("ui.bootstrap.datetimepicker",[]).constant("dateTimePickerConfig",{dropdownSelector:null,minuteStep:5,minView:"minute",startView:"day"}).directive("datetimepicker",["$log","dateTimePickerConfig",function($log,defaultConfig){function DateObject(){var tempDate=new Date,localOffset=6e4*tempDate.getTimezoneOffset();this.utcDateValue=tempDate.getTime(),this.selectable=!0,this.localDateValue=function(){return this.utcDateValue+localOffset};var validProperties=["utcDateValue","localDateValue","display","active","selectable","past","future"];for(var prop in arguments[0])validProperties.indexOf(prop)>=0&&(this[prop]=arguments[0][prop])}var validateConfiguration=function(configuration){var validOptions=["startView","minView","minuteStep","dropdownSelector"];for(var prop in configuration)if(validOptions.indexOf(prop)<0)throw"invalid option: "+prop;var validViews=["minute","hour","day","month","year"];if(validViews.indexOf(configuration.startView)<0)throw"invalid startView value: "+configuration.startView;if(validViews.indexOf(configuration.minView)<0)throw"invalid minView value: "+configuration.minView;if(validViews.indexOf(configuration.minView)>validViews.indexOf(configuration.startView))throw"startView must be greater than minView";if(!angular.isNumber(configuration.minuteStep))throw"minuteStep must be numeric";if(configuration.minuteStep<=0||configuration.minuteStep>=60)throw"minuteStep must be greater than zero and less than 60";if(null!==configuration.dropdownSelector&&!angular.isString(configuration.dropdownSelector))throw"dropdownSelector must be a string";null===configuration.dropdownSelector||"undefined"!=typeof jQuery&&"function"==typeof jQuery().dropdown||($log.error("Please DO NOT specify the dropdownSelector option unless you are using jQuery AND Bootstrap.js. Please include jQuery AND Bootstrap.js, or write code to close the dropdown in the on-set-time callback. \n\nThe dropdownSelector configuration option is being removed because it will not function properly."),delete configuration.dropdownSelector)};return{restrict:"E",require:"ngModel",template:'<div class="datetimepicker table-responsive"><table class="table table-condensed  {{ data.currentView }}-view">   <thead>       <tr>           <th class="left" data-ng-click="changeView(data.currentView, data.leftDate, $event)" data-ng-show="data.leftDate.selectable"><i class="glyphicon glyphicon-arrow-left"/></th>           <th class="switch" colspan="5" data-ng-show="data.previousViewDate.selectable" data-ng-click="changeView(data.previousView, data.previousViewDate, $event)">{{ data.previousViewDate.display }}</th>           <th class="right" data-ng-click="changeView(data.currentView, data.rightDate, $event)" data-ng-show="data.rightDate.selectable"><i class="glyphicon glyphicon-arrow-right"/></th>       </tr>       <tr>           <th class="dow" data-ng-repeat="day in data.dayNames" >{{ day }}</th>       </tr>   </thead>   <tbody>       <tr data-ng-if="data.currentView !== \'day\'" >           <td colspan="7" >              <span    class="{{ data.currentView }}"                        data-ng-repeat="dateObject in data.dates"                         data-ng-class="{active: dateObject.active, past: dateObject.past, future: dateObject.future, disabled: !dateObject.selectable}"                        data-ng-click="changeView(data.nextView, dateObject, $event)">{{ dateObject.display }}</span>            </td>       </tr>       <tr data-ng-if="data.currentView === \'day\'" data-ng-repeat="week in data.weeks">           <td data-ng-repeat="dateObject in week.dates"                data-ng-click="changeView(data.nextView, dateObject, $event)"               class="day"                data-ng-class="{active: dateObject.active, past: dateObject.past, future: dateObject.future, disabled: !dateObject.selectable}" >{{ dateObject.display }}</td>       </tr>   </tbody></table></div>',scope:{onSetTime:"&",beforeRender:"&"},replace:!0,link:function(scope,element,attrs,ngModelController){var directiveConfig={};attrs.datetimepickerConfig&&(directiveConfig=scope.$parent.$eval(attrs.datetimepickerConfig));var configuration={};angular.extend(configuration,defaultConfig,directiveConfig),validateConfiguration(configuration);var startOfDecade=function(unixDate){var startYear=10*parseInt(moment.utc(unixDate).year()/10,10);return moment.utc(unixDate).year(startYear).startOf("year")},dataFactory={year:function(unixDate){for(var selectedDate=moment.utc(unixDate).startOf("year"),startDecade=10*parseInt(selectedDate.year()/10,10),startDate=moment.utc(startOfDecade(unixDate)).subtract(1,"year").startOf("year"),activeYear=ngModelController.$modelValue?moment(ngModelController.$modelValue).year():0,result={currentView:"year",nextView:"year"===configuration.minView?"setTime":"month",previousViewDate:new DateObject({utcDateValue:null,display:startDecade+"-"+(startDecade+9)}),leftDate:new DateObject({utcDateValue:moment.utc(startDate).subtract(9,"year").valueOf()}),rightDate:new DateObject({utcDateValue:moment.utc(startDate).add(11,"year").valueOf()}),dates:[]},i=0;12>i;i+=1){var yearMoment=moment.utc(startDate).add(i,"years"),dateValue={utcDateValue:yearMoment.valueOf(),display:yearMoment.format("YYYY"),past:yearMoment.year()<startDecade,future:yearMoment.year()>startDecade+9,active:yearMoment.year()===activeYear};result.dates.push(new DateObject(dateValue))}return result},month:function(unixDate){for(var startDate=moment.utc(unixDate).startOf("year"),previousViewDate=startOfDecade(unixDate),activeDate=ngModelController.$modelValue?moment(ngModelController.$modelValue).format("YYYY-MMM"):0,result={previousView:"year",currentView:"month",nextView:"month"===configuration.minView?"setTime":"day",previousViewDate:new DateObject({utcDateValue:previousViewDate.valueOf(),display:startDate.format("YYYY")}),leftDate:new DateObject({utcDateValue:moment.utc(startDate).subtract(1,"year").valueOf()}),rightDate:new DateObject({utcDateValue:moment.utc(startDate).add(1,"year").valueOf()}),dates:[]},i=0;12>i;i+=1){var monthMoment=moment.utc(startDate).add(i,"months"),dateValue={utcDateValue:monthMoment.valueOf(),display:monthMoment.format("MMM"),active:monthMoment.format("YYYY-MMM")===activeDate};result.dates.push(new DateObject(dateValue))}return result},day:function(unixDate){for(var selectedDate=moment.utc(unixDate),startOfMonth=moment.utc(selectedDate).startOf("month"),previousViewDate=moment.utc(selectedDate).startOf("year"),endOfMonth=moment.utc(selectedDate).endOf("month"),startDate=moment.utc(startOfMonth).subtract(Math.abs(startOfMonth.weekday()),"days"),activeDate=ngModelController.$modelValue?moment(ngModelController.$modelValue).format("YYYY-MMM-DD"):"",result={previousView:"month",currentView:"day",nextView:"day"===configuration.minView?"setTime":"hour",previousViewDate:new DateObject({utcDateValue:previousViewDate.valueOf(),display:startOfMonth.format("YYYY-MMM")}),leftDate:new DateObject({utcDateValue:moment.utc(startOfMonth).subtract(1,"months").valueOf()}),rightDate:new DateObject({utcDateValue:moment.utc(startOfMonth).add(1,"months").valueOf()}),dayNames:[],weeks:[]},dayNumber=0;7>dayNumber;dayNumber+=1)result.dayNames.push(moment.utc().weekday(dayNumber).format("dd"));for(var i=0;6>i;i+=1){for(var week={dates:[]},j=0;7>j;j+=1){var monthMoment=moment.utc(startDate).add(7*i+j,"days"),dateValue={utcDateValue:monthMoment.valueOf(),display:monthMoment.format("D"),active:monthMoment.format("YYYY-MMM-DD")===activeDate,past:monthMoment.isBefore(startOfMonth),future:monthMoment.isAfter(endOfMonth)};week.dates.push(new DateObject(dateValue))}result.weeks.push(week)}return result},hour:function(unixDate){for(var selectedDate=moment.utc(unixDate).startOf("day"),previousViewDate=moment.utc(selectedDate).startOf("month"),activeFormat=ngModelController.$modelValue?moment(ngModelController.$modelValue).format("YYYY-MM-DD H"):"",result={previousView:"day",currentView:"hour",nextView:"hour"===configuration.minView?"setTime":"minute",previousViewDate:new DateObject({utcDateValue:previousViewDate.valueOf(),display:selectedDate.format("ll")}),leftDate:new DateObject({utcDateValue:moment.utc(selectedDate).subtract(1,"days").valueOf()}),rightDate:new DateObject({utcDateValue:moment.utc(selectedDate).add(1,"days").valueOf()}),dates:[]},i=0;24>i;i+=1){var hourMoment=moment.utc(selectedDate).add(i,"hours"),dateValue={utcDateValue:hourMoment.valueOf(),display:hourMoment.format("LT"),active:hourMoment.format("YYYY-MM-DD H")===activeFormat};result.dates.push(new DateObject(dateValue))}return result},minute:function(unixDate){for(var selectedDate=moment.utc(unixDate).startOf("hour"),previousViewDate=moment.utc(selectedDate).startOf("day"),activeFormat=ngModelController.$modelValue?moment(ngModelController.$modelValue).format("YYYY-MM-DD H:mm"):"",result={previousView:"hour",currentView:"minute",nextView:"setTime",previousViewDate:new DateObject({utcDateValue:previousViewDate.valueOf(),display:selectedDate.format("lll")}),leftDate:new DateObject({utcDateValue:moment.utc(selectedDate).subtract(1,"hours").valueOf()}),rightDate:new DateObject({utcDateValue:moment.utc(selectedDate).add(1,"hours").valueOf()}),dates:[]},limit=60/configuration.minuteStep,i=0;limit>i;i+=1){var hourMoment=moment.utc(selectedDate).add(i*configuration.minuteStep,"minute"),dateValue={utcDateValue:hourMoment.valueOf(),display:hourMoment.format("LT"),active:hourMoment.format("YYYY-MM-DD H:mm")===activeFormat};result.dates.push(new DateObject(dateValue))}return result},setTime:function(unixDate){var tempDate=new Date(unixDate),newDate=new Date(tempDate.getTime()+6e4*tempDate.getTimezoneOffset()),oldDate=ngModelController.$modelValue;return ngModelController.$setViewValue(newDate),configuration.dropdownSelector&&jQuery(configuration.dropdownSelector).dropdown("toggle"),scope.onSetTime({newDate:newDate,oldDate:oldDate}),dataFactory[configuration.startView](unixDate)}},getUTCTime=function(modelValue){var tempDate=modelValue?moment(modelValue).toDate():new Date;return tempDate.getTime()-6e4*tempDate.getTimezoneOffset()};scope.changeView=function(viewName,dateObject,event){if(event&&(event.stopPropagation(),event.preventDefault()),viewName&&dateObject.utcDateValue>-(1/0)&&dateObject.selectable&&dataFactory[viewName]){var result=dataFactory[viewName](dateObject.utcDateValue),weekDates=[];if(result.weeks)for(var i=0;i<result.weeks.length;i+=1)for(var week=result.weeks[i],j=0;j<week.dates.length;j+=1){var weekDate=week.dates[j];weekDates.push(weekDate)}scope.beforeRender({$view:result.currentView,$dates:result.dates||weekDates,$leftDate:result.leftDate,$upDate:result.previousViewDate,$rightDate:result.rightDate}),scope.data=result}},ngModelController.$render=function(){scope.changeView(configuration.startView,new DateObject({utcDateValue:getUTCTime(ngModelController.$viewValue)}))}}}}])}),angular.module("monospaced.elastic",[]).constant("msdElasticConfig",{append:""}).directive("msdElastic",["$timeout","$window","msdElasticConfig",function($timeout,$window,config){"use strict";return{require:"ngModel",restrict:"A, C",link:function(scope,element,attrs,ngModel){function initMirror(){mirrored=ta,taStyle=getComputedStyle(ta),angular.forEach(copyStyle,function(val){mirrorStyle+=val+":"+taStyle.getPropertyValue(val)+";"}),mirror.setAttribute("style",mirrorStyle)}function adjust(){var taHeight,taComputedStyleWidth,mirrorHeight,width,overflow;mirrored!==ta&&initMirror(),active||(active=!0,mirror.value=ta.value+append,mirror.style.overflowY=ta.style.overflowY,taHeight=""===ta.style.height?"auto":parseInt(ta.style.height,10),taComputedStyleWidth=getComputedStyle(ta).getPropertyValue("width"),"px"===taComputedStyleWidth.substr(taComputedStyleWidth.length-2,2)&&(width=parseInt(taComputedStyleWidth,10)-boxOuter.width,mirror.style.width=width+"px"),mirrorHeight=mirror.scrollHeight,mirrorHeight>maxHeight?(mirrorHeight=maxHeight,overflow="scroll"):minHeight>mirrorHeight&&(mirrorHeight=minHeight),mirrorHeight+=boxOuter.height,ta.style.overflowY=overflow||"hidden",taHeight!==mirrorHeight&&(ta.style.height=mirrorHeight+"px",scope.$emit("elastic:resize",$ta)),$timeout(function(){active=!1},1))}function forceAdjust(){active=!1,adjust()}var ta=element[0],$ta=element;if("TEXTAREA"===ta.nodeName&&$window.getComputedStyle){$ta.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word"});var text=ta.value;ta.value="",ta.value=text;var mirrored,active,append=attrs.msdElastic?attrs.msdElastic.replace(/\\n/g,"\n"):config.append,$win=angular.element($window),mirrorStyle="position: absolute; top: -999px; right: auto; bottom: auto;left: 0; overflow: hidden; -webkit-box-sizing: content-box;-moz-box-sizing: content-box; box-sizing: content-box;min-height: 0 !important; height: 0 !important; padding: 0;word-wrap: break-word; border: 0;",$mirror=angular.element('<textarea tabindex="-1" style="'+mirrorStyle+'"/>').data("elastic",!0),mirror=$mirror[0],taStyle=getComputedStyle(ta),resize=taStyle.getPropertyValue("resize"),borderBox="border-box"===taStyle.getPropertyValue("box-sizing")||"border-box"===taStyle.getPropertyValue("-moz-box-sizing")||"border-box"===taStyle.getPropertyValue("-webkit-box-sizing"),boxOuter=borderBox?{width:parseInt(taStyle.getPropertyValue("border-right-width"),10)+parseInt(taStyle.getPropertyValue("padding-right"),10)+parseInt(taStyle.getPropertyValue("padding-left"),10)+parseInt(taStyle.getPropertyValue("border-left-width"),10),height:parseInt(taStyle.getPropertyValue("border-top-width"),10)+parseInt(taStyle.getPropertyValue("padding-top"),10)+parseInt(taStyle.getPropertyValue("padding-bottom"),10)+parseInt(taStyle.getPropertyValue("border-bottom-width"),10)}:{width:0,height:0},minHeightValue=parseInt(taStyle.getPropertyValue("min-height"),10),heightValue=parseInt(taStyle.getPropertyValue("height"),10),minHeight=Math.max(minHeightValue,heightValue)-boxOuter.height,maxHeight=parseInt(taStyle.getPropertyValue("max-height"),10),copyStyle=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"];$ta.data("elastic")||(maxHeight=maxHeight&&maxHeight>0?maxHeight:9e4,mirror.parentNode!==document.body&&angular.element(document.body).append(mirror),$ta.css({resize:"none"===resize||"vertical"===resize?"none":"horizontal"}).data("elastic",!0),"onpropertychange"in ta&&"oninput"in ta?ta.oninput=ta.onkeyup=adjust:ta.oninput=adjust,$win.bind("resize",forceAdjust),scope.$watch(function(){return ngModel.$modelValue},function(){forceAdjust()}),scope.$on("elastic:adjust",function(){forceAdjust()}),$timeout(adjust),scope.$on("$destroy",function(){$mirror.remove(),$win.unbind("resize",forceAdjust)}))}}}}]),function(angular){"use strict";angular.module("uuid4",[]).factory("uuid4",function(){return{generate:function(){var now=Date.now(),uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(now+16*Math.random())%16|0;return now=Math.floor(now/16),("x"==c?r:7&r|8).toString(16)});return uuid}}})}(angular),function(){angular.module("angulike",[]).directive("fbLike",["$window","$rootScope",function($window,$rootScope){return{restrict:"A",scope:{fbLike:"=?"},link:function(scope,element,attrs){function renderLikeButton(){if(!attrs.fbLike||scope.fbLike||watchAdded)element.html('<div class="fb-like"'+(scope.fbLike?' data-href="'+scope.fbLike+'"':"")+' data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div>'),$window.FB.XFBML.parse(element.parent()[0]);else var watchAdded=!0,unbindWatch=scope.$watch("fbLike",function(newValue){newValue&&(renderLikeButton(),unbindWatch())})}$window.FB?renderLikeButton():$.getScript("//connect.facebook.net/en_US/sdk.js",function(){$window.FB.init({appId:$rootScope.facebookAppId,xfbml:!0,version:"v2.0"}),renderLikeButton()})}}}]).directive("fbShare",["$window","$rootScope",function($window,$rootScope){return{restrict:"A",scope:{fbShare:"=?"},link:function(scope,element,attrs){function renderShareButton(){if(!attrs.fbShare||scope.fbShare||watchAdded)element.html('<div class="fb-share-button"'+(scope.fbShare?' data-href="'+scope.fbShare+'"':"")+' data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div>'),$window.FB.XFBML.parse(element.parent()[0]);else var watchAdded=!0,unbindWatch=scope.$watch("fbShare",function(newValue){newValue&&(renderShareButton(),unbindWatch())})}$window.FB?renderShareButton():$.getScript("//connect.facebook.net/en_US/sdk.js",function(){$window.FB.init({appId:$rootScope.facebookAppId,xfbml:!0,version:"v2.0"}),renderShareButton()})}}}]).directive("googlePlus",["$window",function($window){return{restrict:"A",scope:{url:"="},link:function(scope,element){function renderPlusButton(){element.html('<div class="g-plusone" data-size="medium" data-href="'+scope.url+'"></div>'),$window.gapi.plusone.go(element.parent()[0])}$window.gapi?renderPlusButton():$.getScript("//apis.google.com/js/platform.js",function(){renderPlusButton()})}}}]).directive("tweet",["$window",function($window){return{restrict:"A",scope:{tweet:"=",url:"="},link:function(scope,element){function renderTweetButton(){if(scope.tweet||watchAdded)element.html('<a href="https://twitter.com/share" class="twitter-share-button" data-text="'+scope.tweet+'" data-url="'+scope.url+'">Tweet</a>'),$window.twttr.widgets.load(element.parent()[0]);else{watchAdded=!0;var unbindWatch=scope.$watch("tweet",function(newValue){newValue&&(renderTweetButton(),unbindWatch())})}}$window.twttr&&$window.twttr.widgets?renderTweetButton():$.getScript("//platform.twitter.com/widgets.js",function(){renderTweetButton()});var watchAdded=!1}}}]).directive("pinIt",["$window","$location",function($window,$location){return{restrict:"A",scope:{pinIt:"=",pinItImage:"="},link:function(scope,element){function renderPinItButton(){if(scope.pinIt||watchAdded)scope.pinItUrl=$location.absUrl(),element.html('<a href="//www.pinterest.com/pin/create/button/?url='+scope.pinItUrl+"&media="+scope.pinItImage+"&description="+scope.pinIt+'" data-pin-do="buttonPin" data-pin-config="beside"><img src="//assets.pinterest.com/images/pidgets/pinit_fg_en_rect_gray_20.png" /></a>'),$window.parsePins(element.parent()[0]);else{watchAdded=!0;var unbindWatch=scope.$watch("pinIt",function(newValue){newValue&&(renderPinItButton(),unbindWatch())})}}$window.parsePins?renderPinItButton():!function(d){var f=d.getElementsByTagName("SCRIPT")[0],p=d.createElement("SCRIPT");p.type="text/javascript",p.async=!0,p.src="//assets.pinterest.com/js/pinit.js",p["data-pin-build"]="parsePins",p.onload=function(){$window.parsePins?renderPinItButton():setTimeout(p.onload,100)},f.parentNode.insertBefore(p,f)}($window.document);var watchAdded=!1}}}])}(),/*!
 * ngTagsInput v3.0.0
 * http://mbenford.github.io/ngTagsInput
 *
 * Copyright (c) 2013-2015 Michael Benford
 * License: MIT
 *
 * Generated at 2015-07-13 02:08:11 -0300
 */
function(){"use strict";var KEYS={backspace:8,tab:9,enter:13,escape:27,space:32,up:38,down:40,left:37,right:39,"delete":46,comma:188},MAX_SAFE_INTEGER=9007199254740991,SUPPORTED_INPUT_TYPES=["text","email","url"],tagsInput=angular.module("ngTagsInput",[]);tagsInput.directive("tagsInput",["$timeout","$document","$window","tagsInputConfig","tiUtil",function($timeout,$document,$window,tagsInputConfig,tiUtil){function TagList(options,events,onTagAdding,onTagRemoving){var getTagText,setTagText,tagIsValid,self={};return getTagText=function(tag){return tiUtil.safeToString(tag[options.displayProperty])},setTagText=function(tag,text){tag[options.displayProperty]=text},tagIsValid=function(tag){var tagText=getTagText(tag);return tagText&&tagText.length>=options.minLength&&tagText.length<=options.maxLength&&options.allowedTagsPattern.test(tagText)&&!tiUtil.findInObjectArray(self.items,tag,options.keyProperty||options.displayProperty)&&onTagAdding({$tag:tag})},self.items=[],self.addText=function(text){var tag={};return setTagText(tag,text),self.add(tag)},self.add=function(tag){var tagText=getTagText(tag);return options.replaceSpacesWithDashes&&(tagText=tiUtil.replaceSpacesWithDashes(tagText)),setTagText(tag,tagText),tagIsValid(tag)?(self.items.push(tag),events.trigger("tag-added",{$tag:tag})):tagText&&events.trigger("invalid-tag",{$tag:tag}),tag},self.remove=function(index){var tag=self.items[index];return onTagRemoving({$tag:tag})?(self.items.splice(index,1),self.clearSelection(),events.trigger("tag-removed",{$tag:tag}),tag):void 0},self.select=function(index){0>index?index=self.items.length-1:index>=self.items.length&&(index=0),self.index=index,self.selected=self.items[index]},self.selectPrior=function(){self.select(--self.index)},self.selectNext=function(){self.select(++self.index)},self.removeSelected=function(){return self.remove(self.index)},self.clearSelection=function(){self.selected=null,self.index=-1},self.clearSelection(),self}function validateType(type){return-1!==SUPPORTED_INPUT_TYPES.indexOf(type)}return{restrict:"E",require:"ngModel",scope:{tags:"=ngModel",text:"=?",onTagAdding:"&",onTagAdded:"&",onInvalidTag:"&",onTagRemoving:"&",onTagRemoved:"&",onTagClicked:"&"},replace:!1,transclude:!0,templateUrl:"ngTagsInput/tags-input.html",controller:["$scope","$attrs","$element",function($scope,$attrs,$element){$scope.events=tiUtil.simplePubSub(),tagsInputConfig.load("tagsInput",$scope,$attrs,{template:[String,"ngTagsInput/tag-item.html"],type:[String,"text",validateType],placeholder:[String,"Add a tag"],tabindex:[Number,null],removeTagSymbol:[String,String.fromCharCode(215)],replaceSpacesWithDashes:[Boolean,!0],minLength:[Number,3],maxLength:[Number,MAX_SAFE_INTEGER],addOnEnter:[Boolean,!0],addOnSpace:[Boolean,!1],addOnComma:[Boolean,!0],addOnBlur:[Boolean,!0],addOnPaste:[Boolean,!1],pasteSplitPattern:[RegExp,/,/],allowedTagsPattern:[RegExp,/.+/],enableEditingLastTag:[Boolean,!1],minTags:[Number,0],maxTags:[Number,MAX_SAFE_INTEGER],displayProperty:[String,"text"],keyProperty:[String,""],allowLeftoverText:[Boolean,!1],addFromAutocompleteOnly:[Boolean,!1],spellcheck:[Boolean,!0]}),$scope.tagList=new TagList($scope.options,$scope.events,tiUtil.handleUndefinedResult($scope.onTagAdding,!0),tiUtil.handleUndefinedResult($scope.onTagRemoving,!0)),this.registerAutocomplete=function(){var input=$element.find("input");return{addTag:function(tag){return $scope.tagList.add(tag)},focusInput:function(){input[0].focus()},getTags:function(){return $scope.tagList.items},getCurrentTagText:function(){return $scope.newTag.text()},getOptions:function(){return $scope.options},on:function(name,handler){return $scope.events.on(name,handler),this}}},this.registerTagItem=function(){return{getOptions:function(){return $scope.options},removeTag:function(index){$scope.disabled||$scope.tagList.remove(index)}}}}],link:function(scope,element,attrs,ngModelCtrl){var setElementValidity,hotkeys=[KEYS.enter,KEYS.comma,KEYS.space,KEYS.backspace,KEYS["delete"],KEYS.left,KEYS.right],tagList=scope.tagList,events=scope.events,options=scope.options,input=element.find("input"),validationOptions=["minTags","maxTags","allowLeftoverText"];setElementValidity=function(){ngModelCtrl.$setValidity("maxTags",tagList.items.length<=options.maxTags),ngModelCtrl.$setValidity("minTags",tagList.items.length>=options.minTags),ngModelCtrl.$setValidity("leftoverText",scope.hasFocus||options.allowLeftoverText?!0:!scope.newTag.text())},ngModelCtrl.$isEmpty=function(value){return!value||!value.length},scope.newTag={text:function(value){return angular.isDefined(value)?(scope.text=value,void events.trigger("input-change",value)):scope.text||""},invalid:null},scope.track=function(tag){return tag[options.keyProperty||options.displayProperty]},scope.$watch("tags",function(value){value?(tagList.items=tiUtil.makeObjectArray(value,options.displayProperty),scope.tags=tagList.items):tagList.items=[]}),scope.$watch("tags.length",function(){setElementValidity(),ngModelCtrl.$validate()}),attrs.$observe("disabled",function(value){scope.disabled=value}),scope.eventHandlers={input:{keydown:function($event){events.trigger("input-keydown",$event)},focus:function(){scope.hasFocus||(scope.hasFocus=!0,events.trigger("input-focus"))},blur:function(){$timeout(function(){var activeElement=$document.prop("activeElement"),lostFocusToBrowserWindow=activeElement===input[0],lostFocusToChildElement=element[0].contains(activeElement);!lostFocusToBrowserWindow&&lostFocusToChildElement||(scope.hasFocus=!1,events.trigger("input-blur"))})},paste:function($event){$event.getTextData=function(){var clipboardData=$event.clipboardData||$event.originalEvent&&$event.originalEvent.clipboardData;return clipboardData?clipboardData.getData("text/plain"):$window.clipboardData.getData("Text")},events.trigger("input-paste",$event)}},host:{click:function(){scope.disabled||input[0].focus()}},tag:{click:function(tag){events.trigger("tag-clicked",{$tag:tag})}}},events.on("tag-added",scope.onTagAdded).on("invalid-tag",scope.onInvalidTag).on("tag-removed",scope.onTagRemoved).on("tag-clicked",scope.onTagClicked).on("tag-added",function(){scope.newTag.text("")}).on("tag-added tag-removed",function(){scope.tags=tagList.items,ngModelCtrl.$setDirty()}).on("invalid-tag",function(){scope.newTag.invalid=!0}).on("option-change",function(e){-1!==validationOptions.indexOf(e.name)&&setElementValidity()}).on("input-change",function(){tagList.clearSelection(),scope.newTag.invalid=null}).on("input-focus",function(){element.triggerHandler("focus"),ngModelCtrl.$setValidity("leftoverText",!0)}).on("input-blur",function(){options.addOnBlur&&!options.addFromAutocompleteOnly&&tagList.addText(scope.newTag.text()),element.triggerHandler("blur"),setElementValidity()}).on("input-keydown",function(event){var shouldAdd,shouldRemove,shouldSelect,shouldEditLastTag,key=event.keyCode,addKeys={};if(!tiUtil.isModifierOn(event)&&-1!==hotkeys.indexOf(key)){if(addKeys[KEYS.enter]=options.addOnEnter,addKeys[KEYS.comma]=options.addOnComma,addKeys[KEYS.space]=options.addOnSpace,shouldAdd=!options.addFromAutocompleteOnly&&addKeys[key],shouldRemove=(key===KEYS.backspace||key===KEYS["delete"])&&tagList.selected,shouldEditLastTag=key===KEYS.backspace&&0===scope.newTag.text().length&&options.enableEditingLastTag,shouldSelect=(key===KEYS.backspace||key===KEYS.left||key===KEYS.right)&&0===scope.newTag.text().length&&!options.enableEditingLastTag,shouldAdd)tagList.addText(scope.newTag.text());else if(shouldEditLastTag){var tag;tagList.selectPrior(),tag=tagList.removeSelected(),tag&&scope.newTag.text(tag[options.displayProperty])}else shouldRemove?tagList.removeSelected():shouldSelect&&(key===KEYS.left||key===KEYS.backspace?tagList.selectPrior():key===KEYS.right&&tagList.selectNext());(shouldAdd||shouldSelect||shouldRemove||shouldEditLastTag)&&event.preventDefault()}}).on("input-paste",function(event){if(options.addOnPaste){var data=event.getTextData(),tags=data.split(options.pasteSplitPattern);tags.length>1&&(tags.forEach(function(tag){tagList.addText(tag)}),event.preventDefault())}})}}}]),tagsInput.directive("tiTagItem",["tiUtil",function(tiUtil){return{restrict:"E",require:"^tagsInput",template:'<ng-include src="$$template"></ng-include>',scope:{data:"="},link:function(scope,element,attrs,tagsInputCtrl){var tagsInput=tagsInputCtrl.registerTagItem(),options=tagsInput.getOptions();scope.$$template=options.template,scope.$$removeTagSymbol=options.removeTagSymbol,scope.$getDisplayText=function(){return tiUtil.safeToString(scope.data[options.displayProperty])},scope.$removeTag=function(){tagsInput.removeTag(scope.$index)},scope.$watch("$parent.$index",function(value){scope.$index=value})}}}]),tagsInput.directive("autoComplete",["$document","$timeout","$sce","$q","tagsInputConfig","tiUtil",function($document,$timeout,$sce,$q,tagsInputConfig,tiUtil){function SuggestionList(loadFn,options,events){var getDifference,lastPromise,getTagId,self={};return getTagId=function(){return options.tagsInput.keyProperty||options.tagsInput.displayProperty},getDifference=function(array1,array2){return array1.filter(function(item){return!tiUtil.findInObjectArray(array2,item,getTagId(),function(a,b){return options.tagsInput.replaceSpacesWithDashes&&(a=tiUtil.replaceSpacesWithDashes(a),b=tiUtil.replaceSpacesWithDashes(b)),tiUtil.defaultComparer(a,b)})})},self.reset=function(){lastPromise=null,self.items=[],self.visible=!1,self.index=-1,self.selected=null,self.query=null},self.show=function(){options.selectFirstMatch?self.select(0):self.selected=null,self.visible=!0},self.load=tiUtil.debounce(function(query,tags){self.query=query;var promise=$q.when(loadFn({$query:query}));lastPromise=promise,promise.then(function(items){promise===lastPromise&&(items=tiUtil.makeObjectArray(items.data||items,getTagId()),items=getDifference(items,tags),self.items=items.slice(0,options.maxResultsToShow),self.items.length>0?self.show():self.reset())})},options.debounceDelay),self.selectNext=function(){self.select(++self.index)},self.selectPrior=function(){self.select(--self.index)},self.select=function(index){0>index?index=self.items.length-1:index>=self.items.length&&(index=0),self.index=index,self.selected=self.items[index],events.trigger("suggestion-selected",index)},self.reset(),self}function scrollToElement(root,index){var element=root.find("li").eq(index),parent=element.parent(),elementTop=element.prop("offsetTop"),elementHeight=element.prop("offsetHeight"),parentHeight=parent.prop("clientHeight"),parentScrollTop=parent.prop("scrollTop");parentScrollTop>elementTop?parent.prop("scrollTop",elementTop):elementTop+elementHeight>parentHeight+parentScrollTop&&parent.prop("scrollTop",elementTop+elementHeight-parentHeight)}return{restrict:"E",require:"^tagsInput",scope:{source:"&"},templateUrl:"ngTagsInput/auto-complete.html",controller:["$scope","$element","$attrs",function($scope,$element,$attrs){$scope.events=tiUtil.simplePubSub(),tagsInputConfig.load("autoComplete",$scope,$attrs,{template:[String,"ngTagsInput/auto-complete-match.html"],debounceDelay:[Number,100],minLength:[Number,3],highlightMatchedText:[Boolean,!0],maxResultsToShow:[Number,10],loadOnDownArrow:[Boolean,!1],loadOnEmpty:[Boolean,!1],loadOnFocus:[Boolean,!1],selectFirstMatch:[Boolean,!0],displayProperty:[String,""]}),$scope.suggestionList=new SuggestionList($scope.source,$scope.options,$scope.events),this.registerAutocompleteMatch=function(){return{getOptions:function(){return $scope.options},getQuery:function(){return $scope.suggestionList.query}}}}],link:function(scope,element,attrs,tagsInputCtrl){var shouldLoadSuggestions,hotkeys=[KEYS.enter,KEYS.tab,KEYS.escape,KEYS.up,KEYS.down],suggestionList=scope.suggestionList,tagsInput=tagsInputCtrl.registerAutocomplete(),options=scope.options,events=scope.events;options.tagsInput=tagsInput.getOptions(),shouldLoadSuggestions=function(value){return value&&value.length>=options.minLength||!value&&options.loadOnEmpty},scope.addSuggestionByIndex=function(index){suggestionList.select(index),scope.addSuggestion()},scope.addSuggestion=function(){var added=!1;return suggestionList.selected&&(tagsInput.addTag(angular.copy(suggestionList.selected)),suggestionList.reset(),tagsInput.focusInput(),added=!0),added},scope.track=function(item){return item[options.tagsInput.keyProperty||options.tagsInput.displayProperty]},tagsInput.on("tag-added tag-removed invalid-tag input-blur",function(){suggestionList.reset()}).on("input-change",function(value){shouldLoadSuggestions(value)?suggestionList.load(value,tagsInput.getTags()):suggestionList.reset()}).on("input-focus",function(){var value=tagsInput.getCurrentTagText();options.loadOnFocus&&shouldLoadSuggestions(value)&&suggestionList.load(value,tagsInput.getTags())}).on("input-keydown",function(event){var key=event.keyCode,handled=!1;if(!tiUtil.isModifierOn(event)&&-1!==hotkeys.indexOf(key))return suggestionList.visible?key===KEYS.down?(suggestionList.selectNext(),handled=!0):key===KEYS.up?(suggestionList.selectPrior(),handled=!0):key===KEYS.escape?(suggestionList.reset(),handled=!0):key!==KEYS.enter&&key!==KEYS.tab||(handled=scope.addSuggestion()):key===KEYS.down&&scope.options.loadOnDownArrow&&(suggestionList.load(tagsInput.getCurrentTagText(),tagsInput.getTags()),handled=!0),handled?(event.preventDefault(),event.stopImmediatePropagation(),!1):void 0}),events.on("suggestion-selected",function(index){scrollToElement(element,index)})}}}]),tagsInput.directive("tiAutocompleteMatch",["$sce","tiUtil",function($sce,tiUtil){return{restrict:"E",require:"^autoComplete",template:'<ng-include src="$$template"></ng-include>',scope:{data:"="},link:function(scope,element,attrs,autoCompleteCtrl){var autoComplete=autoCompleteCtrl.registerAutocompleteMatch(),options=autoComplete.getOptions();scope.$$template=options.template,scope.$index=scope.$parent.$index,scope.$highlight=function(text){return options.highlightMatchedText&&(text=tiUtil.safeHighlight(text,autoComplete.getQuery())),$sce.trustAsHtml(text)},scope.$getDisplayText=function(){return tiUtil.safeToString(scope.data[options.displayProperty||options.tagsInput.displayProperty])}}}}]),tagsInput.directive("tiTranscludeAppend",function(){return function(scope,element,attrs,ctrl,transcludeFn){transcludeFn(function(clone){element.append(clone)})}}),tagsInput.directive("tiAutosize",["tagsInputConfig",function(tagsInputConfig){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ctrl){var span,resize,threshold=tagsInputConfig.getTextAutosizeThreshold();span=angular.element('<span class="input"></span>'),span.css("display","none").css("visibility","hidden").css("width","auto").css("white-space","pre"),element.parent().append(span),resize=function(originalValue){var width,value=originalValue;return angular.isString(value)&&0===value.length&&(value=attrs.placeholder),value&&(span.text(value),span.css("display",""),width=span.prop("offsetWidth"),span.css("display","none")),element.css("width",width?width+threshold+"px":""),originalValue},ctrl.$parsers.unshift(resize),ctrl.$formatters.unshift(resize),attrs.$observe("placeholder",function(value){ctrl.$modelValue||resize(value)})}}}]),tagsInput.directive("tiBindAttrs",function(){return function(scope,element,attrs){scope.$watch(attrs.tiBindAttrs,function(value){angular.forEach(value,function(value,key){attrs.$set(key,value)})},!0)}}),tagsInput.provider("tagsInputConfig",function(){var globalDefaults={},interpolationStatus={},autosizeThreshold=3;this.setDefaults=function(directive,defaults){return globalDefaults[directive]=defaults,this},this.setActiveInterpolation=function(directive,options){return interpolationStatus[directive]=options,this},this.setTextAutosizeThreshold=function(threshold){return autosizeThreshold=threshold,this},this.$get=["$interpolate",function($interpolate){var converters={};return converters[String]=function(value){return value},converters[Number]=function(value){return parseInt(value,10)},converters[Boolean]=function(value){return"true"===value.toLowerCase()},converters[RegExp]=function(value){return new RegExp(value)},{load:function(directive,scope,attrs,options){var defaultValidator=function(){return!0};scope.options={},angular.forEach(options,function(value,key){var type,localDefault,validator,converter,getDefault,updateValue;type=value[0],localDefault=value[1],validator=value[2]||defaultValidator,converter=converters[type],getDefault=function(){var globalValue=globalDefaults[directive]&&globalDefaults[directive][key];return angular.isDefined(globalValue)?globalValue:localDefault},updateValue=function(value){scope.options[key]=value&&validator(value)?converter(value):getDefault()},interpolationStatus[directive]&&interpolationStatus[directive][key]?attrs.$observe(key,function(value){updateValue(value),scope.events.trigger("option-change",{name:key,newValue:value})}):updateValue(attrs[key]&&$interpolate(attrs[key])(scope.$parent))})},getTextAutosizeThreshold:function(){return autosizeThreshold}}}]}),tagsInput.factory("tiUtil",["$timeout",function($timeout){var self={};return self.debounce=function(fn,delay){var timeoutId;return function(){var args=arguments;$timeout.cancel(timeoutId),timeoutId=$timeout(function(){fn.apply(null,args)},delay)}},self.makeObjectArray=function(array,key){if(!angular.isArray(array)||0===array.length||angular.isObject(array[0]))return array;var newArray=[];return array.forEach(function(item){var obj={};obj[key]=item,newArray.push(obj)}),newArray},self.findInObjectArray=function(array,obj,key,comparer){var item=null;return comparer=comparer||self.defaultComparer,array.some(function(element){return comparer(element[key],obj[key])?(item=element,!0):void 0}),item},self.defaultComparer=function(a,b){return self.safeToString(a).toLowerCase()===self.safeToString(b).toLowerCase()},self.safeHighlight=function(str,value){function escapeRegexChars(str){return str.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}if(!value)return str;str=self.encodeHTML(str),value=self.encodeHTML(value);var expression=new RegExp("&[^;]+;|"+escapeRegexChars(value),"gi");return str.replace(expression,function(match){return match.toLowerCase()===value.toLowerCase()?"<em>"+match+"</em>":match})},self.safeToString=function(value){return angular.isUndefined(value)||null==value?"":value.toString().trim()},self.encodeHTML=function(value){return self.safeToString(value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},self.handleUndefinedResult=function(fn,valueIfUndefined){return function(){var result=fn.apply(null,arguments);return angular.isUndefined(result)?valueIfUndefined:result}},self.replaceSpacesWithDashes=function(str){return self.safeToString(str).replace(/\s/g,"-")},self.isModifierOn=function(event){return event.shiftKey||event.ctrlKey||event.altKey||event.metaKey},self.simplePubSub=function(){var events={};return{on:function(names,handler){return names.split(" ").forEach(function(name){events[name]||(events[name]=[]),events[name].push(handler)}),this},trigger:function(name,args){var handlers=events[name]||[];return handlers.every(function(handler){return self.handleUndefinedResult(handler,!0)(args)}),this}}},self}]),tagsInput.run(["$templateCache",function($templateCache){$templateCache.put("ngTagsInput/tags-input.html",'<div class="host" tabindex="-1" ng-click="eventHandlers.host.click()" ti-transclude-append><div class="tags" ng-class="{focused: hasFocus}"><ul class="tag-list"><li class="tag-item" ng-repeat="tag in tagList.items track by track(tag)" ng-class="{ selected: tag == tagList.selected }" ng-click="eventHandlers.tag.click(tag)"><ti-tag-item data="::tag"></ti-tag-item></li></ul><input class="input" autocomplete="off" ng-model="newTag.text" ng-model-options="{getterSetter: true}" ng-keydown="eventHandlers.input.keydown($event)" ng-focus="eventHandlers.input.focus($event)" ng-blur="eventHandlers.input.blur($event)" ng-paste="eventHandlers.input.paste($event)" ng-trim="false" ng-class="{\'invalid-tag\': newTag.invalid}" ng-disabled="disabled" ti-bind-attrs="{type: options.type, placeholder: options.placeholder, tabindex: options.tabindex, spellcheck: options.spellcheck}" ti-autosize></div></div>'),$templateCache.put("ngTagsInput/tag-item.html",'<span ng-bind="$getDisplayText()"></span> <a class="remove-button" ng-click="$removeTag()" ng-bind="::$$removeTagSymbol"></a>'),$templateCache.put("ngTagsInput/auto-complete.html",'<div class="autocomplete" ng-if="suggestionList.visible"><ul class="suggestion-list"><li class="suggestion-item" ng-repeat="item in suggestionList.items track by track(item)" ng-class="{selected: item == suggestionList.selected}" ng-click="addSuggestionByIndex($index)" ng-mouseenter="suggestionList.select($index)"><ti-autocomplete-match data="::item"></ti-autocomplete-match></li></ul></div>'),$templateCache.put("ngTagsInput/auto-complete-match.html",'<span ng-bind-html="$highlight($getDisplayText())"></span>')}])}(),angular.module("modal/hellosign-tutorial.html",[]).run(function($templateCache){$templateCache.put("modal/hellosign-tutorial.html",'<div class="hellosign-modal">  <div class="modal-header">    <h3 class="modal-title">Non-Disclosure Agreement: Instructions</h3>  </div>  <div class="modal-body">    <ul>      <li ng-repeat="step in steps">        <div class="li-title">{{$index + 1}}</div>        <div class="li-content">{{step}}</div>        <div class="li-clear"></div>      </li>    </ul>    <div class="sign-warning">        <i class="icon-warning-sign"></i> e-Signature is legally binded in Non-Disclosure Agreement.    </div>  </div>  <div class="modal-footer">    <button ng-show="showContinue" class="btn btn-primary" ng-click="ok()">Continue</button>    <button class="btn" ng-click="cancel()">Cancel</button>  </div></div>')}),angular.module("template/appNote.html",[]).run(function($templateCache){$templateCache.put("template/appNote.html",'<div class="note-wrapper"><div class="note-loading" ng-show="loading"><i class="icon-spin icon-spinner"></i> Loading...</div><div class="note-li clearfix" ng-repeat="note in notes | reverse"><img class="pull-left" ng-src="{{ note.sender.small_avatar_url }}"><div class="note-li-container"><b ng-if="note.sender.level == \'mentor\'" class="note-li-name"><a ng-href="/{{ note.sender.username }}">{{ note.sender.name || note.sender.username }}</a></b><b ng-if="note.sender.level != \'mentor\'" class="note-li-username"><a ng-href="/{{ note.sender.username }}">{{ note.sender.name || note.sender.username }}</a></b><small class="muted note-li-ago">{{note.created_at | strftime: \'%b %-d, %l:%M %p\'}}</small><a ng-if="note.sender.username == User.username" confirmed-click="removeNote(note)"  ng-confirm-click="Are you sure you want to remove this note?" class="muted icon-remove note-li-remove"></a><div class="note-li-note" ng-bind-html="note.message | parseNote"></div></div></div><div class="note-li clearfix" ng-if="creatingNote"><img class="pull-left" ng-src="{{ User.avatarUrl }}"><div class="note-li-container"><b ng-if="User.isMentor" class="note-li-name"><a ng-href="/{{ User.username }}">{{ User.name || User.username }}</a></b><b ng-if="!User.isMentor" class="note-li-username">{{ User.name || User.username }}</b><div class="note-li-note"><i class="icon-spin icon-spinner"></i></div></div></div><div class="note-textarea clearfix"><img class="pull-left" ng-src="{{ currentUserAvatar}}"><div class="note-li-container note-li-actions"><textarea msd-elastic class="note-li-textarea" ng-model="newNote" placeholder="Add note here. (only you and {{oppositeName}} could see this)" rows="3"></textarea><div class="note-li-attach-files" ng-show="files.length>0"><attach-file file="f" ng-repeat="f in files"></div><div class="note-li-action-bar clearfix"><a href="#" class="note-li-action-link pull-left" ng-click="pickfile()"><i class="icon-paper-clip"></i> Attach File</a><button class="btn btn-primary" ng-click="createNote()">Send</button></div></div></div></div>'),$templateCache.put("template/attachFile.html",'<div class="attach-file"><a href="{{file.url}}" target="_blank">{{file.filename}}</a> <b>{{ file.size | fileSize }}</b><span class="act"><span class="attach-file-remove" ng-click="remove(file)"><i class="icon-remove"></i></span></span></div>')}),angular.module("appNote",["template/appNote.html"]).factory("Note",function($resource,appConfig){return $resource(appConfig.apiHost+"/api/questions/:question_id/messages/:id",{id:"@id",question_id:"@question_id"},{deleteNote:{method:"DELETE"}})}).directive("ngConfirmClick",function(){return{link:function(scope,element,attr){var msg=attr.ngConfirmClick||"Are you sure?",clickAction=attr.confirmedClick;element.bind("click",function(){window.confirm(msg)&&scope.$eval(clickAction)})}}}).directive("appNote",function($timeout,$rootScope,Note){return{restrict:"E",replace:!0,scope:!0,templateUrl:"template/appNote.html",controller:function($scope){$scope.$on("removeAttachFile",function(e,file){$scope.files=_.without($scope.files,file)})},link:function(scope,element,attrs){scope.loading=!0,scope.oppositeName=attrs.oppositeName,scope.currentUserAvatar=attrs.currentUserAvatar,scope.newNote="",scope.files=[],scope.notes=[];var textAreaElement=(angular.element(element.children()[1].children[1]),angular.element(element.children()[1].children[1].children[0]));"true"==attrs.initWithNotes&&$timeout(function(){scope.loadNotes()}),scope.loadNotes=function(){scope.notes=Note.query({question_id:attrs.questionId,mentor_id:attrs.mentorId},function(){scope.loading=!1})},scope.$on("loadNotesOfRequest-"+attrs.questionId,function(){scope.loadNotes()}),scope.pickfile=function(){filepicker.pick(function(InkBlob){scope.files.push(InkBlob),scope.$digest()})},scope.createNote=function(newContent){var content=newContent||scope.newNote;content&&(scope.creatingNote=!0,scope.files.length>0&&angular.forEach(scope.files,function(file){content+='\n[Attachment: <a codementor-attach-file target="_blank" href="'+file.url+'">'+file.filename+"</a>]"}),new Note({question_id:attrs.questionId,message:content,mentor_id:attrs.mentorId}).$save(function(note){scope.notes.unshift(note),scope.creatingNote=!1}),newContent||(scope.newNote=""),scope.files=[])},scope.removeNote=function(note){Note.deleteNote({question_id:attrs.questionId,id:note.id}).$promise.then(function(data){data.success&&(scope.notes=_.without(scope.notes,note))})},$rootScope.$on("onNoteAdd"+attrs.questionId,function(){textAreaElement.attr("placeholder","Tell more about how you can help. (only you and "+scope.oppositeName+" could see this)"),textAreaElement.focus(),textAreaElement.parent().addClass("highlight");var textWatcher=scope.$watch("newNote",function(newVal,oldVal){newVal!==oldVal&&(textAreaElement.attr("placeholder","Add note here. (only you and "+scope.oppositeName+" could see this)"),textAreaElement.parent().removeClass("highlight"),textWatcher())})}),scope.$on("$destroy",function(){delete $rootScope.$$listeners["onNoteAdd"+attrs.questionId]})}}}).directive("attachFile",function(){return{restrict:"E",replace:!0,templateUrl:"template/attachFile.html",scope:{file:"=file"},link:function(scope){scope.remove=function(file){scope.$emit("removeAttachFile",file),console.log("removeAttachFile")}}}}),angular.module("template/appSound.html",[]).run(function($templateCache){$templateCache.put("template/appSound.html",'<audio data-effect="notify"><source ng-src="{{CdnRoot + \'/notify.ogg\'}}" type="audio/ogg"><source ng-src="{{CdnRoot + \'/notify.mp3\'}}" type="audio/mpeg"></audio>')}),angular.module("appSound",["template/appSound.html"]).factory("Sound",function(){return{}}).directive("appSound",function(Sound){return{restrict:"E",templateUrl:"template/appSound.html",link:function(scope,element){angular.forEach(element.children(),function(child){Sound[child.dataset.effect]=function(){child.volume=.2,child.play()}})}}}),angular.module("template/appChat.html",[]).run(function($templateCache){$templateCache.put("template/appChat.html",'<app-chat-list></app-chat-list><app-chatbox var-chatroom="chatroom" var-messages="data[chatroom.id]" ng-repeat="chatroom in Chat.chatrooms | filter: {  isClosed: false, isHidden: false} | orderBy:\'lastOpenedAt\'"></app-chatbox><app-sys-chatbox var-chatroom="sysChatroom" var-messages="sysMessages" ng-if="User.isMember&&sysChatroom.isClosed==false"></app-sys-chatbox><div id="hidden-chat-container" ng-if="Chat.hiddenChatrooms().length>0"><div id="hidden-list" ng-show="showHiddenList"><div ng-click="Chat.openChatroom(chatroom); toggleHiddenList()"class="hidden-chatroom-name"ng-repeat="chatroom in hiddenList = (Chat.chatrooms | filter: { isClosed: false, isHidden: true }) | orderBy: \'lastOpenedAt\'">{{ chatroom.contact.name }}</div></div><div id="hidden-list-count" ng-click="toggleHiddenList()"><i class="icon-comment"></i><strong>{{ hiddenList.length }}</strong></div></div>')}),angular.module("template/appChatNotification.html",[]).run(function($templateCache){$templateCache.put("template/appChatNotification.html",'<div class="chatNotification pull-right ng-cloak"><a class="cm-notify" ng-class="{active:chatNoti.show}" href="#" ng-click="chatNoti.toggleNoti()"><i class="icon-comments"></i><i class="count" ng-hide="chatNoti.count<=0 || chatNoti.hideCount">{{chatNoti.count|min:99}}</i></a><div class="notification-list list-group" ng-show="chatNoti.show"><div class="list-group-heading clearfix"><h3 class="list-group-title pull-left">Inbox<img ng-src="{{ CdnRoot + \'/ajax-loader.gif\'}}" ng-cloak ng-show="chatNoti.loading"></h3></div><div class="list-group-body" prevent-body-scroll><div ng-class="{read:chatNoti.isRead(noti)}" class="list-group-item clearfix" ng-repeat="noti in chatNoti.notifications" ng-click="chatNoti.openChat(noti)"><span class="cm-avatar pull-left"><img ng-src="{{(User.username==noti.sender.username)?noti.receiver.avatar_url:noti.sender.avatar_url}}"></span><h4 class="list-group-item-heading">{{(User.username==noti.sender.username)?noti.receiver.name:noti.sender.name}}</h4><p class="list-group-item-text"><i class="icon-reply" style="font-size:12px; margin-right: 5px;" ng-show="User.username==noti.sender.username"></i>{{chatNoti.getContent(noti)|truncate:35}}</p><div class="muted time">{{noti.created_at | strftime: \'%b %-d, %l:%M %p\'}}</div></div><div class="empty-notification list-group-item read center" ng-cloak ng-show="chatNoti.notifications.length==0">No notifications.</div></div><div class="list-group-footer center clearfix"></div></div></div>')}),window.APPCHAT_VERSION=2,angular.module("appChat",["ngResource","ngSanitize","ui.keypress","mm.foundation.modal","mm.foundation.tpls","angularMoment","monospaced.elastic","uuid4","appFirebase","debounceService","notifyService","appSchedule","template/appChat.html","template/appChatNotification.html","preventBodyScroll"]).factory("ChatData",function($rootScope){return $rootScope.$new(!0)}).factory("NewChatData",function(Firebase,User){return Firebase("realtime/"+User.firebaseId+"/new_chat")}).factory("UnreadCount",function(Firebase,User){return Firebase("realtime/"+User.firebaseId+"/unread_count")}).factory("BindRooms",function(){return{}}).factory("SysChatData",function(){return{}}).factory("ChatNotificationData",function($resource,appConfig){return $resource(appConfig.apiHost+"/api/chatrooms")}).factory("Chat",function($filter,$window,$timeout,$rootScope,$http,appConfig,$localStorage,Firebase,FirebaseArray,User,ChatData,BindRooms,SysChatData,RefreshAlert,Sound){var ret={chatSideBar:!1,chatrooms:$localStorage.$default({chatrooms:[]}).chatrooms,chatList:$localStorage.$default({chatList:{isMinimized:!1}}).chatList,categoryID:null,chatBarMinimize:function(){$rootScope.$broadcast("disableChatBar"),this.chatSideBar=!1,this.chatList.isMinimized=!0},chatBarMaximize:function(){$rootScope.$broadcast("enableChatBar"),this.chatSideBar=!0,this.chatList.isMinimized=!1},maxChatBox:3,getChatroom:function(id){return $filter("filter")(this.chatrooms,{id:id},!0)[0]},openedChatrooms:function(){return this.chatrooms.filter(function(chatroom){return!chatroom.isClosed&&!chatroom.isHidden}).sort(function(c1){return c1.lastOpenedAt<c1.lastOpenedAt})},hiddenChatrooms:function(){return this.chatrooms.filter(function(chatroom){return!chatroom.isClosed&&chatroom.isHidden}).sort(function(c1){return c1.lastOpenedAt>c1.lastOpenedAt})},openHiddenChatroom:function(n){n=n||1;for(var hiddenChatrooms=this.hiddenChatrooms(),i=0;n>i;i++)hiddenChatrooms[i]&&(hiddenChatrooms[i].isClosed=!1,hiddenChatrooms[i].isMinimized=!1,hiddenChatrooms[i].isHidden=!1,hiddenChatrooms[i].lastOpenedAt=(new Date).getTime())},openChatroom:function(chatroom,config){if(User.username==chatroom.contact.username)return!1;User.isMember||(chatroom.id=chatroom.id||chatroom.contact&&chatroom.contact.username);var config=config||{},_chatroom=this.getChatroom(chatroom.id);
if(!config.silent){var openedChatrooms=this.openedChatrooms();if(openedChatrooms.length>=this.maxChatBox){var openedIds=_.map(openedChatrooms,function(c){return c.id});openedIds.indexOf(chatroom.id)<0&&_.each(openedChatrooms.slice(this.maxChatBox-1),function(c){c.isClosed=!1,c.isMinimized=c.isHidden=!0})}}if(_chatroom?(_chatroom.chats_path=chatroom.chats_path,config.silent||((_chatroom.isClosed||_chatroom.isHidden)&&(_chatroom.lastOpenedAt=(new Date).getTime()),_chatroom.isClosed=_chatroom.isMinimized=_chatroom.isHidden=!1,config.initMessage&&(_chatroom.initMessage=config.initMessage))):(_chatroom=this.chatrooms[this.chatrooms.push(angular.extend(chatroom,{isMinimized:!!config.close,isClosed:!!config.close,isHidden:!!config.close,initMessage:config.initMessage,isFake:!1}))-1],_chatroom.lastOpenedAt=(new Date).getTime()),$timeout(function(){_chatroom.doClick=!config.isNew}),config.infoMsg&&(_chatroom.infoMsg=config.infoMsg),User.isMember||(_chatroom.isFake=!0,_chatroom.ready=!0),!config.silent)try{amplitude.logEvent("/chat/open",{username:_chatroom.contact.username,signed_in:User.isMember})}catch(e){console.log(e)}if(chatroom.id&&!BindRooms[chatroom.id]&&User.isMember){var _init=!0,count=config.isNew?0:1;BindRooms[chatroom.id]=FirebaseArray(chatroom.id,function(fb){return fb.orderByChild("created_at").limitToLast(11)}),BindRooms[chatroom.id].$on$("child_added",function(snapshot){var message=snapshot.val();if(_chatroom.lastMessageKey=message.id,ChatData[chatroom.id]=ChatData[chatroom.id]||{},_init)ChatData[chatroom.id][message.id]=message;else{var sentByMe=!!_.find(ChatData[chatroom.id],function(val){return val.local?val.content===message.content:val.id===message.id});sentByMe||(ChatData[chatroom.id][message.id]=message)}if(!_init||0==count){var sender,blocked;sender=message.sender.username,blocked=_.contains(User.blocked_users,sender),_chatroom.isClosed||_chatroom.isHidden||(_chatroom.isMinimized=!1),ChatData.$emit(chatroom.id),sender!==User.username&&!blocked&&Sound.notify()}config.isNew&&count++}).$on$("child_changed",function(snapshot){var message=snapshot.val();ChatData[chatroom.id]=ChatData[chatroom.id]||{};var myMessage=_.find(ChatData[chatroom.id],function(val){return val.id==message.id});myMessage&&null==myMessage.readAt&&(myMessage.read_at=message.read_at,ChatData.$emit(chatroom.id))}).$once$("value",function(snapshot){null===snapshot.val()?$http.post(appConfig.apiHost+"/api/chatrooms/"+chatroom.contact.username+"/move-my-conversation").then(function(){},function(response){401==response.status&&RefreshAlert.open("logout")})["finally"](function(){_chatroom.ready=!0,$timeout(function(){_chatroom.doClick=!0})}):_chatroom.ready=!0}).$loaded(function(data){_init=!1,ChatData.$emit(chatroom.id),ChatData.$emit(chatroom.id+"_after_init",data)})}return _chatroom},openSysChatroom:function(){var _init=!0,_sysChatroom={isMinimized:!0,isClosed:!0},ref=Firebase("system_chatrooms/"+User.firebaseId);return ref.$loaded(function(){_init=!1}),ref.$on$("child_added",function(response){_init||(_sysChatroom.isClosed=_sysChatroom.isMinimized=!1),SysChatData[response.snapshot.name]=response.snapshot.value,_init||amplitude.logEvent("/system_message/receive",{message:response.snapshot.value})}),_sysChatroom},openChatroomViaAPI:function(opt){"string"==typeof opt&&(opt={username:opt}),opt&&opt.username&&$http.get(appConfig.apiHost+"/api/chat_info/"+opt.username).success(function(result){var chatbox=this.openChatroom({id:result.chats_path,contact:{name:opt.displayName||result.display_name,username:opt.username,avatarUrl:opt.img||result.avatar}},{infoMsg:opt.infoMsg,initMessage:opt.initMessage});opt.callback&&opt.callback(chatbox)}.bind(this)).error(function(data,status){401==status&&RefreshAlert.open("logout")})},resetChatBoxes:function(){var openedChatrooms=this.openedChatrooms(),diff=(this.hiddenChatrooms(),this.maxChatBox-openedChatrooms.length);0>diff?_.each(openedChatrooms.slice(this.maxChatBox),function(c){c.isClosed=!1,c.isMinimized=c.isHidden=!0}):diff>0&&this.openHiddenChatroom(diff)},send:function(username,content,config){this.openChatroomViaAPI({username:username,callback:function(chatbox){ChatData.$emit(chatbox.id+"-send",content,config)}})}};return window.addEventListener("cmOpenChat",function(ev){$rootScope.$apply(function(){ev.detail.chatroom?ret.openChatroom(ev.detail.chatroom,ev.detail.config):ret.openChatroomViaAPI(ev.detail)})}),window.addEventListener("cmSendChat",function(ev){$rootScope.$apply(function(){ret.send(ev.detail.username,ev.detail.content||{},ev.detail.config)})}),ret}).directive("doCompile",function($compile){return function(scope,element,attrs){var content=attrs.doCompile&&scope.$eval(attrs.doCompile);element.html(content),$compile(element.find("a[ng-click]"))(scope.$parent.$parent.$parent)}}).directive("appChatboxMessage",function($resource,$modal,$rootScope,User){return{restrict:"E",replace:!0,templateUrl:"/template/appChatboxMessage.html",scope:{contactUsername:"=",appChatboxObject:"=",message:"=varMessage",lastReadMessageId:"=varLastReadMessageId"},link:function(scope){scope.User=User,scope.mentorStartSign=function(signUrl,clientId,fromUser){$modal.open({templateUrl:"modal/hellosign-tutorial.html",controller:"HellosignModalInstanceCtrl",resolve:{showContinue:function(){return!1},steps:function(){var menteeName=fromUser,steps=["Once "+menteeName+" has completed and signed the Non-Disclosure Agreement, you will receive the agreement in your email address via HelloSign.","Please review carefully and sign the agreement electronically on HelloSign.","The final document will be sent to both "+menteeName+"'s and your email addresses. Please keep it for future reference."];return steps}}})},$rootScope.$on("onProfileImgChange",function(event,imgUrl){scope.User.avatarUrl=imgUrl})}}}).directive("appChatbox",function($timeout,$resource,$document,$modal,$rootScope,Idle,User,Schedule,Firebase,FirebaseArray,ChatData,Chat,BindRooms,SignUpForm,RefreshAlert,BlackBackground,NewModal,OfflineHelpModals){return{restrict:"E",replace:!1,templateUrl:"/template/appChatbox.html",scope:{chatroom:"=varChatroom",messages:"=varMessages"},controllerAs:"chatbox",controller:function($rootScope,$window,$scope,$http,appConfig,uuid4,User,Modal,NewModal){if(!$scope.chatroom.contact.username){var i=Chat.chatrooms.indexOf($scope.chatroom);return i>=0&&Chat.chatrooms.splice(i,1),!1}var that=this;$scope.messageNum=10,$scope.showMore=!1,$scope.moreLoading=!1,$scope.chatroom.showToolbox=!1,$scope.chatroom.mentorAskSession=!1,$scope.chatroom.contact.blocked=_.contains(User.blocked_users,$scope.chatroom.contact.username),$scope.chatroom.contact.favorited=_.contains(User.favorite_users,$scope.chatroom.contact.username),$scope.self=this,$scope.contactUsername=$scope.chatroom.contact.username,$scope.showOnVacationMsg=!1,$scope.onVacation=!1,$scope.lastReadMessageId="",$document.click(function(){$scope.chatroom.showToolbox=!1,$scope.$digest()});var getMsgKeys=function(ms){return ms.$add?_.filter(Object.keys(ms||{}),function(k){return k&&"-"==k[0]}):Object.keys(ms||{})};User.isUser&&$http.get(appConfig.apiHost+"/api/users/"+$scope.contactUsername+"/on_vacation").success(function(result){$scope.showOnVacationMsg=result.on_vacation,$scope.onVacation=result.on_vacation}),this.closeLatestReq=function(){this.latestReq&&localStorage.setItem("latest-request-"+$scope.chatroom.contact.username,this.latestReq.id),this.showLatestReq=!1}.bind(this),this.viewLatestReqDetails=function(){amplitude.logEvent("Click View Details (Latest Request) in Chat Box",{opposite:$scope.chatroom.contact.username})};var hasViewedLatestReq=function(req){var viewLatestReqId=localStorage.getItem("latest-request-"+$scope.chatroom.contact.username);return viewLatestReqId==req.id};this.prepareLatestReq=function(req){req?(this.latestReq=req,hasViewedLatestReq(req)?this.showLatestReq=!1:this.showLatestReq=!0):(this.latestReq=null,this.showLatestReq=!1)}.bind(this),$scope.chatroom.contact.username&&$http.get(appConfig.apiHost+"/api/chat_info/"+$scope.chatroom.contact.username).success(function(result){result&&_.isNumber(result.timezone_offset)&&($scope.oppositeTimezoneOffset=result.timezone_offset,that.oppositeTimezoneOffset=result.timezone_offset,User.isMentor&&(that.suspicious=result.is_suspicious||result.is_locked,that.suspended=result.is_suspended,that.newToService=result.is_new_to_service,that.prepareLatestReq(result.latest_request)))}),$scope.$watch("messages",function(ms){ms&&$timeout(function(){var msgLength=getMsgKeys(ms).length;msgLength-$scope.messageNum>1&&($scope.messageNum=msgLength-1),$scope.showMore=msgLength>$scope.messageNum,getLastReadMessageId()},0)}),ChatData.$on($scope.chatroom.id,function(){if($scope.messages){var msgLength=getMsgKeys($scope.messages).length;msgLength-$scope.messageNum>1&&($scope.messageNum=msgLength-1),getLastReadMessageId()}}),ChatData.$on($scope.chatroom.id+"_after_init",function(e,data){data&&0!=data.length?checkLastMessageCreatedAt(data,36e5):that.getResponseInfo(function(result){(result.chats_response_rate<.6||result.chats_response_time>86400)&&($scope.showNotResponsiveMsg=!0)}),getLastReadMessageId()});var checkLastMessageCreatedAt=function(msgs,seconds){if(msgs&&User.isUser){var msgLength=getMsgKeys(msgs).length,sentMsCount=_.countBy(msgs,function(m){return m.sender.username})[User.username],lastMsg=_.sortBy(msgs,function(m){return-m.created_at})[0];lastMsg&&10>msgLength&&msgLength==sentMsCount&&Date.now()-lastMsg.created_at>seconds?that.getResponseInfo(function(result){null===result.chats_response_time?$scope.responseTimeDisplay="a long time":result.chats_response_time<86400?$scope.responseTimeDisplay="a few hours":$scope.responseTimeDisplay="a day",$scope.showNoReplyMsg=!0}):$scope.showNoReplyMsg=!1}},getLastReadMessageId=function(){setShowAvatarAndTime();var temp_clone=_.clone($scope.messages),temp_array=[];_.mapObject(temp_clone,function(msg){msg.sender.username===User.username&&temp_array.push(msg)}),temp_array.reverse();var lastReadMessage=_.find(temp_array,function(msg){return msg.read_at});lastReadMessage?$scope.lastReadMessageId=lastReadMessage.id:$scope.lastReadMessageId=null},setShowAvatarAndTime=function(){_.mapObject($scope.messages,function(msg){msg.showTime=!1,msg.hoverTime=moment(msg.created_at).format("MMM DD, YYYY, h:mm a")});var temp_array=[];_.mapObject($scope.messages,function(msg){temp_array.push(msg)});var index=0;_.mapObject($scope.messages,function(msg){var diffDays=moment().diff(moment(temp_array[index].created_at),"days");if(temp_array[index-1]){var diffPrevMessage=temp_array[index].created_at-temp_array[index-1].created_at;(1>=diffDays&&diffPrevMessage>=6e5||diffDays>1&&diffPrevMessage>=864e5)&&(msg.showTime=moment(temp_array[index].created_at).fromNow(),diffDays>1&&(msg.showTime=msg.hoverTime)),1===index&&$scope.showMore&&(msg.showTime=msg.hoverTime)}else 0!==index||$scope.showMore||(msg.showTime=msg.hoverTime);index+=1})};if(ChatData.$on($scope.chatroom.id+"-send",function(e,content,config){that.send(content,config)}),ChatData.$on($scope.chatroom.id+"-send-pending",function(event,args){that.send(args.content,{type:"pending_msg"})}),this.userOnline=!1,this.getChatroomID=function(){return $scope.chatroom.id},this.more=function(){var currentChatsHash=ChatData[$scope.chatroom.id];if(!$scope.moreLoading&&Object.keys(currentChatsHash).length){$scope.moreLoading=!0;var moreFb=FirebaseArray($scope.chatroom.id,function(ref){var messages=_.map(currentChatsHash,function(msg){return msg}),oldestMessage=_.sortBy(messages,function(m){return m.created_at})[0];return ref.orderByChild("created_at").endAt(oldestMessage.created_at).limitToLast(11)});moreFb.$once$("value",function(snapshot){var newMessages=snapshot.val();$scope.moreLoading=!1,_.extend(currentChatsHash,newMessages),ChatData.$emit($scope.chatroom.id)})}},this.timezoneToolToggled=!1,this.toggleTimezoneTool=function(){this.timezoneToolToggled=!this.timezoneToolToggled},this.checkConnectionForMonthly=function(e){if(!this.userOnline){var statusTxt=this.presence.$value||"offline";"session"==statusTxt&&(statusTxt="in a session"),$scope.alertMsg=$scope.chatroom.contact.name+" is currently "+statusTxt+". Please schedule a session or leave a message",e.stopPropagation(),e.preventDefault()}},this.showToolbarButtonInfo=function(msg,fn,event){msg===!0?($scope.toolbarButtonInfo=this._prevToolbarButtonInfo,this._onExtraInfoClick=this._prevOnExtraInfoClick,angular.element(this._prevToolbarButtonTarget).addClass("active"),this._toolbarButtonTarget=this._prevToolbarButtonTarget):(this._prevToolbarButtonInfo=$scope.toolbarButtonInfo,this._prevOnExtraInfoClick=this._onExtraInfoClick,this._prevToolbarButtonTarget=this._toolbarButtonTarget,msg?($scope.toolbarButtonInfo=msg,this._onExtraInfoClick=fn,this._toolbarButtonTarget=event.target):($scope.toolbarButtonInfo="",this._onExtraInfoClick=function(){},angular.element(this._toolbarButtonTarget).removeClass("active"),this._toolbarButtonTarget=null))}.bind(this),this.onExtraInfoClick=function(e){this._onExtraInfoClick(e,$scope.chatroom.contact)}.bind(this),this.read=function(opt){opt=opt||{};var lastMessage=_.find($scope.messages,function(val){return val.id===$scope.chatroom.lastMessageKey});(opt.force||lastMessage&&!lastMessage.read_at&&lastMessage.receiver.username===User.username)&&(lastMessage&&(lastMessage.read_at=(new Date).getTime()),$http.post(appConfig.apiHost+"/api/chatrooms/"+$scope.chatroom.contact.username+"/read").success(function(){Idle.cancelIdleTimer()}).error(function(data,status){401==status&&RefreshAlert.open("logout")}))},this.openMenteeRecentRequestsModal=function(){amplitude.logEvent("Mentee Recent Requests Modal Opened",{mentee:$scope.chatroom.contact.username}),NewModal.open("mentee-recent-requests",{windowClass:"mentee-recent-requests-modal",mentee:$scope.chatroom.contact,footer:!1})},this.suggestTime=function(timeObj){this.send(timeObj,{type:"suggestTime"})}.bind(this),this.uploadFile=function(){filepicker.pick(function(InkBlob){this.send(InkBlob,{type:"file"})}.bind(this))}.bind(this),User.isMentor){var username=User.username.replace(/\./g,"^"),MentorPresence=Firebase("presence/"+username+"/magic");MentorPresence.$on$("value",function(response){var _v=response.snapshot.value;$.isEmptyObject(_v)?$scope.MentorPresence="offline":$scope.MentorPresence=_v})}var checkOnlineBeforeStartSession=function(callback){"offline"==$scope.MentorPresence||"away"==$scope.MentorPresence||"session"==$scope.MentorPresence?($scope.alertMsg="You are currently not online. Please change your status before asking to start a session.",$scope.chatroom.mentorAskSession=!1):callback()};this.startSession=function(sessionLink){checkOnlineBeforeStartSession(function(){$scope.chatroom.mentorAskSession=!1,this.findScheduleCluster()?this.send({},{type:"schedule_cluster_connect"}):sessionLink?this.send({},{type:"sessionLink",sessionLink:sessionLink}):this.send({},{type:"connect"})}.bind(this))}.bind(this),this.startFreeSession=function(){checkOnlineBeforeStartSession(function(){$scope.chatroom.mentorAskSession=!1,this.send({},{type:"freeConnect"})}.bind(this))}.bind(this),this.attachRequest=function(){Modal.open("choose-request",{title:"Attach Request Information",actions:["Cancel","Attach"],data:{mentor:$scope.chatroom.contact.username}}).then(function(result){this.send(result,{type:"request"})}.bind(this))}.bind(this),this.sendNda=function(){var modalInstance=$modal.open({windowClass:"hellosign-modal-frame",templateUrl:"modal/hellosign-tutorial.html",controller:"HellosignModalInstanceCtrl",resolve:{showContinue:function(){return!0},steps:function(){var mentorName=$scope.chatroom.contact.name,steps=["Press Continue to initiate a Non-Disclosure Agreement request with "+mentorName+". You will receive an email with a Non-Disclosure Agreement template provided by Codementor via HelloSign.","You will be asked to fill in project and personal information in the Non-Disclosure Agreement.  After you sign electronically, the agreement will be sent to "+mentorName+"'s email address.",mentorName+" will review the details and sign the agreement.","The final document will be sent to both "+mentorName+"'s and your email addresses. Please keep it for future reference."];return steps}}}),self=this;modalInstance.result.then(function(){var signResource=$resource("/start_NDA",{},{post:{method:"POST",isArray:!1}});$resource("/mentee_done_NDA",{},{post:{method:"POST",isArray:!1}});BlackBackground.open(!0),signResource.post(null,{mentor:$scope.chatroom.contact.username},function(data){data.mentee_sign_url,data.mentor_signature_id,data.signature_request_id,data.client_id;self.send({fromUser:User.name,general:!1},{type:"signature"}),BlackBackground.remove()},function(){BlackBackground.remove()})})}.bind(this),this.startSessionFromLinkInChat=function(link){User.isMentor?alert("Please wait for user joining the sesssion room first."):window.location.href=link},this.send=function(content,config){if($scope.chatroom.isFake){SignUpForm.open({onopen:function(){angular.element('input[name="user[pending_msg_content]"]').val(content),angular.element('input[name="user[pending_msg_mentor]"]').val($scope.chatroom.contact.username),"/get-help-now"!=window.location.pathname&&angular.element('input[name="user[after_sign_in_url]"]').val(window.location.pathname)},title:"Please Sign Up to Continue",extraInfo:"The message for "+$scope.chatroom.contact.name+" will be sent after signing up.",becomeMentorLink:!1});try{amplitude.logEvent("/message/prelogin",{message:content})}catch(e){console.log(e)}return void localStorage.removeItem("ngStorage-chatrooms")}var config=config||{type:"message"},message={id:uuid.v1(),chats_path:$scope.chatroom.id,type:config.type,created_at:{".sv":"timestamp"},read_at:null,sender:User,receiver:$scope.chatroom.contact};switch(config.type){case"message":message.content=content,$scope.chatroom.input="";break;case"pending_msg":message.content=content,message.is_pending_msg=!0,message.type="message",$scope.chatroom.input="";break;case"sessionLink":message.request={sessionLink:config.sessionLink};break;default:message.request=content}if(Idle.cancelIdleTimer(),content){var localRandomKey="local-"+Math.floor(1e6*Math.random()).toString();message.created_at=(new Date).getTime(),message.local=!0,ChatData[$scope.chatroom.id]=ChatData[$scope.chatroom.id]||{},ChatData[$scope.chatroom.id][localRandomKey]=message,ChatData.$emit($scope.chatroom.id),$http.post(appConfig.apiHost+"/api/chatrooms/"+$scope.chatroom.contact.username,{message:message}).success(function(res){ChatData[$scope.chatroom.id][localRandomKey].id=res.id,ChatData[$scope.chatroom.id][localRandomKey].local=!1,ChatData[$scope.chatroom.id][localRandomKey].created_at=res.created_at,$rootScope.$emit("NewComingChatMsg",message)}).error(function(data,status){401==status&&RefreshAlert.open("logout")});try{amplitude.logEvent("/chat/send/message",{to:$scope.chatroom.contact.username})}catch(e){console.log(e)}}},this.close=function(){if(this.expanded)this.toggleExpand();else{Chat.hiddenChatrooms();$scope.chatroom.input="",$scope.chatroom.isClosed=!0,$scope.chatroom.isMinimized=!0,$scope.chatroom.isHidden=!0,Chat.openHiddenChatroom()}},this.toggleToolbox=function(show,e){if($scope.chatroom.showToolbox=show,show&&($scope.chatroom.oppositeTimezoneOffsetText=!1,_.isNumber($scope.oppositeTimezoneOffset))){var timezoneTxt=timezoneToText(-($scope.oppositeTimezoneOffset/60));$scope.chatroom.oppositeTimezoneOffsetText=(new Date).offset(1e3*$scope.oppositeTimezoneOffset).strftime("%a %l:%M %p ")+"GMT"+timezoneTxt.sign+timezoneTxt.h+timezoneTxt.m}e.stopPropagation()},this.toggleMentorAskSession=function(show){$scope.alertMsg="",$scope.chatroom.mentorAskSession=show},User.isMember&&!User.isMentor&&$scope.$watch(function(){return User.favorite_users.length},function(){$scope.chatroom.contact.favorited=_.contains(User.favorite_users,$scope.chatroom.contact.username)}),this.favorite=function(e){e.stopPropagation(),$scope.chatroom.contact.favorited=!0,$http.post("/users/favorite_users/"+$scope.chatroom.contact.username),User.favorite_users.push($scope.chatroom.contact.username)},this.unfavorite=function(e){e.stopPropagation(),$scope.chatroom.contact.favorited=!1,$http["delete"]("/users/favorite_users/"+$scope.chatroom.contact.username),User.favorite_users=_.reject(User.favorite_users,function(n){return n==$scope.chatroom.contact.username})},this.openReportModal=function(e){e.stopPropagation(),NewModal.open("report-user",{username:$scope.chatroom.contact.username,name:$scope.chatroom.contact.name,isMentor:!User.isMentor,footer:!1,windowClass:"report-user-modal new-modal",ok:that.reportUser})},this.reportUser=function(result){result.reason||(result.reason="other");var data=_.extend(result,{username:$scope.chatroom.contact.username});$http.post("/users/report_user",data).success(function(){window.showMessage("notice","Thanks for helping us make Codementor a better community.  Our team will review this shortly.")}).error(function(){window.showMessage("error","Some error occurred, please try again later")})},this.block=function(e){e.stopPropagation(),$scope.chatroom.contact.blocked=!0,$http.post(appConfig.apiHost+"/api/users/block/"+$scope.chatroom.contact.username).success(function(){$rootScope.$broadcast("BlockUser",$scope.chatroom.contact.username)}).error(function(){$scope.chatroom.contact.blocked=!1})},this.unblock=function(e){e.stopPropagation(),$scope.chatroom.contact.blocked=!1,$http.post(appConfig.apiHost+"/api/users/unblock/"+$scope.chatroom.contact.username).success(function(){$rootScope.$broadcast("UnblockUser",$scope.chatroom.contact.username)}).error(function(){$scope.chatroom.contact.blocked=!0})},this.openOfflineHelpModal=function(e){e.stopPropagation(),$scope.chatroom.contact.blocked||OfflineHelpModals.openRequestModal($scope.chatroom.contact.username,$scope.chatroom.contact.name)},this.goToScheduleCluster=function(){var sc=that.findScheduleCluster();$window.location.href="/dashboard#/monthly/"+sc.id},this.connect=function(mentor){if(User.isMentor)return void alert("Please ask "+$scope.chatroom.contact.name+' to click on the "Start Session" invitation.');if(this.userOnline)Schedule.showConnectForm({mentor:mentor,from:"chat-box"}).then(function(){$scope.chatroom.isMinimized=!0;try{amplitude.logEvent("/chat/connect/now/start/session",{to:mentor.username})}catch(e){console.log(e)}}.bind(this));else{var statusTxt=this.presence.$value||"offline";"session"==statusTxt&&(statusTxt="in a session"),$scope.alertMsg=$scope.chatroom.contact.name+" is currently "+statusTxt+". Please schedule a session or leave a message"}}.bind(this),this.schedule=function(e,mentor){mentor||(mentor=e),Schedule.showScheduleForm({mentor:mentor,from:"chat-box"}).then(function(){try{amplitude.logEvent("/chat/schedule",{to:mentor.username})}catch(e){console.log(e)}})},this.findScheduleCluster=function(){return User.isMentor?_.findWhere(User.mentored_schedule_clusters,{username:$scope.chatroom.contact.username}):_.findWhere(User.schedule_clusters,{mentor_username:$scope.chatroom.contact.username})},this.getStartScheduleClusterSessionPath=function(){var sc=that.findScheduleCluster();return sc?"/questions/connect_realtime?username="+$scope.chatroom.contact.username+"&schedule_cluster_id="+sc.id:""},this.getResponseInfo=function(callback){$http.get(appConfig.apiHost+"/api/users/"+$scope.contactUsername+"/response_info").success(callback)},$scope.$watch("chatroom.isClosed",function(newValue){var willOpen=!newValue;willOpen&&(this.read({force:!0}),$scope.goBottom())}.bind(this)),this.getHelpNow=function(e,from){window.IHRc&&window.IHRc.getHelpNow(event,from)},$scope.$watch("chatroom.isMinimized",function(newValue){var willOpen=!newValue,hasOpened=!$scope.chatroom.isClosed;willOpen&&hasOpened&&(this.read(),$scope.goBottom())}.bind(this)),_.contains(User.targets,md5($scope.chatroom.contact.username))||(this.presence=Firebase("presence/"+$scope.chatroom.contact.username.replace(/\./g,"^")+"/magic"),this.presence.$on$("value",function(response){var _v=response.snapshot.value;$.isEmptyObject(_v)?(this.userOnline=!1,$scope.alertMsg=""):("offline"==_v||"session"==_v?this.userOnline=!1:this.userOnline=!0,$scope.alertMsg="")}.bind(this)))},link:function(scope,element){var textBox=element.find(".appChatbox-action"),contentBox=element.find(".appChatbox-dialog");scope.User=User,scope.$watch("chatroom.doClick",function(yes){yes&&($timeout(function(){element.find("textarea")[0].focus()}),scope.chatroom.doClick=!1)}),scope.$watch("chatroom.initMessage",function(text){if(text){var origin=scope.chatroom.input||" ";scope.chatroom.input=origin+text,scope.chatroom.initMessage=""}}),element.click(function(e){e.target==element.get(0)&&scope.chatbox.toggleExpand()}),scope.$on("elastic:resize",function(e,$ta){$ta=$ta||element.find("textarea");var taHeight=parseInt($ta[0].style.height,10),newHeight=306-taHeight-11,diff=contentBox.height()-newHeight;textBox.height(taHeight+1),scope.chatbox.expanded?110>taHeight?contentBox.css({height:"calc(100vh - 200px - "+taHeight+"px)","max-height":"calc(100vh - 200px - "+taHeight+"px)"}):contentBox.css({height:"calc(100vh - 310px)","max-height":"calc(100vh - 310px)"}):newHeight>=186&&(contentBox.height(newHeight),scope.rescroll(diff))}),scope.chatbox.toggleExpand=function(){scope.chatbox.expanded=!scope.chatbox.expanded,scope.chatbox.expanded?(angular.element("body").css("overflow","hidden"),angular.element("app-chat").addClass("fullscreen"),element.addClass("fullscreen")):(angular.element("body").css("overflow","auto"),angular.element("app-chat").removeClass("fullscreen"),element.removeClass("fullscreen")),scope.$emit("elastic:resize"),scope.goBottom(),scope.chatroom.isMinimized=!1,element.find("textarea")[0].focus()},scope.goBottom=function(){$timeout(function(){contentBox.get(0).scrollTop=contentBox.get(0).scrollHeight},0)},scope.rescroll=function(diff){$timeout(function(){contentBox.get(0).scrollTop+=diff},0)},scope.$on("goBottom",scope.goBottom)}}}).directive("timezoneTool",function(User){return{restrict:"E",templateUrl:"/template/timezoneTool.html",scope:{chatbox:"=vmChat",oppositeDetail:"=oppositeDetail"},controllerAs:"vm",controller:function($scope){var vm=this;vm.oppositeDetail=$scope.oppositeDetail,vm.oppositeTimezone=0;var getOppositeTimeFormat=function(timestamp){var utcOffset=vm.oppositeTimezone;return moment(1e3*timestamp).utcOffset(utcOffset).format("ddd, hh:mma, MMM DD, YYYY UTCZ")},getTimeObject=function(timestamp,utc){var m=moment(1e3*timestamp).utcOffset(utc||moment().utcOffset());return{unix:timestamp,month:m.format("MMMM"),date:m.format("DD"),day:m.format("dddd"),hour:m.format("HH"),hour12:m.format("hh"),ampm:m.format("a"),minute:m.format("mm"),utc:m.format("Z")}},getDateOfWeekOptions=function(timestamp){for(var m=moment(1e3*timestamp),options=[],i=0;7>i;i++)options.push({date:m.format("DD"),day:m.format("ddd"),unix:m.unix()}),m.add(1,"day");return options},getHourOptions=function(timestamp){var nowUnix=moment().unix(),m=moment(1e3*timestamp),hours=_.map(_.range(0,24),function(n){return("0"+n).slice(-2)}),options={};for(var i in hours)options[hours[i]]=nowUnix>m.hour(parseInt(hours[i])).unix();return options},getMinuteOptions=function(timestamp){var nowUnix=moment().unix(),m=moment(1e3*timestamp),minutes=["00","30"],options={};for(var i in minutes)options[minutes[i]]=nowUnix>m.minute(parseInt(minutes[i])).unix();return options},updateTimeOptions=function(timestamp){return{datesInfo:getDateOfWeekOptions(timestamp),hours:getHourOptions(timestamp),minutes:getMinuteOptions(timestamp)}},isAfterNow=function(timestamp){var m=moment(1e3*timestamp);return moment().unix()<m.unix()},listener=$scope.$watch("chatbox.oppositeTimezoneOffset",function(newValue,oldValue){newValue!=oldValue&&(vm.oppositeTimezone=$scope.chatbox.oppositeTimezoneOffset/60,vm.oppositeUserTimeFormat=getOppositeTimeFormat(vm.timeSelected.unix),listener())}),getFormatedNowUnix=function(){var miniteBiggerThanThirty=moment().minute()>30;return miniteBiggerThanThirty?moment().minute(30).add(30,"minute").unix():moment().minute(30).unix()};vm.timeSelected=getTimeObject(getFormatedNowUnix()),vm.oppositeUserTimeFormat=getOppositeTimeFormat(vm.timeSelected.unix),vm.timeOptions=updateTimeOptions(getFormatedNowUnix()),vm.checkIsAfterNow=function(timestamp){return isAfterNow(timestamp)},vm.selectDate=function(index){var m=moment(1e3*vm.timeSelected.unix),mSelected=moment(1e3*vm.timeOptions.datesInfo[index].unix),unix=m.month(mSelected.month()).date(mSelected.date()).unix();isAfterNow(unix)||(unix=getFormatedNowUnix()),vm.timeSelected=getTimeObject(unix),vm.timeOptions.hours=getHourOptions(vm.timeSelected.unix),vm.timeOptions.minutes=getMinuteOptions(vm.timeSelected.unix),vm.oppositeUserTimeFormat=getOppositeTimeFormat(vm.timeSelected.unix)},vm.selectHour=function(index){var unix=moment(1e3*vm.timeSelected.unix).hour(parseInt(index)).unix();isAfterNow(unix)&&(vm.timeSelected=getTimeObject(unix),vm.oppositeUserTimeFormat=getOppositeTimeFormat(vm.timeSelected.unix))},vm.selectMinute=function(index){var unix=moment(1e3*vm.timeSelected.unix).minute([0,30][index]).unix();isAfterNow(unix)&&(vm.timeSelected=getTimeObject(unix),vm.oppositeUserTimeFormat=getOppositeTimeFormat(vm.timeSelected.unix))},vm.nextNDays=function(n){var lastTimeOptionMoment=moment(1e3*vm.timeOptions.datesInfo[6].unix);vm.timeSelected=getTimeObject(moment(1e3*vm.timeSelected.unix).add(n,"day").unix()),vm.timeOptions=updateTimeOptions(lastTimeOptionMoment.add(1,"day").unix()),vm.oppositeUserTimeFormat=getOppositeTimeFormat(vm.timeSelected.unix)},vm.prevNDays=function(n){var lastSevenDayUnix=moment(1e3*vm.timeOptions.datesInfo[0].unix).subtract(7,"day").hour(vm.timeSelected.hour).minute(vm.timeSelected.minute).unix(),lastNDayUnix=moment(1e3*vm.timeSelected.unix).subtract(n,"day").unix();isAfterNow(lastSevenDayUnix)||isAfterNow(lastNDayUnix)||(lastSevenDayUnix=lastNDayUnix=getFormatedNowUnix()),vm.timeSelected=getTimeObject(lastNDayUnix),vm.timeOptions=updateTimeOptions(lastSevenDayUnix),vm.oppositeUserTimeFormat=getOppositeTimeFormat(vm.timeSelected.unix)},vm.nextMonth=function(){var unix=moment(1e3*vm.timeSelected.unix).date(1).add(1,"month").unix();vm.timeSelected=getTimeObject(unix),vm.timeOptions=updateTimeOptions(unix),vm.oppositeUserTimeFormat=getOppositeTimeFormat(vm.timeSelected.unix)},vm.prevMonth=function(){var unix=moment(1e3*vm.timeSelected.unix).subtract(1,"month").unix();isAfterNow(unix)||(unix=getFormatedNowUnix()),vm.timeSelected=getTimeObject(unix),vm.timeOptions=updateTimeOptions(unix),vm.oppositeUserTimeFormat=getOppositeTimeFormat(vm.timeSelected.unix)},vm.send=function(){var packet={};packet[vm.oppositeDetail.username]=getTimeObject(vm.timeSelected.unix,vm.oppositeTimezone),packet[User.username]=vm.timeSelected,$scope.chatbox.suggestTime(packet),$scope.chatbox.toggleTimezoneTool()},vm.dismiss=function(){$scope.chatbox.toggleTimezoneTool()}}}}).directive("appSysChatbox",function($timeout){return{restrict:"E",replace:!1,templateUrl:"/template/appSysChatbox.html",scope:{chatroom:"=varChatroom",messages:"=varMessages"},controllerAs:"chatbox",controller:function($scope){this.close=function(){$scope.chatroom.isClosed=!0},this.minimized=function(){$scope.chatroom.isMinimized=!0}},link:function(scope,element){var contentBox=element.find(".appChatbox-dialog");scope.goBottom=function(){$timeout(function(){contentBox.get(0).scrollTop=contentBox.get(0).scrollHeight},0)},scope.$on("goBottom",scope.goBottom)}}}).directive("scrollBottom",function(){return function(scope){scope.$last===!0&&scope.$emit("goBottom")}}).directive("appChatNotification",function($resource,$rootScope,$http,appConfig,ChatNotificationData,User,Chat,Idle,UnreadCount,RefreshAlert,notify){return{restrict:"E",replace:!0,templateUrl:"template/appChatNotification.html",controllerAs:"chatNoti",controller:function($scope){this.show=!1,this.count=0,this.hideCount=!1,this.loading=!1,this.notifications=[],this._clickOut=function(event){$(event.target).parents(".chatNotification").size()>0||$(event.target).hasClass("chatNotification")||($(document).off("click",this._clickOut),$(document).off("touchend",this._clickOut),this.show=!1,$scope.$digest())}.bind(this),this.toggleNoti=function(){this.show||(this.hideCount=!0,notify.updateTitleNotify(0,!1,"chat"),this.getNoti()),this.show=!this.show,this.show&&($(document).on("click",this._clickOut),$(document).on("touchend",this._clickOut))}.bind(this),this.getNoti=function(){this.loading=!0,ChatNotificationData.query(function(data){this.loading=!1;var that=this;this.notifications=_.reject(data,function(noti){return that.isBlocked(noti)});var unread=_.filter(this.notifications,function(noti){return!that.isRead(noti)});this.count=unread.length;
}.bind(this),function(err){console.log(err),this.loading=!1,err&&401==err.status&&RefreshAlert.open("logout")}.bind(this))}.bind(this),UnreadCount.$on$("value",function(data){this.count=data.snapshot.value?data.snapshot.value.count:0,notify.updateTitleNotify(this.count,!1,"chat")}.bind(this));var _read=function(id){var target=_.find(this.notifications,function(noti){return noti.id==id?noti:void 0});if(!target.read_at){target.read_at=(new Date).toJSON(),this.count-=1,this.count<0&&(this.count=0);var targetUser=target.sender.username==User.username?target.receiver:target.sender;$http.post(appConfig.apiHost+"/api/chatrooms/"+targetUser.username+"/read").success(function(){Idle.cancelIdleTimer()}).error(function(data,status){401==status&&RefreshAlert.open("logout")})}}.bind(this);this.openChat=function(noti){_read(noti.id);var targetUser=noti.sender.username==User.username?noti.receiver:noti.sender;Chat.openChatroom({id:noti.chats_path,contact:{name:targetUser.name,username:targetUser.username,avatarUrl:targetUser.avatar_url}}),this.show=!1,$scope.$$phase||$scope.$digest()}.bind(this),this.isRead=function(noti){return noti.sender.username===User.username?!0:noti.read_at?new Date(noti.read_at)<new Date:!1},this.isBlocked=function(noti){return!(!_.contains(User.blocked_users,noti.sender.username)&&!_.contains(User.blocked_users,noti.receiver.username))},this.getContent=function(noti){switch(noti.type){case"request":return"[Request] "+noti.request.title;case"file":return"[File] "+noti.request.filename;case"connect":return"Please click Start Session to connect with me.";case"freeConnect":return"Please click here to have a free info session with me.";case"signature":return noti.request.general?"[NDA Request] "+noti.request.msg:"[NDA Request] Please review and sign the Non Disclosure Agreement";default:return noti.content}},$scope.User=User,$rootScope.$on("NewComingChatMsg",function(){this.hideCount=!1}.bind(this)),$rootScope.$on("UnblockUser",function(){this.hideCount=!1}.bind(this)),this.getNoti()},link:function(){}}}).directive("appChatList",function($http,appConfig,$rootScope,$timeout,$caser,User,Chat,ChatData,RefreshAlert,Rating){return{restrict:"E",scope:!0,templateUrl:"/templates/appChatList.html",replace:!1,controllerAs:"chatList",controller:function($scope){function _rejectBlockedUsers(list){return list.recent_chats=_.reject(list.recent_chats,function(v){return _.contains(User.blocked_users,that.oppositeUser(v).username)}),list.category_chats=_.map(list.category_chats,function(category){return category.chat_list=_.reject(category.chat_list,function(v){_.contains(User.blocked_users,that.oppositeUser(v).username)}),category}),list.my=_.reject(list.my,function(v){return _.contains(User.blocked_users,that.oppositeUser(v).username)}),list}var that=this,init=!1;that.list={recent_chats:[],category_chats:[],my:[]},that.loading=!0,that.recentChatLimit=20,that.myListLimit=20,that.noMoreList=!1,that.noMoreMy=!1,that.tab="category",$scope.Rating=Rating,$rootScope.$on("BlockUser",function(e,username){User.blocked_users.push(username),that.list=_rejectBlockedUsers(that.list)}),$rootScope.$on("UnblockUser",function(e,username){User.blocked_users=_.reject(User.blocked_users,function(v){return v==username}),that.update()});var _checkIfChange=function(){return!0};if(that.update=function(){var updateUrl;updateUrl=User.isMember?appConfig.apiHost+"/api/chatrooms/list":appConfig.apiHost+"/api/public_chat_list",Chat.categoryID&&(updateUrl+="?category_id="+Chat.categoryID),$http.get(updateUrl).success(function(data){data=_rejectBlockedUsers(data),that.list&&!_checkIfChange(data)||(that.list=data),!init&&that.list.recent_chats.length&&(that.tab="recent"),init=!0,that.loading=!1,that.list.recent_chats.length<=that.recentChatLimit&&(that.noMoreList=!0),that.list.my.length<=that.myListLimit&&(that.noMoreMy=!0)}).error(function(data,status){that.loading=!1,401==status&&RefreshAlert.open("logout")})},$rootScope.$on("NewComingChatMsg",function(e,msg){var existingMessage=_.find(that.list.recent_chats,function(r){return r.chats_path===msg.chats_path});existingMessage?_.extend(existingMessage,$caser.toSnakeCase(msg)):that.list.recent_chats.push($caser.toSnakeCase(msg))}),this.signup=function(){$("#signup-modal").modal()},that.oppositeUser=function(obj){return obj.mentor?obj.mentor.username==User.username?obj.mentee:obj.mentor:obj.sender.username==User.username?obj.receiver:obj.sender},that.openChat=function(obj){var targetUser=that.oppositeUser(obj);Chat.openChatroom({id:obj.chats_path,contact:{name:targetUser.name,username:targetUser.username,avatarUrl:targetUser.avatar_url}})},that.sortByStatus=function(obj){var user=that.oppositeUser(obj);switch(obj.presence){case"available":return 4*new Date(user.created_at).getTime();case"online":return 3*new Date(user.created_at).getTime();case"away":return 2*new Date(user.created_at).getTime();default:return 1*new Date(user.created_at).getTime()}},that.sortByStatusAndFavorite=function(obj){var user=that.oppositeUser(obj),isFavorited=_.contains(User.favorite_users,user.username);return isFavorited?500*new Date(user.created_at).getTime():that.sortByStatus(obj)},that.sortByCreatedAt=function(obj){return new Date(obj.created_at).getTime()},that.loadMoreList=function(){that.recentChatLimit=that.recentChatLimit+10,that.list.recent_chats.length<=that.recentChatLimit&&(that.noMoreList=!0)},that.loadMoreMy=function(){that.myListLimit=that.myListLimit+10,that.list.my.length<=that.myListLimit&&(that.noMoreMy=!0)},that.domChatboxDialog=angular.element(".appChatbox-dialog"),that.domRecentChats=angular.element(".appChatList-recent-chats"),User.pending_msg_data){var pmd=User.pending_msg_data;Chat.openChatroom({id:pmd.chats_path,contact:{name:pmd.mentor_name,username:pmd.mentor_username,avatarUrl:pmd.mentor_avatar_url}});$timeout(function(){ChatData.$emit(pmd.chats_path+"-send-pending",{content:pmd.content})})}that.toggleFooter=function(){angular.element("footer.signed-in").toggleClass("active"),that.infoActive=!that.infoActive},that.isFavorited=function(u){return _.contains(User.favorite_users,u.username)},that.update(),User.isMember&&!User.isMentor&&$scope.$watch(function(){return User.favorite_users.length},function(){that.update(),$(".popoverProfileParent").mouseleave(function(e){$(e.currentTarget).remove()})})}}}).directive("appChat",function(User,ChatData,NewChatData,BindRooms,SysChatData,Chat,Idle,$timeout,Firebase,debounce,$rootScope){return{restrict:"E",templateUrl:"template/appChat.html",link:function(scope,elem,attrs){if(attrs.category&&(Chat.categoryID=attrs.category),User.username){scope.data=ChatData,angular.forEach(Chat.chatrooms,function(room){room.chats_path&&0==room.isClosed?Chat.openChatroom({id:room.id,contact:room.contact,chats_path:room.chats_path},{silent:!0}):room.isClosed=!0});var init=!0;NewChatData.$loaded(function(){init=!1}),NewChatData.$on$("value",function(response){if(response.val()&&!init&&!_.contains(User.blocked_users,response.snapshot.value.sender.username)){var message=response.val(),_contact=message.sender.username===User.username?"receiver":"sender";Chat.openChatroom({id:message.chats_path,contact:{name:message[_contact].name,username:message[_contact].username,avatarUrl:message[_contact].avatarUrl},chats_path:message.chats_path},{isNew:!0});Idle.idleTimer||Idle.setIdleTimer(),$rootScope.$emit("NewComingChatMsg",message)}}),scope.sysChatroom=Chat.openSysChatroom(),scope.sysMessages=SysChatData,scope.showHiddenList=!1,scope.toggleHiddenList=function(){scope.showHiddenList=!scope.showHiddenList}}scope.$watch("Viewport.width",function(w){w>0&&(w>=1280?gon.minimize_chat_side_bar?(gon.minimize_chat_side_bar=!1,Chat.chatBarMinimize()):Chat.chatBarMaximize():Chat.chatBarMinimize(),w>1685?Chat.maxChatBox=4:w>1389?Chat.maxChatBox=3:w>1119?Chat.maxChatBox=2:Chat.maxChatBox=1,Chat.resetChatBoxes())})}}}),angular.module("template/appAlert.html",[]).run(function($templateCache){$templateCache.put("template/appAlert.html",'<div class="center alert">   <a class="close" data-dismiss="alert">\xd7</a>   <div class="msg" ng-transclude></div></div>')}),angular.module("modal/crop-image-modal.html",[]).run(function($templateCache){$templateCache.put("modal/crop-image-modal.html",'<div class="profile-modal">  <div class="modal-header">    <h3 class="modal-title">Crop Photo</h3>  </div>  <div class="modal-body">    <div id="profile-wrapper" class="profile-wrapper-modal">      <img ng-show="!showImg" ng-src="{{ CdnRoot + \'/ajax-loader.gif\' }}" class="ng-hide">      <img id="profile-image-crop" ng-show="showImg" ng-cloak ng-src="{{imgUrl}}">      <div id="profile-image-frame" ng-show="showImg" class="profile-frame-modal">        <div class="inner-frame">        </div>      </div>    </div>  </div>  <div class="modal-footer">    <button ng-show="showImg" class="btn btn-primary" ng-click="ok()">Crop</button>    <button class="btn" ng-click="cancel()">Cancel</button>  </div></div>')}),angular.module("appExpertiseSorting",[]).directive("appExpertiseSorting",function(){return{restrict:"A",controller:function($scope){$scope.sortable=!1,$scope.changeMode=function(){$scope.sortable=!$scope.sortable},$scope.updateRanking=function(){}},link:function(scope,element){element.find(".cm-expertise-item").click(function(e){return element.hasClass("sortable")?(e.preventDefault(),e.stopPropagation(),!1):void 0}),scope.$watch("sortable",function(nVal){nVal===!0?scope.sortableObj=new Sortable(element.find(".cm-expertise-list")[0],{ghostClass:"sortable-ghost",onUpdate:function(){element.find(".cm-expertise-list li").each(function(i){element.find(".expertiseRank"+$(this).data("id")).val(i)}),scope.$digest()}}):scope.sortableObj&&scope.sortableObj.destroy()})}}}),angular.module("appPayoutSettings",[]).directive("appPayoutSettings",function(){return{restrict:"A",controller:function($scope){$scope.init=function(method){$scope.payoutMethod=method},$scope.onChange=function(){}},link:function(){}}}),angular.module("appPopoverProfile",["userInfoService","appSchedule","appFavorite"]).factory("PopoverStorage",function(){return{}}).directive("popoverProfile",function($compile,$q,$modal,$sessionStorage,$timeout,$window,$http,Viewport,Chat,User,PopoverStorage,userInfo){return{restrict:"A",replace:!1,scope:{username:"@popoverProfile",placement:"@",hideAction:"@"},link:function(scope,element){function getScrollOffsets(w){if(w=w||window,null!=w.pageXOffset)return{x:w.pageXOffset,y:w.pageYOffset};var d=w.document;return"CSS1Compat"==document.compatMode?{x:d.documentElement.scrollLeft,y:d.documentElement.scrollTop}:{x:d.body.scrollLeft,y:d.body.scrollTop}}function setPopoverHeight(){var obj=scope.popoverDom;if(obj){var scrollY=getScrollOffsets($window).y;obj.position().top-scrollY<0?$(".popover.popoverProfileParent").css("top",scrollY+5+"px"):obj.height()+obj.position().top>scrollY+$(window).height()&&$(".popover.popoverProfileParent").css("top",scrollY+$(window).height()-obj.height()-5+"px")}}function hitLocalStorage(){return _.findWhere(scope.$storage.mentor,{username:scope.username})}function open(){opened=!0,firstOpen?($(element).popover("show"),$(element).popover("hide"),$(element).popover("show"),firstOpen=!1):$(element).popover("show")}function openPopover(event){return User.isMentor||!scope.username||Viewport.width<790?!1:(scope.mouseEvent=event,scope.cancel=!1,$(element).mouseleave(function(){scope.cancel=!0}),void $timeout(function(){if(!opened&&!scope.cancel){var mentor_data,mentor_local=hitLocalStorage();if(void 0===mentor_local){var promise=userInfo.getUserInfo(scope.username);promise.then(function(data){""===data||scope.cancel||(mentor_data=data.data,mentor_data.username===scope.username&&(scope.mentor=mentor_data,scope.gravatar_profile_image=mentor_data.gravatar_profile_image,scope.$storage.mentor.push({username:mentor_data.username,mentor_data:mentor_data}),open()))},function(err){return err})}else scope.mentor=mentor_local.mentor_data,scope.gravatar_profile_image=scope.mentor.gravatar_profile_image,open()}},300))}if(User.isMentor)return!1;scope.uuid=uuid.v1();var html='<div rel="popover" class="popoverProfile '+scope.uuid+'" id="mentor_popover"  ng-mouseleave="mouseleave(100)" ng-mouseenter="cancelClose()"><favorite-star ng-attr-username="{{username}}" ng-if="user.isMember"></favorite-star><div class="mentor_popover_container"><div class="popover-header"><div class="popover-gravatar"><img ng-src="{{gravatar_profile_image}}" class="img-circle"></div><div class="popover-info"><div class="mentor_popover_name"><a ng-href="/{{username}}" ng-bind="mentor.name"></a></div><div class="rating" ng-show="mentor.rating>0"><span class="star" ng-repeat="i in range(mentor.rating) track by $index" ng-if="i !== undefined"> \u2605 </span><span class="star empty" ng-repeat="i in range(5-mentor.rating) track by $index" ng-if="i !== undefined"> \u2605 </span></div><div ng-switch="mentor.reason" class="price" ng-if="User.isMember||!mentor.hide_my_rate"><strong>${{mentor.rate}}</strong> <small>/15min</small> <small ng-switch-when="special_deal" class="muted">(special rate)</small><small ng-switch-when="longterm_rate" class="muted">(long-term mentorship rate)</small><small ng-switch-when="group_rate" class="muted">({{mentor.group.title}} rate)</small></div><div class="free-length" ng-if="mentor.free_length>0"><small class="red">First {{mentor.free_length/60}} Minutes Free</small></div><div class="session-count" ng-if="getSessionCount()>0"><small class="muted">{{getSessionCount()}} session{{(getSessionCount()>1)?"s":""}}</small></div></div></div><div class="popover-actions" ng-if="!hideAction && !User.isMentor"><div class="btn btn-success" ng-click="startMsg();hide();">Get Help From {{mentor.first_name}}</div></div></div></div>';scope.$storage=PopoverStorage,scope.$storage.mentor=scope.$storage.mentor||[];var opened=!1,firstOpen=!0;element.popover({animation:!1,trigger:"manual",html:!0,container:"body",viewport:{selector:"body",padding:0},placement:scope.placement||"right",content:function(){return $compile(html)(scope)}}),element.on("shown.bs.popover",function(){scope.popoverDom=$("."+scope.uuid).parents(".popover"),scope.popoverDom.addClass("popoverProfileParent"),$timeout(function(){setPopoverHeight()},0)}),$(element).bind("mouseenter",function(event){scope.mouseenter(event)}),$(element).bind("mouseleave",function(){scope.mouseleave(100)}),scope.timer=null,scope.getSessionCount=function(){return scope.mentor?parseInt(scope.mentor.finished_session):0},scope.cancelClose=function(){scope.timer&&$timeout.cancel(scope.timer)},scope.range=function(n){return _.range(n)},scope.hide=function(){scope.cancel=!0,$(element).popover("hide")},scope.mouseleave=function(interval){scope.timer=$timeout(function(){opened=!1,scope.hide()},interval)},scope.mouseenter=function(event){openPopover(event),$timeout.cancel(scope.timer)},scope.user=User,element.bind("click",function(){scope.hide()})},controller:function($scope){$scope.startMsg=function(){Chat.openChatroom({id:$scope.mentor.chats_path,contact:{name:$scope.mentor.name,username:$scope.mentor.username,avatarUrl:$scope.mentor.gravatar_profile_image}})}}}}),angular.module("appSelectAllText",[]).directive("appSelectAllText",function(){return function(scope,element){element.on("click",function(){element[0].select()})}}),angular.module("appWelcomeMat",[]).directive("welcomeMat",function($rootScope,$timeout,$window){return{restrict:"E",scope:!0,templateUrl:"/templates/app-welcome-mat.html",replace:!0,controller:function(){},link:function(scope,element,attrs){scope.disableWelcomeMat=!0,scope.actionContent=attrs.actionContent,scope.title=attrs.title,scope.description=attrs.description,scope.url=attrs.url;var now=(new Date).getTime();if(!bowser.mobile&&angular.element("body").width()>768&&angular.element("body").height()>650&&(null==localStorage.getItem("welcomeMat/"+attrs.actionContent)||1==localStorage.getItem("welcomeMat/"+attrs.actionContent)||now-localStorage.getItem("welcomeMat/"+attrs.actionContent)>864e5)){window.optimizely=window.optimizely||[],window.optimizely.push(["activate",4159264425]),window.optimizely.push(["activate",4152925185]);var counter=0,startScrolling=!1,currentPosition=angular.element("body").scrollTop();scope.disableWelcomeMat=!1,scope.fadeIn=!0,localStorage.setItem("welcomeMat/"+attrs.actionContent,now),amplitude.logEvent("openWelcomeMat",{type:attrs.actionContent}),angular.element($window).on("scroll",function(){counter+=1,35==counter?(scope.fadeIn=!1,angular.element($window).scrollTop(currentPosition),angular.element("body").addClass("overflow-hidden"),scope.$digest(),$timeout(function(){startScrolling=!0,angular.element("body").removeClass("overflow-hidden"),amplitude.logEvent("closeWelcomeMat",{type:attrs.actionContent,method:"scroll"})},50)):35>counter?angular.element($window).scrollTop(currentPosition):startScrolling||angular.element($window).scrollTop(currentPosition)}),scope.hideWelcomeMat=function(btnType){scope.fadeIn=!1,startScrolling=!0,counter=36,amplitude.logEvent(btnType,{type:attrs.actionContent,method:"click-btn"})}}}}}),angular.module("genAvatar",[]).directive("genAvatar",function(){return{restrict:"E",scope:{url:"@gaUrl",type:"@gaType",lastName:"@gaName"},template:'<img class="noti-avatar" ng-class="{\'without-radius\': vm.isCustomIcon(type)}" ng-src="{{ vm.getAvatarUrl(type, url) }}" check-src />     <div class="noti-avatar with-text" style="display: none;">{{ lastName.toUpperCase() | limitTo: 1  }}</div>',controller:function(){var vm=this,urlMap={new_related_request:"/assets/notification/REQUEST.png",new_review:"/assets/notification/REVIEW.png",schedule_created:"/assets/notification/SCHEDULE.png",new_related_schedule_cluster:"/assets/notification/MONTHLY.png",hire_task_broadcast:"/assets/notification/FOR_HIRE.png"},getImageCheckingPath=function(url){return url.indexOf("www.gravatar.com")>-1?url+"&d=404":url};vm.isCustomIcon=function(type){return Object.keys(urlMap).indexOf(type)>-1},vm.getAvatarUrl=function(type,url){return urlMap[type]||getImageCheckingPath(url)}},compile:function(element){return{post:function(){element.parent().removeClass("rendering")}}},controllerAs:"vm"}}).directive("checkSrc",function(){return{link:function(scope,element,attrs){element.bind("error",function(){attrs.src!=attrs.errSrc&&(element.css("display","none"),element.next().css("display","flex"))})}}}),angular.module("preventBodyScroll",[]).directive("preventBodyScroll",function(){return{restrict:"A",link:function(scope,element){var isOverScroll=function(element,delta){var isOverScrollDown=function(){var scrollHeightNow=element.innerHeight()+element.scrollTop(),scrollBarHeight=element.get(0).scrollHeight;return scrollHeightNow>=scrollBarHeight&&0>delta},isOverScrollUp=function(){var scrollHeightNow=element.scrollTop();return 0==scrollHeightNow&&delta>0};return isOverScrollUp()||isOverScrollDown()};element.bind("mousewheel DOMMouseScroll",function(e){var eo=e.originalEvent,delta=eo.wheelDelta||-eo.detail;isOverScroll(element,delta)&&e.preventDefault()})}}}),angular.module("appAlert",["appUser","template/appAlert.html"]).service("Alert",function(){function neverAskAgainCookie(name){return"never-ask-"+name+"-again"}var that=this;that.alerts=[],that.addCookieAlert=function(msgType,msg,name,htmlUnsafe){var alert={name:name,cookieAlert:!0};$.cookie(neverAskAgainCookie(name))||("notice"==msgType?alert.type="alert-success":alert.type="alert-"+msgType,alert.type+=" cookie-alert",htmlUnsafe?alert.msgHtmlUnsafe=msg:alert.msg=msg,that.alerts.push(alert))},that.addAlert=function(msgType,msg,name,htmlUnsafe){var alert={name:name};"notice"==msgType?alert.type="alert-success":alert.type="alert-"+msgType,htmlUnsafe?alert.msgHtmlUnsafe=msg:alert.msg=msg,that.alerts.push(alert)},that.neverAskAgain=function(name){that.alerts=_.reject(that.alerts,function(alert){return alert.name==name}),$.cookie(neverAskAgainCookie(name),!0,{path:"/",expires:365})},that.pop=function(){return that.alerts.pop()}}).controller("AlertCtrl",function(Payment,Alert,User,$scope){var alertHtml;$scope.Alert=Alert,$scope.openPaymentSettingForm=function(){Payment.openSettingForm({backdrop:!0})},User.isMember&&!User.confirmed?(alertHtml=User.isUser?'Please confirm your email address before you can start a session.  <a href="/auth/resend_email_confirmation" data-method="post">Resend email confirmation</a>':User.isApprovedApplicant?'Congrats!  You\'ve been approved as a mentor but you\'ll need to confirm your email.  <a href="/auth/resend_email_confirmation" data-method="post">Resend email confirmation</a>':'Please confirm your email address.  <a href="/auth/resend_email_confirmation" data-method="post">Resend email confirmation</a>',Alert.addAlert("warning",alertHtml,"ask-set-payment-and-test-session",!0)):!User.isMember||User.isMentor||!User.isUser||User.hadLessonBefore||gon.dontShowSetUpAlert||(alertHtml=(User.hasPayment||User.team_id)&&User.cardAuthorized||User.credit>0?'Make sure you\'re properly set up!  Please <a href="/session?intro=true" target="_blank">try a test session</a>.':'Make sure you\'re properly set up!  Please <a href="/session?intro=true" target="_blank">try a test session</a> and <a href="#" ng-click="openPaymentSettingForm()">set up billing info</a>.',Alert.addCookieAlert("notice",alertHtml,"ask-set-payment-and-test-session",!0))}).directive("msgHtmlUnsafe",function($compile){return{restrict:"A",replace:!0,link:function(scope,ele,attrs){scope.$watch(attrs.msgHtmlUnsafe,function(html){ele.html(html),$compile(ele.contents())(scope)})}}}).directive("appAlert",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"template/appAlert.html"}}),angular.module("appApplicantNew",[]).factory("ApplicantNewUtils",function(){return{scrollTo:function(selector){var to=parseInt(selector);to||(to=($(selector).offset()||{}).top||0),$("html, body").animate({scrollTop:Math.max(to,0)},800)}}}).controller("applicantNewCtrl",function($scope,ApplicantNewUtils){$scope.scrollTo=function(position){ApplicantNewUtils.scrollTo(position)}}),angular.module("appAvatar",[]).directive("avatar",function(){return{restrict:"E",replace:!0,templateUrl:"template/avatar.html",scope:{},controller:function(){},link:function(scope,elem,attrs){scope.username=attrs.name,scope.userAvatarUrl=attrs.imgSrc.replace("d=mm","d=404");var shortName=function(name){return name?name.replace(/[^\w]/g,"")[0]||"":""};elem.find("img").on("error",function(){scope.userShortName=shortName(attrs.name).toUpperCase(),scope.$digest()})}}}).run(function($templateCache){$templateCache.put("template/avatar.html",'<span>    <img ng-hide="!!userShortName" class="img-circle avatar" ng-src="{{userAvatarUrl}}" alt="{{username}}" title="{{username}}">    <div class="customizeAvatar" ng-show="!!userShortName">{{userShortName}}</div>  </span>')}),angular.module("appBlogShow",[]).controller("blogShowCtrl",function($timeout,$scope){$("body").attr("id","skrollr-body"),bowser.mobile||$timeout(function(){$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(){}})},0),$scope.popReceiveTutorialForm=function(){$("#email_collection_modal").modal()}}),angular.module("appBlogList",[]).controller("blogListCtrl",function($timeout,$scope){$("body").attr("id","skrollr-body"),bowser.mobile||$timeout(function(){$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(){}})},0)}),angular.module("appBusiness",[]).factory("BusinessUtils",function(){return{scrollTo:function(selector){var to=parseInt(selector);to||(to=($(selector).offset()||{}).top||0),$("html, body").animate({scrollTop:Math.max(to-30,0)},400)}}}).controller("businessCtrl",function($scope,BusinessUtils){this.scrollTo=function(selector){BusinessUtils.scrollTo(selector)}}),angular.module("appCategory",["ngTagsInput"]).factory("TagUtils",function($q,$http){return{convert:function(text){return text.toLowerCase().replace(/[^#\+\-\.0-9A-Za-z]/g,"-").replace(/-+/g,"-")},loadTags:function(query){return $http.get(gon.agoliaCategoryURL+"?query="+query,{withCredentials:!1,headers:{"X-CSRF-TOKEN":void 0,"X-Algolia-API-Key":gon.agoliaAPIKey,"X-Algolia-Application-Id":gon.agoliaAPPID}}).then(function(response){return _.map(response.data.hits,function(category){return{text:category.name}})})},recommand:function(tags){var deferred=$q.defer(),tagsStr=_.map(tags,function(t){return t.text}).join(";").replace("#","%23");return $.getJSON("https://api.stackexchange.com/2.2/tags/"+tagsStr+"/related?site=stackoverflow&key=LecJZYqlUgzwPLAVNQ6KYA((",function(data){deferred.resolve(data)}),deferred.promise}}}).controller("CategoryCtrl",function($scope,$timeout,TagUtils){$scope.requiredWarning=!1,$scope.max=0,$scope.recommandations=[],$scope.tags=$scope.realTags||[],$scope.defaultRecommandations=[],$scope.updateTags=$scope.updateTags||function(){},$scope.onInit=$scope.onInit||function(){},$scope.recommandCount=10,$scope.enableRecommand=!0,this.initTags=function(tags){tags&&($scope.tags=_.map(tags,function(tag){return{text:tag}}),$scope.onInit($scope.tags)),this.id&&$scope.$parent.$on("changeTags_"+this.id,function(e,tags){0==tags.length?$timeout(function(){$scope.tags=[]}):$scope.tags=_.map(tags,function(t){return{text:TagUtils.convert(t)}})}.bind(this))},this.setDefaultRecommand=function(tagSet){$scope.recommandations=tagSet,$scope.defaultRecommandations=tagSet},this.updateRecommand=function(){if(!$scope.enableRecommand)return!1;if(0==$scope.tags.length)$scope.recommandations=$scope.defaultRecommandations;else{var promise=TagUtils.recommand($scope.tags);promise.then(function(results){$scope.recommandations=_.map(_.first(results.items,$scope.recommandCount),function(item){return item.name})})}},this.removeWarning=function(){$scope.tags.length>0&&($scope.requiredWarning=!1)},this.loadTags=TagUtils.loadTags,this.onAddTag=function(tag){if($scope.max>0&&$scope.tags.length>$scope.max)$scope.tags.pop();else{var _tmpTag=_.clone(tag);_tmpTag.text=TagUtils.convert(_tmpTag.text),tag.text!=_tmpTag.text&&$scope.tags.pop()&&$scope.tags.push(_tmpTag),this.updateRecommand(),$scope.updateTags($scope.tags)}this.removeWarning()}.bind(this),this.onRemoveTag=function(){this.updateRecommand(),$scope.updateTags($scope.tags)}.bind(this),this.addTag=function(tagName){if(!($scope.max>0&&$scope.tags.length>=$scope.max)){var _tagName=TagUtils.convert(tagName);_.find($scope.tags,function(t){return t.text==_tagName})||$scope.tags.push({text:TagUtils.convert(_tagName)}),this.updateRecommand(),$scope.updateTags($scope.tags),this.removeWarning()}}.bind(this),$scope.$parent.$on("changeTags",function(e,tags){$scope.tags=_.map(tags,function(t){return{text:TagUtils.convert(t)}})}),$scope.$on("required",function(){$scope.requiredWarning=!0,$scope.$digest()})}),angular.module("appCodementorMonthly",[]).factory("CourseMonthlyUtils",function(){return{scrollTo:function(selector){var to=parseInt(selector);to||(to=($(selector).offset()||{}).top||0),$("html, body").animate({scrollTop:Math.max(to,0)},400)}}}).controller("cmCourseMonthlyCtrl",function($scope,$http,$timeout,User,appConfig,CourseMonthlyUtils){$scope.courseDetail="short",$scope.hasSubscribe=!1,$scope.mixpanelPrefix="/MonthlyUdemyShow",$scope.initialSet=function(planName,mixpanelPrefix,hasSubscribe){$scope.planName=planName,$scope.mixpanelPrefix=mixpanelPrefix,$scope.hasSubscribe=hasSubscribe,amplitude.logEvent($scope.mixpanelPrefix),(localStorage.getItem("udemy/"+planName)||User.isMember)&&($scope.hasSubscribe=!0)},$scope.switchToggle=function(option){$scope.courseDetail=option},$scope.subscribe=function(){isEmail($scope.subscribeEmail)&&$http.post(appConfig.apiHost+"/api/email/subscribe",{from:"monthly_udemy_show_"+$scope.planName,email:$scope.subscribeEmail}).success(function(){$scope.hasSubscribe=!0,localStorage.setItem("udemy/"+$scope.planName,!0),"/MonthlyUdemyLanding"==$scope.mixpanelPrefix&&$timeout(function(){CourseMonthlyUtils.scrollTo("#overview")},200),User.isMember?amplitude.logEvent($scope.mixpanelPrefix+"/User/Subscribe"):amplitude.logEvent($scope.mixpanelPrefix+"/Guest/Subscribe"),amplitude.logEvent($scope.mixpanelPrefix+"/All/Subscribe"),ga("send","event",$scope.planName+" subscription","subscribe")})},$scope.onKeyPress=function($event){13!=$event.keyCode||$scope.hasSubscribe||$scope.subscribe()};var isEmail=function(email){var regex=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;return regex.test(email)}}).controller("cmMonthlyCtrl",function($scope,$timeout){var that=this;that.triggerCounter=0,$scope.initialSet=function(){$scope.showGroup="1",$("#curriculums-select").change(function(){$("#subscription_from").val("monthly_udemy_index_"+$(this).val()),$(".btn-subscribe").attr("href","/subscriptions?"+$.param({subscription:{from:"monthly_udemy_index_"+$(this).val()}}))}),$timeout(function(){$("[data-typer-targets]").typer(),that.triggerCounter=1},50)},$scope.scrollToPlan=function(){$timeout(function(){var to=$("#plans").offset().top;$("html, body").animate({scrollTop:Math.max(to,0)},1e3)},50)},$scope.trackClickPlan=function(plan){amplitude.logEvent("/Monthly/ChoosePlan/"+plan)}}).directive("hourCounter",function(){return{restrict:"E",scope:{count:"=",cost:"@",totalCost:"="},replace:!0,template:'<span class="hourCounter"><i ng-click="op($event, -1)" class="opBtn fa fa-minus"></i><span class="sessionNum"><b>{{count}} </b> {{(count>1)?"hours":"hour"}} / week</span><i ng-click="op($event, 1)" class="opBtn fa fa-plus"></i></span>',link:function(scope){scope.op=function(e,n){e.stopPropagation(),e.preventDefault();var tmp=scope.count+n;tmp>0&&10>=tmp&&(scope.count=tmp),scope.totalCost=scope.count*scope.cost}}}}),angular.module("appCourse",[]).factory("Course",function(User,$http,appConfig){return{funCourses:function(scope){var url;return User.isMentor?!1:(url=appConfig.apiHost+"/api/dashboard/mentee/courses",void $http.get(url).success(function(data){scope.db.hideCoursesLoading=!0,scope.courses=data.courses}))}}}).factory("CourseUtils",function(){return{scrollTo:function(selector){var to=parseInt(selector);to||(to=($(selector).offset()||{}).top||0),$("html, body").animate({scrollTop:Math.max(to-70,0)},400)}}}).controller("CourseShowCtrl",function($scope){$scope.currentCaseName="",$scope.initialSet=function(cases){cases.length>0&&($scope.currentCaseName=cases[0])},$scope.isCurrentCase=function(name){return $scope.currentCaseName==name},$scope.setCurrentCase=function(name){$scope.currentCaseName=name}}).controller("CoursesConfirmCtrl",function($scope,$timeout,$http){var that=this;this.last4=gon.last4,this.addCard=!gon.last4,this.courseId=gon.courseId,this.cost=gon.cost,this.curriculum=gon.curriculum,$timeout(function(){$("input.cc-num").payment("formatCardNumber"),$scope.load_paypal_payment_link()},0),this.toggleAddCard=function(){that.addCard=!that.addCard,$timeout(function(){$("input.cc-num").payment("formatCardNumber")},0)},$scope.load_paypal_payment_link=function(){$scope.paypalPaymentUrl=null,$scope.loadingPaypalLink=!1,$scope.paypalError=null,$scope.loadingPaypalLink=!0,$http.post("/paypal/courses/"+that.courseId+"/payment_link").success(function(result){$scope.loadingPaypalLink=!1,$scope.paypalPaymentUrl=result.approval_url}).error(function(){$scope.loadingPaypalLink=!1,$scope.paypalError="Some error occurred, please try again later"})}}).controller("CourseStudentsCtrl",function($scope,$rootScope,$location,CourseUtils,CMVideo){this.playback=function(youtubeId){CMVideo.openWithId(youtubeId)},$rootScope.$on("$locationChangeSuccess",function(){"/"!=$location.path()&&CourseUtils.scrollTo("#"+$location.path().replace("/",""))})}).controller("CourseIndexCtrl",function(){this.scrollToClasses=function(){$("html, body").animate({scrollTop:$("#upcoming-classes").offset().top},500)},this.scrollToFeatures=function(){$("html, body").animate({scrollTop:$("#course-format").offset().top},300)}}),angular.module("appDashboard",["ngRoute","mm.foundation.tooltip","angulike","appCourse","appScheduleCluster","ngSanitize","ngTagsInput"]).factory("storage",function(){return{finishedSessins:[],finishedRequests:[],cancelledRequests:[],interestedRequests:[],mentorSessionsPage:1,mentorFinishedRequestsPage:1,mentorCancelledRequestsPage:1,mentorInterestedRequestsPage:1}}).config(function($routeProvider){return gon.dashboardRoute?$routeProvider.when("/general-assembly",{}).when("/makegameswithus",{}).when("/getting-started",{}).when("/create-gig",{}).when("/my-gigs",{}).when("/pending-orders",{}).when("/pending-orders/:id",{}).when("/active-orders",{}).when("/active-orders/:id",{}).when("/finished-orders",{}).when("/finished-orders/:id",{}).when("/other-gigs",{}).when("/update-gig",{}).when("/active-requests",{}).when("/active-requests/:id",{}).when("/finished-sessions",{}).when("/finished-sessions/:id",{}).when("/finished-requests",{}).when("/finished-requests/:id",{}).when("/cancelled-requests",{}).when("/cancelled-requests/:id",{}).when("/open-requests",{}).when("/open-requests/:id",{}).when("/interested-requests",{}).when("/interested-requests/:id",{}).when("/other-open-requests",{}).when("/other-open-requests/:id",{}).when("/confirmed-offline-helps",{}).when("/confirmed-offline-helps/:id",{}).when("/finished-offline-helps",{}).when("/finished-offline-helps/:id",{}).when("/solved-offline-helps",{}).when("/solved-offline-helps/:id",{}).when("/upcoming-office-hours",{}).when("/finished-office-hours",{}).when("/longterm-mentorships",{}).when("/ongoing-longterm-requests",{}).when("/udemy-mentors",{}).when("/classes",{}).when("/monthly",{}).when("/monthly/:id",{}).when("/finished-monthly",{}).when("/finished-monthly/:id",{}).when("/monthly-requests",{}).when("/monthly-requests/:id",{}).when("/edit-monthly-request/:id",{}).when("/unpublished-tutorials",{}).when("/published-tutorials",{}).when("/application",{}).when("/mentors",{}).when("/clients",{}).otherwise({
redirectTo:function(routeParams,path){var match=null;return(match=path.match(/finished-question-(\d+)/))?"/finished-requests/"+match[1]:(match=path.match(/active-question-(\d+)/))?"/active-requests/"+match[1]:(match=path.match(/open-question-(\d+)/))?"/open-requests/"+match[1]:void 0}}):void 0}).controller("dashboardCtrl",function($rootScope,$scope,$location,$resource,$http,appConfig,$timeout,$document,$sce,$q,CdnRoot,Chat,CMVideo,NewModal,User,Schedule,Lesson,storage){function truncate(text,n,useWordBoundary){var that=String(text),toLong=that.length>n,s_=toLong?that.substr(0,n-1):that;return s_=useWordBoundary&&toLong?s_.substr(0,s_.lastIndexOf(" ")):s_,toLong?s_+" ...":s_}function getNeedTags(){var deffered=$q.defer();return $http.get(appConfig.apiHost+"/api/feature_experts").success(function(data){$scope.needed_tag=data.needs,deffered.resolve(data)}),deffered.promise}var tabs=["/general-assembly","/makegameswithus","/getting-started","/create-gig","/my-gigs","/pending-orders","/active-orders","/finished-orders","/other-gigs","/update-gig","/active-requests","/finished-sessions","/finished-requests","/cancelled-requests","/open-requests","/interested-requests","/other-open-requests","/longterm-mentorships","/ongoing-longterm-requests","/udemy-mentors","/classes","/edit-monthly-request","/monthly-requests","/monthly","/finished-monthly","/confirmed-offline-helps","/finished-offline-helps","/solved-offline-helps","/upcoming-office-hours","/finished-office-hours","/unpublished-tutorials","/published-tutorials","/application"],that=this;$scope.user=User,$scope.interested=[],$scope.interested_num=[],$scope.skipped=[],$scope.client=new AlgoliaSearch(gon.agoliaAPPID,gon.agoliaAPIKey),$scope.index=$scope.client.initIndex(gon.agoliaMentorIndex),User.isUser&&gon.group_active?this.tab=gon.group_url_string:User.isUser&&!gon.group_active?gon.active_request_count>0?this.tab="/active-requests":gon.schedule_cluster_count>0?this.tab="/monthly":this.tab="/getting-started":User.isMentor?this.tab="/active-requests":User.isApplicant?this.tab="/application":this.tab="/active-requests",$scope.issue={body:"",title:""},$scope.editMode=function(id){$("#questionEdit").modal(),$scope.issue.title=$.trim($('[question-panel="'+id+'"] h4').text());var blank_body=$('[question-panel="'+id+'"] .truncated-body').hasClass("muted");blank_body?$scope.issue.body="":($scope.issue.body=$.trim($('[question-panel="'+id+'"] .full-body div').text())||$.trim($('[question-panel="'+id+'"] .full-body').text()),""===$scope.issue.body&&($scope.issue.body=$.trim($('[question-panel="'+id+'"] .truncated-body div').text())||$.trim($('[question-panel="'+id+'"] .truncated-body').text()))),$scope.issue.id=id},$scope.hintToSetSpecialRate=function(){$("#hint-to-set-special-rate").modal()},$scope.submitQuestion=function(issue){$http.put(appConfig.apiHost+"/api/questions/"+issue.id+"/update",issue).success(function(){$('[question-panel="'+issue.id+'"] h4').text(issue.title),""===issue.body||" "===issue.body?(issue.body="No Description",$('[question-panel="'+issue.id+'"] .truncated-body').addClass("muted"),$('[question-panel="'+issue.id+'"] .full-body').addClass("muted")):($('[question-panel="'+issue.id+'"] .truncated-body').removeClass("muted"),$('[question-panel="'+issue.id+'"] .full-body').removeClass("muted"));var more_html="",less_html="",full_body=0!==$('[question-panel="'+issue.id+'"] .full-body').length;full_body?(issue.body.length>300&&(more_html="<a class='more' href='#'>more<i class='icon-double-angle-right'></i></a>",less_html="<a class='less' href='#'>less<i class='icon-double-angle-right'></i></a>"),$('[question-panel="'+issue.id+'"] .full-body').html("<div style='white-space:pre-wrap;'>"+issue.body+"</div>"+less_html),$('[question-panel="'+issue.id+'"] .truncated-body').html("<div style='white-space:pre-wrap;'>"+truncate(issue.body,300,!0)+"</div>"+more_html)):$('[question-panel="'+issue.id+'"] .truncated-body').html("<div style='white-space:pre-wrap;'>"+issue.body+"</div>"+more_html)}).error(function(){console.log(issue)}),$("#questionEdit").modal("hide")},$scope.setNumericFilters=function(){var filter="rate_for_index>=0,stamina>50,rating>3.9,free_length>0";return filter},$scope.itemsPerPage=15,$scope.currentPage=1,$scope.searchAlgolia=function(){$scope.query_term=$scope.needed_tag.join(" "),$scope.index.search($scope.query_term,$scope.searchCallback,{hitsPerPage:$scope.itemsPerPage,page:$scope.currentPage-1,numericFilters:$scope.setNumericFilters(),facets:"expertise_names",facetFilters:[[]]},500)},$scope.searchCallback=function(success,result){if(0===result.hits.length)return $scope.needed_tag=[],void $scope.searchAlgolia();if(result.page==$scope.currentPage-1&&result.query==$scope.query_term){20*Math.pow(window.scrollY,.5);$scope.loaded=!0,$scope.items=_.map(result.hits,function(hit){return hit.rate=getRate(hit),hit.group_imgs=getGroupImg(hit),hit.expertises=genExpertises(hit),hit}),$scope.$digest(),$(".free-trial-block").tooltip()}};var returnRate=function(rate,reason){var r="$"+(rate||0).toFixed(2);return reason?r+"<br><small class='red'>"+reason+"</small>":r},getExpTagUrl=function(expertiseName){return expertiseName.toLowerCase().replace(/^\./g,"dot_").replace(/\./g,"").replace(/\+/g,"_plus").replace(/\#/g,"_sharp").replace(/\-css/g,"_css").replace(/[^0-9A-Za-z_]/g,"-").replace(/^-+/,"").replace(/-+$/,"")},addEmTag=function(displayName,url){for(var i=0;i<$scope.needed_tag.length;i++)if(getExpTagUrl($scope.needed_tag[i])==url)return"<em>"+displayName+"</em>";return displayName},getExpUrl=function(expertiseName){return"/"+getExpTagUrl(expertiseName)+"-experts"},getRate=function(hit){var longterm=_.find(hit.longterm_list,function(longterm){return longterm.username==User.username&&1e3*longterm.valid_to>(new Date).getTime()});if(longterm)return returnRate(longterm.rate,"(long-term mentorship rate)");var groups=getMutualGroups(hit);if(groups.length>0)return returnRate(groups[0].default_rate,"("+groups[0].name+" rate)");var specialterm=_.find(hit.rate_list,function(specialterm){return specialterm.username==User.username});return specialterm&&specialterm.rate!=hit.rate_for_index?returnRate(specialterm.rate,"(special rate)"):returnRate(hit.rate_for_index)},getGroupImg=function(hit){return _.map(getMutualGroups(hit),function(group){return group.icon})},getMutualGroups=function(hit){return _.filter(hit.group_for_index,function(gi){return User.groups?User.groups.indexOf(gi.id)>-1:!1})},genExpertises=function(hit){return _.map(hit.expertise_names,function(exp){return{route:getExpUrl(exp),name:addEmTag(hit.expertise_display_names[exp],getExpTagUrl(exp))}})};getNeedTags().then(function(){$scope.searchAlgolia()}),this.gotPromoteFeature=function(id){$http.post(appConfig.apiHost+"/api/users/got_promote_feature",{id:id}).success(function(){that.hidePromoteFeature=!0}).error(function(){that.hidePromoteFeature=!0})},$rootScope.$on("$routeChangeStart",function(event,currRoute){if(currRoute&&currRoute.$$route){currRoute.params.id&&0==$("[question-panel="+currRoute.params.id+"]").size(),$scope.qid=currRoute.params.id;for(var path=currRoute.$$route.originalPath,match=null,i=0,len=tabs.length;len>i;i++)if(match=path.match(new RegExp(tabs[i]))){this.tab=tabs[i],$scope.$broadcast("change_tab_"+this.tab);break}}}.bind(this));var __lastPath__="";$rootScope.$on("$routeChangeSuccess",function(){var curr=$location.path().split("/")[1];curr!==__lastPath__&&(__lastPath__=curr,window.scroll(0,0))}),$scope.toggleExpand=function(path,id){$scope.qid==id?($scope.qid="",$location.path("/"+__lastPath__)):($scope.qid=id,$location.path(path+id))},$scope.popupRequestOptions=function(id,$event){$scope.open[id]=!0,$($event.currentTarget).bind("mouseleave",function(){$scope.open[id]=!1,$scope.$apply()})},$scope.disable=function($event){$($event.currentTarget).attr("disabled",!0),$($event.currentTarget).click(function(e){e.preventDefault()})},$scope.confirmPayment=function($event,name){confirm("I confirm that the request has been completed. By clicking on 'OK', the payment to "+name+" will be processed and will be non-refundable.  Are you sure?")||($event.preventDefault(),$event.stopPropagation())},$scope.getCategoryIconURL=function(icon){return CdnRoot+"/category_icons/"+icon+".png"},$scope.showDateWithTimeOffset=function(timestamp){return new Date(1e3*timestamp).strftime("%b %d, %Y")+" ("+d.currentTimeZoneText()+")"},$scope.showDate=this.showDate=function(timestamp){return new Date(1e3*timestamp).strftime("%b %d, %Y")},$scope.showDateFromDatetime=this.showDateFromDatetime=function(datetime){return new Date(datetime).strftime("%b %d, %Y")},$scope.lessThanNDays=this.lessThanNDays=function(timestamp,n){var t=(new Date).getTime()-1e3*timestamp;return 24*n*60*60*1e3>t},$scope.getHourUnit=function(num){return parseInt(num)>1?"hours":"hour"},$scope.getInterest=function(num){return 0==parseInt(num)?"interests":1==parseInt(num)?"interest":"interests"},$scope.genEmptyRateRange=this.genEmptyRateRange=function(rating){return _.range(5-Math.round(rating))},$scope.genRateRange=this.genRateRange=function(rating){return _.range(Math.round(rating))},$scope.withTruncated=function(trun,desc){return trun.length<desc.length},$scope.clickMsgBtn=this.clickMsgBtn=function(username){Chat.openChatroomViaAPI(username)},$scope.sendMsg=function(username,content,config){Chat.send(username,content,config)},$scope.clickScheduleBtn=this.clickScheduleBtn=function(mentor){Schedule.showScheduleForm({from:"long-term",mentor:mentor})},$scope.getAmount=function(amount,calAmount){return amount>0?amount:calAmount.toFixed(2)},$scope.getRemainingHour=this.getRemainingHour=function(credit,rate){return rate>0?(credit/rate/4).toFixed(2):0},$scope.getRemainingHourUnit=this.getRemainingHourUnit=function(credit,rate){return $scope.getRemainingHour(credit,rate)>1?"hours":"hour"},$scope.mentorOfficeHourHowItWork=function(){NewModal.open("mentor-office-hour-howitworks",{actions:["Okay"]})},this.openHowToStartOfficeHourModal=function(oh){NewModal.open("how-to-start-office-hours",{officeHour:oh,footer:!1})},$scope.removeArticle=function(id){if(confirm("Are you sure you\u2019d like to remove this tutorial?  This will be permanently deleted.")){var url="/api/dashboard/mentor/tutorials/delete/"+id;$http["delete"](url).success(function(){$(".article_"+id).hide()})}},$scope.loadMoreSessions=function(){var url;storage.mentorSessionsPage=storage.mentorSessionsPage+1,url="/templates/finished-sessions.html?page="+storage.mentorSessionsPage,$scope.db.hideFinishedSessionsLoading=!1,$http.get(url).success(function(data){$scope.db.hideFinishedSessionsLoading=!0,storage.finishedSessions=data})},$scope.loadMoreFinishedRequests=function(){var url;storage.mentorFinishedRequestsPage=storage.mentorFinishedRequestsPage+1,url="/templates/finished-requests.html?page="+storage.mentorFinishedRequestsPage,$scope.db.hideFinishedRequestsLoading=!1,$http.get(url).success(function(data){$scope.db.hideFinishedRequestsLoading=!0,storage.finishedRequests=data})},$scope.loadMoreInterestedRequests=function(){var url;storage.mentorInterestedRequestsPage=storage.mentorInterestedRequestsPage+1,url="/templates/interested-requests.html?page="+storage.mentorInterestedRequestsPage,$scope.db.hideInterestedRequestsLoading=!1,$http.get(url).success(function(data){$scope.db.hideInterestedRequestsLoading=!0,storage.interestedRequests=data})},$scope.loadMoreCancelledRequests=function(){var url;storage.mentorCancelledRequestsPage=storage.mentorCancelledRequestsPage+1,url="/templates/cancelled-requests.html?page="+storage.mentorCancelledRequestsPage,$scope.db.hideCancelledRequestsLoading=!1,$http.get(url).success(function(data){$scope.db.hideCancelledRequestsLoading=!0,storage.cancelledRequests=data})},this.setupModal=function(){NewModal.open("first-time-setup",{actions:["Okay"]})},this.revokePublic=function(qid){$http.put(appConfig.apiHost+"/api/questions/"+qid+"/revoke_public").success(function(){})},this.makePublic=function(qid){$http.put(appConfig.apiHost+"/api/questions/"+qid+"/make_public").success(function(){})},this.openSessionFeedbackModal=function(lessonId,steps,oppositeUser){Lesson.openFeedbackModal({lessonId:lessonId,steps:steps,oppositeUser:oppositeUser,ok:function(){var commentbtn=".comment"+lessonId,invoicebtn=".invoice"+lessonId;$(commentbtn).hide(),$(invoicebtn).removeClass("btnInvoice"),$(invoicebtn).addClass("btn-success")}})},this.playWelcomeVideo=function(){CMVideo.open("welcome","Mentee Dashboard")},this.playStartSessionVideo=function(){CMVideo.open("firstSession","Monthly")},this.requestStartScheduleClusterSession=function(username){$scope.sendMsg(username,{},{type:"schedule_cluster_connect"})},this.openScheduleClusterPolicyModal=function(){NewModal.open("schedule-cluster-policy",{windowClass:"schedule-cluster-policy-modal",footer:!1})},this.askToStartSession=function(username,sessionLink){User.isMentor&&Chat.send(username,{},{type:"sessionLink",sessionLink:sessionLink})},gon.show_first_time_survey&&!(User.groups||{}).length&&(!window.localStorage||(new Date).getTime()-parseInt(JSON.parse(localStorage.skipSurveyObj||"{}")[User.username]||0)>864e5)&&NewModal.open("first-time-survey",{windowClass:"first-time-survey",backdrop:"static",keyboard:!1,footer:!1,ok:function(){getNeedTags().then(function(){$scope.searchAlgolia()})},cancel:function(reason){}}),this.now=function(){return Date.now()}}).controller("dashboardOfficeHoursCtrl",function($scope,$http,appConfig,$timeout,$sce,NewModal){function camelCase(input){return input.toLowerCase().replace(/-(.)/g,function(match,group){return group.toUpperCase()})}function capitaliseFirstLetter(string){return string.charAt(0).toUpperCase()+string.slice(1)}function toTweeterTag(string){return"#"+capitaliseFirstLetter(camelCase(string))}var that=this;$scope.$on("change_tab_/upcoming-office-hours",function(){that.upcomingOfficeHours=null,$http.get(appConfig.apiHost+"/api/dashboard/mentor/active_office_hours").success(function(officeHours){that.upcomingOfficeHours=_.map(officeHours,function(oh){var tags=_.reduce(oh.categories,function(tags,c){return tags.push(toTweeterTag(c.name)),tags},[]);return oh.tweet="RSVP for my free "+tags.join(" ")+" @CodementorIO #OfficeHours "+oh.title,oh})}).error(function(){showMessage("error","Some error occurred. Please try again later.")})}),$scope.$on("change_tab_/finished-office-hours",function(){that.finishedOfficeHours=null,$http.get(appConfig.apiHost+"/api/dashboard/mentor/finished_office_hours").success(function(officeHours){that.finishedOfficeHours=officeHours}).error(function(){showMessage("error","Some error occurred. Please try again later.")})}),this.cancelOfficeHour=function(id){confirm("Are you sure you'd like to cancel the office hours proposal?")&&($("#office-hour-"+id).hide(),$http.post("/officehours/"+id+"/cancel").success(function(){that.upcomingOfficeHours=_.reject(that.upcomingOfficeHours,function(oh){return oh.id==id})}).error(function(){$("#office-hour-"+id).show(),showMessage("error","Some error occurred. Please try again later.")}))},this.openHowToStartOfficeHourModal=function(oh){NewModal.open("how-to-start-office-hours",{officeHour:oh,footer:!1,windowClass:"how-to-start-office-hours-modal"})}}).directive("compile",["$compile",function($compile){return function(scope,element,attrs){scope.$watch(function(scope){return scope.$eval(attrs.compile)},function(value){scope.scrollHandlers&&_.each(scope.scrollHandlers,function(unregister){unregister()}),element.html(value),$compile(element.contents())(scope)})}}]).directive("questionPanel",function($timeout){return{restrict:"A",link:function(scope,element,attrs){scope.scrollHandlers=scope.scrollHandlers||[];var handler=scope.$watch("qid",function(nVal){if(nVal==attrs.questionPanel){if($(".navbar-inner").height()>40)var reduce=90;else var reduce=50;$timeout(function(){$("html, body").animate({scrollTop:element.offset().top-reduce},300)},0),scope.$broadcast("loadNotesOfRequest-"+nVal)}});scope.scrollHandlers.push(handler)}}}).directive("orderPanel",function($timeout){return{restrict:"A",link:function(scope,element,attrs){scope.scrollHandlers=scope.scrollHandlers||[];var handler=scope.$watch("qid",function(nVal){if(nVal==attrs.orderPanel){var reduce=$(".navbar-inner").height()>40?90:50;$timeout(function(){$("html, body").animate({scrollTop:element.offset().top-reduce},300)},0)}});scope.scrollHandlers.push(handler)}}}).directive("tmpltFinishedSessions",function(storage,$http,$timeout){return{restrict:"E",templateUrl:"/templates/finished-sessions-module.html",link:function(scope){scope.storage=storage;var funFinishedSessions=function(){var url="/templates/finished-sessions.html?page="+storage.mentorSessionsPage;$http.get(url).success(function(data){scope.db.hideFinishedSessionsLoading=!0,storage.finishedSessions=data,$timeout(function(){$("[data-toggle=tooltip]").tooltip()})})};"/finished-sessions"==scope.db.tab&&funFinishedSessions(),scope.$on("change_tab_/finished-sessions",function(){scope.qid&&storage.finishedSessions||funFinishedSessions()})}}}).directive("tmpltInterestedRequests",function(storage,$http){return{restrict:"E",templateUrl:"/templates/interested-requests-module.html",link:function(scope){scope.storage=storage;var funInterestedRequests=function(){var url="/templates/interested-requests.html?page="+storage.mentorRequestsPage;$http.get(url).success(function(data){scope.db.hideInterestedRequestsLoading=!0,storage.interestedRequests=data})};"/interested-requests"==scope.db.tab&&funInterestedRequests(),scope.$on("change_tab_/interested-requests",function(){scope.qid||funInterestedRequests()})}}}).directive("tmpltFinishedRequests",function(storage,$http){return{restrict:"E",templateUrl:"/templates/finished-requests-module.html",link:function(scope){scope.storage=storage;var funFinishedRequests=function(){var url="/templates/finished-requests.html?page="+storage.mentorFinishedRequestsPage;$http.get(url).success(function(data){scope.db.hideFinishedRequestsLoading=!0,storage.finishedRequests=data})};"/finished-requests"==scope.db.tab&&funFinishedRequests(),scope.$on("change_tab_/finished-requests",function(){scope.qid||funFinishedRequests()})}}}).directive("tmpltCancelledRequests",function(storage,$http){return{restrict:"E",templateUrl:"/templates/cancelled-requests-module.html",link:function(scope){scope.storage=storage;var funCancelledRequests=function(){var url="/templates/cancelled-requests.html?page="+storage.mentorCancelledRequestsPage;$http.get(url).success(function(data){scope.db.hideCancelledRequestsLoading=!0,storage.cancelledRequests=data})};"/cancelled-requests"==scope.db.tab&&funCancelledRequests(),scope.$on("change_tab_/cancelled-requests",function(){scope.qid||funCancelledRequests()})}}}).directive("tmpltHelpRequests",function($http,appConfig,$rootScope,Chat){return{restrict:"E",scope:{path:"@",qshow:"@",mentorId:"@"},template:'<a class="btn btn-primary" ng-click="helpRequest()"><i class="icon-ok" ng-hide="loading"></i><i class="icon-spin icon-spinner" ng-show="loading"></i> I Can Help </a>',link:function(scope,elem){scope.loading=!1,scope.helpRequest=function(){scope.loading=!0,$http.post(appConfig.apiHost+"/api/questions/"+scope.path+"/interest",{user:scope.user}).success(function(data){return data.message.error?(window.showMessage("error",data.message.flash),data.message.error):("1"===scope.qshow?scope.$parent.interested=!0:(scope.$parent.interested[parseInt(scope.path,10)]=!0,scope.$parent.interested_num[parseInt(scope.path,10)]=scope.$parent.interested_num[parseInt(scope.path,10)]+1),gon.auto_applied||(data.message.user_online&&data.message.username?Chat.openChatroomViaAPI({username:data.message.username,infoMsg:"Tell "+data.message.name+" more about how you can help."}):$rootScope.$broadcast("onNoteAdd"+scope.path)),elem.parents(".question-header").find(".question .interested").show(),void(scope.loading=!1))})}}}}).directive("tmpltSkipRequests",function($http,appConfig,$rootScope,NewModal){return{restrict:"E",scope:{path:"@",qshow:"@",mentorId:"@"},template:'<a class="btn btn-default" ng-click="openSkipRequestModal()"><i class="icon-remove" ng-hide="loading"></i><i class="icon-spin icon-spinner" ng-show="loading"></i> Skip </a>',link:function(scope){scope.loading=!1,scope.skipRequest=function(result){scope.loading=!0,$http.post(appConfig.apiHost+"/api/questions/"+scope.path+"/skip",result).success(function(){"1"===scope.qshow?scope.$parent.skipped=!0:scope.$parent.skipped[parseInt(scope.path,10)]=!0,scope.loading=!1}).error(function(){window.showMessage("error","Some error occurred, please try again later"),scope.loading=!1})},scope.openSkipRequestModal=function(){NewModal.open("skip-question",{footer:!1,windowClass:"skip-question-modal new-modal",ok:scope.skipRequest})}}}}).directive("tmpltUndoSkipRequests",function($http,appConfig){return{restrict:"E",scope:{path:"@",qshow:"@",mentorId:"@"},template:'<a class="btn btn-default" ng-click="undoSkipRequest()"><i class="icon-undo" ng-hide="loading"></i><i class="icon-spin icon-spinner" ng-show="loading"></i> Undo </a>',link:function(scope){scope.loading=!1,scope.undoSkipRequest=function(){scope.loading=!0,$http["delete"](appConfig.apiHost+"/api/questions/"+scope.path+"/skip",{user:scope.user}).success(function(){"1"===scope.qshow?scope.$parent.skipped=!1:scope.$parent.skipped[parseInt(scope.path,10)]=!1,scope.loading=!1}).error(function(){window.showMessage("error","Some error occurred, please try again later"),scope.loading=!1})}}}}).directive("tmpltLongtermMentorships",function($http){return{restrict:"E",templateUrl:"/templates/longterm-mentorships.html",link:function(scope){scope.longtermMentorships=[];var funLongterms=function(){var url="/api/dashboard/mentee/longterms/ongoing";$http.get(url).success(function(data){scope.db.hideLongtermMentorshipsLoading=!0,scope.longtermMentorships=data.longterms}).error(function(){scope.db.hideLongtermMentorshipsLoading=!0})};"/longterm-mentorships"==scope.db.tab&&funLongterms(),scope.$on("change_tab_/longterm-mentorships",function(){funLongterms()})}}}).directive("tmpltOngoingLongtermRequests",function($http){return{restrict:"E",templateUrl:"/templates/ongoing-longterm-requests.html",link:function(scope){scope.ongoingLongtermRqeusts=[],scope.db.hideOngoingLongtermRequestsLoading=!1;var funOngoingLongtermRequests=function(){var url="/api/dashboard/mentor/longterms/ongoing";$http.get(url).success(function(data){scope.db.hideOngoingLongtermRequestsLoading=!0,scope.ongoingLongtermRequests=data.longterms})};"/ongoing-longterm-requests"==scope.db.tab&&funOngoingLongtermRequests(),scope.$on("change_tab_/ongoing-longterm-requests",function(){funOngoingLongtermRequests()})}}}).directive("tmpltUdemyMentors",function($http){return{restrict:"E",templateUrl:"/templates/udemy-mentors.html",link:function(scope){scope.udemyMentors=[],scope.db.hideUdemyMentorsLoading=!1;var getUdemyMentors=function(){var url="/api/dashboard/mentee/longterms/ongoing?is_extendable=false";$http.get(url).success(function(data){scope.db.hideUdemyMentorsLoading=!0,scope.udemyMentors=data.longterms,console.log(123456),console.log(scope.udemyMentors),console.log(scope.udemyMentors[0].longterm.is_extendable),console.log(123456)}).error(function(){scope.db.hideUdemyMentorsLoading=!0})};"/udemy-mentors"==scope.db.tab&&getUdemyMentors(),scope.$on("change_tab_/udemy-mentors",function(){getUdemyMentors()})}}}).directive("tmpltCourses",function(Course){return{restrict:"E",templateUrl:"/templates/courses.html",scope:{db:"="},link:function(scope){scope.db.hideCoursesLoading=!1,Course.funCourses(scope),"/classes"==scope.db.tab&&Course.funCourses(scope),scope.$on("change_tab_/classes",function(){Course.funCourses(scope)}),scope.goToCourse=function(curriculum_id){location="/classes/"+curriculum_id+"/students"}}}}).directive("tmpltScheduleClusters",function(User,ScheduleCluster,NewModal,CdnRoot,$timeout){return{restrict:"E",templateUrl:"/templates/schedule_clusters.html",scope:{db:"=",qid:"="},link:function(scope){scope.ongoingLongtermRqeusts=[],scope.user=User,scope.CdnRoot=CdnRoot,"/monthly"==scope.db.tab&&ScheduleCluster.funScheduleClusters(scope),scope.$on("change_tab_/monthly",function(){$timeout(function(){ScheduleCluster.funScheduleClusters(scope)})}),scope.goToScheduleCluster=function(id){location.hash="/monthly/"+id},scope.showDate=function(timestamp){return new Date(1e3*timestamp).strftime("%b %d, %Y")},scope.openCourseRedeemModal=function(sc){NewModal.open("schedule-cluster-course-redeem",{windowClass:"schedule-cluster-course-redeem-modal",footer:!1,redeemUrl:"/schedule_clusters/course/"+sc.id+"/redeem",previewUrl:sc.schedule_cluster_plan.course_udemy_url,planType:sc.schedule_cluster_plan.plan_type})},scope.edit=function(id){location.hash="/edit-monthly-request/"+id},scope.schedulesOrderBy=function(s){return"finished"==s.tab?-s.appointment_time:s.appointment_time}}}}).directive("tmpltEditScheduleCluster",function(User,ScheduleCluster,NewModal,appConfig,$timeout,$location,$http){return{restrict:"E",templateUrl:"/templates/edit_schedule_cluster.html",scope:{db:"=",qid:"="},link:function(scope){scope.ongoingLongtermRqeusts=[],scope.user=User;var cal="#user-availability-calendar",setUp=function(){ScheduleCluster.funScheduleClusters(scope,function(){$timeout(function(){setUpCalendar()})})},setUpCalendar=function(){scope.sc=_.find(scope.scheduleClusters,{id:scope.qid});var events=ScheduleCluster.availabilityToLocalEvents(scope.sc.availability),defaultDate=events[0].start.format("YYYY-MM-DD");$(cal).fullCalendar("destroy"),ScheduleCluster.setUpCalendar(cal,{defaultDate:defaultDate,events:events,slotDuration:"00:60:00"})},getAvailability=function(){var events=$(cal).fullCalendar("clientEvents");return _.map(events,function(e){return{start:e.start,end:e.end}})};"/edit-monthly-request"==scope.db.tab&&setUp(),scope.$on("change_tab_/edit-monthly-request",function(){setUp()}),scope.submit=function(){$http.put(appConfig.apiHost+"/api/dashboard/mentee/schedule_clusters/"+scope.sc.id,{description:scope.sc.description,availability:getAvailability()}).success(function(){location.hash="/monthly/"+scope.sc.id}).error(function(){})},scope.cancel=function(){location.hash="/monthly/"+scope.sc.id}}}}).directive("tmpltMentorScheduleClusters",function(ScheduleCluster,$timeout){return{restrict:"E",templateUrl:"/templates/mentor_schedule_clusters.html",scope:{db:"=",qid:"="},link:function(scope){ScheduleCluster.funScheduleClusters(scope),"/monthly"==scope.db.tab&&ScheduleCluster.funScheduleClusters(scope),scope.$on("change_tab_/monthly",function(){$timeout(function(){ScheduleCluster.funScheduleClusters(scope)})}),scope.goToScheduleCluster=function(id){location.hash="/monthly/"+id},scope.showDate=function(timestamp){return new Date(1e3*timestamp).strftime("%b %d, %Y")},scope.schedulesOrderBy=function(s){return"finished"==s.tab?-s.appointment_time:s.appointment_time}}}}).directive("tmpltMentorFinishedScheduleClusters",function(ScheduleCluster,$timeout){return{restrict:"E",templateUrl:"/templates/mentor_schedule_clusters.html",scope:{db:"=",qid:"="},link:function(scope){ScheduleCluster.funFinishedScheduleClusters(scope),"/finished-monthly"==scope.db.tab&&ScheduleCluster.funFinishedScheduleClusters(scope),scope.$on("change_tab_/finished-monthly",function(){$timeout(function(){ScheduleCluster.funFinishedScheduleClusters(scope)})}),scope.goToScheduleCluster=function(id){location.hash="/finished-monthly/"+id}}}}).directive("tmpltMentorScheduleClusterRequests",function(ScheduleCluster,User,NewModal,Alert,appConfig,$http,$timeout){return{restrict:"E",templateUrl:"/templates/mentor_schedule_cluster_requests.html",scope:{db:"=",qid:"="},link:function(scope){var eventChangeCallback=function(){scope.sc.mentorAvailability=getMentorAvailability(),scope.validateInterestMentorAvailability(),scope.$digest()},getMentorAvailability=function(){var events=$("#calendar").fullCalendar("clientEvents",function(e){return"background"!=e.rendering});return _.map(events,function(e){return{start:e.start,end:e.end}})},eventDuration=function(){var eventDuration;return eventDuration=scope.sc.schedule_cluster_plan.is_course?27e5:36e5},eventsTotalLength=function(events){return _.reduce(events,function(memo,e){return memo+(e.end-e.start)},0)},setUpCalendar=function(){var events=ScheduleCluster.availabilityToLocalEvents(scope.sc.availability,{rendering:"background",id:"userAvailability"}),defaultDate=events[0].start.format("YYYY-MM-DD"),duration=eventDuration();ScheduleCluster.setUpCalendar("#calendar",{defaultDate:defaultDate,selectConstraint:"userAvailability",events:events,editable:!0,eventResize:function(){eventChangeCallback()},select:function(start,end){var eventData,length;length=(Math.floor((end-start)/duration)||1)*duration,end=start.clone().add(length),ScheduleCluster.isSelectableTime("#calendar",end)&&(eventData={title:"",start:start,end:end,constraint:"userAvailability"},$("#calendar").fullCalendar("renderEvent",eventData,!0),$("#calendar").fullCalendar("unselect"),eventChangeCallback())},eventClick:function(calEvent){$("#calendar").fullCalendar("removeEvents",calEvent._id),eventChangeCallback()}})},destroyCalendar=function(){$("#calendar").fullCalendar("destroy")},setUpMentorAvailability=function(){var source;source=scope.sc.mentorAvailability,!source&&scope.sc.interest&&(source=scope.sc.interest.mentor_availability),$("#calendar").fullCalendar("addEventSource",source)},funScheduleClusterRequests=function(){var url="/api/dashboard/mentor/schedule_cluster_requests";scope.db.hideScheduleClusterRequestsLoading=!1,scope.qid&&(url+="/"+scope.qid),$http.get(url).success(function(data){scope.db.hideScheduleClusterRequestsLoading=!0,scope.qid?(scope.sc=data.schedule_cluster,scope.sc.interest=scope.sc.interest||{},scope.sc.interested?(scope.sc.errorMsg={interestReason:null,interestMentorAvailability:null},scope.sc.interest.mentor_availability_text=ScheduleCluster.availabilityToText(scope.sc.interest.mentor_availability)):scope.sc.errorMsg={},scope.sc.availability_text=ScheduleCluster.availabilityToText(scope.sc.availability),scope.sc.schedule_cluster_plan.is_course?scope.sc.mentorEventsRequiredNum=scope.sc.schedule_num/4/.75:scope.sc.mentorEventsRequiredNum=scope.sc.schedule_num/4,$timeout(function(){setUpCalendar(),setUpMentorAvailability()})):scope.scheduleClusters=data.schedule_clusters,$("html, body").scrollTop(0)})},submitOrUpdateMentorAvailabilityCallback=function(){scope.sc.mentorAvailability=getMentorAvailability(),scope.sc.interested=!0,scope.sc.interest={reason:scope.sc.interest.reason,mentor_availability:getMentorAvailability(),mentor_availability_text:ScheduleCluster.availabilityToText(getMentorAvailability())},scope.endEditAvailability()};scope.user=User,scope.acceptScheduleClusterPolicy=function(){$http.post("/api/dashboard/mentor/accept_schedule_cluster_policy").success(function(){User.accept_schedule_cluster_policy=!0,scope.db.hideScheduleClusterRequestsLoading=!1,funScheduleClusterRequests()})},scope.openInterestScheduleClusterModal=function(){var modal=NewModal.open("interest-schedule-cluster",{scheduleCluster:scope.sc,footer:!1,submit:function($modalScope){$http.post(appConfig.apiHost+"/api/dashboard/mentor/schedule_cluster_requests/"+this.sc.id+"/interest",{reason:this.reason,mentor_availability:getMentorAvailability()}).success(function(){$modalScope.$close("interested"),scope.sc.mentorAvailability=getMentorAvailability(),$("html, body").scrollTop(0)}).error(function(){})}});modal.result.then(function(){scope.sc.interested=!0})},scope.$on("change_tab_/monthly-requests",function(){$timeout(funScheduleClusterRequests)}),scope.goToScheduleClusterRequest=function(id){location.hash="/monthly-requests/"+id},scope.validateInterest=function(){scope.sc.showErrorMsgOnFooter=!0,scope.validateInterestReason(),scope.validateInterestMentorAvailability()},scope.validateInterestReason=function(){scope.sc.errorMsg.interestReason=null,(!scope.sc.interest.reason||scope.sc.interest.reason.length<20)&&(scope.sc.errorMsg.interestReason="(min. 20 characters)")},scope.requiredLengthText=function(){if(scope.sc){var text,requiredLength=scope.sc.mentorEventsRequiredNum*eventDuration(),oneHour=36e5,hours=Math.floor(requiredLength/oneHour),mins=requiredLength%oneHour/1e3/60;return hours>0?(text=moment.duration(hours,"hours").humanize(),mins>0&&(text+=" and "+mins+" minutes")):text=mins+" minutes",text}},scope.validateInterestMentorAvailability=function(){var length=eventsTotalLength(getMentorAvailability()),requiredLength=scope.sc.mentorEventsRequiredNum*eventDuration(),text=scope.requiredLengthText();scope.sc.errorMsg.interestMentorAvailability=null,requiredLength>length?scope.sc.errorMsg.interestMentorAvailability="please select a total of "+text:length>requiredLength&&(scope.sc.errorMsg.interestMentorAvailability="please select "+text+" only");
},scope.hasError=function(sc){return sc?null===sc.errorMsg.interestReason&&null===sc.errorMsg.interestMentorAvailability?(sc.showErrorMsgOnFooter=!1,!1):!0:!1},scope.startEditAvailability=function(){scope.sc.editAvailability=!0,destroyCalendar(),$timeout(function(){setUpCalendar(),setUpMentorAvailability(),$timeout(function(){$("html, body").animate({scrollTop:$(".interest-form").offset().top-60},300),$(".interest-form textarea").focus()})}),Alert.pop()},scope.endEditAvailability=function(){scope.sc.editAvailability=!1,$("html, body").animate({scrollTop:0},300)},scope.submitMentorAvailability=function(){$http.post(appConfig.apiHost+"/api/dashboard/mentor/schedule_cluster_requests/"+this.sc.id+"/interest",{reason:scope.sc.interest.reason,mentor_availability:getMentorAvailability()}).success(function(){Alert.addAlert("success","You've successfully submitted your proposal."),submitOrUpdateMentorAvailabilityCallback(),$("html, body").scrollTop(0)}).error(function(){})},scope.updateMentorAvailability=function(){$http.put(appConfig.apiHost+"/api/dashboard/mentor/schedule_cluster_requests/"+this.sc.id+"/interest",{reason:scope.sc.interest.reason,mentor_availability:getMentorAvailability()}).success(function(){Alert.addAlert("success","Your availability has been updated."),submitOrUpdateMentorAvailabilityCallback(),scope.endEditAvailability()}).error(function(){})},"/monthly-requests"==scope.db.tab&&funScheduleClusterRequests()}}}).directive("tmpltUnpublishedTutorials",function($http){return{restrict:"E",templateUrl:"/templates/unpublished-tutorials.html",link:function(scope){scope.unpublishedTutorials=[],scope.db.hideUnpublishedTutorialsLoading=!1;var funTutorialDrafts=function(){var url="/api/dashboard/mentor/tutorials/unpublished";$http.get(url).success(function(data){scope.db.hideUnpublishedTutorialsLoading=!0,scope.unpublishedTutorials=data.articles})};"/unpublished-tutorials"==scope.db.tab&&funTutorialDrafts(),scope.$on("change_tab_/unpublished-tutorials",function(){funTutorialDrafts()})}}}).directive("tmpltPublishedTutorials",function($http){return{restrict:"E",templateUrl:"/templates/published-tutorials.html",link:function(scope){scope.publishedTutorials=[],scope.db.hidePublishedTutorialsLoading=!1;var funPublishedTutorials=function(){var url="/api/dashboard/mentor/tutorials/published";$http.get(url).success(function(data){scope.db.hidePublishedTutorialsLoading=!0,scope.publishedTutorials=data.articles})};"/published-tutorials"==scope.db.tab&&funPublishedTutorials(),scope.$on("change_tab_/published-tutorials",function(){funPublishedTutorials()})}}}).directive("tmpltApplication",function(){return{restrict:"E",templateUrl:"/templates/application.html.haml",link:function(){}}}).directive("userSkipOnboardingNews",function($http){return{restrict:"E",scope:{newsId:"@"},replace:!0,template:"<i class='fa fa-times skip-onboarding-news' ng-click='skipNews()'></i>",link:function(scope){var url="/api/dashboard/onboarding_news/"+scope.newsId+"/skip";scope.skipNews=function(){$http.post(url).success(function(){$("div#news_record_"+scope.newsId).remove(),0===$(".news_records").find(".onboarding_news").size()&&$(".news_records").remove()})}}}}).directive("endorseTagInput",function(){return{restrict:"E",scope:{mentor:"="},template:'<tags-input ng-model="vm.selectedTags" display-property="display_name" placeholder="Add a tag or search skills here" replace-spaces-with-dashes="false" max-tags="3" on-tag-added="vm.checkReachMaxTag();" add-from-autocomplete-only="true" ng-class="{\'has-tags\': vm.isReachNumber(3)}"><auto-complete source="vm.getMatchExpertise($query)" min-length="0" load-on-focus="true" load-on-empty="true"max-results-to-show="15"></auto-complete></tags-input><div class="hot-tag-box"><span ng-click="vm.addTag(expertise)" ng-repeat="expertise in vm.sortedExpertise | limitTo: 10"><i class="icon-plus"></i>{{ expertise.display_name }}</span></div><input type="hidden" name="selected_tags[]" ng-repeat="expertise in vm.selectedTags" value="{{ expertise.id }}">',controller:function($scope,$element,$http){var vm=this,loadExpertise=function(){return $http.get("/api/users/"+$scope.mentor+"/sorted_expertise").then(function(response){vm.sortedExpertise=response.data})};$element.find("input").on("keypress",function(e){return 13==e.keyCode?(e.preventDefault(),e.stopPropagation(),!1):void 0}),loadExpertise(),vm.sortedExpertise=[],vm.selectedTags=[],vm.getMatchExpertise=function($query){return vm.sortedExpertise.filter(function(expertise){return-1!=expertise.display_name.toLowerCase().indexOf($query.toLowerCase())})},vm.isReachNumber=function(num){return vm.selectedTags.length>=num},vm.checkReachMaxTag=function(){vm.isReachNumber(4)&&vm.selectedTags.pop()},vm.addTag=function(tag){vm.isReachNumber(3)||_.find(vm.selectedTags,function(obj){return obj.id===tag.id})||vm.selectedTags.push(tag)}},controllerAs:"vm"}}),angular.module("appDirectory",["ngSanitize"]).controller("DirectoryCtrl",function($rootScope,$scope,$http,appConfig,$location,$timeout,$modal,CdnRoot,NewModal,User,Chat,$window){function clearLanguages(){$scope.languages={}}var that=this;$scope.currentPage=1,$scope.itemsPerPage=30,$scope.totalCount=0,$scope.query_term="",$scope.items=[],$scope.facets=[],$scope.tags_name=[],$scope.isSearch=!1,$scope.loaded=!1,$scope.urlChanged=!0,$scope.client=new AlgoliaSearch(gon.agoliaAPPID,gon.agoliaAPIKey),$scope.index=$scope.client.initIndex(gon.agoliaMentorIndex),$scope.iconArray=[],$scope.noRecommend=!1,$scope.gID=0,$scope.languages={},$scope.redirectUrls=[],$scope.topicCats={},$scope.topicCatUrl=!1,$scope.topicCatName=!1,$scope.relatedCat=null,$scope.reviews=[],$scope.showLeaderboard=!0,this.showLanguageFilter=!1,$scope.initialSet=function(queryString,rateLevel,hirable,firstSessionFree,totalCount,currentPage,itemsPerPage,icons,gID,checkedLanguages,topics,topicCats){$scope.tags_name=_.map(queryString.trim().split(" "),function(c){return c.toLowerCase().replace(/[^#\+\-\.0-9A-Za-z]/g,"-").replace(/-+/g,"-")}),$scope.rateLevel=rateLevel,$scope.hirable=hirable,$scope.firstSessionFree=firstSessionFree,$scope.totalCount=totalCount,$scope.currentPage=currentPage,$scope.itemsPerPage=itemsPerPage,$scope.iconArray=icons,$scope.gID=gID,$scope.redirectUrls=topics,$scope.topicCats=topicCats;for(var i=0;i<checkedLanguages.length;i++)$scope.languages[checkedLanguages[i]]=!0},$rootScope.floatRound=function(f,n){n||(n=0);var p=Math.pow(10,n),r=Math.round(f*p)/p;return 10*r%10===0&&(r+=".0"),r},$rootScope.$on("$locationChangeStart",function(e){var pathMatch2,pathMatch=$location.path().match(/(([\w#_\-\.]+)-)?experts/);return that.initPathMatch2?pathMatch2=$location.path().match(/(([\w#_\-\.]+)-)?experts\/.+/):(pathMatch2=!1,that.initPathMatch2=!0),!pathMatch&&!pathMatch2||isMatchTopicUrl()?($window.location.href=$location.url(),e.preventDefault(),!1):void 0}),$rootScope.$on("$locationChangeSuccess",function(){var pathMatch=$location.path().match(/(([\w#_\-\.]+)-)?experts$/);if(pathMatch||(pathMatch=$location.path().match(/(([\w#_\-\.]+)-)?experts\/.+/)),!$scope.urlChanged){var params=$location.search();params.q=params.q||"",void 0!=User.groups&&isGroupMember(params.g),pathMatch[2]&&-1==params.q.indexOf(pathMatch[2])&&("famous"==pathMatch[2]&&(pathMatch[2]="famo.us"),params.q+=pathMatch[2]+" "),params.q=params.q.replace(/_plus/g,"+").replace(/_sharp/g,"#").replace(/^dot_/g,".").replace(/_css/g,"-css"),$scope.$emit("clearLanguages",[]),clearLanguages(),params.q?($scope.tags_name=params.q.trim().replace("%20"," ").split(" "),$scope.$emit("changeTags",$scope.tags_name)):($scope.tags_name=[],$scope.$emit("changeTags",[])),params.r>0?$scope.rateLevel=params.r:$scope.rateLevel=0,params.h>0?$scope.hirable=params.h:$scope.hirable=!1,params.f>0?$scope.firstSessionFree=params.f:$scope.firstSessionFree=!1,params.p>1?$scope.currentPage=params.p:$scope.currentPage=1,$scope.searchAlgolia(!0)}$scope.urlChanged=!1});var isMatchTopicUrl=function(){for(var i=0;i<$scope.redirectUrls.length;i++)if($location.path().match("experts/"+$scope.redirectUrls[i]))return!0;return!1},isGroupMember=function(){var i,isMember=!1;for(i=0;i<User.groups.length;i++)User.groups[i]==$scope.gID&&(isMember=!0);0==isMember&&0==$scope.gID},changeUrl=function(){var search={};$scope.query_term&&(search.q=$scope.query_term),$scope.rateLevel>0&&(search.r=$scope.rateLevel),$scope.hirable&&(search.h=$scope.hirable+""),$scope.firstSessionFree&&(search.f=$scope.firstSessionFree+""),$scope.currentPage>1&&(search.p=$scope.currentPage);var langs="";for(var i in $scope.languages)$scope.languages[i]===!0&&(langs.length>0&&(langs+=","),langs+=i);langs&&(search.lang=langs),$scope.urlChanged=!0,$location.path("/experts").search(search)};$scope.addTag=function(url_string){var params=$location.search();params.q=params.q||"",params.q=params.q.replace(/_plus/g,"+").replace(/_sharp/g,"#").replace(/^dot_/g,".").replace(/_css/g,"-css"),params.q?$scope.tags_name=params.q.trim().replace("%20"," ").split(" "):$scope.tags_name=[],$scope.tags_name.indexOf(url_string)<0&&($scope.tags_name.push(url_string),$scope.$emit("changeTags",$scope.tags_name),$scope.searchAlgolia(!1))},$scope.addSubTag=function(url_string){var m=$location.path().match(/(([\w#_\-\.]+)-)?experts$/);m||(m=$location.path().match(/(([\w#_\-\.]+)-)?experts\/.+/)),m[2]?$scope.tags_name=[m[2]]:$scope.tags_name=[],$scope.tags_name.indexOf(url_string)<0&&($scope.tags_name.push(url_string),$scope.$emit("changeTags",$scope.tags_name),$scope.searchAlgolia(!0)),$scope.currentPage=1,$scope.rateLevel=0,$scope.urlChanged=!0},$scope.searchAlgolia=function(dontChangeUrl){$scope.showLeaderboard=!1,$scope.query_term=$scope.tags_name.join(" "),dontChangeUrl||changeUrl(),$scope.index.search($scope.query_term,$scope.searchCallback,{hitsPerPage:$scope.itemsPerPage,page:$scope.currentPage-1,numericFilters:$scope.setNumericFilters(),facets:"expertise_names",facetFilters:[getLangFacetFilter()]},500),$scope.isSearch=!0,amplitude.logEvent("/experts/search",{q:$scope.tags_name,r:$scope.rateLevel,p:$scope.currentPage})},$scope.searchCallback=function(success,result){if($scope.isSearch=!1,result.page==$scope.currentPage-1&&result.query==$scope.query_term){20*Math.pow(window.scrollY,.5);$scope.loaded=!0,$scope.isSearch=!1,$scope.items=_.map(result.hits,function(hit){return hit.rate=getRate(hit),hit.group_imgs=getGroupImg(hit),hit.expertises=genExpertises(hit),hit}),$scope.totalCount=result.nbHits,$scope.facets=genFacets(result.facets.expertise_names),$(".h1Title").html("Codementor Software Expert Help"),$(".h1Description").html("Get instant 1:1 help from expert developers on Codementor. Experts on Codementor include book authors, creators of popular open source libraries, and engineers at well-known tech companies."),$(".recentPostHeader").hide(),$(".relatedPost").hide(),$(".showMorePost").hide(),$("h2.getHelpFromExperts").text("Get help from expert developers"),0===$scope.facets.length?$scope.noRecommend=!0:$scope.noRecommend=!1,$scope.tags_name.length>0&&(setTopicCategory($scope.tags_name[0]),setRelatedCategory($scope.tags_name[0]),User.isMember||getReviews($scope.tags_name[0])),$scope.$digest()}},$scope.getNumber=function(num){return new Array(num)};var getReviews=function(url_string){$http.get(appConfig.apiHost+"/api/reviews?category_url_string="+url_string).success(function(data){$scope.reviews=data.reviews}).error(function(){$scope.reviews=[]})},setRelatedCategory=function(url_string){var name,url;name=url_string.toLowerCase().replace(/^\./g,"dot_").replace(/\./g,"").replace(/\+/g,"_plus").replace(/\#/g,"_sharp").replace(/\-css/g,"_css").replace(/[^0-9A-Za-z_]/g,"-").replace(/^-+/,"").replace(/-+$/,""),url=appConfig.apiHost+"/api/get_child_categories?category_url_string="+name,$http.get(url).success(function(data){$scope.relatedCat=data}).error(function(){$scope.relatedCat=null})},setTopicCategory=function(url_string){var name=url_string;for(var i in $scope.topicCats){var n=$scope.topicCats[i].url_string.replace(/_plus/g,"+").replace(/_sharp/g,"#").replace(/^dot_/g,".").replace(/_css/g,"-css");if(n==name)return $scope.topicCatUrl=$scope.topicCats[i].url_string,$scope.topicCatName=$scope.topicCats[i].name,!0}return $scope.topicCatUrl=!1,$scope.topicCatName=!1,!1},getLangFacetFilter=function(){var langFilter=[];for(var i in $scope.languages)$scope.languages[i]===!0&&langFilter.push("language_index:"+i[0].toUpperCase()+i.substring(1));return langFilter},getMutualGroups=function(hit){return _.filter(hit.group_for_index,function(gi){return User.groups?User.groups.indexOf(gi.id)>-1:!1})},getGroupImg=function(hit){return _.map(getMutualGroups(hit),function(group){return group.icon})},getExpTagUrl=function(expertiseName){return expertiseName.toLowerCase().replace(/^\./g,"dot_").replace(/\./g,"").replace(/\+/g,"_plus").replace(/\#/g,"_sharp").replace(/\-css/g,"_css").replace(/[^0-9A-Za-z_]/g,"-").replace(/^-+/,"").replace(/-+$/,"")},getExpUrl=function(expertiseName){return"/"+getExpTagUrl(expertiseName)+"-experts"},addEmTag=function(displayName,url){for(var i=0;i<$scope.tags_name.length;i++)if(getExpTagUrl($scope.tags_name[i])==url)return"<em>"+displayName+"</em>";return displayName},genFacets=function(exps){var facets=[],i=0;for(var expName in exps)if($scope.tags_name.indexOf(expName.toLowerCase())<0){var icon;if(icon=expName in $scope.iconArray?CdnRoot+"/category_icons/"+$scope.iconArray[expName]+".png":CdnRoot+"/category_icons/no-icon.png",facets.push({url:getExpTagUrl(expName),name:expName,count:exps[expName],icon:icon}),i>=9)break;i+=1}return facets},genExpertises=function(hit){return _.map(hit.expertise_names,function(exp){return{route:getExpUrl(exp),name:addEmTag(hit.expertise_display_names[exp],getExpTagUrl(exp))}})},getRate=function(hit){var longterm=_.find(hit.longterm_list,function(longterm){return longterm.username==User.username&&1e3*longterm.valid_to>(new Date).getTime()});if(longterm)return returnRate(longterm.rate,"(long-term mentorship rate)");var groups=getMutualGroups(hit);if(groups.length>0)return returnRate(groups[0].default_rate,"("+groups[0].name+" rate)");var specialterm=_.find(hit.rate_list,function(specialterm){return specialterm.username==User.username});return specialterm&&specialterm.rate!=hit.rate_for_index?returnRate(specialterm.rate,"(special rate)"):returnRate(hit.rate_for_index)},returnRate=function(rate,reason){var r="$"+(rate||0).toFixed(2);return reason?r+"<br><small class='red'>"+reason+"</small>":r};$scope.startMsg=function(username,img,displayName){Chat.openChatroomViaAPI({username:username,img:img,displayName:displayName})},$scope.setRateFilter=function(){switch(parseInt($scope.rateLevel)){case 0:return"rate_for_index>=0";case 1:return"rate_for_index<=10";case 2:return"rate_for_index>10,rate_for_index<= 20";case 3:return"rate_for_index>20,rate_for_index<= 40";case 4:return"rate_for_index>40";default:return"rate_for_index>=0"}},$scope.setHirableFilter=function(){return $scope.hirable?"contract_job_for_index=1":""},$scope.setFirstSessionFreeFilter=function(){return $scope.firstSessionFree?$scope.User.applicableForFreeSession?"free_length>0":($scope.firstSessionFree=!1,"rate_for_index>=0"):""},$scope.setNumericFilters=function(){var filter=$scope.setRateFilter()+","+$scope.setHirableFilter()+","+$scope.setFirstSessionFreeFilter()+",stamina>50,(rating>3.9, rating=0)";return 0!=$scope.gID&&(filter+=",group_for_index.id="+$scope.gID),filter},$scope.setGroup=function(gID){$scope.gID=gID,$scope.currentPage=1,$scope.rateLevel=0,$scope.searchAlgolia()},$scope.$watch("rateLevel",function(){that.initRateLevel?($scope.currentPage=1,$scope.gID=0,$scope.searchAlgolia()):that.initRateLevel=!0}),$scope.$watch("hirable",function(n){that.initHirable?($scope.hirable=n,$scope.currentPage=1,$scope.gID=0,$scope.searchAlgolia()):that.initHirable=!0}),$scope.$watch("firstSessionFree",function(){that.initFirstSessionFree?($scope.currentPage=1,$scope.gID=0,$scope.searchAlgolia()):that.initFirstSessionFree=!0}),$scope.activeCategory=function(tags_name,cat){var name=cat.toLowerCase().replace(/[^#\+\-\.0-9A-Za-z]/g,"-").replace(/-+/g,"-");return 1==tags_name.length?tags_name[0]==name:2==tags_name.length&&$location.path().match(/(([\w#_\-\.]+)-)?experts\/\2\-.+/)?-1!=tags_name.indexOf(name):!1},$scope.filterIsSelected=function(level){return $scope.rateLevel===level},$scope.updateTags=function(tags){$scope.tags_name=_.map(tags,function(tag){return tag.text.toLowerCase().replace(/[^#\+\-\.0-9A-Za-z]/g,"-").replace(/-+/g,"-")}),$scope.currentPage=1,$scope.searchAlgolia()},$scope.prevPage=function(){$scope.currentPage>1&&($scope.currentPage--,$scope.searchAlgolia())},$scope.range=function(){var start,end,rangeSize=10,ret=[];start=Math.ceil($scope.currentPage-rangeSize/2),start>$scope.pageCount()-rangeSize&&(start=$scope.pageCount()-rangeSize+1),0>=start&&(start=1),end=start+rangeSize,end>$scope.pageCount()&&(end=$scope.pageCount()+1);for(var i=start;end>i;i++)ret.push(i);return ret},$scope.prevPageDisabled=function(){return 1===$scope.currentPage?"disabled":""},$scope.pageCount=function(){return Math.ceil($scope.totalCount/$scope.itemsPerPage)},$scope.nextPage=function(){$scope.currentPage<$scope.pageCount()&&($scope.currentPage++,$scope.searchAlgolia())},$scope.nextPageDisabled=function(){return $scope.currentPage===$scope.pageCount()?"disabled":""},$scope.setPage=function(n){$scope.currentPage=n,$scope.searchAlgolia(),$("html, body").animate({scrollTop:44},20*Math.pow(window.scrollY,.5))},$scope.genEmptyRateRange=function(rating){return _.range(5-Math.round(rating))},$scope.genRateRange=function(rating){return _.range(Math.round(rating))},this.goToProfile=function(e,username){var elem=e.target&&angular.element(e.target);elem.hasClass("messageBtn")||elem.hasClass("rate")||elem.hasClass("removeDec")||0!=elem.parents(".rate").size()||!username||(window.location.href="/"+username)};var _focusSearchInput=function(){$timeout(function(){angular.element(".searchBarContent .tags > input").focus()})};this.firstTimeSurvey=function(){NewModal.open("first-time-survey",{windowClass:"first-time-survey",backdrop:"static",keyboard:!1,footer:!1,ok:function(result){result&&_focusSearchInput(),window.showMessage("notice",'Great! Let\'s start from <b>Search</b> or <a href="/questions/new">Get Help Now</a>',function(){})},cancel:function(reason){}})},$scope.onLanguageChange=function(lang){$scope.languages[lang.text.toLowerCase()]=lang.checked,$scope.currentPage=1,$scope.searchAlgolia(!1)},gon.first_time_sign_in&&!(User.groups||{}).length&&(!window.localStorage||(new Date).getTime()-parseInt(JSON.parse(localStorage.skipSurveyObj||"{}")[User.username]||0)>864e5)&&this.firstTimeSurvey()}),angular.module("appDirectoryTopic",["ngSanitize"]).controller("DirectoryTopicCtrl",function($scope,$window){$scope.tags_name=[],$scope.searchCount=0,$scope.updateTags=function(tags){$scope.tags_name=_.map(tags,function(tag){return tag.text}),$scope.searchCount-=1};var genUrl=function(){var query_string="";return 1==$scope.tags_name.length?query_string="/"+$scope.tags_name[0]+"-experts":$scope.tags_name.length>1&&(query_string="/experts?q="+$scope.tags_name.join("%20")),query_string};$(document).on("keyup",".question_category_names input",function(event){13==event.which&&($scope.searchCount+=1,1==$scope.searchCount&&$scope.searchAndRedirect())}),$scope.searchAndRedirect=function(){$window.location.href=genUrl()}}),angular.module("appEditExpertise",[]).controller("editExpertiseCtrl",function($scope,$http,$window){$scope.expertise=[],$scope.expObj={},$scope.newExp=[],$scope.user_id,$scope.submitBtn="Submit Application",$scope.isSubmitting=!1,$scope.initialSet=function(expertise,user_id){$scope.expertise=JSON.parse(expertise),$scope.user_id=user_id,$scope.expertise.length>0&&($scope.expObj=$scope.expertise[0],$scope.expertise=$scope.expertise.map(function(exp){return 0==exp.experience&&(exp.experience=null),0==exp.p_rating&&(exp.p_rating=null),exp}))},$scope.updateTags=function(tags){$scope.expObj.tags=_.map(tags,function(tag){return tag.text.toLowerCase().replace(/[^#\+\-\.0-9A-Za-z]/g,"-").replace(/-+/g,"-")})},$scope.changeTab=function(exp){$scope.expObj=exp,$scope.$emit("changeTags_tagsCtrl",exp.tags)},$scope.removeExp=function(exp){var index=$scope.expertise.indexOf(exp);confirm("Do you really want to delete "+exp.display_name+"? You will not receive any request related to this expertise anymore. Are you sure?")&&index>-1&&($scope.expertise.splice(index,1),$scope.expertise.length>0?$scope.expObj=$scope.expertise[0]:$scope.expObj={})},$scope.openModal=function(){$scope.newExp=[],$scope.$emit("changeTags_nec",[]),$("#newExpertise").modal("show")},$scope.saveAndRoute=function(user_id,currentPage,toPage){$scope.isSubmitting=!0,$scope.submitBtn="Submit Application",$http.post("/mentor/"+$scope.user_id+"/add_expertise",{expertise:$scope.expertise}).success(function(){$window.location="/mentor/"+user_id+"/edit/"+toPage}).error(function(){$scope.isSubmitting=!1,$scope.submitBtn="Submit Application"})},$scope.createNewExpertise=function(){$scope.expertise=$scope.expertise.concat($scope.newExp),$scope.newExp.length>0&&$scope.changeTab($scope.newExp[0]),$scope.newExp=[],$scope.$emit("changeTags_nec",[]),$("#newExpertise").modal("hide")},$scope.addNewExpertise=function(tag){for(var obj={display_name:tag.text,name:tag.text,description:"",experience:0,p_rating:0,tags:[]},i=$scope.expertise.length-1;i>=0;i--)if($scope.expertise[i].name==tag.text)return;for(var i=$scope.newExp.length-1;i>=0;i--)if($scope.newExp[i].name==tag.text)return;$scope.newExp.push(obj)},$scope.removeNewExpertise=function(tag){for(var i=$scope.newExp.length-1;i>=0;i--)$scope.newExp[i].name==tag.text&&$scope.newExp.splice(i,1)},$scope.submitApplication=function(){$scope.isSubmitting=!0,$scope.submitBtn="Submitting...",$http.post("/mentor/"+$scope.user_id+"/add_expertise",{expertise:$scope.expertise}).success(function(){$window.location.href="/mentor/"+$scope.user_id+"/save/2"}).error(function(){$scope.isSubmitting=!1,$scope.submitBtn="Submit Application"})},$scope.goBack=function(){$scope.isSubmitting=!0,$http.post("/mentor/"+$scope.user_id+"/add_expertise",{expertise:$scope.expertise}).success(function(){$window.location.href="/mentor/"+$scope.user_id+"/edit/1"}).error(function(){$scope.isSubmitting=!1})}}),angular.module("appExpertiseForm",["appCategory"]).controller("NewExpertiseFormCtrl",function($q,$http,$scope,TagUtils){$scope.recommandations=[],$scope.categoryTags=[],$scope.relatedTags=[],this.loadTags=TagUtils.loadTags,this.removeWarning=function(){$scope.categoryTags.length>0&&($scope.requiredWarning=!1)},this.updateRecommand=function(){var allTags=_.last(_.union($scope.categoryTags,$scope.relatedTags),4);if(0==allTags.length)return void($scope.recommandations=[]);var deferred=$q.defer(),tagsStr=_.map(allTags,function(t){return t.text}).join(";").replace("#","%23");$.getJSON("https://api.stackexchange.com/2.2/tags/"+tagsStr+"/related?site=stackoverflow&key=LecJZYqlUgzwPLAVNQ6KYA((",function(data){deferred.resolve(data)}),deferred.promise.then(function(results){$scope.recommandations=_.map(_.first(results.items,6),function(item){return item.name})})},this.onAddCategoryTag=function(tag){if($scope.categoryTags.length>1)$scope.categoryTags.pop();else{var _tmpTag=_.clone(tag);_tmpTag.text=TagUtils.convert(_tmpTag.text),tag.text!=_tmpTag.text&&$scope.categoryTags.pop()&&$scope.categoryTags.push(_tmpTag),this.removeWarning(),this.updateRecommand()}}.bind(this),this.onRemoveCategoryTag=function(){this.updateRecommand()}.bind(this),this.onAddRelatedTag=function(tag){if($scope.relatedTags.length>8)$scope.relatedTags.pop();else if($scope.categoryTags.length>0&&TagUtils.convert(tag.text)==TagUtils.convert($scope.categoryTags[0].text))$scope.relatedTags.pop();else{var _tmpTag=_.clone(tag);_tmpTag.text=TagUtils.convert(_tmpTag.text),tag.text!=_tmpTag.text&&$scope.relatedTags.pop()&&$scope.relatedTags.push(_tmpTag),this.updateRecommand()}}.bind(this),this.onRemoveRelatedTag=function(){this.updateRecommand()}.bind(this),this.clickToAddTag=function(tagName){if(!($scope.relatedTags.length>8)){var _tagName=TagUtils.convert(tagName);_.find($scope.relatedTags,function(t){return t.text==_tagName})||$scope.relatedTags.push({text:TagUtils.convert(_tagName)}),this.updateRecommand()}}.bind(this),this.onSubmit=function(e){return 0==$scope.categoryTags.length?(e.preventDefault(),e.stopPropagation(),$scope.requiredWarning=!0,!1):void 0}.bind(this)}),angular.module("appFaq",[]).factory("FaqUtils",function(){return{scrollTo:function(selector){var to=parseInt(selector);to||(to=($(selector).offset()||{}).top||0),$("html, body").animate({scrollTop:Math.max(to-70,0)},400)}}}).controller("faqCtrl",function($rootScope,$scope,$anchorScroll,$location,FaqUtils){$rootScope.$on("$locationChangeSuccess",function(){"/"!=$location.path()&&FaqUtils.scrollTo("#"+$location.path().replace("/",""))})}),angular.module("appFavorite",[]).directive("favoriteStar",function(User,$document,$http){$document.find('meta[name="csrf-token"]').attr("content");return{restrict:"E",scope:{username:"@"},controller:function($scope){$scope.favorited=!!_.contains(User.favorite_users,$scope.username),$scope.toggleFavorite=function(){$scope.favorited?($http["delete"]("/users/favorite_users/"+$scope.username),User.favorite_users=_.reject(User.favorite_users,function(n){return n==$scope.username})):($http.post("/users/favorite_users/"+$scope.username),User.favorite_users.push($scope.username)),$scope.favorited=!$scope.favorited},$scope.$watch(function(){return User.favorite_users.length},function(){$scope.favorited=!!_.contains(User.favorite_users,$scope.username)})},link:function(scope,element){scope.$on("$destroy",function(){element.click(function(){element.hasClass("favorited")?element.removeClass("favorited"):element.addClass("favorited")})})},replace:!0,template:'<div class="favorite" ng-class="{favorited: favorited}" ng-click="toggleFavorite()" style="cursor: pointer;"><i class="icon-star"></i></div>'}}),angular.module("appFreeCredit",[]).controller("FreeCreditCtrl",function($scope,$http,appConfig,User,SignUpForm){this.code="",this.types={basicDark:"//cdn.codementor.io/badges/codementor_dark@2x.png",basicLight:"//cdn.codementor.io/badges/codementor_light@2x.png",builtDark:"//cdn.codementor.io/badges/built_with_codementor_dark@2x.png",builtLight:"//cdn.codementor.io/badges/built_with_codementor_light@2x.png",poweredDark:"//cdn.codementor.io/badges/powered_by_codementor_dark@2x.png",poweredLight:"//cdn.codementor.io/badges/powered_by_codementor_light@2x.png"},this.url="",this.genCode=function(type){return this.types[type]?'<a href="https://www.codementor.io"><img width="108" src="'+this.types[type]+'" alt="Codementor" /></a>':""},this.doSelect=function(e){e.target.select()},this.verifyBadge=function(){User.username?this.url.trim()&&(this.loading=!0,this.urlSuccess="",this.urlError="",$http.post(appConfig.apiHost+"/api/badge/verify",{url:this.url.trim()}).success(function(res){res.success?this.urlSuccess="Success - your badge has been detected and you will receive the free credit soon.":this.urlError="THE BADGE WAS NOT FOUND ON THAT PAGE.",this.loading=!1}.bind(this)).error(function(){this.loading=!1,this.urlError="ERROR! PLEASE TRY AGAIN."}.bind(this))):SignUpForm.open({onopen:function(){angular.element('input[name="utm_form"]').val("user_badge")},title:"Please Sign Up to Continue",becomeMentorLink:!1})}.bind(this),this.changeBadge=function(badgeName){this.badgeType=badgeName},this.compareBadge=function(badge){return this.badgeType===badge},$scope.$watch("fc.badgeType",function(n){n&&(this.code=this.genCode(n))}.bind(this)),this.badgeType="basicDark"}),angular.module("appFindMentor",[]).factory("TopBottomEvent",function($rootScope){function bodyScrollState(){return document.documentElement.clientHeight+$(document).scrollTop()>=document.body.offsetHeight?"bottom":0==$(document).scrollTop()?"top":!1}function checkScroll(){var state=bodyScrollState(),bottom="bottom"==state,top="top"==state;scope.$emit("bodyScrollBottom",bottom),scope.$emit("bodyScrollTop",top)}var scope=$rootScope.$new(!0);return $(window).scroll(checkScroll),{scope:scope,checkScroll:checkScroll}}).controller("findMentorsCtrl",function($scope,$http,$rootScope,$timeout,$location,$anchorScroll,$window,User,RefreshAlert,TopBottomEvent){$scope.init=function(params){$scope.original_budget=params.budget,$scope.budget=$scope.original_budget,$scope.offlineMentorDisplay="budget",$scope.isBroadcasted=params.isBroadcasted,$scope.broadcastUrl=params.broadcastUrl,$scope.initStep=params.step,$scope.loading=!0,$scope.percentage=100,$scope.remove_loading(),$rootScope.$on("$routeChangeSuccess",function(){switch($location.path()){case"/online_mentors":$scope.step=1;break;case"/available_mentors":$scope.step=2}}),$scope.bottom=!1,TopBottomEvent.scope.$on("bodyScrollBottom",function(e,state){$timeout(function(){$scope.bottom=state})}),$scope.goStep($scope.initStep),$scope.show=!0,$scope.online_mentor_count=params.online_mentor_count,$scope.offline_mentor_count=params.online_mentor_count,amplitude.logEvent("Find Mentor",{online_mentor_count:$scope.online_mentor_count,offline_mentor_count:$scope.offline_mentor_count})},$scope.offlineMentorShow=function(state){$scope.offlineMentorDisplay=state,"all"==state?$scope.budget=999999:$scope.budget=$scope.original_budget},$scope.remove_loading=function(){$timeout(function(){$scope.loading=!1,$anchorScroll(),$scope.isBroadcasted||$scope.doBroadcast()},4500)},$scope.doBroadcast=function(){$scope.broadcastUrl&&void 0!=$scope.isBroadcasted&&1!=$scope.isBroadcasted&&$http.post($scope.broadcastUrl).success(function(){$scope.isBroadcasted=!0,$window.showMessage("notice","Your request has been broadcasted to Codementor experts. In the mean time, you are also free to connect with one of the expert mentors below.",null,"broadcastSuccess"),amplitude.logEvent("Find Mentor - broadcasted")}).error(function(data,status){401==status&&RefreshAlert.open("logout")})},$scope.goStep=function(n){switch(n>$scope.loaded&&!$scope.isBroadcasted&&($scope.loading=n,$scope.loaded=n,$scope.remove_loading()),n){case 1:$location.path("/online_mentors"),amplitude.logEvent("Find Mentor - step 1: online_mentors",{online_mentor_count:$scope.online_mentor_count});break;case 2:$location.path("/available_mentors"),amplitude.logEvent("Find Mentor - step 2: available_mentors",{offline_mentor_count:$scope.offline_mentor_count})}TopBottomEvent.checkScroll(),$("#broadcastSuccess > .close").click()}}),angular.module("appGetHelpNow",[]).controller("GetHelpNowCtrl",function($rootScope,$scope,$timeout,$http,$window,appConfig){$scope.tags=[],$scope.requestSent=!1,$scope.loggingRequesting=!1;var updateExperMarginTop=function(){var expertListMarginTop=angular.element(".request-section").outerHeight();angular.element(".expert-list").css({"margin-top":expertListMarginTop+41+"px"})},toggleBackground=function(){angular.element(".non-login-form-bg").size()?(angular.element(".non-login-form-bg").remove(),angular.element(".request-section").removeClass("opened")):(angular.element('<div class="non-login-form-bg"></div>').appendTo("body"),angular.element(".request-section").addClass("opened"))};$scope.budgets=[{amount:40,value:10,selected:!1},{amount:60,value:15,selected:!0},{amount:120,value:30,selected:!1},{amount:160,value:40,selected:!1},{amount:200,value:50,selected:!1},{amount:320,value:80,selected:!1}],$scope.updateTags=function(tags){$scope.tags=tags.map(function(t){return t.text})},$scope.onInit=$scope.updateTags,this.selectBudget=function(value){$scope.budgets.forEach(function(b){b.selected=b.value==value}),amplitude.logEvent("/get_help_now/selectBudget",{budget:4*value})},$scope.showRequestForm=!1,this.togglePostRequest=function(){$scope.showRequestForm=!$scope.showRequestForm,$timeout(function(){updateExperMarginTop(),angular.element(".input-description").focus()},100),toggleBackground(),$scope.showRequestForm?amplitude.logEvent("/get_help_now/openRequestForm"):amplitude.logEvent("/get_help_now/closeRequestForm")},$scope.showSignIn=!1,this.signInToggle=function(){$scope.showSignIn=!$scope.showSignIn,$scope.showSignIn?amplitude.logEvent("/get_help_now/enableSignIn"):amplitude.logEvent("/get_help_now/disableSignIn")};var DataException=function(name,message){this.name=name,this.message=message};this.getTitle=function(){var tmpTitle=($scope.questionTitle||"").trim();if(tmpTitle){if(tmpTitle.length>255)throw new DataException("TITLE_MAX_LENGTH_EXCEED","The request title is too long - limit is 255 characters.");return tmpTitle}throw new DataException("TITLE_REQIRED","Request title is required.")},this.getDescription=function(){return($scope.questionDescription||"").trim()},this.getCategories=function(){if($scope.tags.length>0)return $scope.tags;
throw new DataException("CATEGORY_REQUIRED","Please provide at least one tag for your request.")},this.getBudget=function(){var tmpBudget=$scope.budgets.filter(function(b){return b.selected});return tmpBudget[0].value},this.getEmail=function(){var tmpEmail=($scope.userEmail||"").trim();if(tmpEmail)return tmpEmail;throw new DataException("EMAIL_REQIRED","Email is required.")},$scope.userPassword="",this.getPassword=function(){var tmpPass=$scope.userPassword||"";if(tmpPass)return tmpPass;throw new DataException("PASSWORD_REQIRED","Password is required.")},$scope.userName="",this.getName=function(){var tmpName=$scope.userName||"";if(!$scope.showSignIn){if(tmpName)return tmpName;throw new DataException("NAME_REQIRED","Name is required.")}},this.submit=function(event){this.errorName="",this.errorMsg="";try{var title=this.getTitle(),description=this.getDescription(),categories=this.getCategories(),budget=this.getBudget(),name=this.getName(),email=this.getEmail(),password=this.getPassword();event&&(event.preventDefault()||event.stopPropagation()),$scope.loggingRequesting=!0,$http.post(appConfig.apiHost+"/api/quick/help",{title:title,body:description,category_names:categories,budget:budget,name:name,email:email,password:password}).then(function(res){res.data.success&&(res.data.location?$window.location.href=res.data.location:($scope.requestSent=!0,$scope.showRequestForm=!1,toggleBackground(),$timeout(function(){updateExperMarginTop()},100)),amplitude.logEvent("/get_help_now/submitRequest",{success:!0,signin:$scope.showSignIn}))}.bind(this),function(res){switch($scope.loggingRequesting=!1,res.status){case 400:this.errorName="BAD_REQUEST",this.errorMsg=res.data.error?res.data.error.message:"An account with your email already exists. Please confirm your email address by clicking the link in the email sent from Codementor.";break;case 401:$scope.showSignIn?(this.errorName="DONT_MATCH",this.errorMsg="Your email and password don't match."):(this.errorName="EXISTING_USER",this.errorMsg="An account with your email already exists. Please sign in to proceed.");break;case 409:this.errorName="SIGNUP_ERROR",this.errorMsg=res.data.error.message;break;default:this.errorName="UNKNOW_ERROR",this.errorMsg="Unknow error, please try again or contact support@coementor.io."}amplitude.logEvent("/get_help_now/submitRequest",{success:!1,signin:$scope.showSignIn})}.bind(this))}catch(e){event&&(event.preventDefault()||event.stopPropagation()),this.errorName=e.name,this.errorMsg=e.message}}.bind(this),this.inputEnter=function(){this.submit()}.bind(this),$("body").attr("id","skrollr-body"),bowser.mobile||$timeout(function(){updateExperMarginTop(),$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(element,name,direction){var elem=angular.element(element);"data20Top"==name&&(updateExperMarginTop(),"down"==direction?elem.css({position:"fixed",top:"20px",left:"auto",width:elem.parents(".span9").outerWidth()+"px"}):elem.css({position:"absolute",top:"0px",left:"0px",width:"100%"}))}})},0),amplitude.logEvent("/get_help_now/loaded")}),angular.module("appFirebase",["firebase"]).factory("Firebase",function($firebaseObject){return function(location){var fb=new Firebase(gon.data_init.firebase.path+location),toReturn=$firebaseObject(fb);return toReturn.$on$=fbCamelizedOn(fb,toReturn),toReturn.$once$=fbCamelizedOn(fb,toReturn,"once"),toReturn}}).factory("FirebaseArray",function($firebaseArray){return function(location,queries){var fb=new Firebase(gon.data_init.firebase.path+location),queried=fb;angular.isFunction(queries)&&(queried=queries(fb));var toReturn=$firebaseArray(queried);return toReturn.$push$=function(item){var newItem=nullify(item);return toReturn.$add(humps.decamelizeKeys(newItem))},toReturn.$on$=fbCamelizedOn(queried,toReturn),toReturn.$once$=fbCamelizedOn(queried,toReturn,"once"),toReturn}}),angular.module("appHelpListingShow",[]).controller("helpListingShowCtrl",function($scope,$timeout){$("body").attr("id","skrollr-body"),bowser.mobile||$timeout(function(){$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(){}})},0),$scope.popReceiveTutorialForm=function(){$("#email_collection_modal").modal()}}),angular.module("appInvoice",["appUser","appPayment","appLesson"]).controller("InvoiceController",function($http,$scope,User,Payment,Lesson,appConfig){function submitEvent(){if(0==$scope.totalCost||confirm(confirmContent)){var tips=$("#tipAmount").val();$("#payNow,#tryAgain").attr("disabled",!0),$("#payNow,#tryAgain").html("Processing..."),$("#submitNotSatisfied").attr("disabled",!0),amplitude.logEvent("/invoice/tips",{tip_amount:tips}),amplitude.logEvent("/invoice/pay_now"),$("#payForm").submit()}}function calCreditTotal(){var url=appConfig.apiHost+"/api/lessons/"+lessonId+"/estimated_cost?tips="+$("#tipAmount").val().toString();$("#calLoading").show(),$http.get(url).success(function(data){var $obj=$("#creditAmount");if(0!=data.credit?($obj.html(parseFloat(data.credit).toFixed(1)),$obj.addClass("colorRed")):($obj.html(0),$obj.removeClass("colorRed")),specialterm){var $longterm_obj=$("#longterm_creditAmount");0!=data.longterm_credit?($longterm_obj.html(parseFloat(data.longterm_credit).toFixed(1)),$longterm_obj.addClass("colorRed")):($longterm_obj.html(0),$longterm_obj.removeClass("colorRed"))}data.percentage.length>0&&($("#discount-percentage").html(parseInt(data.percentage[0].off)+"% OFF"),$("#discount-credit").html(parseFloat(data.percentage[0].amount).toFixed(1))),data.money>=0&&($("#totalAmount").html(parseFloat(data.money).toFixed(1)),$scope.totalCost=parseFloat(data.money).toFixed(1)),data.money>0?($("#payNow").html("Pay Now!"),confirmContent="Your "+(User.team_id?"organization's ":"")+"credit card will be charge $"+data.money+" for the session."):($("#payNow").html("Confirm"),confirmContent="Your "+(User.team_id?"organization's ":"")+"credit will be deducted for the session."),$("#calLoading").hide()})}function isPositiveFloat(n){var regex=/^(?:[1-9]\d*|0)?(?:\.\d+)?$/;return null!=n.match(regex)}var that=this,paid=gon.paymentProcessed,isMonthly=gon.isMonthly,specialterm=gon.specialterm,lessonId=gon.lessonId,mentorUsername=gon.mentorUsername,mentorName=gon.mentorName,confirmContent="";$scope.totalCost="-",gon.openFeedbackModal&&Lesson.openFeedbackModal({lessonId:lessonId,oppositeUser:{username:mentorUsername,name:mentorName},steps:gon.feedbackSteps}),that.openPaymentSettingForm=function(warning){Payment.openSettingForm({warning:warning,ok:function(){User.hasPayment=!0,User.cardAuthorized=!0,submitEvent()}})},paid||isMonthly||(calCreditTotal(),$("#tipAmount").on("blur",function(){var tips=$(this).val();isPositiveFloat(tips)&&parseFloat(tips)||$(this).val(0),calCreditTotal()}),$("#payNow,#tryAgain").on("click",function(event){var url=appConfig.apiHost+"/api/lessons/"+lessonId+"/estimated_cost?tips="+$("#tipAmount").val().toString();event.preventDefault(),$("#calLoading").show(),$http.get(url).success(function(data){0!=data.credit&&($("#creditRow").show(),$("#creditAmount").html(parseFloat(data.credit))),1==specialterm&&0!=data.longterm_credit&&($("#longterm_creditRow").show(),$("#longterm_creditAmount").html(parseFloat(data.longterm_credit))),data.money>0?($("#totalAmount").html(parseFloat(data.money)),$scope.totalCost=parseFloat(data.money),User.team_id||User.hasPayment&&User.cardAuthorized?submitEvent():that.openPaymentSettingForm()):submitEvent(),$("#calLoading").hide()})}),$("#submitNotSatisfied").on("click",function(){var tips=$("#tipAmount").val();$(this).attr("disabled",!0),$(this).html("Processing..."),$("#payNow").attr("disabled",!0),amplitude.logEvent("/invoice/tips",{tip_amount:tips}),amplitude.logEvent("/invoice/invoice_question"),$("#notSatisfiedForm").submit()}),$("#triggerTips").on("click",function(){$(this).hide(),$("#tipsRow").show(),$("#tipAmount").focus()}),$("#tipAmount").bind("keyup paste",function(){$("#tipHideAmount").val($(this).val())}))}),angular.module("appLanguage",["ngTagsInput","ngResource"]).controller("LanguageCtrl",function($scope,$resource,$location,$q,$timeout,$rootScope){function removeFromCheckedlanguages(tag){for(var i in $scope.checkedLanguages)if($scope.checkedLanguages[i].text===tag.text){$scope.checkedLanguages.splice(i,1);break}}function addToCheckedlanguages(tag){removeFromCheckedlanguages(tag),$scope.checkedLanguages.push(tag)}function removeFromPopularLanguages(tag){for(var i in $scope.popularLanguages)if($scope.popularLanguages[i].text===tag.text){$scope.popularLanguages.splice(i,1);break}}function addToPopularLanguages(tag){removeFromPopularLanguages(tag),$scope.popularLanguages.push(tag)}$scope.popularLanguages=[],$scope.loading=!0,$scope.checkedLanguages=[],$scope.showAdd=!0,$scope.firstHide=!0;var langInputElement,langInputBox,suggestElement;$timeout(function(){langInputElement=angular.element("#add-lang-btn input"),langInputBox=angular.element("#add-lang-btn .host .tags")[0],suggestElement=angular.element("#add-lang-btn auto-complete")[0],langInputElement.blur(function(){langInputElement[0].value="",langInputElement[0].style.width="80px",langInputBox.style.display="none",$scope.showAdd=!0}),suggestElement.style.position="absolute",suggestElement.style.top="30px",suggestElement.style.width="100%"},0);var otherLanguages=[],langResource=$resource($location.protocol()+"://"+$location.host()+":"+$location.port()+"/get_all_languages");langResource.get({},function(langList){otherLanguages=langList.data.other_languages,$scope.loading=!1,$scope.popularLanguages=langList.data.popular_languages;var isFind=!1;for(var i in $scope.checkedLanguages){isFind=!1;for(var j in $scope.popularLanguages)if($scope.checkedLanguages[i].text===$scope.popularLanguages[j].text){$scope.popularLanguages[j]=$scope.checkedLanguages[i],isFind=!0;break}if(!isFind){$scope.popularLanguages.push($scope.checkedLanguages[i]);for(var k in otherLanguages)if(otherLanguages[k]===$scope.checkedLanguages[i].text){otherLanguages.splice(i,1);break}}}}),$scope.toggleBtn=function(){$scope.showAdd=!$scope.showAdd,$scope.firstHide=!1,langInputBox.style.display="block",$scope.showAdd||$timeout(function(){langInputElement[0].focus()},0)},this.initTags=function(tags){tags&&($scope.checkedLanguages=_.map(tags,function(tag){return tag=tag[0].toUpperCase()+tag.substring(1),{text:tag,checked:!0}}))},this.loadTags=function(query){var langCandidates=[],deferred=$q.defer();for(var i in otherLanguages)0===otherLanguages[i].text.toLowerCase().indexOf(query.toLowerCase())&&langCandidates.push(otherLanguages[i]);return $timeout(function(){deferred.resolve(langCandidates)},0),deferred.promise},this.onAddTag=function(tag){$scope.tags=[],tag.checked=!0,addToPopularLanguages(tag),addToCheckedlanguages(tag),otherLanguages.splice(otherLanguages.indexOf(tag),1)},this.checkChange=function(tag){if(tag.checked){for(var i in $scope.checkedLanguages)if($scope.checkedLanguages[i].text===tag.text){$scope.checkedLanguages.splice(i,1);break}}else $scope.checkedLanguages.push(tag)},angular.element(document).on("keypress","#add-lang-btn input",function(e){return 13==e.keyCode?!1:void 0}),$rootScope.$on("clearLanguages",function(){for(var i=0;i<$scope.popularLanguages.length;i++)$scope.popularLanguages[i].checked=!1})}),angular.module("appLearn",[]).controller("learnCtrl",function($timeout,$scope,Viewport){$("body").attr("id","skrollr-body"),bowser.mobile||$timeout(function(){$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(element,name,direction){if("data48Top"==name){var mq=window.matchMedia("(min-width: 1280px)");if("down"==direction){if(mq.matches&&document.getElementsByClassName("chat-side-bar").length>0){$(element);$(element).css({top:48,width:"100%","padding-right":Viewport.width>=1280?"220px":"0px","box-shadow":"0px 3px 4px rgba(0,0,0,0.2)","z-index":6,background:"#fff","box-sizing":"border-box",position:"fixed"})}else $(element).css({top:48,width:"100%","box-sizing":"border-box","box-shadow":"0px 3px 4px rgba(0,0,0,0.2)",background:"#fff","z-index":6,position:"fixed"});$(".second").css({"margin-top":"48px"}),$(".top-promotion-area").hide()}else"up"==direction&&(mq.matches&&document.getElementsByClassName("chat-side-bar").length>0?$(element).css({top:"auto",width:"100%","padding-right":"0px","box-shadow":"none","z-index":3,"box-sizing":"border-box",background:"#e9eaec"}):$(element).css({top:"auto","box-shadow":"none","z-index":3,background:"#e9eaec"}),$(".second").css({"margin-top":"0px"}),$(".top-promotion-area").show())}}})},0)}),angular.module("appLesson",[]).factory("Lesson",function(NewModal){return{openFeedbackModal:function(options){return options=options||{},NewModal.open("lesson-feedback",{windowClass:"lesson-feedback-modal",keyboard:!1,footer:!1,oppositeUser:options.oppositeUser,lessonId:options.lessonId,steps:options.steps,ok:options.ok||function(){},cancel:options.cancel||function(){}})}}}),angular.module("appLongterm",[]).controller("DirectLongtermModalCtrl",function($modalInstance,$http,config){var that=this;that.config=config,that.acceptableHours=1,that.hoursPerWeek="1 hour per week";var isFilled=function(){return that.description&&that.prefer_time?(that.requiredMsgTitle="",!0):(that.requiredMsgTitle="redborder",!1)};that.acceptableHoursChanged=function(){that.hoursPerWeek=that.acceptableHours>1?that.acceptableHours+" hours per week":that.acceptableHours+" hour per week"},that.submit=function(e){var confirmMsg="You are about to send a long-term request to "+that.config.mentorName+".  Are you sure?";!that.loading&&isFilled()&&confirm(confirmMsg)?that.loading=!0:e.preventDefault()}}).factory("LongtermModals",function($modal){return{openDirectRequestModal:function(mentorUsername,mentorName){$modal.open({windowClass:"direct-longterm-modal new-modal",templateUrl:"/template/direct-longterm-modal.html",resolve:{config:function(){var config={mentorUsername:mentorUsername,mentorName:mentorName};return config}},controller:"DirectLongtermModalCtrl as modal"})}}}),angular.module("appMenteeProfile",["surveyService"]).factory("profileUtils",function(){return{scrollTo:function(selector){var to=parseInt(selector);to||(to=($(selector).offset()||{}).top||0),$("html, body").animate({scrollTop:Math.max(to-90,0)},400)}}}).controller("menteeProfileCtrl",function($scope,$window,$timeout,$location,$http,Chat,profileUtils,survey){function getMenteeData(){return gon.mentee_profile_user}function sendUpdateRequest(mentee,section){$http.post("users/mentee_profile",{authenticity_token:$('meta[name="csrf-token"]').attr("content"),user:mentee,section:section}).success(function(data){switch(section){case"time_zone":$scope.mentee.time_zone_str=data.time_zone_str}})}function initMentee(){$scope.mentee=getMenteeData(),$scope.experience=survey.getExperienceLevelText(),$scope.why_use=survey.getWhyUseText(),_.each($scope.why_use,function(item,index){_.contains($scope.mentee.why_use,index)&&(item.selected=!0)}),_.each($scope.mentee.why_use_text,function(item){_.contains($scope.why_use,item)||($scope.mentee.other=!0,$scope.mentee.other_text=item)})}$scope.currentTab="overview",bowser.mobile||$timeout(function(){$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(element,name,direction){if("data50Top"==name){var mq=window.matchMedia("(min-width: 1280px)");"down"==direction?mq.matches&&!document.getElementsByClassName("chat-side-bar")?$(element).css({top:50,"box-shadow":"0px 0px 4px rgba(0,0,0,0.2)","z-index":6}):$(element).css({top:50,width:"100%","padding-right":Chat.chatSideBar?"220px":"0px","box-shadow":"0px 0px 4px rgba(0,0,0,0.2)","z-index":6,"box-sizing":"border-box"}):"up"==direction&&(mq.matches&&!document.getElementsByClassName("chat-side-bar")?$(element).css({top:"auto","box-shadow":"none","z-index":3}):$(element).css({top:"auto",width:"100%","padding-right":"0px","box-shadow":"none","z-index":3,"box-sizing":"border-box"}))}"dataBottomTop"==name&&"down"==direction&&$(element).hasClass("menuPart")&&$(element).css({top:"auto","box-shadow":"none"})}})},0),$scope.setTab=function(tab){$scope.currentTab=tab,$scope.tabScrollTo("#"+tab)},$scope.isTabSelected=function(tab){return tab==$scope.currentTab},$scope.tabScrollTo=function(selector){profileUtils.scrollTo(selector)},$scope.setTab=function(tab){$scope.currentTab=tab,$scope.tabScrollTo("#"+tab)},$scope.isTabSelected=function(tab){return tab==$scope.currentTab},$scope.tabScrollTo=function(selector){profileUtils.scrollTo(selector)},$scope.updateTags=function(tags){$scope.mentee.need_categories=_.map(tags,function(tag){return tag.text})},$scope.editMode={},$scope.editSection=function(section){$scope.editMode[section]=!0},$scope.submitSection=function(section,cancel){if($scope.editMode[section]=!1,cancel)switch(initMentee(),section){case"need_categories":$scope.$emit("changeTags",$scope.need_cats),$scope.mentee.need_categories=$scope.need_cats;break;case"experience_level":$scope.mentee.experience_level=$scope.experience_level}else"experience_level"===section&&($scope.mentee.experience_level_text=$scope.experience[$scope.mentee.experience_level].title),$scope.mentee.why_use=[],$scope.mentee.why_use_text=[],_.each($scope.why_use,function(item,index){item.selected&&($scope.mentee.why_use.push(index),$scope.mentee.why_use_text.push(item.title))}),$scope.mentee.other&&$scope.mentee.why_use_text.push($scope.mentee.other_text),sendUpdateRequest($scope.mentee,section),$scope.need_cats=$scope.mentee.need_categories},$scope.isEditingSection=function(section){return void 0===$scope.editMode[section]&&($scope.editMode[section]=!1),$scope.editMode[section]},initMentee(),$scope.need_cats=$scope.mentee.need_categories,$scope.experience_level=$scope.mentee.experience_level}),angular.module("appMentorApplyEdit",[]).controller("mentorApplyEditCtrl",function($scope,$http,appConfig){$scope.categories=[],$scope.selected_categories=[],$scope.user_id="",$scope.input_tags=[],$scope.initial_set=function(user_id){$scope.user_id=user_id,$http.get(appConfig.apiHost+"/api/mentor/apply/get_init_categories").success(function(data){$scope.categories=JSON.parse(data.categories),$http.get(appConfig.apiHost+"/api/mentor/"+user_id+"/categories").success(function(data){$scope.selected_categories=JSON.parse(data.categories),$scope.setup_categories()})})},$scope.initial_second_step=function(){$(".timezone-input option").first().remove()},$scope.is_selected_category=function(category){return void 0!==_.find($scope.selected_categories,function(cat){return cat.id==category.id})},$scope.setup_categories=function(){var cats=_.map($scope.categories,function(cat){return cat.id}),init_cats=_.filter($scope.selected_categories,function(cat){return-1==cats.indexOf(cat.id)});$scope.input_tags=_.map(init_cats,function(cat){return cat.name}),$scope.$emit("changeTags",$scope.input_tags)},$scope.saveAndRoute=function(user_id,currentPage,toPage){$("form").attr("action","/mentor/"+user_id+"/save/"+currentPage+"/"+toPage),$("form").submit()}}),angular.module("appMentorProfile",["genAvatar"]).controller("mentorProfileCtrl",function($timeout,$rootScope,$location,$scope,$modal,NewModal,Chat){$("body").attr("id","skrollr-body"),this.checkUrl=function(){var path=$location.path();path&&("/review"==path&&angular.element(".tab-review").size()>0?$scope.currentProfileTab="review":"/activity"==path&&angular.element(".tab-reputation").size()>0?$scope.currentProfileTab="reputation":"/gigs"==path&&angular.element(".tab-gigs").size()>0?$scope.currentProfileTab="gigs":"/overview"==path&&(path&&$location.path("/overview").replace(),$scope.currentProfileTab="overview"),$scope.scrollToCurrentProfileTab())},$scope.scrollToCurrentProfileTab=function(){$timeout(function(){$("html, body").animate({scrollTop:$("#"+$scope.currentProfileTab).position().top-100+"px"})},0)},bowser.mobile||($timeout(function(){$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(element,name,direction){if("data50Top"==name){var mq=window.matchMedia("(min-width: 1280px)");"down"==direction?(mq.matches&&!document.getElementsByClassName("chat-side-bar")?$(element).css({top:50,"box-shadow":"0px 3px 4px rgba(0,0,0,0.2)","z-index":6}):$(element).css({top:50,width:"100%","padding-right":Chat.chatSideBar?"220px":"0px","box-shadow":"0px 3px 4px rgba(0,0,0,0.2)","z-index":6,"box-sizing":"border-box"}),$(".top-promotion-area").hide()):"up"==direction&&(mq.matches&&!document.getElementsByClassName("chat-side-bar")?$(element).css({top:"auto","box-shadow":"none","z-index":3}):$(element).css({top:"auto",width:"100%","padding-right":"0px","box-shadow":"none","z-index":3,"box-sizing":"border-box"}),$(".top-promotion-area").show())}else $(element).is("#overview, #reputation, #gigs, #review")&&("data120TopBottom"==name&&"up"==direction||"data120Top"==name&&"down"==direction)?($(".tabPart .tab").removeClass("active"),$(".tabPart .tab-"+$(element).attr("id")).addClass("active")):"dataBottomTop"==name&&"down"==direction&&$(element).hasClass("tabPart")&&$(element).css({top:"auto","box-shadow":"none"})}})},0),$scope.$on("disableChatBar",function(){angular.element(".tabPart").css({"padding-right":"0px"})}),$scope.$on("enableChatBar",function(){angular.element(".tabPart").css({"padding-right":"220px"})}),$rootScope.$on("$locationChangeStart",this.checkUrl))}).directive("helpListingDeleteBtn",function($window,$http,appConfig){return{restrict:"E",replace:!0,scope:{hid:"="},template:'<a class="delete" ng-class="{deleting:doing}" href="#" ng-click="deleteHelpListing()"><i class="icon-remove"></i> <span>{{deleteText}}</span></a>',link:function(scope,elem){scope.deleteText="Delete",scope.doing=!1,scope.deleteHelpListing=function(){!scope.doing&&$window.confirm("Are you sure you want to delete this help listing?")&&(scope.doing=!0,scope.deleteText="Deleting...",$http["delete"](appConfig.apiHost+"/api/help_listing/"+scope.hid).success(function(){2==elem.parents(".help-listing-route").children().size()?elem.parents(".help-listing-route").remove():elem.parents(".help-listing").remove(),scope.doing=!1,scope.deleteText="Delete"}).error(function(){scope.doing=!1,scope.deleteText="Delete"}))}}}}),angular.module("appOfficeHour",[]).filter("htmlToPlainText",function(){return function(text){return String(text).replace(/<[^>]+>/gm,"").replace(/^(&nbsp;|\s)+/g,"")}}).directive("renderDataTable",function(){return{restrict:"A",scope:{orderBy:"@",ascOrDesc:"@"},link:function(scope,elem){var option={paging:!1,search:!0};scope.ascOrDesc||(scope.ascOrDesc="asc"),scope.orderBy&&(option.order=[[scope.orderBy,scope.ascOrDesc]]),elem.DataTable(option)}}}).controller("AdminOfficeHourCtrl",function($scope){$scope.selectedTab="created",$scope.initialSet=function(tab){$scope.selectedTab=tab},$scope.isSelected=function(tab){return tab==$scope.selectedTab},$scope.choose=function(tab){$scope.selectedTab=tab}}).controller("AdminAMACtrl",function($scope){$scope.selectedTab="created",$scope.initialSet=function(tab){$scope.selectedTab=tab},$scope.isSelected=function(tab){return tab==$scope.selectedTab},$scope.choose=function(tab){$scope.selectedTab=tab}}).controller("EditOfficeHourCtrl",function(){var that=this;this.startAt=new Date($("#office_hour_start_at").val()||Date.now()).toString(),this.submit=function(e){var isNew=$(e.currentTarget).hasClass("new_office_hour");that.errMsg="",$('[name="office_hour[title]"]').val()?$('[name="office_hour[title]"]').val().length>255?that.errMsg="Title too long (maximum is 255 characters)":CKEDITOR.instances.office_hour_body.getData()?new Date($('[name="office_hour[start_at]"]').val())<Date.now()+864e5&&"ready"!=$('[name="office_hour[state]"]').val()&&isNew?that.errMsg="Can't schedule office hours within 24 hours":0==$('[name="office_hour[categories][]"]').length?that.errMsg="Please select at least one tag":$('[name="office_hour[gmail]"]').val()||(that.errMsg="Google account is required"):that.errMsg="Detail is required":that.errMsg="Title is required",that.errMsg?e.preventDefault():that.submitting=!0}}),angular.module("appOfficeHourLanding",[]).controller("officeHourLandingCtrl",function($scope,$timeout){$scope.is_register_form_open=!1,$scope.selected_tab="events",$scope.switch_register_form=function(){$scope.is_register_form_open=!$scope.is_register_form_open,$scope.is_register_form_open&&$scope.scrollToSignUp()},$scope.scrollToSignUp=function(){$scope.is_register_form_open=!0,$timeout(function(){var to=$(".registerBtn").offset().top;$(".registered").find(".input_email")[0].focus(),$("html, body").animate({scrollTop:Math.max(to-70,0)},1e3)},50)},$scope.is_form_show=function(){return 1==$scope.is_register_form_open},$scope.showDate=function(timestamp){return new Date(1e3*timestamp).strftime("%B %o %Y")},$scope.changeTab=function(tab){$scope.selected_tab=tab},$scope.is_selected_tab=function(tab){return $scope.selected_tab==tab}}),angular.module("appOfflineHelp",[]).constant("requestModalClass","offline-help-modal").controller("NoOfflineHelpController",function(){var that=this;that.showScreenshots=!1}).controller("OfflineHelpModalCtrl",function($modalInstance,$http,$timeout,config,requestModalClass,RefreshAlert,User,Payment){function openCardSettingForm(e){var $form=$(e.currentTarget),warning="Please set up your credit card info or <a href='/users/buy_credit'>buy more credit</a> before proceeding.";User.credit>0&&(warning=User.free_credit>0&&that.cost<User.credit?"You don't have enough credit (free credit can't be used for offline help). "+warning:"You don't have enough credit. "+warning),$("."+requestModalClass).hide(),Payment.openCardSettingForm({ok:function(){User.hasPayment=!0,User.cardAuthorized=!0,$timeout(function(){$form.submit()},0)},cancel:function(){$("."+requestModalClass).show()},warningHtmlUnsafe:warning})}var that=this;this.config=config;var checkNum=function(){return that.requiredMsgTitle="",that.cost=parseFloat(that.cost),isNaN(that.cost)||0==that.cost||parseFloat(that.cost)>1e5?(that.cost=0,that.errorMsg="Please input a valid number.",!1):(that.errorMsg="",!0)},isFilled=function(){return that.title?(that.requiredMsgTitle="",!0):(that.requiredMsgTitle="redborder",!1)};this.amountBlur=function(){checkNum()},this.submit=function(e){var confirmMsg;if(confirmMsg=that.delay_payment?"You are about to send delay payment of $"+that.cost+" to "+that.config.mentorName+".  Are you sure?":"You are about to send payment of $"+that.cost+" to "+that.config.mentorName+". By clicking on 'OK', the payment to "+that.config.mentorName+" will be processed and will be non-refundable. Are you sure?",checkNum()&&!that.loading&&isFilled()){if(that.loading=!0,!User.team_id&&User.credit-User.free_credit<that.cost&&(!User.hasPayment||!User.cardAuthorized))return that.loading=!1,openCardSettingForm(e),e.preventDefault(),void e.preventDefault();if(confirm(confirmMsg))return;that.loading=!1}e.preventDefault(),$("."+requestModalClass).show()}}).controller("HireForProjectsModalCtrl",function($modalInstance,$http,config){var that=this;this.config=config;var checkNum=function(){return that.requiredMsgTitle="",that.cost=parseFloat(that.cost),isNaN(that.cost)||0==that.cost||parseFloat(that.cost)>1e5?(that.cost=0,that.errorMsg="Please input a valid number.",!1):(that.errorMsg="",!0)},isFilled=function(){return that.title?(that.requiredMsgTitle="",!0):(that.requiredMsgTitle="redborder",!1)};this.amountBlur=function(){checkNum()},this.submit=function(e){var confirmMsg;confirmMsg="You are about to send delay payment of $"+that.cost+" to "+that.config.mentorName+".  Are you sure?",checkNum()&&!that.loading&&isFilled()&&confirm(confirmMsg)||e.preventDefault()}}).factory("OfflineHelpModals",function($modal,requestModalClass){function openRequestModal(mentorUsername,mentorName){$modal.open({windowClass:requestModalClass,templateUrl:"/template/offline-help-modal.html",resolve:{config:function(){var config={mentorUsername:mentorUsername,mentorName:mentorName};return config}},controller:"OfflineHelpModalCtrl as modal"})}return{openRequestModal:openRequestModal}}),angular.module("appOrder",[]).controller("OrderController",function($http,$scope,$location,$timeout,appConfig){function request(options,cb){var _options={method:options.method||"get",url:options.url,data:options.data};$http(_options).success(function(data){cb(data)}).error(function(err){cb(null,err)})}function getOrderIndexById(id){var target_order_index=null;return $scope.orders.forEach(function(ele,index){ele.id===id&&(target_order_index=index)}),target_order_index}var _API_ROOT=appConfig.apiHost+"/api/seller";$scope.orders=[],$scope.createOrder=function(service_id,msg){request({url:_API_ROOT+"/services/"+service_id+"/orders",data:msg},function(res,err){})},$scope.doOrderAction=function(order_id,action,data){if(order_id&&action){if("review"!==action){var _msg="receive"===action?"I confirm that the gig has been completed. By clicking on \u2018OK\u2019, the payment to mentor will be processed. Are you sure?":"Are you sure?";if(!confirm(_msg))return}var _target_index=getOrderIndexById(order_id),_order=$scope.orders[_target_index],_options={method:"review"===action?"put":"post",url:_API_ROOT+"/orders/"+order_id+"/"+action,data:data};$scope.processing=!0,_order.showMask=!0,$timeout(function(){$scope.fading=!0,request(_options,function(res,err){return $scope.processing=!1,err?(_order.actionFailure=!0,_order.actionFailureMessage=err.error&&err.error.message,void console.error(err)):void("review"===action?_order.review=res:(_order.actionFailure=!1,_order.reason=res.reason,_order.aasm_state=res.aasm_state,_order.aasm_state_display=$scope.parseToDisplayState(res.aasm_state),_order.reason_not_refund=res.reason_not_refund||""))})},10)}},$scope.closeMask=function(order_id){$scope.fading=!1,$timeout(function(){$scope.orders[getOrderIndexById(order_id)].showMask=!1},400)},$scope.giveInstructionByState=function(next_state){if(next_state)switch(next_state){case"processing":return"Excellent! The client is waiting for your awesome gig, click 'Deliver' to let him know once you're done.";case"delivered":return"We just notify the client about your delivery!";default:return""}},$scope.setModalInfo=function(order_id,action){$scope.actionModal={type:action,answer:{rating:5,message:""},error:!1,btnAction:function(){if(!this.answer.message)return void(this.error=!0);var _target="#orderActionModal-"+$scope.templateState;return"review"===action?($(_target).modal("hide"),$scope.doOrderAction(order_id,action,{rating:parseInt(this.answer.rating,10),content:this.answer.message})):-1!==["decline","cancel","not_refund"].indexOf(action)?($(_target).modal("hide"),$scope.doOrderAction(order_id,action,{reason:this.answer.message})):"decline_after_accept"===action?($(_target).modal("hide"),$scope.doOrderAction(order_id,"decline",{reason:this.answer.message})):void 0}}},$scope.showModalFromMask=function(order_id){$scope.setModalInfo(order_id,"review"),$scope.closeMask(order_id)},$scope.setup=function(role,state){var _lastPath="";$scope.$on("$routeChangeSuccess",function(){var routes=$location.path().split("/"),currentPath=routes[1],isMentor="mentor"===role;if(-1==["active-orders","finished-orders","pending-orders"].indexOf(currentPath))return void(_lastPath=currentPath);if(currentPath!==_lastPath){var currentState=currentPath.split("-")[0];currentState===state&&($scope.loading=!0,$scope.loaded=!1,$scope.filterSetupOK=!1,$scope.togglePath="/"+currentPath+"/",_lastPath=currentPath,"pending"!==currentState&&$scope.setupFilter(currentPath),$scope.templateState=state,$scope.getAllOrders(state,isMentor))}})},$scope.getAllOrders=function(state,isMentor){var path=isMentor?"/orders/received/"+state:"/orders/submitted/"+state;request({url:_API_ROOT+path},function(res,err){err?console.log("err",err):$scope.orders=res;var query=$location.search();query.search&&($scope.data.searchTitle=query.search),$scope.parseAndSetDueDate(),$scope.loading=!1,$scope.loaded=!0})},$scope.parseAndSetDueDate=function(){$scope.orders&&($scope.orders=$scope.orders.map(function(ele){var _zone=ele.mentee.timezone,_actual_due_date=moment(1e3*ele.due_at),_estimated_due_date=moment().add(ele.total_hours_needed,"hours").tz(_zone);return Object.assign({},ele,{aasm_state_display:$scope.parseToDisplayState(ele.aasm_state),updated_at_display:moment(1e3*ele.updated_at).tz(_zone).format("lll"),due_at_display:ele.due_at>0?_actual_due_date.format("ll"):_estimated_due_date.format("ll")})}))},$scope.setupFilter=function(path){function getStateTable(type){var col="active"===type?["paid","processing","delivered","asking_for_refund"]:["declined","received","invalid"];return col.map(function(ele){var _show=$scope.parseToDisplayState(ele);return{value:_show,display:_show}})}$scope.data.showState="",$scope.orderStateTable=getStateTable("active-orders"===path?"active":"finished"),$scope.filterSetupOK=!0},$scope.parseToDisplayState=function(state){var arr={created:"Pending",paid:"New",processing:"Processing",delivered:"Delivered",asking_for_refund:"Cancellation Request",
declined:"Declined",received:"Received",refunded:"Cancelled",cancelled:"Cancelled",invalid:"Cancelled"};return arr[state]}}).filter("capitalize",function(){return function(input){return input?input.charAt(0).toUpperCase()+input.substr(1).toLowerCase():""}}),angular.module("appScheduleCluster",[]).filter("htmlToPlainText",function(){return function(text){return text?String(text).replace(/<[^>]+>/gm,""):""}}).factory("ScheduleCluster",function(User,$http,appConfig){var nextMidnight=function(d){return d=new Date(d),d.setDate(d.getDate()+1),d.setHours(0,0,0,0),d},isSameDate=function(a,b){return a.getFullYear()===b.getFullYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate()},compactAvailability=function(availability){var ma=_.sortBy(availability,"start");return _.reduce(ma,function(memo,a){var last=_.last(memo);return last&&last.end==a.start?last.end=a.end:memo.push(_.clone(a)),memo},[])},availabilityToText=function(availability){var ma=compactAvailability(availability);return _.map(ma,function(a){var start=moment(a.start),end=moment(a.end);return start.day()!=end.day()?start.format("ddd, hh:mm A")+" - "+end.format("ddd, hh:mm A"):start.format("ddd, hh:mm A")+" - "+end.format("hh:mm A")})},availabilityToHtml=function(availability){var ma=compactAvailability(availability);return _.map(ma,function(a){var start=moment(a.start),end=moment(a.end);return start.day()!=end.day()?start.format("<b>ddd</b>, hh:mm A")+" - "+end.format("<b>ddd</b>, hh:mm A"):start.format("<b>ddd</b>, hh:mm A")+" - "+end.format("hh:mm A")})},scheduleClusterMassage=function(sc){var nextScheduleIndex,now=new Date;if(sc.schedule_cluster_plan&&sc.schedule_cluster_plan.is_course&&(sc.schedule_cluster_plan.name_v0=sc.schedule_cluster_plan.name.split(/_v[\d]+/)[0]),sc.schedules=_.sortBy(sc.schedules,function(s){return s.appointment_time}),sc.availability_text=availabilityToText(sc.availability),sc.availability_html=availabilityToHtml(sc.availability),_.each(sc.interests,function(interest){interest.mentor_availability_text=availabilityToText(interest.mentor_availability),interest.mentor_availability_html=availabilityToHtml(interest.mentor_availability)}),nextScheduleIndex=_.findIndex(sc.schedules,function(s){return nextMidnight(s.appointment_time)>Date.now()}),-1==nextScheduleIndex)return sc.upcomingScheduleCount=0,sc.finishedScheduleCount=sc.size,void _.each(sc.schedules,function(s){s.tab="finished"});var nextSchedule=sc.schedules[nextScheduleIndex];sc.nextSchedule=nextSchedule,nextSchedule.isNext=!0,sc.upcomingScheduleCount=sc.schedules.length-nextScheduleIndex,sc.finishedScheduleCount=nextScheduleIndex,_.each(sc.schedules,function(s,i){nextScheduleIndex>i?s.tab="finished":(s.tab="upcoming",s.upcomingIndex=i-nextScheduleIndex,isSameDate(new Date(s.appointment_time),new Date(nextSchedule.appointment_time))&&isSameDate(new Date(s.appointment_time),now)&&(s.isNext=!0,s.isToday=!0,sc.nextSchedule.last_finished_sub_lesson_obfuscated_id&&(sc.nextSchedule=s)))}),sc.schedules=_.sortBy(sc.schedules,function(s,i){return nextScheduleIndex>i?-s.appointment_time:void 0})};return{funScheduleClusters:function(scope,callback){var url;scope.db.hideScheduleClustersLoading=!1,url=User.isMentor?appConfig.apiHost+"/api/dashboard/mentor/schedule_clusters":appConfig.apiHost+"/api/dashboard/mentee/schedule_clusters",$http.get(url).success(function(data){scope.db.hideScheduleClustersLoading=!0,scope.scheduleClusters=data.schedule_clusters,_.each(scope.scheduleClusters,scheduleClusterMassage),callback&&callback()})},funFinishedScheduleClusters:function(scope){var url;scope.db.hideFinishedScheduleClustersLoading=!1,url=User.isMentor?appConfig.apiHost+"/api/dashboard/mentor/finished_schedule_clusters":appConfig.apiHost+"/api/dashboard/mentee/finished_schedule_clusters",$http.get(url).success(function(data){scope.db.hideFinishedScheduleClustersLoading=!0,scope.scheduleClusters=data.schedule_clusters,_.each(scope.scheduleClusters,scheduleClusterMassage)})},setUpCalendar:function(selector,options){options=_.extend({timezone:"local",defaultView:"agendaWeek",allDaySlot:!1,header:{right:"",center:"",left:""},columnFormat:{week:"dddd"},slotEventOverlap:!1,selectable:!0,editable:!0,selectHelper:!1,selectOverlap:function(stillEvent){return"background"===stillEvent.rendering},eventOverlap:function(stillEvent){return"background"===stillEvent.rendering},select:function(start,end){var eventData;eventData={title:"",start:start,end:end},$(selector).fullCalendar("renderEvent",eventData,!0),$(selector).fullCalendar("unselect")},eventClick:function(calEvent){$(selector).fullCalendar("removeEvents",calEvent._id)}},options||{}),$(selector).fullCalendar(options)},isSelectableTime:function(calendarSelector,time){var valid,$cal=$(calendarSelector),clientEvents=$cal.fullCalendar("clientEvents"),backgroundEvents=_.filter(clientEvents,function(e){return"background"==e.rendering}),events=_.filter(clientEvents,function(e){return"background"!=e.rendering});return time=moment(time),valid=!!_.find(backgroundEvents,function(e){return e.start<=time&&time<=e.end}),valid=valid&&!_.find(events,function(e){return e.start<time&&time<=e.end})},availabilityToLocalEvents:function(availability,eventOptions){var availability=_.reduce(availability,function(memo,a){for(var start=moment(a.start),end=moment(a.end),duration=18e5,times=(end-start)/duration,i=0;times>i;i++)memo.push({start:moment(start+duration*i),end:moment(start+duration*i+duration)});return memo},[]);availability=_.sortBy(availability,"start");var sunday=availability[0].start.clone().day(0).startOf("day"),nextSunday=sunday.clone().day(7);return availability=_.map(availability,function(a){return a.start>=nextSunday&&(a.start.subtract(1,"week"),a.end.subtract(1,"week")),a=_.extend(a,eventOptions||{})}),availability=_.sortBy(availability,"start"),availability=_.reduce(availability,function(memo,e){var l=_.last(memo);return l&&l.end.isSame(e.start)?(l.end=e.end.clone(),memo):(memo.push(e),memo)},[])},availabilityToText:availabilityToText}}).controller("ScheduleClustersRegistrationCtrl",function($scope){var that=this;this.scheduleClusterId=gon.scheduleClusterId,this.plans=gon.plans,this.schedule_num=gon.schedule_num,that.plan=getUrlParameterByName("plan")||this.plans[0].name,that.months=_.findWhere(gon.plans,{name:that.plan}).months,that.type=_.findWhere(gon.plans,{name:that.plan}).type,$scope.change_plan=function(plan){that.plan=plan},$scope.is_selected_plan=function(plan){return that.plan==plan},$scope.cost_per_month=function(){return _.findWhere(that.plans,{name:that.plan}).cost*that.schedule_num/4},$scope.total_cost=function(){return $scope.cost_per_month()*that.months}}).controller("ScheduleClustersConfirmCtrl",function($scope,$timeout,$http,appConfig,NewModal,ScheduleCluster){function stripeResponseHandler(status,response){var $form=$("form.edit_schedule_cluster");if(response.error)$form.find(".payment-errors").text(response.error.message).show(),$form.find("input[type=submit]").prop("disabled",!1).val("Confirm"),CM_LIB.CreditCard.reportFailedAttempt(response.error,$form);else{var token=response.id;$form.append($('<input type="hidden" name="stripe_token" />').val(token)),openConfrimModal()}}function openConfrimModal(){var $form=$("form.edit_schedule_cluster"),plan=_.findWhere(that.plans,{name:that.plan}),traits={plan:that.plan,months:that.months,schedule_num:that.schedule_num,total_cost:$scope.total_cost()};amplitude.logEvent("/Monthly/Confirm/OpenConfrimModal",traits),_.extend(plan,{months:that.months,schedule_num:that.schedule_num,total_cost:$scope.total_cost()}),NewModal.open("schedule-cluster-payment-confirm",{windowClass:"schedule-cluster-payment-confirm-modal",footer:!1,plan:plan,ok:function(){$form.get(0).submit(),amplitude.logEvent("/Monthly/Confirm/ConfirmModal/OK",traits),ga("send","event","monthly","pay"),(window.optimizely||[]).push(["trackEvent","monthly_pay"])},cancel:function(){$form.find("input[type=submit]").prop("disabled",!1).val("Confirm"),amplitude.logEvent("/Monthly/Confirm/ConfirmModal/Cancel",traits)}})}var that=this,paypalAuthorizationUrls={};this.last4=gon.last4,this.addCard=!gon.last4,this.scheduleClusterId=gon.scheduleClusterId,this.plans=gon.plans,this.interestId=gon.interestId,this.mentorAvailabilityText=ScheduleCluster.availabilityToText(gon.mentorAvailability),$timeout(function(){$("input.cc-num").payment("formatCardNumber")},0),this.toggleAddCard=function(){that.addCard=!that.addCard,$timeout(function(){$("input.cc-num").payment("formatCardNumber")},0)},that.plan=$("#schedule_cluster_plan").val(),that.months=_.findWhere(gon.plans,{name:that.plan}).months,that.monthsOptions=_.uniq(_.pluck(gon.plans,"months")),that.scheduleNums=_.reduce(this.plans,function(memo,p){return memo[p.name]=p.confirm_schedule_nums,memo},{}),$scope.labelForScheduleNum=function(num){var perWeek=num/4;return 1==perWeek?perWeek+" hour per week":perWeek+" hours per week"},$scope.changeScheduleNumPerWeek=function(){var n=parseInt(that.schedule_num_per_week,10);_.isNaN(n)||(_.contains(that.scheduleNums[that.plan],4*n)||(n=4*n>that.scheduleNums[that.plan][that.scheduleNums[that.plan].length-1]?that.scheduleNums[that.plan][that.scheduleNums[that.plan].length-1]/4:that.scheduleNums[that.plan][0]/4),that.schedule_num=4*n,that.schedule_num_per_week=n,$scope.load_paypal_authorization_link())},$scope.change_plan=function(plan){that.plan=plan,$scope.load_paypal_authorization_link()},$scope.is_selected_plan=function(plan){return that.plan==plan},$scope.cost_per_month=function(){var planObj=_.findWhere(that.plans,{name:that.plan});return(planObj.cost/4*that.schedule_num).toString()},$scope.total_cost=function(){return $scope.cost_per_month()*that.months},$scope.change_months=function(m){var i;i=_.findIndex(_.groupBy(gon.plans,"months")[that.months],{name:that.plan}),$scope.change_plan(_.groupBy(gon.plans,"months")[m][i].name),that.months=m},$scope.load_paypal_authorization_link=function(){var plan=that.plan,schedule_num=that.schedule_num,interestId=that.interestId;$scope.paypalAuthorizationUrl=null,$scope.loadingPaypalLink=!1,$scope.paypalError=null,paypalAuthorizationUrls[plan+"_"+schedule_num]?$scope.paypalAuthorizationUrl=paypalAuthorizationUrls[plan+"_"+schedule_num]:($scope.loadingPaypalLink=!0,$http.post("/paypal/schedule_clusters/"+that.scheduleClusterId+"/authorization_link",{interest_id:interestId}).success(function(result){$scope.loadingPaypalLink=!1,$scope.paypalAuthorizationUrl=result.approval_url,paypalAuthorizationUrls[plan+"_"+schedule_num]=result.approval_url}).error(function(){$scope.loadingPaypalLink=!1,$scope.paypalError="Some error occurred, please try again later"}))},$("form.edit_schedule_cluster").submit(function(){var $form=$(this);return!$("input.cc-num").val()&&gon.last4?(openConfrimModal(),!1):($("input[type=submit]").prop("disabled",!0).val("Processing..."),Stripe.createToken($form,stripeResponseHandler),!1)})}).controller("ScheduleClustersCourseConfirmCtrl",function($scope,$timeout,$http){var that=this;this.last4=gon.last4,this.addCard=!gon.last4,this.scheduleClusterId=gon.scheduleClusterId,this.cost=gon.cost,that.plan=gon.plan,that.schedule_num=gon.schedule_num,$timeout(function(){$("input.cc-num").payment("formatCardNumber"),$scope.load_paypal_payment_link()},0),this.toggleAddCard=function(){that.addCard=!that.addCard,$timeout(function(){$("input.cc-num").payment("formatCardNumber")},0)},$scope.load_paypal_payment_link=function(){$scope.paypalPaymentUrl=null,$scope.loadingPaypalLink=!1,$scope.paypalError=null,$scope.loadingPaypalLink=!0,$http.post("/paypal/schedule_clusters/"+that.scheduleClusterId+"/authorization_link",{plan:that.plan,schedule_num:that.schedule_num}).success(function(result){$scope.loadingPaypalLink=!1,$scope.paypalPaymentUrl=result.approval_url}).error(function(){$scope.loadingPaypalLink=!1,$scope.paypalError="Some error occurred, please try again later"})}}).controller("RequestDetailCtrl",function(){var that=this,isCoursePlan=gon.is_course_plan;this.submit=function(e){var data=$(".edit_schedule_cluster").serializeArray();that.errors={},isCoursePlan?that.errors.cameFrom=!_.findWhere(data,{name:"schedule_cluster[came_from]"})&&0==_.findWhere(data,{name:"schedule_cluster[came_from_other]"}).value.trim().length:(that.errors.description=0==_.findWhere(data,{name:"schedule_cluster[description]"}).value.trim().length,that.errors.categories=0==_.where(data,{name:"schedule_cluster[categories][]"}).length),that.errors.whyUse=_.where(data,{name:"user[why_use][]"}).length+_.findWhere(data,{name:"user[why_use_other]"}).value.trim().length==0,_.filter(that.errors,function(v){return v}).length>0&&(e.preventDefault(),e.stopPropagation())},this.resetCameFrom=function(){$('[name="schedule_cluster[came_from]"]').prop("checked",!1)}}).controller("ScheduleClusterNewScheduleCtrl",function($scope,$document,ScheduleCluster){function setAvaibility(){var events,json;events=_.map($("#calendar").fullCalendar("clientEvents"),function(event){return{start:event.start.toDate(),end:event.end.toDate()}}),json=JSON.stringify(events);var totalTime=0;return _.each(events,function(e){totalTime+=e.end-e.start}),totalTime<36e5*gon.atLeastHours?(alert("Please select at least "+gon.atLeastHours+" hours."),!1):void $("#schedule_cluster_availability").val(json)}$document.ready(function(){$(".alerts, [check-time-zone]").remove(),amplitude.logEvent("/Login/Monthly/Schedule"),$(".timezone").text((new Date).currentTimeZoneText()),$("input[type=submit]").click(setAvaibility),localStorage.removeItem("monthlyRequestDetail"),localStorage.removeItem("monthlyRequestCategories"),ScheduleCluster.setUpCalendar("#calendar",{slotDuration:"00:60:00"})})}).filter("lessonLengthText",function(){return function(secs){return 3600>secs?Math.floor(secs/60)+" mins":secs>=3600&&7200>secs?"1 hour "+Math.floor(secs%3600/60)+" mins":Math.floor(secs/3600)+" hours "+Math.floor(secs%3600/60)+" mins"}}),angular.module("appOhShow",[]).controller("ohShowCtrl",function($scope,$http,appConfig,$timeout,SignUpForm,NewModal){$scope.options=["Attending","Not Attending"],$scope.initSet=function(is_attending,open_sign_up,open_share,ohID){$scope.currentOption=is_attending?"Attending":"Not Attending",open_sign_up&&$timeout(function(){$scope.signUp(ohID)})},$scope.update=function(ohID){var url;url=$scope.isAttending()?appConfig.apiHost+"/api/officehours/"+ohID+"/attend":appConfig.apiHost+"/api/officehours/"+ohID+"/not_attend",$http.get(url).success(function(){})},$scope.signUp=function(ohID){SignUpForm.open({onopen:function(){angular.element('input[name="user[office_hour]"]').val(ohID)},title:"Please Sign Up to RSVP for Office Hour",becomeMentorLink:!1})},$scope.isAttending=function(){return"Attending"==$scope.currentOption},$scope.openHowToStartOfficeHourModal=function(oh){NewModal.open("how-to-start-office-hours",{officeHour:oh,footer:!1,windowClass:"how-to-start-office-hours-modal"})}}),angular.module("appPayment",["app","mm.foundation.modal","mm.foundation.tpls"]).directive("stripeForm",function(){return{link:function(scopr,elem){elem.find(".cc-number").payment("formatCardNumber"),elem.find(".cc-exp").payment("formatCardExpiry"),elem.find(".cc-cvc").payment("formatCardCVC")}}}).factory("Payment",function($sce,NewModal){return{openAskForSettingForm:function(options){return options=options||{},NewModal.open("ask-for-setup-payment",{windowClass:"ask-for-setup-payment-modal",realCreditsToSessionTime:Math.round(parseFloat(options.realCreditsToSessionTime||0)),cardDeclined:options.cardDeclined,mentor:options.mentor,keyboard:!1,footer:!1,ok:options.ok||function(){},cancel:options.cancel||function(){},next:options.next||function(){}})},openSettingForm:function(options){return options=options||{},NewModal.open("setup-payment",{windowClass:"setup-payment-modal",mentor:options.mentor,backdrop:options.backdrop||"static",keyboard:!1,footer:!1,warning:options.warning,successMsg:options.successMsg||"Thanks! You've set up billing info successfully.",ok:options.ok,cancel:options.cancel||function(){}})},openCardSettingForm:function(options){return options=options||{},NewModal.open("setup-credit-card",{windowClass:"setup-credit-card-modal",mentor:options.mentor,backdrop:"static",keyboard:!1,footer:!1,warning:options.warning,warningHtmlUnsafe:options.warningHtmlUnsafe,successMsg:options.successMsg||"Thanks! You've set up credit card info successfully.",ok:options.ok,cancel:options.cancel||function(){}})}}}).controller("BuyCreditController",function($scope,$http,$timeout,$document,User){function loadPaypalLinks(plans){$http.post("/paypal/plan_approval_links",{plans:plans}).then(function(res){$scope.paypalApprovalLinks=res.data.links})}function loadCoinbaseButtons(plans){$scope.coinbaseButtonScriptLoaded=!1,$http.post("/coinbase/plan_buttons",{plans:plans}).then(function(res){$scope.coinbaseButtons=res.data.buttons,$timeout(function(){$scope.coinbaseButtonScriptLoaded=!0},100)})}$scope.totalCredit=parseFloat(User.credit),$scope.payWith="",$scope.bitcoinFormData={},$scope.coinbaseButtonScriptLoaded=!1,$document.ready(function(){var plans=$(".plan").map(function(i,v){return $(v).data("plan")}).get();loadPaypalLinks(plans),loadCoinbaseButtons(plans)}),$scope.upSellingInit=function(){$scope.payWith="card"},$scope.changePlan=function(){$scope.setPlan(),$scope.setSpend(),$scope.setCredit()},$scope.$watch("payWith",$scope.changePlan),$scope.setPlan=function(){$scope.plan=window.cmvar.pricingTable.getPlan(),"plan1"==$scope.plan?$scope.payWith="card":$scope.plan||($scope.payWith="")},$scope.setSpend=function(){$scope.spend=window.cmvar.pricingTable.getSpend()},$scope.setCredit=function(){$scope.credit=window.cmvar.pricingTable.getCredit()},$scope.openCoinbaseBitcoinModal=function(code){$document.trigger("coinbase_show_modal",code)},$document.on("coinbase_payment_complete",function(event,code){console.log("Payment completed for button "+code),$scope.totalCredit+=$scope.credit}),$document.on("coinbase_payment_mispaid",function(event,code){console.log("Payment mispaid for button "+code)}),$document.on("coinbase_payment_expired",function(event,code){console.log("Payment expired for button "+code)})}),angular.module("appPrepareLesson",[]).controller("prepareLessonCtrl",function($scope,$rootScope,$timeout,$window,User){$scope.lesson=gon.prepare_lesson,$scope.state="waiting",$rootScope.$on("firebase_auth_success",function(){$scope.sessionRef=$rootScope.firebaseRef.child("sessions").child($scope.lesson.token),$scope.myOnlineRef=$scope.sessionRef.child("online").child(User.firebaseId),$scope.myOnlineRef.update({status:!0}),$scope.myOnlineRef.onDisconnect().update({status:!1}),$scope.opposite_user=User.username==$scope.lesson.mentee.username?$scope.lesson.mentor:$scope.lesson.mentee,$scope.oppositeUserRef=$scope.sessionRef.child("online").child($scope.opposite_user.firebase_hash_id),$scope.oppositeUserRef.child("status").on("value",function(snapshot){var value=snapshot.val()?snapshot.val():!1;1==value?($scope.state="ready",$("#lessonStart")[0].play()):$scope.state="waiting",$scope.$digest()})}),$rootScope.$on("connect_now_declined",function(){$scope.state="declined"}),$rootScope.$on("connect_now_expired",function(){"waiting"==$scope.state&&($scope.state="retry")}),$scope.tryAgain=function(url){amplitude.logEvent("click /prepare_lesson/try_again"),getUrlParameterByName("realtime")?$window.location.href=url:$window.location.reload()},$scope.startSession=function(url){amplitude.logEvent("click /prepare_lesson/start_session_now"),$window.location.href=url},$scope.findMentor=function(url){amplitude.logEvent("click /prepare_lesson/find_mentor"),$scope.lesson.question.isDirect?$window.location.href="/experts":$window.location.href=url}}),angular.module("appPresence",["appFirebase"]).factory("Idle",function($timeout,$http,$localStorage,appConfig){function setLastNonIdleTimestamp(){var now=(new Date).getTime();$localStorage.lastNonIdleTimestamp=now}function isIdle(){var lastNonIdleTimestamp=$localStorage.lastNonIdleTimestamp||0,now=(new Date).getTime();return now-lastNonIdleTimestamp>IDLE_THREASHOLD}var IDLE_THREASHOLD=12e4;return{setIdleTimer:function(time){time=time||IDLE_THREASHOLD,!this.idleTimer&&isIdle()&&(this.idleTimer=$timeout(function(){isIdle()&&$http.post(appConfig.apiHost+"/api/users/me/idle").success(function(){}).error(function(data,status){401==status&&RefreshAlert.open("logout")})},time))},cancelIdleTimer:function(){return setLastNonIdleTimestamp(),this.idleTimer&&($timeout.cancel(this.idleTimer),this.idleTimer=null),!0}}}).directive("presence",function(User,Firebase){return{restrict:"E",scope:{status:"=status"},templateUrl:"template/presence.html",replace:!0,link:function(scope,elem,attrs){var username=attrs.un.replace(/\./g,"^"),presence=Firebase("presence/"+username+"/magic");scope.showStatus=!!attrs.showStatus,scope.hideOffline=!!attrs.hideOffline,scope.presenceStatus="offline",scope.presenceStatusName="offline",_.contains(User.targets,md5(attrs.un))||presence.$on$("value",function(response){var _v=response.snapshot.value;if($.isEmptyObject(_v))scope.presenceStatusName="Offline",scope.presenceStatus="offline",scope.status="offline";else switch(scope.presenceStatus=_v,scope.status=_v,_v){case"available":scope.presenceStatusName="Available";break;case"online":scope.presenceStatusName="Online";break;case"away":scope.presenceStatusName="Away";break;case"session":scope.presenceStatusName="In Session";break;case"offline":scope.presenceStatusName="Offline";break;default:scope.presenceStatusName="Offline",scope.presenceStatus="offline",scope.status="offline"}})}}}).directive("mentorPresenceToggle",function($rootScope,$http,$timeout,Firebase,User,Idle,NewModal,RefreshAlert){return{restrict:"E",replace:!0,templateUrl:"template/mentorPresenceToggle.html",scope:{},controller:function($scope){var username=User.username.replace(/\./g,"^");$scope.showMenu=!1,$scope.loading=!0,$scope.userStatus="offline",$scope.toggleMenu=function(){$scope.showMenu=!$scope.showMenu},$scope.updateStatus=function(status){$scope.loading=!0,$http.post("/online_users/update_status",{status:status}).error(function(data,status){401==status&&RefreshAlert.open("logout")}),$scope.showMenu=!1,$timeout(function(){$scope.loading=!1},5e3)};var presence=Firebase("presence/"+username+"/magic");presence.$on$("value",function(response){var _v=response.snapshot.value;$.isEmptyObject(_v)?$scope.userStatus="offline":$scope.userStatus="available"==_v||"online"==_v||"away"==_v||"session"==_v?_v:"offline","available"==_v&&window.Notification&&"granted"!==Notification.permission&&Notification.requestPermission(function(status){Notification.permission!==status&&(Notification.permission=status)}),$scope.loading=!1});var insessionRef=$rootScope.firebaseRef.child("presence").child(User.username.replace(/\./g,"^")).child("session");insessionRef.set(!1)},link:function(scope){scope.$on("bodyClicked",function(e,$event){0==$($event.target).parents(".mentor-presence-toggle").size()&&(scope.showMenu=!1),scope.$digest()})}}}).run(function($templateCache,$rootScope,$timeout,User){User.username&&$rootScope.$on("firebase_auth_success",function(){var userRef=$rootScope.firebaseRef.child("presence").child(User.username.replace(/\./g,"^")).child("web"),insessionRef=$rootScope.firebaseRef.child("presence").child(User.username.replace(/\./g,"^")).child("session");userRef.on("value",function(snap){snap.val()===!1&&$timeout(function(){userRef.set(!0)},1e3)}),userRef.onDisconnect().set(!1),userRef.set(!0),insessionRef.set(!1)}),$templateCache.put("template/mentorPresenceToggle.html",'<div class="mentor-presence-toggle presence-{{userStatus}}" ng-cloak ng-class="{\'loading\':loading}">    <div class="mentor-presence-status" ng-click="showMenu=!showMenu">      <i ng-class="{\'icon-circle\':userStatus!=\'available\', \'icon-ok fa fa-flash\':userStatus==\'available\'}"></i>      <span us-spinner="{radius:4, width:2, length:3, lines:9, color:\'#fff\'}" ng-cloak></span>      <span class="status">{{userStatus == \'available\' ? \'available\' : userStatus}}</span>      <i class="icon-caret-down"></i>    </div>    <div class="mentor-presence-menu" ng-cloak ng-show="showMenu">      <div class="presence-available" ng-click="updateStatus(\'available\')"><i class="icon-ok fa fa-flash"></i> available </div>      <div class="presence-online" ng-click="updateStatus(\'online\')"><i class="icon-circle"></i> online</div>      <div class="presence-away" ng-click="updateStatus(\'away\')"><i class="icon-circle"></i> away</div>      <div class="presence-offline" ng-click="updateStatus(\'offline\')"><i class="icon-circle"></i> offline</div>    </div>  </div>'),$templateCache.put("template/presence.html","<span class=\"presence presence-{{presenceStatus}}\" ng-hide=\"hideOffline&&presenceStatus=='offline'\" ng-cloak>    <i ng-class=\"{'icon-circle':presenceStatus!='available', 'icon-ok fa fa-flash':presenceStatus=='available'}\"></i>    <span ng-show=\"showStatus\">{{presenceStatusName}}</span>  </span>")}),angular.module("appPromoteMentor",[]).controller("PromoteMentorCtrl",function($scope,$http,appConfig,RefreshAlert){$scope.mentorProfile="",$scope.promoteText="",$scope.finishedLoading=!1,$scope.expHashTag="",$scope.setMentorUrl=function(path,expHashTag){$scope.mentorProfile=path,$scope.expHashTag=expHashTag,$scope.promoteText="Get live 1:1"+expHashTag+" #code help and #pairprogram with me.  "+$scope.mentorProfile+" @CodementorIO",$scope.finishLoading=!0},$scope.$watch("availableFreeLength",function(nv){"undefined"!=typeof nv&&$scope.updateFreeStatus()}),$scope.updateFreeStatus=function(){var url=appConfig.apiHost+"/api/mentor_config/update";$scope.finishLoading&&"undefined"!=typeof $scope.availableFreeLength&&($http.post(url,{availableFreeLength:$scope.availableFreeLength,freeLength:15}).success(function(){}).error(function(data,status){401==status&&RefreshAlert.open("logout")}),1==$scope.availableFreeLength&&$scope.finishLoading?($scope.promoteText="Get live 1:1"+$scope.expHashTag+" #code help and #pairprogram with me. First 15 minutes free: "+$scope.mentorProfile+" @CodementorIO",$(".twitter-share-button").hide(),twttr.widgets.createShareButton("#",$(".twitterBtn")[0],function(){},{text:$scope.promoteText}),$(".twitterBtn").removeClass("invisible"),$(".twitterBtn").show()):$scope.promoteText="Get live 1:1"+$scope.expHashTag+" #code help and #pairprogram with me.  "+$scope.mentorProfile+" @CodementorIO")}}),angular.module("appQuestion",[]).controller("QuestionShowCtrl",function($scope,$http,appConfig,$timeout,NewModal,Chat,User){function anyError(){var error=!1;return!mentorInfoData.rate||!parseFloat(mentorInfoData.rate)&&0!=parseFloat(mentorInfoData.rate)?(mentorInfoData.error.rate=!0,error=!0):mentorInfoData.error.rate=!1,mentorInfoData.aboutMe&&mentorInfoData.aboutMe.trim()?mentorInfoData.error.aboutMe=!1:(mentorInfoData.error.aboutMe=!0,error=!0),mentorInfoData.helpWith&&mentorInfoData.helpWith.trim()?mentorInfoData.error.aboutMe=!1:(mentorInfoData.error.helpWith=!0,error=!0),error}var mentorInfoData={error:{},rate:"15.00"};this.openRegModal=function(menteeName){amplitude.logEvent("/public_question/i_can_help"),NewModal.open("guest-mentor-reg",{windowClass:"guest-mentor-reg",actions:["Cancel"],menteeName:menteeName,footer:!1})},this.init=function(questionId,questionBudget,isPublic){$scope.questionId=questionId;var budget=parseFloat(questionBudget);budget>0&&(mentorInfoData.rate=budget),isPublic&&1==isPublic&&amplitude.logEvent("/public_question/view")},this.askToStartSession=function(username,sessionLink){User.isMentor&&Chat.send(username,{},{type:"sessionLink",sessionLink:sessionLink})},this.openNewMentorInfoModal=function(){amplitude.logEvent("/public_question/confirmed"),NewModal.open("new-mentor-info-form",{windowClass:"new-mentor-info-form",footer:!1,data:mentorInfoData,backdrop:"static",keyboard:!1,cancel:function(){gon.auto_applied=!1},submit:function(){return anyError()||void 0==gon.auto_applied||void 0==$scope.questionId?!1:($http.put(appConfig.apiHost+"/api/users/new_mentor_info",{question_id:$scope.questionId,default_rate:mentorInfoData.rate,about:mentorInfoData.aboutMe,help_with:mentorInfoData.helpWith}).then(function(response){var im=response.data;Chat.openChatroom({id:im.chats_path,contact:{name:im.receiver.name,username:im.receiver.username,avatarUrl:im.receiver.avatar_url}}),$timeout(function(){$(".q-icanhelp a").click()})}),!0)}})},gon.auto_applied&&this.openNewMentorInfoModal()}),angular.module("appRequest",["appCategory"]).controller("NewRequestCtrl",function($q,$http,appConfig,$scope,RefreshAlert){$scope.mentorCount=-1,$scope.updateMentorCount=!1,$scope.onInit=function(tags){$scope.updateTags(tags)},$scope.updateTags=function(tags){tags&&$scope.updateMentorCount&&(0==tags.length?$scope.mentorCount=-1:$http({url:appConfig.apiHost+"/api/related_mentor_count",method:"POST",data:{tags:_.map(tags,function(tag){return tag.text})}}).success(function(data){parseInt(data)>=0&&($scope.mentorCount=parseInt(data))}).error(function(data,status){401==status&&RefreshAlert.open("logout")}))},$("#faq-public-request").popover()}),angular.module("appRateForClient",[]).directive("scheduleRate",function($rootScope,$http,appConfig,$modal,RefreshAlert){return{restrict:"A",template:'${{rate}} <small>/15min</small> <i class="icon-edit"></i>',scope:{},link:function(scope,elem,attrs){scope.rate=attrs.scheduleRate,scope.scheduleId=attrs.sid,elem.click(function(){$modal.open({windowClass:"rate-modal",templateUrl:"template/appScheduleRateModal.html",resolve:{config:function(){var config={rate:scope.rate,scheduleId:scope.scheduleId,username:attrs.un};return config}},controller:function($scope,$modalInstance,config){$scope.config=config,$scope.check=function(){var _tmp=String($scope.config.rate||0).trim().replace(/[^\d\.]+/g,"");return $scope.config.rate=Math.round(100*parseFloat(_tmp,10))/100,$scope.config.rate>=0?($scope.errorMsg="",!0):($scope.errorMsg="The input is invalid.",!1)},$scope.sumbit=function(){return $scope.check()?void($scope.config.rate==$scope.config.original?$modalInstance.dismiss():($scope.loading=!0,$http.post(appConfig.apiHost+"/api/schedule/"+$scope.config.scheduleId+"/rate",{rate:$scope.config.rate}).success(function(data){$modalInstance.dismiss(data),$rootScope.$broadcast("rate-update-"+$scope.config.username,data)}).error(function(data,status){$scope.loading=!1,401==status&&RefreshAlert.open("logout")}))):($scope.loading=!1,!1)}}}).result.then(function(){},function(rate){rate&&rate.rate>=0&&(scope.rate=rate.rate)})})}}}).directive("rateForClient",function($rootScope,$http,appConfig,User,$modal,RefreshAlert){return{restrict:"E",replace:!0,scope:{isDisabled:"=",isMonthlyClient:"="},templateUrl:"template/appRateForClient.html",controller:function($scope){$scope.rate="-",$scope.rateReason="",$scope.rateLabel="Rate: ",$scope.$watch("rateReason",function(nv){switch(nv){case"longterm_rate":$scope.rateLabel="Long-Term Rate: ";break;case"special_deal":$scope.rateLabel="Special Rate: ";break;case"group_rate":$scope.rateLabel=$scope.group.title+" Rate: ";break;default:$scope.rateLabel="Rate: "}})},link:function(scope,elem,attrs){if(User.isMentor){scope.mentee=JSON.parse(attrs.mentee),scope.label="false"!=attrs.label;var updateRate=function(){$http.get(appConfig.apiHost+"/api/rate_for/"+attrs.un).success(function(data){scope.rate=data.rate,scope.rateReason=data.reason,scope.group=data.group}).error(function(data,status){401==status&&RefreshAlert.open("logout")})};$rootScope.$on("rate-update-"+attrs.un,function(e,data){scope.rate=data.rate,scope.rateReason=data.reason,scope.group=data.group}),updateRate(),elem.find(".rate-editor").click(function(){$modal.open({windowClass:"rate-modal",templateUrl:"template/appRateForClientModal.html",resolve:{config:function(){var config={mentee:scope.mentee,rate:scope.rate,rateReason:scope.rateReason,group:scope.group};return config}},controller:function($scope,$modalInstance,config){$scope.focus=!1,$scope.config=config,$scope.check=function(){var _tmp=String($scope.config.rate||0).trim().replace(/[^\d\.]+/g,"");$scope.config.rate=Math.round(100*parseFloat(_tmp,10))/100,$scope.config.rate>=0?$scope.errorMsg="":$scope.errorMsg="The input is invalid."},$scope.sumbit=function(){var rate;"longterm_rate"!=scope.rateReason&&((rate=parseFloat($scope.config.rate))>=0?($scope.loading=!0,$http.post(appConfig.apiHost+"/api/rate_for/"+config.mentee.username,{rate:rate}).success(function(data){$scope.errorMsg="",$scope.loading=!1,$modalInstance.dismiss(data.rate),$rootScope.$broadcast("rate-update-"+config.mentee.username,data)}).error(function(data,status){$scope.loading=!1,401==status&&RefreshAlert.open("logout")})):($scope.loading=!1,$scope.errorMsg="The input is invalid."))}}}).result.then(function(){},function(mentorRate){
mentorRate&&2==mentorRate.length&&(scope.rate=mentorRate.rate,scope.rateReason=mentorRate.reason)})})}}}}).run(function($templateCache){$templateCache.put("template/appRateForClient.html",'<div>    <button class="rate-editor {{rateReason}}" ng-disabled="isDisabled" ng-hide="isMonthlyClient"><span>${{rate | number:2}}</sapn> <small>/15min</small></button>  </div>'),$templateCache.put("template/appScheduleRateModal.html",'<div class="modal-body">    <h3>Adjust your rate for this session</h3>    <p>You can choose to offer a special discounted rate for this session.</p>    <div class="editor">      <span class="editor-dollar-sign">$</span>      <input ng-enter="sumbit()" ng-blur="check()" class="rate-input" type="text" maxlength="7" ng-model="config.rate">      <span class="editor-time-label"> / 15min</span>    </div>    <div class="error-msg" ng-show="errorMsg">{{errorMsg}}</div>  </div>  <div class="modal-footer text-center">    <button class="btn" ng-click="$dismiss()">      <i class="icon-remove"></i>      Cancel    </button>    <button ng-class="{\'btn-primary\':!loading}" class="btn submit" ng-click="sumbit()">      <i ng-hide="loading" class="icon-ok"></i>      <img ng-show="loading" ng-src="{{ CdnRoot + \'/loading_w_l.gif\' }}" style="width:16px;">      <span>Save</span>    </button>  </div>'),$templateCache.put("template/appRateForClientModal.html",'<div class="modal-body">    <h3 ng-show="config.rateReason==\'longterm_rate\'">Long-term Rate for {{config.mentee.name}}</h3>    <h3 ng-show="config.rateReason==\'group_rate\'">{{config.group.title}} Rate for {{config.mentee.name}}</h3>    <h3 ng-show="config.rateReason!=\'longterm_rate\' && config.rateReason!=\'group_rate\'">Offer a Special Rate for {{config.mentee.name}}</h3>    <p ng-show="config.rateReason==\'default_rate\'">Customize your rate for {{config.mentee.name}}</p>    <p ng-show="config.rateReason==\'special_deal\'">Customize your rate for {{config.mentee.name}}</p>    <p ng-show="config.rateReason==\'longterm_rate\'" style="margin-bottom: 0px;">You have a dedicated long-term mentorship arrangement with {{config.mentee.name}}. <br> The special long-term rate is:</p>    <p ng-show="config.rateReason==\'group_rate\'" style="margin-bottom: 0px;"><img ng-src="{{config.group.icon}}" width="24"> You are in group of {{config.group.title}}. <br> The group rate is:</p>    <div class="editor">      <span class="editor-dollar-sign">$</span>      <input ng-enter="sumbit()" ng-blur="check()" class="rate-input" ng-disabled="config.rateReason==\'longterm_rate\' || config.rateReason==\'group_rate\'" type="text" maxlength="7" ng-model="config.rate">      <span class="editor-time-label"> / 15min</span>    </div>    <p><small>(Your normal rate is ${{User.default_rate}} / 15min)</small></p>    <div class="error-msg" ng-show="errorMsg">{{errorMsg}}</div>  </div>  <div class="modal-footer text-center">    <button class="btn" ng-click="$dismiss()">      <i class="icon-remove"></i>      Cancel    </button>    <button ng-class="{\'btn-primary\':!loading}" ng-hide="config.rateReason==\'longterm_rate\' || config.rateReason==\'group_rate\'" class="btn submit" ng-click="sumbit()">      <i ng-hide="loading" class="icon-ok"></i>      <img ng-show="loading" ng-src="{{ CdnRoot + \'/loading_w_l.gif\'}}" style="width:16px;">      <span>Save</span>    </button>  </div>')}),angular.module("appRightSideBar",["appFavorite"]).controller("rightSideBarCtrl",function($resource,$scope,$modal,$element,NewModal,OfflineHelpModals,LongtermModals){this.openOfflineHelpModal=OfflineHelpModals.openRequestModal,$element.find(".disabledOfflineHelpBtn").tooltip({title:"The mentor has reached the limit of ongoing offline requests and cannot accept new requests at this time.",placement:"left"}),this.openDirectLongtermModal=LongtermModals.openDirectRequestModal}),angular.module("appSchedule",[]).factory("Schedule",function($http){return{showScheduleForm:function(){},showConnectForm:function(){},submit:function(data,cb){$http({method:"POST",url:"/direct_schedule",data:$.param(data),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(s){angular.isFunction(cb)&&cb(s)})}}}).factory("SelectableTimes",function(){var str_h_12,str_h_24,str_m,ampm,hour_time={},hours=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],mins=[0,30];return hours.forEach(function(h){mins.forEach(function(m){str_h_12=h>=12?h-12==0?12:h-12:0==h?12:h,str_h_24=10>h?"0"+h:h,str_m=10>m?"0"+m:m,ampm=12>h?"AM":"PM",hour_time[str_h_24+":"+str_m]=str_h_12+":"+str_m+" "+ampm})}),hour_time}).factory("DateTimeTool",function(){function timezone_convert(userDatetime,cOffset,oOffset){var utime=userDatetime.getTime(),utc=utime-cOffset,otime=utc+oOffset;return new Date(otime)}function add_zero(i){return 10>i&&(i="0"+i),i}function datetime_to_string(otime){var ny=otime.getFullYear(),nm=add_zero(otime.getMonth()+1),nd=add_zero(otime.getDate()),nh=otime.getHours(),nmin=add_zero(otime.getMinutes());if(nh>=12)var ampm="PM";else var ampm="AM";var is_bad=!1;return 6>nh&&nh>2&&(is_bad=!0),nh>12?nh-=12:0==nh&&(nh=12),[ny+"-"+nm+"-"+nd+" "+nh+":"+nmin+ampm,is_bad]}return{timezone_convert:timezone_convert,add_zero:add_zero,datetime_to_string:datetime_to_string}}).directive("connectForm",function($q,$http,appConfig,$window,$timeout,User,Schedule,RefreshAlert,Payment){return{restrict:"A",controller:function($scope){$scope.getNumber=function(num){return new Array(num)}},controllerAs:"cf",link:function(scope,element){var totalCheckBoxes=0,checked=0;scope.allChecked=!0,Schedule.showConnectForm=function(params){if(User.username==params.mentor.username)return alert("You could not have session with self."),!1;var deferred=$q.defer();scope.mentor=params.mentor;var updateRequests=function(mentorUsername){$http.get("/users/get_requests?mentor="+mentorUsername).success(function(data){scope.requests=data}).error(function(data,status){401==status&&RefreshAlert.open("logout")})};return $http.get("/users/info?username="+params.mentor.username).success(function(data){angular.extend(scope.mentor,data);var openModal=function(){element.modal()},openSettingForm=function(){Payment.openSettingForm({ok:function(){User.hasPayment=!0,User.cardAuthorized=!0,openModal()}})};scope.real_credits_to_session_time=data.real_credits_to_session_time,scope.need_authorize=User.hasPayment&&scope.real_credits_to_session_time<15&&0==User.pre_authorized_amount&&User.total_spending<500;var teamHasCard=function(){return User.team_id&&User.teamHasPayment&&User.teamCardAuthorized},longtermRemaining=data.remaining;if(!(longtermRemaining&&longtermRemaining.hours>0))if(User.team_id){if(User.over_capacity)return alert("Your monthly spending has exceeded the organization's monthly cap.  Please contact your organization's admin or email support@codementor.io"),$window.location.href="/users/team",deferred.resolve(!1),deferred.promise}else{if(User.hasPayment){if(!User.cardAuthorized&&!User.allowNoCard)return alert("Your credit card was declined or expired. Please update your credit card before proceeding."),$window.location.href="/users/payment_setting",deferred.resolve(!1),deferred.promise}else if(!User.allowNoCard)return alert("Please complete your billing info before proceeding."),$window.location.href="/users/buy_credit",deferred.resolve(!1),deferred.promise;if(!User.confirmed)return alert("Please confirm your email address before proceeding."),deferred.resolve(!1),$("html, body").animate({scrollTop:0},"slow"),deferred.promise}teamHasCard()||!User.allowNoCard||User.hasPayment&&User.cardAuthorized||!(data.real_credits_to_session_time<60)?openModal():Payment.openAskForSettingForm({realCreditsToSessionTime:data.real_credits_to_session_time,cardDeclined:User.hasPayment&&!User.cardAuthorized,mentor:scope.mentor,ok:openSettingForm,next:openModal})}).error(function(data,status){401==status&&RefreshAlert.open("logout")}),updateRequests(params.mentor.username),scope.submitDeferred=deferred,scope.$$phase||scope.$digest(),deferred.promise},element.on("shown",function(){checked=0,totalCheckBoxes=element.find(".check-input").size(),$timeout(function(){scope.allChecked=totalCheckBoxes===checked||0==totalCheckBoxes})}),element.on("hide",function(){$timeout(function(){scope.cf.checkbox_1=!1,scope.cf.checkbox_2=!1,scope.cf.checkbox_3=!1},0)}),scope.addChecked=function(bool){bool?checked+=1:checked-=1,scope.allChecked=totalCheckBoxes===checked||0==totalCheckBoxes},scope.onSubmit=function(e){return scope.loading?(e.preventDefault(),void e.stopPropagation()):($http.post(appConfig.apiHost+"/api/users/increase_start_session_conut"),scope.loading=!0,void scope.submitDeferred.resolve(!0))}}}}).directive("scheduleForm",function($q,$http,appConfig,$window,Schedule,SelectableTimes,User,DateTimeTool,RefreshAlert,Payment){return{restrict:"A",controller:function($scope){$scope.SelectableTimes=SelectableTimes,$scope.formType="datetime",$scope.datetimeOnly=!1,$scope.currentUserTimezoneOffset=1e3*-(60*(new Date).getTimezoneOffset()),$scope.mentorTimezoneOffset=$scope.currentUserTimezoneOffset,$scope.selectAvailability=function(datetime,endTime){endTime&&new Date(endTime)-new Date(datetime)>=86399999&&(datetime=new Date(datetime).todayStartTime()),$scope.formType="datetime",$scope.update(datetime,!0)},$scope.update=function(datetime,force){"string"!=typeof datetime&&"number"!=typeof datetime||(datetime=new Date(datetime));var h=datetime.getHours(),m=datetime.getMinutes();59==m?(m=0,h+=1):29==m&&(m+=1),force?(10>h&&(h="0"+h),0==m&&(m="00")):m>=30?(m="00",10>h+1?h="0"+(h+1):h+=1,h>=24&&(h="00")):(m="30",10>h&&(h="0"+h)),$scope.datepicker&&$scope.datepicker.datepicker("setDate",datetime.strftime("%Y-%m-%d")),$scope.selectedTime=h+":"+m},this.updateMentorTime=function(){if(!$scope.selectedDate||!$scope.selectedTime)return!1;var date_str=$scope.selectedDate.split("-"),time_str=$scope.selectedTime.split(":"),y=date_str[0],m=date_str[1]-1,d=date_str[2],h=time_str[0],min=time_str[1],user_datetime=new Date(y,m,d,h,min),other_datetime=DateTimeTool.timezone_convert(user_datetime,$scope.currentUserTimezoneOffset,$scope.mentorTimezoneOffset),mentorTime=DateTimeTool.datetime_to_string(other_datetime);$scope.mentorTime=mentorTime[0],$scope.mentorWarning=mentorTime[1]},$scope.$watch("selectedDate",this.updateMentorTime),$scope.$watch("selectedTime",this.updateMentorTime),$scope.$watch("formType",function(){$scope.warning=""}),$scope.requestOptionTitle=function(request){return request.isDirect?request.title+" - "+new Date(request.createdAt).strftime("%Y-%m-%d"):request.title+" - "+request.body}},link:function(scope,element){scope.datepicker=element.find("#datepickerNew"),scope.datepicker.datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(e){scope.selectedDate=e.date.strftime("%Y-%m-%d"),scope.$$phase||scope.$digest()}),scope.timepicker=element.find(".timepickerNew"),Schedule.showScheduleForm=function(params){if(params.from)try{amplitude.logEvent("/user/click/schedule",{from:params.from})}catch(e){console.log(e)}if(User.username==params.mentor.username)return alert("You could not setup schedule with self."),!1;if(params.hasScheduleCluster&&confirm("You have an ongoing Codementor Monthly mentorship with "+params.mentor.name+".  Would you like to manage your Codementor Monthly schedules instead of adding an extra paid session?"))return void($window.location.href="/dashboard#monthly");var deferred=$q.defer(),$target=element;scope.mentorName=params.mentor.name,scope.mentor=params.mentor;var updateRequests=function(mentorUsername){$http.get("/users/get_requests?mentor="+mentorUsername).success(function(data){scope.requests=data}).error(function(data,status){401==status&&RefreshAlert.open("logout")})};return $http.get("/users/info?username="+params.mentor.username).success(function(data){angular.extend(scope.mentor,data),scope.mentorId=data.id,data.availability.length>0?(scope.formType="availability",scope.availabilities=data.availability,scope.datetimeOnly=!1):(scope.formType="datetime",scope.datetimeOnly=!0),scope.free_length=data.free_length,scope.mentorTimezoneOffset=1e3*data.timezoneOffset;var longtermRemaining=data.remaining;if(!(longtermRemaining&&longtermRemaining.hours>0))if(User.team_id){if(User.over_capacity)return alert("Your monthly spending has exceeded the organization's monthly cap.  Please contact your organization's admin or email support@codementor.io"),$window.location.href="/users/team",deferred.resolve(!1),deferred.promise}else if(User.hasPayment){if(!User.cardAuthorized&&!User.allowNoCard)return alert("Your credit card was declined or expired. Please update your credit card before proceeding."),$window.location.href="/users/payment_setting",deferred.resolve(!1),deferred.promise}else if(!User.allowNoCard)return alert("Please complete your billing info before proceeding."),$window.location.href="/users/buy_credit",deferred.resolve(!1),deferred.promise;var openModal=function(){$target.on("show",function(){scope.update(new Date)}),$target.modal()},openSettingForm=function(){Payment.openSettingForm({ok:function(){User.hasPayment=!0,User.cardAuthorized=!0,openModal()}})},teamHasCard=function(){return User.team_id&&User.teamHasPayment&&User.teamCardAuthorized};teamHasCard()||!User.allowNoCard||User.hasPayment&&User.cardAuthorized||!(data.real_credits_to_session_time<60)?openModal():Payment.openAskForSettingForm({realCreditsToSessionTime:data.real_credits_to_session_time,cardDeclined:User.hasPayment&&!User.cardAuthorized,mentor:params.mentor,ok:openSettingForm,next:openModal})}).error(function(data,status){401==status&&RefreshAlert.open("logout")}),updateRequests(params.mentor.username),scope.submitDeferred=deferred,scope.$$phase||scope.$digest(),deferred.promise},scope.submit=function(){if("datetime"!=scope.formType)scope.warning="Please select a date and time for this schedule.";else if(!scope.warning&&!scope.loading){scope.loading=!0;var yyyy_mm_dd=scope.selectedDate.split("-"),yyyy=parseInt(yyyy_mm_dd[0],10),mm=parseInt(yyyy_mm_dd[1],10)-1,dd=parseInt(yyyy_mm_dd[2],10),h_m=scope.selectedTime.split(":"),h=parseInt(h_m[0],10),m=parseInt(h_m[1],10),submitData={datetime:new Date(yyyy,mm,dd,h,m,0).getTime()/1e3,mentor:scope.mentorId,question_id:scope.scheduleRequestId};$http({method:"POST",url:"/direct_schedule",data:$.param(submitData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(s){return s.error?void($window.location.href=s.redirectTo):(scope.loading=!1,element.modal("hide"),scope.submitDeferred&&scope.submitDeferred.resolve(s),void($window.location.href=s.url))}).error(function(data,status){401==status&&RefreshAlert.open("logout")})}}}}}),angular.module("appSeoNew",[]).factory("SeoMenuTopAfterScroll",function(){return{get:function(){return 90-$(".leftSignUpBlock").height()}}}).controller("seoNewCtrl",function($timeout,$scope,$location,Viewport,SeoMenuTopAfterScroll){$("body").attr("id","skrollr-body"),$scope.promoteTitle="",$scope.promoteUrl="",$scope.path="",$scope.initialSet=function(promoteUrl,promoteTitle,catUrl){$scope.promoteUrl=promoteUrl,$scope.promoteTitle=promoteTitle,$scope.catUrl=catUrl},bowser.mobile||($timeout(function(){$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(element,name,direction){if("data50Top"==name){var mq=window.matchMedia("(min-width: 1280px)");if("down"==direction){if(mq.matches&&document.getElementsByClassName("chat-side-bar").length>0){$(element);$(element).css({top:50,width:"100%","padding-right":Viewport.width>=1280?"220px":"0px","box-shadow":"0px 3px 4px rgba(0,0,0,0.2)","z-index":6,"box-sizing":"border-box"})}else $(element).css({top:50,"box-shadow":"0px 3px 4px rgba(0,0,0,0.2)","z-index":6});$(".contentPart").css({"margin-top":"55px"})}else"up"==direction&&(mq.matches&&document.getElementsByClassName("chat-side-bar").length>0?$(element).css({top:"auto",width:"100%","padding-right":"0px","box-shadow":"none","z-index":3,"box-sizing":"border-box"}):$(element).css({top:"auto","box-shadow":"none","z-index":3}),$(".contentPart").css({"margin-top":"0px"}));$scope.$digest()}"data126Top"==name&&("down"==direction?($(".left-block").css({top:SeoMenuTopAfterScroll.get(),position:"fixed"}),$(".right-block").css({"margin-left":"240px"})):"up"==direction&&($(".left-block").css({top:"initial",position:"inherit"}),$(".right-block").css({"margin-left":"0px"})),$scope.$digest()),"data129Top"==name&&"menu"!=$(element).data("target")&&("down"==direction?$scope.currentBlock=$(element).data("down"):"up"==direction&&($scope.currentBlock=$(element).data("up")),$scope.$digest()),"dataBottomTop"==name&&"down"==direction&&$(element).hasClass("tabPart")&&$(element).css({top:"auto","box-shadow":"none"})}})},0),$scope.changeBlock=function(menu,topic){var scrollOffset,speed;scrollOffset=window.scrollY,speed=30*Math.pow(Math.abs(scrollOffset-$("#"+menu).offset().top),1/3),$scope.currentBlock=topic,$("html, body").animate({scrollTop:$("#"+menu).offset().top-132+1},speed)},$scope.popReceiveTutorialForm=function(){$("#email_collection_modal_for_articles").modal()}),$scope.showSignUpModal=function(){$("#email_collection_modal_for_articles").modal()},$scope.openClassPage=function(position){var url;$scope.catName;url=$scope.promoteUrl?$scope.path+$scope.promoteUrl+"?utm_source=guide&utm_medium="+position+"&utm_term=class&utm_content=guide_"+$scope.catUrl+"&utm_campaign=cm_internal_ad":$scope.path+"/monthly?utm_source=guide&utm_medium="+position+"&utm_term=class&utm_content=tutorial_"+$scope.catUrl+"&utm_campaign=cm_internal_ad",amplitude.logEvent("/Guide"+position,{catName:1}),window.open(url,"_blank")}}).directive("seoMenuStickAtBottom",function($window,User,SeoMenuTopAfterScroll){return{restrict:"A",link:function(){if(!bowser.mobile){var updatePosition=function(){var top=angular.element($window).scrollTop();if($("body").width()<=767)return void $(".left-block").css({position:"relative"});var topAfterScroll=SeoMenuTopAfterScroll.get();$("footer").offset().top-top-145<$(".menuCard__selector").height()+165?$(".left-block").css({top:topAfterScroll-($(".menuCard__selector").height()+165-($("footer").offset().top-top)+145)}):$(".left-block").css({top:topAfterScroll})};angular.element($window).bind("resize",updatePosition),angular.element($window).bind("scroll",updatePosition)}}}}),angular.module("appService",["smoothScrollService"]).controller("MyServiceController",function($scope,$http,$window,$location,$timeout,appConfig){function _notAllowToUpdate(){alert("Sorry, you can't update or remove this Gig before all of its active orders are finished.")}var _username="";$scope.services=[],$scope.shareBlock={show:!1},$scope.showHowItWorks=!1,$scope.setup=function(name,path){_username=name,$scope.$on("$routeChangeSuccess",function(){$location.path()===path&&($scope.shareBlock={},$scope.getMyService(_username),amplitude.logEvent("/service/landing"))})},$scope.showShareTwitterBlock=function(services){var query=$location.search();if(!query&&!query.share)return void($scope.shareBlock={});var random_key=query.share;services.map(function(ele){ele.random_key===random_key&&($scope.shareBlock={show:!0,service:ele})}),$timeout(function(){FB&&FB.XFBML.parse(),twttr&&twttr.widgets.load()},20)},$scope.deleteService=function(service){if(service.has_active_orders)return _notAllowToUpdate(),void($window.location.hash="active-orders");var check=$window.confirm("Are you sure you want to delete this service?"),id=service.random_key;if(check){var url=appConfig.apiHost+"/api/seller/services/"+id,_target=0;$http["delete"](url).success(function(){$scope.services.forEach(function(ele,i){ele.random_key===id&&(_target=i)}),$scope.services.splice(_target,1)}).error(function(err){console.log("fail to delete",err)})}},$scope.getMyService=function(username){if(username){var url=appConfig.apiHost+"/api/seller/services?mentor="+username;$scope.loading=!0,$http.get(url).success(function(data){data.forEach(function(ele){ele.updatedAt=moment(1e3*ele.updated_at).format("lll")}),$scope.services=data,$scope.loading=!1,$scope.showShareTwitterBlock(data)}).error(function(err){console.log(err),$scope.loading=!1})}},$scope.searchOrder=function(query){$window.location.hash="active-orders?search="+query},$scope.turnOffHowItWorks=function(){$scope.showHowItWorks=!1,window.scroll(0,0)},$scope.editService=function(service){return service.has_active_orders?(_notAllowToUpdate(),void($window.location.hash="active-orders")):void($window.location.hash="update-gig?id="+service.random_key)}}).controller("OtherServiceController",function(){}).controller("CreateServiceController",function($scope,$http,$window,$location,appConfig,smoothScroll){function _getDeliveryTable(times,isAddon){for(var arr=[],i=0;times>i;i++){var _day=i>1?" days":" day";arr.push({value:i,name:0!=i||isAddon?i+_day:"Live Session"})}return arr}function _resetForm(){$scope.IS_UPDATE=!1,$scope.UPDATE_SERVICE_ID="",$scope.loading=!1,$scope.submitted=!1,$scope.serviceForm={question_answer_type:"text",deliveryTime:1,price:25,cover_photo:"",addons:[]},$scope.newAddon={deliveryTime:0,price:10},$scope.errorHandler={service:{},addon:{}}}function _tempId(){return Math.random().toString(36).substring(7)}function _validateAddon(addon){$scope.errorHandler.addon={count:0};var _handler=$scope.errorHandler.addon;for(var key in addon)addon.hasOwnProperty(key)&&"undefined"==typeof addon[key]&&0!==addon[key]&&(_handler[key]=!0,_handler.count++);return 0==_handler.count}function _validateService(service,cb){$scope.errorHandler.service={count:0};var _handler=$scope.errorHandler.service,_tracker=0,_topElementId="id",_prefix=$scope.IS_UPDATE?"_":"",_distance={title:{score:10,id:_prefix+"serviceTitle"},service_type_id:{score:9,id:_prefix+"serviceCategory"},hours_needed:{score:8,id:_prefix+"serviceDeliverTime"},description:{score:7,id:_prefix+"serviceDescription"},categories:{score:6,id:_prefix+"serviceTags"},price:{score:5.5,id:_prefix+"servicePrice"},cover_photo:{score:5,id:_prefix+"serviceCoverPhoto"}};for(var key in service)service.hasOwnProperty(key)&&"addons"!==key&&"question_title"!==key&&"question_answer_type"!==key&&("undefined"==typeof service[key]||"description"===key&&service[key].length<100||"categories"===key&&(service[key].length<2||service[key].length>5))&&(_handler[key]=!0,_handler.count++,_distance[key].score>_tracker&&(_tracker=_distance[key].score,_topElementId=_distance[key].id));cb(0==_handler.count,_topElementId)}_resetForm(),$scope.setupPathName=function(path){$scope._PATH=path},$scope.createAddon=function(){var _addon={id:_tempId(),title:$scope.newAddon.title||void 0,price:$scope.newAddon.price||void 0,deliveryTime:"number"==typeof parseInt($scope.newAddon.deliveryTime,10)?$scope.newAddon.deliveryTime:void 0};_validateAddon(_addon)&&(amplitude.logEvent("/service/create_addon"),$scope.serviceForm.addons.push(_addon),$scope.newAddon={title:void 0,price:10,deliveryTime:0})},$scope.removeAddon=function(id){var _addons=[];$scope.serviceForm.addons.forEach(function(ele){ele.id!==id&&_addons.push(ele)}),$scope.serviceForm.addons=_addons},$scope.uploadCoverPhoto=function(){filepicker.pick(function(blob){$scope.serviceForm.cover_photo=blob.url,$scope.$digest()})},$scope.submitForm=function(){$scope.submitted=!0;var _form={service:{title:$scope.serviceForm.title||void 0,price:$scope.serviceForm.price||void 0,description:$scope.serviceForm.description||void 0,service_type_id:parseInt($scope.serviceForm.category,10)||void 0,cover_photo:$scope.serviceForm.cover_photo||void 0,hours_needed:24*$scope.serviceForm.deliveryTime,question_title:$scope.serviceForm.question_title||void 0,question_answer_type:$scope.serviceForm.question_title?$scope.serviceForm.question_answer_type:void 0,categories:$scope.serviceForm.tags?$scope.serviceForm.tags.map(function(ele){return ele.text}):[],addons:$scope.serviceForm.addons.map(function(ele){return{title:ele.title,price:ele.price,hours_needed:24*ele.deliveryTime}})}};_validateService(_form.service,function(pass,topEleId){if(pass){var _options=$scope.IS_UPDATE&&$scope.UPDATE_SERVICE_ID?{method:"put",url:appConfig.apiHost+"/api/seller/services/"+$scope.UPDATE_SERVICE_ID,data:_form}:{method:"post",url:appConfig.apiHost+"/api/seller/services",data:_form};$http(_options).success(function(res){var _succesPath="my-"+$scope._PATH+"s?share="+res.random_key;$window.location.hash=_succesPath,$scope.IS_UPDATE?amplitude.logEvent("/service/update_ok"):amplitude.logEvent("/service/create_ok"),_resetForm()}).error(function(){$scope.submitted=!1})}else $scope.submitted=!1,smoothScroll.scrollToAnchor(topEleId)})},$scope.noMoreAddon=function(){var addonsLimit=10;return $scope.serviceForm.addons.length>=addonsLimit},$scope.deliveryTable=_getDeliveryTable(11),$scope.deliveryAddOnTable=_getDeliveryTable(11,!0)}).controller("UpdateServiceController",function($http,$scope,$window,$location,$controller,appConfig){function _setupBeforeUpdate(id){var url=appConfig.apiHost+"/api/seller/services/"+id;$scope.IS_UPDATE=!0,$scope.UPDATE_SERVICE_ID=id,$scope.loading=!0,$http.get(url).success(function(data){return data.has_active_orders?(alert("Sorry, you can't update or remove this Gig before all of its active orders are finished."),void($window.location.hash="active-orders")):($scope.loading=!1,$scope.serviceForm=data,$scope.serviceForm.category=data.service_type.id,$scope.serviceForm.deliveryTime=data.hours_needed/24,$scope.serviceForm.tags=data.categories.map(function(ele){return ele.name}),void($scope.serviceForm.addons=data.addons.map(function(ele){return{id:ele.random_key,title:ele.title,price:ele.price,deliveryTime:ele.hours_needed/24}})))}).error(function(err){$scope.loading=!1,console.log("failed to load service",err)})}$scope.IS_UPDATE=!1,$scope.UPDATE_SERVICE_ID="",$scope.loading=!1,angular.extend(this,$controller("CreateServiceController",{$scope:$scope})),$scope.$on("$routeChangeSuccess",function(){var PATH="/update-"+$scope._PATH;if($location.path()===PATH){var query=$location.search();query&&query.id?_setupBeforeUpdate(query.id):$window.location.hash="my-"+$scope._PATH+"s"}})}),angular.module("appServiceProfile",[]).controller("ServiceProfileController",function($scope,$filter,$http,$window,$location,orderService){function processNewOrder(service_id){var _order_id="",_create_order_success=!1;orderService.createOrder(service_id,$scope.checkout_info).then(function(payload){return _order_id=payload.data.id,_create_order_success=!0,orderService.payOrder(_order_id)}).then(function(){$scope.loading=!1,$scope.finishAndRedirect=!0,amplitude.logEvent("/gig/profile/paid"),setTimeout(function(){$window.location.href="/dashboard#/active-orders/"+_order_id},20)},function(payload){errorHandler(payload),_create_order_success&&(amplitude.logEvent("/gig/profile/created"),$scope.processFailMessage="Order created! Failed to pay. Redirecting to dashboard...",setTimeout(function(){$window.location.href="/dashboard#/pending-orders/"+_order_id},20))})}function processNewPayment(form,service_id){orderService.getStripeToken(form).then(function(token){return orderService.savePayment(token)}).then(function(){processNewOrder(service_id)},errorHandler)}function errorHandler(payload){$scope.loading=!1,$scope.processFail=!0,$scope.processFailMessage=payload.data&&payload.data.error&&payload.data.error.message}function validatePaymentForm(){return $scope.cardInfo&&$.payment.validateCardNumber($scope.cardInfo.number)&&$.payment.validateCardCVC($scope.cardInfo.cvc)&&$.payment.validateCardExpiry($scope.cardInfo.month,$scope.cardInfo.year)?($scope.failCardValidate=!1,!0):($scope.failCardValidate=!0,$scope.loading=!1,!1)}$scope.base={},$scope.ng_addons=[],$scope.checkout_info={},$scope.loading=!1,$scope.openModal=function(notUser){amplitude.logEvent("/gig/profile/click_buy");var target=notUser?"#signup-modal":"#checkoutModal";$(target).modal()},$scope.nextPage=function(){$scope.base.question&&!$scope.checkout_info.question_answer?$scope.failValidation=!0:($scope.failValidation=!1,$scope.goToPayment=!0,$("input.cc-number").payment("formatCardNumber"),$("input.cc-cvc").payment("formatCardCVC"))},$scope.prevPage=function(){$scope.goToPayment=!1},$scope.init=function(data){$scope.base=data.base,$scope.ng_addons=data.addons,$scope.cardInfo={},$scope.checkout_info={addons:[],price:$scope.base.price,delivery:$scope.base.delivery}},$scope.selectAddon=function(id){var found={};$scope.ng_addons.map(function(ele){ele.random_key===id&&(ele.selected=!ele.selected,found=ele)}),found.selected?($scope.checkout_info.addons.push(found.random_key),$scope.checkout_info.price+=found.price,$scope.checkout_info.delivery+=found.delivery):($scope.checkout_info.addons.splice($scope.checkout_info.addons.indexOf(found.random_key),1),$scope.checkout_info.price-=found.price,$scope.checkout_info.delivery-=found.delivery)},$scope.uploadImage=function(){filepicker.pick(function(blob){$scope.checkout_info.question_answer=blob.url,$scope.$digest()})},$scope.doNotHaveCard=function(bool){$scope.show_new_card_form=bool},$scope.toggleNewCard=function(){$scope.show_new_card_form=!$scope.show_new_card_form},$scope.submitOrder=function(service_id){if($scope.loading=!0,$scope.show_new_card_form){if(!validatePaymentForm())return;processNewPayment({number:$scope.cardInfo.number,cvc:$scope.cardInfo.cvc,exp_month:$scope.cardInfo.month,exp_year:$scope.cardInfo.year},service_id)}else processNewOrder(service_id)}}).factory("orderService",function($http,$q,appConfig){var _API_ROOT=appConfig.apiHost+"/api";return{getStripeToken:function(form){var deferred=$q.defer();return Stripe.createToken(form,function(status,res){res.error?deferred.reject(res.error):deferred.resolve(res.id)}),deferred.promise},savePayment:function(stripe_token){return $http({method:"post",url:_API_ROOT+"/payments/save_payment",data:{stripeToken:stripe_token}}).then(function(res){return res})},createOrder:function(service_id,checkout_info){return $http({method:"post",url:_API_ROOT+"/seller/services/"+service_id+"/orders",data:{addons:checkout_info.addons,message:checkout_info.question_answer||""}}).then(function(res){return res})},payOrder:function(order_id){return $http({method:"post",url:_API_ROOT+"/seller/orders/"+order_id+"/pay"}).then(function(res){return res})}}}),angular.module("appSessionSummary",[]).controller("SessionSummaryController",function($scope,$timeout){$scope.costTooltip="",$scope.init=function(free_length){$scope.costTooltip=free_length>0?"After platform fee\nFirst 15 minutes free":"After platform fee",$timeout(function(){$(".tooltip-total").tooltip()},10)}}),angular.module("appStoryShow",[]).controller("storyShowCtrl",function($timeout,$scope){$("body").attr("id","skrollr-body"),bowser.mobile||$timeout(function(){$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(){}})},0)}),angular.module("available_time_app",[]).directive("nat",function(){return{restrict:"C",scope:{_ngStart:"@varNgStartTime",_ngEnd:"@varNgEndTime",_ngCurrentuserTimezone:"@varNgCurrentuserTimezone"},link:function(scope,element){var _start=element.data("start"),_end=element.data("end"),_currentuserTimezone=element.data("currentuser-timezone");scope._ngStart&&scope._ngEnd&&(_start=new Date(parseInt(scope._ngStart)).getTime(),_end=new Date(parseInt(scope._ngEnd)).getTime(),_currentuserTimezone=scope._ngCurrentuserTimezone),_start%1e4!=0&&(_start+=1e3),_end%1e4!=0&&(_end+=1e3);var start=new Date(_start),end=new Date(_end),now=new Date,current_offset=-(60*now.getTimezoneOffset()*1e3),currentuserTimezone=1e3*parseInt(_currentuserTimezone,10);-1e3==currentuserTimezone&&(currentuserTimezone=current_offset);var start_offset=start,end_offset=end,now_offset=now,allDay=!1,endOfStartDay=start_offset.nextDayStartTime();end_offset-start_offset>=86399999?allDay=!0:end_offset>=endOfStartDay&&end_offset.setTime(endOfStartDay.getTime()-1);var time,endOfWeek=now_offset.endOfWeek(),date="";time=allDay?"All Day":start_offset.strftime("%l:%M%p")+" - "+end_offset.strftime("%l:%M%p"),date=start_offset.theSameDate(now_offset)?"Today":start_offset>endOfWeek?start_offset.strftime("%b %d, %Y"):start_offset.strftime("%A"),element.find(".date").text(date),element.find(".time").text(time)}}}).directive("cmUserTimeZone",function(){return{restrict:"A",link:function(scope,element){element.text((new Date).currentTimeZoneText())}}}),angular.module("notification_app",[]).factory("notificationUtils",function($http){return{updateServerConfig:function(isEnabled){$http({method:"put",url:gon.api_host+"/api/web-push/preferences",headers:{"Content-Type":"application/json"},data:JSON.stringify({enabled:isEnabled}),withCredentials:!0})}}}).controller("notificationSettingCtrl",function($scope,notificationUtils){$scope.status=gon.web_push_enabled,$scope.turn=function(toStatus){var isEnabled="on"===toStatus;$scope.status=isEnabled,notificationUtils.updateServerConfig(isEnabled),
isEnabled?CM_LIB.OneSignal.register():CM_LIB.OneSignal.unsubscribe()}}).run(function($rootScope,$window,$localStorage,notificationUtils,User){var domString='<b><a href="#" class="notify_enable">Click here to enable</a></b> desktop notifications for Codementor so you won\'t miss an incoming request. &nbsp;&nbsp; <a href="#" class="notify_disable">No thanks</a>';User.isMember&&(gon.web_push_enabled?CM_LIB.OneSignal.register():$localStorage.discardNotificationPrompt||showMessage("info",domString,function($dom){$(".notify_enable",$dom).click(function(){notificationUtils.updateServerConfig(!0),CM_LIB.OneSignal.register()}),$(".notify_disable",$dom).click(function(){$(".close",$dom).click(),notificationUtils.updateServerConfig(!1),CM_LIB.OneSignal.unsubscribe(),$localStorage.discardNotificationPrompt=!0})}))}),angular.module("beta_dashboard_app",[]).factory("betaDashboardUtils",function($http){return{updateBetaDashboardConfig:function(isEnabled){return $http({method:"put",url:gon.api_host+"/api/v2/me/opt-beta-dashboard",headers:{"Content-Type":"application/json"},data:JSON.stringify({enabled:isEnabled}),withCredentials:!0})}}}).controller("betaDashboardSettingCtrl",function($scope,$window,betaDashboardUtils){$scope.init=function(status){$scope.status=status,$scope.isLoading=!1},$scope.turn=function(val){var isEnabled="on"===val;$scope.isLoading=!0,betaDashboardUtils.updateBetaDashboardConfig(isEnabled).then(function(){$scope.isLoading=!1,$scope.status=isEnabled},function(err){$scope.isLoading=!1,console.log("err",err)})},$scope.joinBeta=function(){betaDashboardUtils.updateBetaDashboardConfig(!0).then(function(){$window.location.href="/m/dashboard/open-requests?type=related"},function(err){console.log("error",err)})}}),angular.module("mentor_calendar_app",["ngResource","ui.calendar"]).constant("DayNames",["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]).factory("Availabilities",function($resource,appConfig){return $resource(appConfig.apiHost+"/api/available_time/:id",{id:"@id"},{create:{method:"POST"},read:{method:"GET",isArray:!0,transformResponse:function(data){return angular.fromJson(data).map(function(availability){return availability.title="",availability.start=new Date(availability.start),availability.end=new Date(availability.end),availability})}},update:{method:"PUT"}})}).directive("fcEvent",function(){return{restrict:"C",transclude:!0,template:'<div class="full-height" ng-transclude></div><div class="absolute-top-right text-center app-scheduler-event-delete" ng-click="delete(id)">&#10006;</div>'}}).directive("fcEventTime",function(){return{restrict:"C",replace:!0,transclude:!0,template:'<div ng-click="edit(id)" ng-transclude></div>'}}).controller("SchedulerCtrl",function($scope,$filter,$compile,$http,DayNames,appConfig,Availabilities){$scope.DayNames=DayNames,$scope.saving=!1,$scope.loading=!1;var _override=function(start,end,eventId){var events=$scope.calendar.fullCalendar("clientEvents",function(e){return(start<=e.start&&end>e.start||start<e.end&&end>=e.end||start>=e.start&&end<=e.end)&&(!eventId||e.id!=eventId)});if(events.length>0){var answer=confirm("This action will delete other available time which are overlaped by new one.");if(!answer)return $scope.calendar.fullCalendar("unselect"),!1;for(var ids=_.map(events,function(e){return e.id}),i=0,len=ids.length;len>i;i++){var e=$scope.calendar.fullCalendar("clientEvents",ids[i])[0];$scope["delete"](e.id)}}return!0},_eventResize=function(event,dayDelta,minuteDelta,revert){Availabilities.read(function(availabilities){var _availability=$filter("filter")(availabilities,{id:event.id})[0];event.interval=_availability.interval;var endOfStartDay=event.start.nextDayStartTime();event.end>endOfStartDay&&(event.end=endOfStartDay),_override(event.start,event.end,event.id)?$scope.update(event):revert()})},_select=function(start,end,allDay,jsEvent,view){var endOfStartDay=start.nextDayStartTime();end>endOfStartDay&&(end=endOfStartDay),new Date>start?(alert("You can only select the time in the future."),$scope.calendar.fullCalendar("unselect")):"month"===view.name?($scope.calendar.fullCalendar("changeView","agendaDay"),$scope.calendar.fullCalendar("gotoDate",start)):_override(start,end)&&($scope.saving=!0,new Availabilities({title:"",start:start,end:end,allDay:allDay,interval:0}).$create(function(){$scope.saving=!1,$scope.calendar.fullCalendar("refetchEvents")}),$scope.calendar.fullCalendar("unselect"))};$scope.update_my_vacation=function(bool){$http.post(appConfig.apiHost+"/api/users/on_vacation",{on_vacation:bool}).then(function(){return bool})},$scope.scheduler={config:{height:576,editable:!0,selectable:!0,selectHelper:!0,eventStartEditable:!1,allDaySlot:!1,ignoreTimezone:!1,axisFormat:"HH:mm",timeFormat:"HH:mm{ - HH:mm}",header:{right:"today, month, agendaWeek, prev, next"},defaultView:"agendaWeek",eventRender:function(event,element){$compile(element)(angular.extend($scope.$new(),{id:event.id}))},eventResize:_eventResize,select:_select},availabilities:[function(start,end,callback){var viewStartTimestamp=start.getTime();Availabilities.read(function(availabilities){var _createRepeat=function(availability,options){options=options||{};var repeatEnd,delta={day:void 0!==options.day?options.day:availability.start.getDay(),hour:availability.start.getHours(),minute:availability.start.getMinutes(),length:availability.end-availability.start},repeatStart=new Date(start);repeatStart.setTime(viewStartTimestamp+864e5*delta.day+36e5*delta.hour+6e4*delta.minute),start.dst()!=repeatStart.dst()&&(repeatStart.dst()?repeatStart.setTime(repeatStart.getTime()-36e5):repeatStart.setTime(repeatStart.getTime()+36e5)),repeatStart>availability.start&&(repeatEnd=new Date(repeatStart),repeatEnd.setTime(repeatStart.getTime()+delta.length),availabilities.push({id:availability.id,title:"",start:repeatStart,end:repeatEnd,allDay:!1}))};angular.forEach(availabilities,function(availability){if(availability.interval)switch(availability.interval){case 1:if("agendaWeek"===$scope.calendar.fullCalendar("getView").name)for(var i=7;i--;)_createRepeat(availability,{day:i});else for(var i=42;i--;)_createRepeat(availability,{day:i});break;case 7:if("agendaWeek"===$scope.calendar.fullCalendar("getView").name)_createRepeat(availability);else for(var i=6;i--;)_createRepeat(availability,{day:availability.start.getDay()+7*i})}}),callback(availabilities)})}]},$scope.edit=function(id){Availabilities.read(function(availabilities){$scope.activeAvailability=$filter("filter")(availabilities,{id:id})[0],$scope.activeAvailability.startDate=$scope.activeAvailability.start.getFullYear()+"-"+($scope.activeAvailability.start.getMonth()+1)+"-"+$scope.activeAvailability.start.getDate(),$scope.activeAvailability.endDate=$scope.activeAvailability.end.getFullYear()+"-"+($scope.activeAvailability.end.getMonth()+1)+"-"+$scope.activeAvailability.end.getDate(),$scope.activeAvailability.startTime=$scope.activeAvailability.start.toTimeString().substr(0,5),$scope.activeAvailability.endTime=$scope.activeAvailability.end.toTimeString().substr(0,5)})},$scope.update=function(availability){if(availability.startTime){var _sD=$("#ugly-hack-1").val().split("-"),_sT=availability.startTime.split(":"),_eD=$("#ugly-hack-2").val().split("-"),_eT=availability.endTime.split(":"),_s=new Date(_sD[0],_sD[1]-1,_sD[2],_sT[0],_sT[1]),_e=new Date(_eD[0],_eD[1]-1,_eD[2],_eT[0],_eT[1]);_e>_s&&(availability.start=_s,availability.end=_e)}Availabilities.update(availability).$promise.then(function(){$scope.calendar.fullCalendar("refetchEvents")})},$scope["delete"]=function(id){Availabilities.read(function(availabilities){var _availability=$filter("filter")(availabilities,{id:id})[0];(!_availability.interval||_availability.interval&&confirm("This action will delete all available times in this series. Continue?"))&&($scope.saving=!0,Availabilities["delete"]({id:id}).$promise.then(function(){$scope.saving=!1}),$scope.calendar.fullCalendar("removeEvents",id))})}}),angular.module("online_status_toggle_app",[]).directive("onlineStatusToggle",["$rootScope","$http","$interval",function($rootScope,$http,$interval){return{restrict:"E",template:'<a class="online-indicator-{{status}}" ng-click="toggleStatus($event)" href="#">{{status}}</a>',replace:!0,controller:["$scope",function($scope){$scope.toggleStatus=function(e){e&&("online"===$scope.status?$scope.status="offline":$scope.status="online",$http.post($scope.updateStatusUrl,{status:$scope.status}))}}],link:function(scope,element,attrs){scope.status=attrs.status,scope.updateStatusUrl=attrs.updateStatusUrl,$interval(function(){$http.get(attrs.statusUrl).success(function(data){"online"!=data&&"offline"!=data||(scope.status=data)})},3e3)}}}]),angular.module("timezone_app",[]).directive("timezoneDisplayer",function(){return{link:function(scope,element,attrs){function _timezone_convert(user_datetime,c_offset,o_offset){var utime=user_datetime.getTime(),utc=utime-c_offset,otime=utc+o_offset;return new Date(otime)}function _add_zero(i){return 10>i&&(i="0"+i),i}function _datetime_to_string(otime){var ny=otime.getFullYear(),nm=_add_zero(otime.getMonth()+1),nd=_add_zero(otime.getDate()),nh=otime.getHours(),nmin=_add_zero(otime.getMinutes());if(nh>=12)var ampm="PM";else var ampm="AM";var is_bad=!1;return 6>nh&&nh>2&&(is_bad=!0),nh>12?nh-=12:0==nh&&(nh=12),[ny+"-"+nm+"-"+nd+" "+nh+":"+nmin+ampm,is_bad]}function _refresh(e){if(e&&e.date)var date_str=e.date.strftime("%Y-%m-%d");else var date_str=date_picker.datepicker("getDate").strftime("%Y-%m-%d");if(date_str=date_str.split("-"),time_picker.size()>1)var v=$(time_picker.selector+":checked").val(),time_str=v?v.split(":"):void 0;else var time_str=time_picker.val().split(":");var now=new Date;scope.$emit("timeChanged",date_str,time_str);var y=date_str[0],m=date_str[1]-1,d=date_str[2],h=time_str?time_str[0]:now.getHours(),min=time_str?time_str[1]:now.getMinutes(),user_datetime=new Date(y,m,d,h,min),other_datetime=_timezone_convert(user_datetime,scope.current_user_timezone_offset,scope.other_user_timezone_offset),str=_datetime_to_string(other_datetime);$(".timeDisplay").text(str[0]),str[1]?element.find(".warning").show():element.find(".warning").hide(),user_datetime<new Date&&scope.$emit("timeChangedToPast")}var time_picker=element.find(attrs.timePicker||".time_picker"),date_picker=element.find(attrs.datePicker||"#datepicker");scope.$on("timezoneInit",function(e,data){if(data.default_time)var now=new Date(data.default_time);else var now=new Date;var h=now.getHours(),m=now.getMinutes();59==m?(m=0,h+=1):29==m&&(m+=1),data.default_time?(10>h&&(h="0"+h),0==m&&(m="00")):m>=30?(m="00",10>h+1?h="0"+(h+1):h+=1,h>=24&&(h="00")):(m="30",10>h&&(h="0"+h)),date_picker.datepicker("setDate",now.strftime("%Y-%m-%d")),time_picker.size()>1?time_picker.each(function(){return this.value==h+":"+m?(this.checked=!0,!1):void 0}):time_picker.val(h+":"+m),scope.current_user_timezone_offset=data.current_user_timezone_offset,scope.other_user_timezone_offset=data.other_user_timezone_offset,_refresh()}),scope.$on("timezoneChangeOffset",function(e,data){scope.current_user_timezone_offset=data.current_user_timezone_offset,scope.other_user_timezone_offset=data.other_user_timezone_offset,_refresh()}),time_picker.on("change",_refresh),date_picker.on("changeDate",_refresh),date_picker.on("show",function(e){e.stopPropagation(),e.preventDefault()})}}}).directive("checkTimeZone",function($rootScope,User){return{restrict:"A",link:function(){var browser_time_zone_offset=(new Date).getTimezoneOffset(),except_re_list=[/\/questions\/\d+/],_is_except=function(str,list){for(var i=0,len=except_re_list.length;len>i;i++)if(str.match(list[i]))return!1;return!0},serverTimezone=null;if(User&&User.time_zone){serverTimezone=User.time_zone.utc_offset;var _tmpServerTimezone=serverTimezone.split(":");if(2!=_tmpServerTimezone.length)return;var _tmpServerTimezoneHour=parseInt(_tmpServerTimezone[0]),_tmpServerTimezoneMin=0;_tmpServerTimezoneMin=_tmpServerTimezoneHour>0?parseInt(_tmpServerTimezone[1]):-parseInt(_tmpServerTimezone[1]),serverTimezone=60*_tmpServerTimezoneHour+_tmpServerTimezoneMin,serverTimezone!=-browser_time_zone_offset&&"true"!=$.cookie("never_ask_time_zone")&&_is_except(window.location.href,except_re_list)&&window.showMessage("other","Your time zone setting may be incorrect. Update time zone to GMT"+(new Date).currentTimeZoneText()+' ? <a class="yes" style="padding-left:10px;text-decoration:underline;" href="/users/profile_setting">Yes, take me to profile setting page</a> &nbsp; <a style="padding-left:10px;text-decoration:underline;" class="never_ask muted" href="#">Never ask again</a>',function(element){element.find(".yes").click(function(){amplitude.logEvent("Change Time Zone",{type:"yes",user:User.username})}),element.find(".never_ask").click(function(){$.cookie("never_ask_time_zone","true",{path:"/",expires:99999}),amplitude.logEvent("Change Time Zone",{type:"never_ask",user:User.username}),element.find(".close").click()})})}}}}),angular.module("userInfoService",[]).factory("userInfo",function($http){return{getUserInfo:function(username){return $http.get("/users/mentor_popover?username="+username)}}}),angular.module("notifyService",[]).factory("notify",function(){var inboxNotify=0,chatNotify=0,totalNotify=0;return{updateTitleNotify:function(count,hide,type){"inbox"===type?inboxNotify=count:chatNotify=count,totalNotify=inboxNotify+chatNotify,totalNotify>0&&!hide?document.title="("+totalNotify+") "+document.title.replace(/^\(\d+\) /,""):document.title=document.title.replace(/^\(\d+\) /,"")}}}),angular.module("surveyService",[]).factory("survey",function(){return{getExperienceLevelText:function(){return[{id:0,title:"Beginner"},{id:1,title:"Intermediate"},{id:2,title:"Advanced"}]},getWhyUseText:function(){return[{id:0,title:"I'm working on a side project",selected:!1},{id:1,title:"I'm building a startup",selected:!1},{id:2,title:"I'm a freelance developer",selected:!1},{id:3,title:"I'm a student",selected:!1},{id:4,title:"I'd like to find a job as a developer",selected:!1},{id:5,title:"I'm working as a full-time developer at a company",selected:!1}]}}}),angular.module("smoothScrollService",[]).factory("smoothScroll",function(){var currentYPosition=function(){return self.pageYOffset?self.pageYOffset:0},elmYPosition=function(eID){for(var elm=document.getElementById(eID),y=elm.offsetTop,node=elm,offset=100;node.offsetParent&&node.offsetParent!=document.body;)node=node.offsetParent,y+=node.offsetTop;return y-offset};return{scrollToAnchor:function(eId){var startY=currentYPosition(),stopY=elmYPosition(eId),distance=stopY>startY?stopY-startY:startY-stopY;if(100>distance)return void scrollTo(0,stopY);var speed=Math.round(distance/100);speed>=20&&(speed=20);var step=Math.round(distance/25),leapY=stopY>startY?startY+step:startY-step,timer=0;if(stopY>startY)for(var i=startY;stopY>i;i+=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),leapY+=step,leapY>stopY&&(leapY=stopY),timer++;else for(var i=startY;i>stopY;i-=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),leapY-=step,stopY>leapY&&(leapY=stopY),timer++}}}),angular.module("BadgePreviewerCtrl",[]).controller("BadgePreviewerCtrl",function($scope,User){var profileUrl=function(){return"https://www.codementor.io/"+User.username+"?utm_source=github&utm_medium=button&utm_term="+User.username+"&utm_campaign=github"};this.style="badge",this.tab="github",this.theme="light",this.githubBadge="contact-me",this.githubBadgeCode="",this.githubBadgeCodeType="markdown",this.githubBadgeTypes={"contact-me":{name:"Contact me on Codementor",src:"/badges/contact_me_github.svg"},"book-session":{name:"Book session on Codementor",src:"/badges/book_session_github.svg"},"get-help":{name:"Get help on Codementor",src:"/badges/get_help_github.svg"}},this.githubBadgeTypeKeys=Object.keys(this.githubBadgeTypes),this.genGithubCode=function(type){return"html"==this.githubBadgeCodeType?'<a href="'+profileUrl()+'"><img src="https://cdn.codementor.io'+this.githubBadgeTypes[type].src+'" alt="'+this.githubBadgeTypes[type].name+'" style="max-width:100%" /></a>':"[!["+this.githubBadgeTypes[type].name+"](https://cdn.codementor.io"+this.githubBadgeTypes[type].src+")]("+profileUrl()+")"}.bind(this),$scope.$watch("previewer.githubBadge",function(n){n&&(this.githubBadgeCode=this.genGithubCode(n))}.bind(this)),$scope.$watch("previewer.githubBadgeCodeType",function(n){n&&(this.githubBadgeCode=this.genGithubCode(this.githubBadge))}.bind(this)),this.websiteBadge="i-am-a-codementor-dark",this.websiteBadgeCode="",this.websiteBadgeTypes={"i-am-a-codementor-dark":{name:"I am a codementor",src:"/badges/i_am_a_codementor_dark.svg"},"codementor-dark":{name:"Codementor",src:"/badges/codementor_dark.svg"},"i-am-a-codementor-light":{name:"I am a codementor",src:"/badges/i_am_a_codementor_light.svg"},"codementor-light":{name:"Codementor",src:"/badges/codementor_light.svg"}},this.websiteBadgeTypeKeys=Object.keys(this.websiteBadgeTypes),this.genWebsiteCode=function(type){return'<a href="'+profileUrl()+'"><img src="https://cdn.codementor.io'+this.websiteBadgeTypes[type].src+'" alt="'+this.websiteBadgeTypes[type].name+'" style="max-width:100%"/></a>'}.bind(this),$scope.$watch("previewer.websiteBadge",function(n){n&&(this.websiteBadgeCode=this.genWebsiteCode(n))}.bind(this))}),angular.module("appCMGeneralFilters",[]).factory("noteFilePattern",function(){return/\n\[Attachment: (<a codementor-attach-file target="_blank" href=".+">.+<\/a>)\]/g}).filter("truncate",function(){return function(text,length,end){if(isNaN(length)&&(length=10),void 0===end&&(end=" ..."),text&&(text.length<=length||text.length-end.length<=length))return text;var result=String(text).substring(0,length-end.length);return result=result.substr(0,Math.min(result.length,result.lastIndexOf(" "))),result+end}}).filter("min",function(){return function(count,min){return Math.min(count,min)}}).filter("fileSize",function(){return function(size){var num="",unit="";return 1e3>size?(num=Math.round(size/1e3*100)/100,unit="K"):1e6>size?(num=Math.round(size/1e3),unit="K"):(num=Math.round(size/1e6*100)/100,unit="M"),isNaN(num)?"":num+unit}}).filter("reverse",function(){return function(items){return items.slice().reverse()}}).filter("newLine",function(){return function(text){return text.replace(/\n/g,"<br>").replace(/&#10;/g,"<br>")}}).filter("parseNote",function($filter,noteFilePattern){return function(text){var p=noteFilePattern,match=text.match(p);return text=text.replace(p,""),text=$filter("linky")(text,"_blank"),text=$filter("newLine")(text),angular.forEach(match,function(t){text+=t.replace(p,'<div class="note-li-attachment"><i class="icon-paper-clip"></i> $1</div>')}),text}}).filter("strftime",function(){return function(str,format){return new Date(str).strftime(format)}}).filter("firstName",function(){return function(str){return str.split(" ")[0]}}).filter("last",function(){return function(obj,n){if(obj){for(var lastN={},lastNkeys=_.last(Object.keys(obj),n),i=0,len=lastNkeys.length;len>i;i++)lastN[lastNkeys[i]]=obj[lastNkeys[i]];return lastN}return obj}}).filter("orderObjectBy",function(){return function(obj,field,reverse){var filtered=[];return angular.forEach(obj,function(item){filtered.push(item)}),filtered.sort(function(a,b){return a[field]<b[field]?-1:a[field]>b[field]?1:0}),reverse&&filtered.reverse(),filtered}}),angular.module("debounceService",[]).factory("debounce",function($timeout,$q){return function(func,wait,immediate){var timeout,deferred=$q.defer();return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||(deferred.resolve(func.apply(context,args)),deferred=$q.defer())},callNow=immediate&&!timeout;return timeout&&$timeout.cancel(timeout),timeout=$timeout(later,wait),callNow&&(deferred.resolve(func.apply(context,args)),deferred=$q.defer()),deferred.promise}}}),angular.module("template/appInboxNotification.html",[]).run(function($templateCache){$templateCache.put("template/appInboxNotification.html",'<div class="inboxNotification pull-right ng-cloak"><a class="cm-notify" ng-class="{active:show}" href="#" ng-click="toggleNoti()"><i class="icon-bell-alt"></i><i class="count" ng-hide="count<=0 || hideCount">{{count|min:99}}</i></a><div class="notification-list list-group" ng-show="show"><div class="list-group-heading clearfix"><h3 class="list-group-title pull-left">Notifications<img ng-src="{{ CdnRoot + \'/ajax-loader.gif\' }}" ng-cloak ng-show="loading"></h3><div class="action pull-right"><a href="#" ng-click="markAllAsRead()">Mark as Read</a></div></div><div class="list-group-body" prevent-body-scroll><div ng-class="{read:noti.read}" class="list-group-item noti-group-item clearfix" ng-repeat="noti in notifications" ng-click="goto(noti.id, noti.url)"><a ng-href="{{noti.url}}" style="position:absolute;width:100%;height:100%;top:0;left:0;text-decoration:none;z-index:10;background-color:#fff;opacity:0;filter:alpha(opacity=1)"></a><div class="cm-avatar noti-img-box rendering"><gen-avatar ga-name="{{ noti.sender.first_name }}" ga-type="{{ noti.kind }}" ga-url="{{ noti.sender.avatar_url }}"></gen-avatar></div><div class="noti-content"><h5>{{noti.title.replace("Message from","Note from")}}</h5><p>{{getDisplayBody(noti)|truncate:70}}</p></div><div class="noti-date">{{ noti.created_at * 1000 | date: "MMM d"}}</div></div><div class="empty-notification list-group-item read center" ng-cloak ng-show="notifications.length==0">No notifications.</div></div><div class="list-group-footer center clearfix"><a href="/notifications">See All</a></div></div></div>')}),angular.module("appInboxNotification",["template/appInboxNotification.html","debounceService","notifyService","genAvatar"]).factory("Notifications",function($resource,appConfig){return $resource(appConfig.apiHost+"/api/notifications/:nid",{nid:"@nid"},{get:{method:"GET",isArray:!1},markAsRead:{method:"PUT"},markAllAsRead:{url:appConfig.apiHost+"/api/notifications/read_all",isArray:!1,method:"PUT"}})}).directive("cmNotify",function($rootScope,$window,Sound,Notifications,noteFilePattern,Idle,notify){return{restrict:"E",replace:!0,controller:function($scope){$scope.notifications=[],$scope.count=0,$scope.show=!1,$scope.loading=!1,$scope.hideCount=!1,$scope.getNoti=function(){$scope.loading=!0,Notifications.get(function(data){$scope.notifications=data.notifications,$scope.count=data.count||$scope.count,$scope.loading=!1},function(){console.log("FAILURE - notifications"),$scope.loading=!1})},$scope._clickOut=function(event){$(event.target).parents(".inboxNotification").size()>0||$(event.target).hasClass("inboxNotification")||($scope.show=!1,$scope.$digest())},$rootScope.$on("profileAvatarClicked",function(){$scope.show=!1}),$scope.getDisplayBody=function(noti){return noti.body.replace(noteFilePattern," [attachment]")},$scope.toggleNoti=function(){$scope.show||($scope.hideCount=!0,notify.updateTitleNotify(0,!0,"inbox"),$scope.getNoti()),$scope.show=!$scope.show,$(document).off("click",$scope._clickOut),$(document).off("touchend",$scope._clickOut),$(document).on("click",$scope._clickOut),$(document).on("touchend",$scope._clickOut)},$scope.markAllAsRead=function(){$scope.loading=!0,Notifications.markAllAsRead(function(){$scope.loading=!1,$scope.count=0;for(var i=$scope.notifications.length;i--;)$scope.notifications[i].read=!0},function(){console.log("FAILURE - notifications - Mark All As Read"),$scope.loading=!1}),Idle.cancelIdleTimer()};var _read=function(id){var target=_.find($scope.notifications,function(noti){return noti.id==id?noti:void 0});Idle.cancelIdleTimer(),target.read||(target.read=!0,$scope.count-=1,$scope.count<0&&($scope.count=0))};$scope["goto"]=function(id){$scope.loading=!0,_read(id),Notifications.markAsRead({nid:id},function(){$scope.loading=!1},function(){$scope.loading=!1})},$rootScope.$on("new_notification",function(data){$scope.hideCount=!1,$scope.count=data.unread_count||$scope.count,$scope.getNoti(!0),$scope.count>0&&Sound.notify()}),$scope.$watch("count",function(n){n>=0&&notify.updateTitleNotify($scope.count,!1,"inbox")}),$scope.getNoti()},link:function(scope,element){var _getHeight=function(){var winHeight=angular.element($window).height(),result=winHeight-149;return 0>result&&(result=0),result>400&&(result=400),result};angular.element($window).bind("resize",function(){element.find(".list-group-body").css("max-height",_getHeight()+"px")})},templateUrl:"template/appInboxNotification.html"}}).controller("notificationPageCtrl",function($scope,$window,$http,appConfig,RefreshAlert){$scope.goTo=function(notiPath){console.log(notiPath),$http({method:"GET",url:notiPath}).success(function(){}).error(function(data,status){401==status&&RefreshAlert.open("logout")})}}),angular.module("appTutors",[]).controller("TutorsCtrl",function(){}),angular.module("appTutorialList",[]).factory("SubMenuTopAfterScroll",function(){return{get:function(){return 50-$(".fixed-bar").height()}}}).controller("tutorialListCtrl",function($timeout,$scope){$("body").attr("id","skrollr-body"),bowser.mobile||$timeout(function(){$scope.sk=skrollr.init({forceHeight:!1,keyframe:function(){}})},0),$scope.getHelpNow=function(){window.IHRc&&window.IHRc.getHelpNow(event,"header")},$scope.showSignUpModal=function(){$("#email_collection_modal_for_articles").modal()}}).directive("subMenuStickAtBottom",function($window,User,SubMenuTopAfterScroll){return{restrict:"A",link:function(){if(!bowser.mobile){var updatePosition=function(){var top=angular.element($window).scrollTop(),test=$("footer").offset().top<top+$(".signup").height()+$(".top-posts").height()+90;SubMenuTopAfterScroll.get();test?($(".top-posts").css({position:"relative",bottom:top-$("footer").offset().top+$(".top-posts").height()+$("footer").height()+10}),$(".signup").css({position:"relative",bottom:top-$("footer").offset().top+$(".top-posts").height()+$("footer").height()+10})):($(".top-posts").css({bottom:"inherit"}),$(".signup").css({bottom:"inherit"}))};angular.element($window).bind("resize",updatePosition),angular.element($window).bind("scroll",updatePosition)}}}}),angular.module("appTutorialNew",[]).controller("tutorialNewCtrl",function($scope,$timeout,$location,$http){$scope.state="draft",$scope.realTags=[],$scope.need_auto_save=!1;var inSaveProcess=!1;$scope.initialSet=function(selected_category,action_url,update_time,need_auto_save,imgUrl){$("#generateIndexHint").popover(),$("#SelectTopicModal").on("hidden",function(){"other"==$(".tutorialSelector").val()&&($(".tutorialSelector option").removeAttr("selected"),$(".tutorialSelector option[value='']").attr("selected",!0),$scope.selectedItem="")}),void 0!==selected_category&&""!=selected_category&&($scope.selectedItem=selected_category),$scope.tutorialTitle=$(".tutorialTitleInput").val(),$scope.featurePhoto=imgUrl||"",$scope.tutorialContent=decodeURIComponent(gon.article_content),$scope.lastUpdateTime=update_time,$scope.action_url=action_url,$scope.need_auto_save=need_auto_save,$scope.need_auto_save&&($scope.$watch("tutorialContent",_.debounce(SaveUpdates,1e3)),$scope.$watch("featurePhoto",_.debounce(SaveUpdates,1e3)),$scope.$watch("selectedItem",_.debounce(SaveUpdates,1e3)),$scope.$watch("tutorialTags",_.debounce(SaveUpdates,1e3))),$(".tutorialSelector").on("change",function(){if("other"==$(".tutorialSelector").val()){var category=prompt("What's the main topic for your tutorial?","");null!=category&&""!=category.trim()&&/^[a-zA-Z0-9._-]+$/.test(category.trim())?addOptionAndChangeSelected(category.trim()):($(".tutorialSelector option").removeAttr("selected"),$(".tutorialSelector option[value='']").attr("selected",!0),$scope.selectedItem="")}}),$timeout(function(){$("#markdownText").markdown({autofocus:!1,savable:!1}),$("#markdownText").data("markdown").showPreview()},500)},$scope.uploadFeaturePhoto=function(){filepicker.pick(function(Blob){$scope.featurePhoto=Blob.url,$scope.saveFunction(),$scope.$digest()})},$scope.cancelFeaturePhoto=function(){$scope.featurePhoto="",$scope.saveFunction(),$scope.$digest()};var SaveUpdates=function(newVal,oldVal){newVal!=oldVal?(window.onbeforeunload=function(){return $scope.checkSaveInvalid()?"Are you sure you want to leave this page without saving your changes?":"Make sure you have saved the tutorial before leaving"},$scope.saveFunction()):window.onbeforeunload=null};$scope.saveFunction=function(){if($scope.need_auto_save&&!inSaveProcess&&!$scope.checkSaveInvalid()){inSaveProcess=!0;var data={authenticity_token:$('meta[name="csrf-token"]').attr("content"),title:$scope.tutorialTitle,content:$scope.tutorialContent,feature_photo_url:$scope.featurePhoto,main_category:$scope.selectedItem,tags:$scope.tutorialTags};$http.post($scope.action_url,data).success(function(data){$scope.lastUpdateTime=new Date,$scope.action_url=data.next_url,$scope.previewUrl=$location.protocol()+"://"+$location.host()+":"+$location.port()+data.preview_url,$(".newTutorial").attr("action",data.submit_url),inSaveProcess=!1,window.onbeforeunload=null})}},$scope.checkSaveInvalid=function(){return void 0===$scope.tutorialTitle||""==$scope.tutorialTitle?!0:void 0===$scope.selectedItem||""==$scope.selectedItem},$scope.updateTags=function(tags){$scope.tutorialTags=tags.map(function(t){return t.text.toLowerCase()})},$scope.showTime=function(d){return""!=d?new Date(d).strftime("%F %T"):"-"},$scope.submitForm=function(type){window.onbeforeunload=null,$scope.state=type,$(".state").val(type),"submitted"!=type||confirm("The Codementor team will review your submitted tutorial shortly and you\u2019ll be notified once it is approved.")||event.preventDefault()};var addOptionAndChangeSelected=function(s){$(".tutorialSelector").append("<option value='"+s+"'>"+s+"</option>"),$(".tutorialSelector").val(s),$scope.selectedItem=s}}),angular.module("appTutorialShow",[]).controller("tutorialShowCtrl",function($scope,$timeout,$rootScope){$("body").attr("id","skrollr-body"),$scope.promoteTitle="",$scope.promoteUrl="",$scope.path="",$scope.initialSet=function(postTime,promoteUrl,promoteTitle,catName,catUrl,need_to_translate){$scope.postTime=postTime,$scope.promoteTitle=promoteTitle,$scope.promoteUrl=promoteUrl,$scope.currentBlock="mainTitle",$scope.catUrl=catUrl,$scope.catName=catName,$scope.tutorialContent=decodeURIComponent(gon.article_content),$timeout(function(){need_to_translate?($("#markdownText").markdown({autofocus:!1,savable:!1}),$("#markdownText").data("markdown").showPreview()):Prism.highlightAll(),$timeout(function(){var objH2=$("h2"),objH3=$("h3"),str="";if(objH2.length>1){var pStyle="font-style:italic;font-family:Georgia,serif;margin:30px 0px;color:#333;padding:20px 0px;border-top:1px solid #eee;border-bottom:1px solid #eee;",aLinkStyle="font-style:italic;font-family:Georgia,serif;font-weight:bold;";if(promoteTitle&&promoteUrl&&-1!==promoteUrl.indexOf("classes"))str="<p style='"+pStyle+"'>Want to speed up your learning process? <a class='tutorial-inner-class-link' style='"+aLinkStyle+"' href='#'>"+promoteTitle+"</a></p>";else if(promoteTitle&&promoteUrl&&-1!==promoteUrl.indexOf("course")){var catName=-1!==$scope.catName.toLowerCase().indexOf("programming")?"web":$scope.catName;str="<p style='"+pStyle+"'>Want to become a "+catName+" developer? Check out our <a class='tutorial-inner-monthly-link' style='"+aLinkStyle+"' href='#'>1:1 mentorships</a></p>"}else promoteTitle&&promoteUrl&&-1!==promoteTitle.toLowerCase().indexOf("interview")&&(str="<p style='"+pStyle+"'>Ace your next tech interview! <a class='tutorial-inner-interview-link' style='"+aLinkStyle+"' href='#'>Start a Mock Interview</a> with an Expert</p>");$(objH2[1]).before(str)}if(objH2.length>0)for(var i=0;i<objH2.length;i++)objH2[i].id=objH2[i].innerHTML.replace(/\s+/g,"_").replace(/[^\w\d]+/g,"")+"_"+i.toString();else for(var i=0;i<objH3.length;i++)objH3[i].id=objH3[i].innerHTML.replace(/\s+/g,"_").replace(/[^\w\d]+/g,"")+"_"+i.toString();var url=window.location.href,arr=url.split("/");$scope.path=arr[0]+"//"+arr[2],$scope.onClickTracking(".tutorial-inner-class-link","inner-class-link",promoteTitle),$scope.onClickTracking(".tutorial-footer-class-link","footer-class-link",promoteTitle),$scope.onClickTracking(".tutorial-inner-monthly-link","inner-monthly-link",promoteTitle),$scope.onClickTracking(".tutorial-inner-interview-link","inner-interview-link",promoteTitle),bowser.mobile||($scope.sk=skrollr.init({forceHeight:!1,keyframe:function(element,name,direction){"data-51Top"==name&&("down"==direction?$(".top-promotion-area").hide():"up"==direction&&$(".top-promotion-area").show())}})),sideBlock.go({element:$(".detail").get(0),baseUrl:gon.api_host+"/api",categories:[catUrl],onClick:function(options){amplitude.logEvent("SideBlockAdClick",{url:window.location.href,ad:options.ad})},onShow:function(options){amplitude.logEvent("SideBlockAdShow",{url:window.location.href,ad:options.ad
})},queries:{ref:"side-ad"}}),$rootScope.$broadcast("replaceYoutubeImg")},2e3)},200)},$scope.onClickTracking=function(className,position){$(className).on("click",function(){var openUrl,utm_term;return utm_term=$scope.getUtmTerm(),openUrl=-1!==$scope.promoteUrl.indexOf("interview")?$scope.path+$scope.promoteUrl+"?utm_source=tutorial&utm_medium="+position+"&utm_term="+utm_term+"&utm_content=tutorial_"+$scope.catUrl+"&utm_campaign=cm_internal_ad":$scope.path+$scope.promoteUrl+"?utm_source=tutorial&utm_medium="+position+"&utm_term="+utm_term+"&utm_content=tutorial_"+$scope.catUrl+"&utm_campaign=cm_internal_ad",amplitude.logEvent("/Tutorial/"+position,{promoteTitle:1}),window.location.href=openUrl,!0})},$scope.openClassPage=function(position){var url,utm_term;$scope.catName;utm_term=$scope.getUtmTerm(),url=$scope.path+$scope.promoteUrl+"?utm_source=tutorial&utm_medium="+position+"&utm_term="+utm_term+"&utm_content=tutorial_"+$scope.catUrl+"&utm_campaign=cm_internal_ad",amplitude.logEvent("/Tutorial/"+position,{catName:1}),window.location.href=url},$scope.getUtmTerm=function(){return-1!==$scope.promoteUrl.indexOf("classes")?"class":-1!==$scope.promoteUrl.indexOf("course")?"course":-1!==$scope.promoteTitle.toLowerCase().indexOf("interview")?"interview":void 0},$scope.showDate=function(timestamp){return new Date(1e3*timestamp).strftime("%B %o %Y")},$scope.changeBlock=function(id){var scrollOffset,speed;scrollOffset=window.scrollY,speed=30*Math.pow(Math.abs(scrollOffset-$("#"+id).offset().top),1/3),$scope.currentBlock=id,$("html, body").animate({scrollTop:$("#"+id).offset().top-70+1},speed)},$scope.showSignUpModal=function(){$("#email_collection_modal_for_articles").modal()},$scope.showEmailCollectionModal=function(){$("#email_collection_modal").modal()},$scope.scrollTop=function(){$scope.changeBlock("article")},$scope.trackSubmission=function(){$scope.catName;amplitude.logEvent("/Tutorial/submit-tutorial",{catName:1})}}),angular.module("appCourseLanding",[]).factory("CourseLandingUtils",function(){return{scrollTo:function(selector){var to=parseInt(selector);to||(to=($(selector).offset()||{}).top||0),$("html, body").animate({scrollTop:Math.max(to-20,0)},800)}}}).controller("courseLandingCtrl",function($scope,$http,$timeout,appConfig,CourseLandingUtils){$scope.courseSubscriptionUrl="",$scope.hasSubscribe=!1,$scope.userTimeZone=(new Date).currentTimeZoneText(),$scope.initialSet=function(courseSubscriptionUrl){$scope.courseSubscriptionUrl=courseSubscriptionUrl},$scope.onKeyPress=function($event){13!=$event.keyCode||$scope.hasSubscribe||$scope.subscribe()},$scope.subscribe=function(){amplitude.logEvent("/Classes/ClickEmailBtn"),isEmail($scope.subscribeEmail)&&$http.post(appConfig.apiHost+"/api/email/subscribe",{from:$scope.courseSubscriptionUrl,email:$scope.subscribeEmail}).success(function(){$scope.hasSubscribe=!0,$timeout(function(){CourseLandingUtils.scrollTo("#enroll-promotion")},500),amplitude.logEvent("/SubscriptionForm/"+$scope.courseSubscriptionUrl+"/Subscribe"),ga("send","event",$scope.courseSubscriptionUrl+" subscription","subscribe"),(window.optimizely||[]).push(["trackEvent",$scope.courseSubscriptionUrl+"_subscription"])})},$scope.scrollToEnroll=function(){CourseLandingUtils.scrollTo("#enroll")};var isEmail=function(email){var regex=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;return regex.test(email)}}),angular.module("appScheduleClusterLanding",[]).factory("ScheduleClusterLandingUtils",function(){return{scrollTo:function(selector){var to=parseInt(selector);to||(to=($(selector).offset()||{}).top||0),$("html, body").animate({scrollTop:Math.max(to,0)},800)}}}).controller("scheduleClusterLandingCtrl",function($scope,$http,$timeout,appConfig,ScheduleClusterLandingUtils,User){$scope.subscriptionFrom="",$scope.hasSubscribe=!!User.isMember,$scope.formStep=1,$scope.lastFocusInput="#use-cases",$scope.initialSet=function(from){var timezone=(new Date).currentTimeZoneText();$scope.subscriptionFrom=from,$("#user-time-zone").val(timezone),$timeout(function(){localStorage.monthlyRequestDetail?($scope.monthlyDetail=localStorage.monthlyRequestDetail,$scope.hasSubscribe=!0):$scope.monthlyDetail=decodeURIComponent(gon.description),localStorage.monthlyRequestCategories&&($scope.realTags=_.map(JSON.parse(localStorage.monthlyRequestCategories),function(tag){return{text:tag.text}}),$scope.hasSubscribe=!0)},500),$timeout(function(){localStorage.monthlyRequestDetail&&ScheduleClusterLandingUtils.scrollTo("#post-request")},800),$("form").on("submit",function(e){$scope.isFormValid()||(e.preventDefault(),e.stopPropagation())}),User.isMember?amplitude.logEvent("/MonthlyLanding/User"):amplitude.logEvent("/MonthlyLanding/Guest"),amplitude.logEvent("/MonthlyLanding/All")},$scope.recordLastFocusInput=function(key){$scope.lastFocusInput=key},$scope.onKeyPress=function($event){13!=$event.keyCode||$scope.hasSubscribe||$scope.subscribe($scope.lastFocusInput)},$scope.subscribe=function(position){$scope.scrollPosition=position,isEmail($scope.subscribeEmail)&&$http.post(appConfig.apiHost+"/api/email/subscribe",{from:$scope.subscriptionFrom,email:$scope.subscribeEmail}).success(function(){$scope.hasSubscribe=!0,$timeout(function(){ScheduleClusterLandingUtils.scrollTo($scope.scrollPosition)},500),User.isMember?amplitude.logEvent("/MonthlyLanding/User/Subscribe"):amplitude.logEvent("/MonthlyLanding/Guest/Subscribe"),amplitude.logEvent("/MonthlyLanding/All/Subscribe"),ga("send","event","monthly landing page","subscribe"),(window.optimizely||[]).push(["trackEvent","monthly_landing_page_subscription"])})},$scope.scrollTo=function(position){ScheduleClusterLandingUtils.scrollTo(position)},$scope.jumpStep=function(index){if(2==index&&$scope.isFormValid()){var obj=$(".monthly-progress");$(obj[0]).removeClass("active"),$(obj[0]).addClass("passed"),$(obj[1]).addClass("active"),$scope.formStep=index,localStorage.setItem("monthlyRequestDetail",$scope.monthlyDetail)}if(1==index){var obj=$(".monthly-progress");$(obj[1]).removeClass("active"),$(obj[0]).removeClass("passed"),$(obj[0]).addClass("active"),$scope.formStep=index}},$scope.updateTags=function(tags){0==tags.length?$(".tags").addClass("invalid"):$(".tags").removeClass("invalid"),localStorage.setItem("monthlyRequestCategories",JSON.stringify(tags))},$scope.isFormValid=function(){var data=$("form").serializeArray();return 0==_.where(data,{name:"schedule_cluster[categories][]"}).length?$(".tags").addClass("invalid"):$(".tags").removeClass("invalid"),_.where(data,{name:"schedule_cluster[categories][]"}).length>0&&_.findWhere(data,{name:"schedule_cluster[description]"}).value.trim().length>0},$scope.autoSave=function(){localStorage.setItem("monthlyRequestDetail",$scope.monthlyDetail)};var isEmail=function(email){var regex=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;return regex.test(email)}}),angular.module("codementor",["ngRoute","ngResource","ngStorage","angularSpinner","available_time_app","BadgePreviewerCtrl","mentor_calendar_app","modal/hellosign-tutorial.html","notification_app","beta_dashboard_app","online_status_toggle_app","timezone_app","ui.bootstrap.datetimepicker","template/profileImage.html","modal/crop-image-modal.html","app","appAlert","appApplicantNew","appAvatar","appBlogList","appBlogShow","appBusiness","appCMGeneralFilters","appChat","appCodementorMonthly","appCourse","appCourseLanding","appDashboard","appDirectory","appDirectoryTopic","appEditExpertise","appExpertiseForm","appExpertiseSorting","appFindMentor","appGetHelpNow","appFaq","appFavorite","appFreeCredit","appHelpListingShow","appInboxNotification","appInvoice","appLearn","appLanguage","appLongterm","appMenteeProfile","appMentorApplyEdit","appMentorProfile","appPopoverProfile","appNote","appOfficeHour","appOfficeHourLanding","appOfflineHelp","appOhShow","appOrder","appScheduleCluster","appPayment","appPayoutSettings","appPrepareLesson","appPresence","appPromoteMentor","appQuestion","appRateForClient","appRequest","appRightSideBar","appSchedule","appScheduleClusterLanding","appSelectAllText","appService","appServiceProfile","appSeoNew","appSessionSummary","appSound","appStoryShow","appTutors","appTutorialList","appTutorialNew","appTutorialShow","appWelcomeMat"]).config(function($routeProvider){return gon.searchPage||gon.normalHashPage?void 0:$routeProvider.when("/online_mentors",{}).when("/available_mentors",{}).when("/broadcast_mentors",{})}).config(function($compileProvider){$compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|bitcoin):/)}).directive("minibarEvent",function(){return{restrict:"A",link:function(scope,elem,attrs){if("false"!=attrs.minibarEvent){var update=function(){var top=$(document).scrollTop();top>35?elem.addClass("minibar"):(top>20&&$(".navbar .navbar-inner").css("padding-top",top),0>=top&&$(".navbar .navbar-inner").css("padding-top",20),elem.removeClass("minibar"))};$(window).scroll(update),update()}}}}).directive("body",function($rootScope){return{restrict:"E",link:function(scope,elem){elem.bind("click",function(e){$rootScope.$broadcast("bodyClicked",e)}),scope.$on("enableChatBar",function(){elem.addClass("chat-side-bar")}),scope.$on("disableChatBar",function(){elem.removeClass("chat-side-bar")}),elem.on("click","a[target=_blank]",function(e){var url=angular.element(this).attr("href");blankshield.open(url),e.preventDefault()})}}}).directive("sideBarStickAtBottom",function($window){return{restrict:"A",link:function(scope,elem){var updatePosition=function(){var top=angular.element($window).scrollTop();if($("body").width()<=767)return void elem.css({position:"relative",top:"auto","z-index":4});if(document.getElementsByClassName("footer-block").length>0){var rMentorsElemHeight=0;document.getElementsByClassName("related-mentors").length>0&&(rMentorsElemHeight=$(".related-mentors").first().height()+160),elem.height()+100+top>$("footer").offset().top-rMentorsElemHeight-40?(elem.css({position:"absolute",top:$("footer").offset().top-rMentorsElemHeight-elem.height()-100}),elem.offset().top>$(".secondPart").offset().top&&elem.css({"z-index":3})):(elem.css({position:"fixed",top:"137px","z-index":4}),100+top>$(".secondPart").offset().top&&elem.css({"z-index":3}))}else elem.height()+100+top>document.body.offsetHeight-40?(elem.css({position:"absolute",top:document.body.offsetHeight-40-elem.height()-100}),elem.offset().top>$(".secondPart").offset().top&&elem.css({"z-index":3})):(elem.css({position:"fixed",top:"137px","z-index":4}),100+top>$(".secondPart").offset().top&&elem.css({"z-index":3}))};angular.element($window).bind("resize",updatePosition),angular.element($window).bind("scroll",updatePosition)}}}).directive("a",function(){return{restrict:"E",link:function(scope,elem,attrs){""!==attrs.href&&"#"!==attrs.href||elem.on("click",function(e){e.preventDefault()})}}}).directive("wbr",function(){return{restrict:"A",link:function(scope,elem){elem.find(">div a").each(function(){var v=$(this).html();$(this).html(v.replace(/(\%|\&|-|\=)/gi,function(v){return"<wbr>"+v}))})}}}).directive("hideGravatar404",function(){return{restrict:"C",link:function(scope,elem){elem.on("load",function(){elem.show()}).on("error",function(){elem.hide()})}}}).directive("expandable",function(){return{restrict:"A",link:function(scope,elem){elem.click(function(e){$(e.target).is("a")||($(this).parents("li").hasClass("expanded")?$(this).parents("li").removeClass("expanded"):($(".issues-list li").removeClass("expanded"),$(this).parents("li").addClass("expanded")))})}}}).controller("MainCtrl",function($scope,$timeout,Chat,Schedule){$scope.Chat=Chat,$scope.Schedule=Schedule;var timer,hoverFunction=function(element){var target=element.currentTarget;target=$(target);var timeout=175;target.hasClass("learnTopMenu")||(timeout=0);var event_type=element.type+"";timer=$timeout(function(){hover(target,event_type)},timeout)},cancelFunction=function(){$timeout.cancel(timer)},hover=function(target,event_type){"mouseenter"===event_type?(target.addClass("open"),target.off("mouseleave").off("mouseenter"),target.on("mouseleave",hoverFunction).on("mouseenter",cancelFunction)):"mouseleave"===event_type&&(target.removeClass("open"),target.off("mouseleave").off("mouseenter"),target.on("mouseenter",hoverFunction).on("mouseleave",cancelFunction))};$(".learnTopMenu, .subMenuItem").on("mouseenter",hoverFunction).on("mouseleave",cancelFunction)}).controller("cookieHideCtrl",function($scope){$scope.show=!1,$scope.init=function(key){key&&($scope.key=key,$.cookie(key)||($scope.show=!0))},$scope.doHide=function(){$scope.key&&($.cookie($scope.key,!0,{path:"/"}),$scope.show=!1)}}).controller("headerProfileAvatarCtrl",function($scope,$rootScope){$scope.profileMenu=!1,$scope.imgUrl=null,$scope.init=function(imgUrl){$scope.imgUrl=imgUrl},$scope._clickOut=function(e){0==$(e.target).parents(".profile-avatar").size()&&($scope.profileMenu=!1,$(document).off("touchend",$scope._clickOut),$(document).off("click",$scope._clickOut),$scope.$digest())},$scope.onClick=function(e){$rootScope.$broadcast("profileAvatarClicked"),e.stopPropagation(),$scope.profileMenu=!$scope.profileMenu,$(document).off("touchend",$scope._clickOut),$(document).on("touchend",$scope._clickOut),$(document).off("click",$scope._clickOut),$(document).on("click",$scope._clickOut)},$rootScope.$on("onProfileImgChange",function(event,imgUrl){$scope.imgUrl=imgUrl})}).controller("connectNowNotifyCtrl",function($scope,$rootScope,$http,appConfig,$timeout,User){var canceled_notifications={};$scope.show=!1,$scope.snapshot_name="",$scope.data={},$rootScope.$on("firebase_auth_success",function(){$scope.userRef=$rootScope.firebaseRef.child("realtime").child(User.firebaseId);var browser_notifies=[];$scope.cancelNotify=function(){for(var i=0,len=browser_notifies.length;len>i;i++){var browser_notify=browser_notifies[i];browser_notify&&_.isFunction(browser_notify.close)&&browser_notify.close()}},$scope.audio=$("#chatAudio")[0],$scope.audioPlay=function(doLoop){var loop=function(){this.currentTime=0,this.play()};$scope.audio.removeEventListener("ended",loop,!1),doLoop&&$scope.audio.addEventListener("ended",loop,!1),$scope.audio.play()},$scope.userRef.on("child_added",function(snapshot){var data=snapshot.val();if(null!==data){var browser_notify=null,name=snapshot.key(),now=(new Date).getTime();if("undefined"!=typeof data.expired_at&&data.expired_at<now)return void $scope.userRef.child(name).remove();if("new_realtime_lesson"===data.type){if(gon.prepare_lesson&&gon.prepare_lesson.question.id==data.question_id)return;$http.get("/users/info?username="+data.user_name).success(function(data_info){$scope.free_length=data_info.free_length>0?"(first "+data_info.free_length/60+" minutes free)":"",browser_notify=sendNotification("Connect Now",data.user_name+" would like to connect with you now "+(data.question_is_direct?"":"about: "+data.title)+$scope.free_length),browser_notifies.push(browser_notify),$scope.show=!0,amplitude.logEvent("/connect_now/notification/show")})}else{if("reject_realtime_lesson"===data.type)return canceled_notifications[$scope.snapshot_name]=!0,void $scope.userRef.child($scope.snapshot_name).remove();if("expire_realtime_lesson"===data.type)return User.isMentor&&($scope.expire_timer&&$timeout.cancel($scope.expire_timer),name in canceled_notifications||(canceled_notifications[name]=!0,$scope.data.type="miss_connection"),cancelFlashTitle(),browser_notify&&_.isFunction(browser_notify.close)&&browser_notify.close()),canceled_notifications[$scope.snapshot_name]=!0,void $scope.userRef.child($scope.snapshot_name).remove();if("in_prepare_lesson"!==data.type)return"new_notification"===data.type?($rootScope.$broadcast("new_notification",{unread_count:data.unread_count}),void $scope.userRef.child(snapshot.key()).remove()):!1;if(gon.prepare_lesson&&gon.prepare_lesson.question.id==data.question_id)return;browser_notify=sendNotification("The Session is Ready",data.user_name+" is waiting to start the session with you "+(data.question_is_direct?"":"about: "+data.title)),browser_notifies.push(browser_notify),$scope.show=!0}$scope.snapshot_name&&($scope.userRef.child($scope.snapshot_name).remove(),$scope.cancelNotify(),$scope.data.question_id==data.question_id&&$timeout.cancel($scope.expire_timer)),$scope.data=data,$scope.snapshot_name=name,flashTitle("(1) Incoming request!",1e3),$scope.audioPlay("new_realtime_lesson"===data.type),User.isMentor&&($scope.expire_timer=$timeout(function(){name in canceled_notifications||(canceled_notifications[name]=!0,$scope.dismiss(data.cancel_url,!0),$scope.data.type="miss_connection"),cancelFlashTitle(),browser_notify&&_.isFunction(browser_notify.close)&&browser_notify.close()},12e4)),$scope.$digest()}}),$rootScope.firebaseRef.child("presence").child(User.username.replace(/\./g,"^")).child("session").set(!1),$scope.userRef.child("ongoing_session").limitToLast(1).on("child_added",function(snapshot){var data=snapshot.val(),lesson=(snapshot.key(),data[Object.keys(data)[0]]);gon.prepare_lesson&&gon.prepare_lesson.question.id==lesson.question.id||$http.get(appConfig.apiHost+"/api/lessons/"+lesson.id+"/check_ongoing").then(function(r){if(r.data&&r.data.ongoing){if(lesson.type="ongoing_session",lesson.opposite_user=lesson.mentor.username==User.username?lesson.mentee:lesson.mentor,lesson.user_image_url=lesson.opposite_user.profile_image,!r.data.in_session){var browser_notify=sendNotification("Ongoing Session","You have an ongoing session with "+lesson.opposite_user.display_name+" about: "+lesson.question.title);browser_notifies.push(browser_notify),$scope.audioPlay(!1)}$scope.show=!0,$scope.data=lesson}})})}),$scope.stopSound=function(){$scope.audio&&($scope.audio.pause(),$scope.audio.currentTime=0)};var _act=function(doNotRemove){$scope.stopSound(),doNotRemove||(canceled_notifications[$scope.snapshot_name]=!0,$scope.userRef.child($scope.snapshot_name).remove()),cancelFlashTitle(),$scope.cancelNotify(),$timeout.cancel($scope.expire_timer)};$scope.accept=function(url){_act(),$scope.show=!1,window.location.href=url},$scope.dismiss=function(url,is_cancel){_act(),is_cancel||($scope.show=!1),url?is_cancel?amplitude.logEvent("/connect_now/notification",{action:"Expired - Cancel Lesson"}):amplitude.logEvent("/connect_now/notification",{action:"No Thanks"}):amplitude.logEvent("/connect_now/notification/user",{action:"OK"})},$scope.joinDismiss=function(){_act(!0),$scope.show=!1,amplitude.logEvent("/ongoing_session/notification",{action:"OK - ONGOING SESSION"})},$scope.toDashboard=function(url){_act(),$scope.show=!1,amplitude.logEvent("/connect_now/notification",{action:"View Details"}),window.location.href=url.replace("active","open")},$scope.tryAgain=function(url){_act(),$scope.show=!1,amplitude.logEvent("/connect_now/notification/user",{action:"Try Again"}),window.location.href=url},$scope.startNow=function(url){_act(),$scope.show=!1,amplitude.logEvent("/connect_now/notification",{action:"Start Now"}),window.location.href=url},$scope.joinSession=function(url){_act(!0),$scope.show=!1,amplitude.logEvent("/ongoing_session/notification",{action:"Join Now"}),window.location.href=url},$scope.otherMentors=function(url){_act(),$scope.show=!1,amplitude.logEvent("/connect_now/notification/user",{action:"Find Another Mentor"}),$scope.data.question_is_direct?window.location.href="/experts":window.location.href=url}}).directive("ngEnter",function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){13===event.which&&(scope.$apply(function(){scope.$eval(attrs.ngEnter)}),event.preventDefault())})}}).directive("clearStorage",function(){return{restrict:"A",link:function(scope,elem){elem.click(function(){localStorage["ngStorage-chatrooms"]=JSON.stringify([]),"function"==typeof window.Intercom&&Intercom("shutdown")})}}}).directive("currentTime",function($timeout){return{restrict:"E",scope:!0,template:'<span class="current-time">{{currentTime}}</span>',replace:!0,link:function(scope,elem,attrs){var timezoneOffset=parseInt(1e3*attrs.offset),update=function(){isNaN(timezoneOffset)||$timeout(function(){var timezoneTxt=timezoneToText(-(timezoneOffset/1e3/60));scope.currentTime=(new Date).offset(timezoneOffset).strftime("%a %l:%M %p ")+"GMT"+timezoneTxt.sign+timezoneTxt.h+timezoneTxt.m})},debounceUpdate=_.debounce(update,200);elem.parents(".appChatList-li").on("mouseover",debounceUpdate),update(),scope.$on("$destroy",function(){elem.parents(".appChatList-li").off("mouseover",debounceUpdate)})}}}).directive("timeDisplayer",function(){return{restrict:"E",scope:{datetime:"="},template:'<span class="time-displayer">{{time}}</span>',replace:!0,link:function(scope){var date=new Date(scope.datetime);scope.time=date.strftime("%b %d, %Y, %l:%M %p")+" ("+date.currentTimeZoneText()+")"}}}).run(function($rootScope,$http,appConfig,$timeout,$route,Chat){if(window.filepicker&&filepicker.setKey("AnYaDARpUTGKmQ2PClaFrz"),$rootScope.firebaseRef=new Firebase(gon.data_init.firebase.path),$timeout(function(){$rootScope.firebaseRef.authWithCustomToken(gon.data_init.firebase.token,function(error){error||$rootScope.$broadcast("firebase_auth_success")})},0),$rootScope.cmTrack=function(eventName,payload){amplitude.logEvent(eventName,payload)},window.getUrlParameterByName){var username=window.getUrlParameterByName("openchat");username&&$http.get(appConfig.apiHost+"/api/chat_info/"+username).success(function(result){Chat.openChatroom({id:result.chats_path,contact:{name:result.display_name,username:username,avatarUrl:result.avatar}})}).error(function(data,status){401==status&&RefreshAlert.open("logout")})}}).directive("profileImage",function($resource,$location,$modal){return{restrict:"E",scope:{imgSrc:"@"},transclude:!0,templateUrl:"template/profileImage.html",link:function(scope){function cropAndUpload(url,width,height,top,left){scope.imgShow=!1;var blob={url:url,mimetype:"image/jpeg",isWriteable:!1},option={fit:"clip",crop:[left,top,200,200]};width&&(option.width=width),height&&(option.height=height),filepicker.convert(blob,option,function(new_Blob){var uploadPhotoResource=$resource(baseUrl+"/users/upload_photo",{},{post:{method:"POST",isArray:!1}});uploadPhotoResource.post(null,{photoUrl:new_Blob.url},function(){if(scope.imgSrc.indexOf("https://www.gravatar.com")<0){var oldBlob={url:scope.imgSrc,mimetype:"image/jpeg"};filepicker.remove(oldBlob)}scope.imgSrc=new_Blob.url,scope.isGravatar=!1,scope.$emit("onProfileImgChange",scope.imgSrc)}),filepicker.remove(blob)},function(e){console.log("Fail to convert image: "+e)})}var baseUrl=$location.protocol()+"://"+$location.host()+":"+$location.port();scope.imgShow=!0,scope.showText=!1,scope.isShowUpdateOption=!1,scope.isGravatar=scope.imgSrc.indexOf("https://www.gravatar.com")>=0,angular.element("#profile-photo")[0].onload=function(){scope.$apply(function(){scope.imgShow=!0})},scope.imgMouseOver=function(){scope.showText=!0},scope.imgMouseLeave=function(){scope.isShowUpdateOption||(scope.showText=!1)},scope.showUpdateOption=function(){scope.isShowUpdateOption=!scope.isShowUpdateOption},scope.uploadPhoto=function(){scope.showText=!1,scope.isShowUpdateOption=!1,filepicker.pick({mimetype:"image/*"},function(Blob){var blob={url:Blob.url},modalInstance=$modal.open({templateUrl:"modal/crop-image-modal.html",controller:"cropImageModalCtrl",resolve:{imgMetadata:function(){return{url:Blob.url}}}});modalInstance.result.then(function(data){cropAndUpload(Blob.url,data.width,data.height,data.top,data.left)},function(){filepicker.remove(blob)})})},scope.redirectGravatar=function(){window.open("https://www.gravatar.com/","_blank")},scope.removePhoto=function(){if(!(scope.imgSrc.indexOf("https://www.gravatar.com")>=0)){scope.showText=!1,scope.isShowUpdateOption=!1,scope.imgShow=!1;var removePhotoResource=$resource(baseUrl+"/users/remove_photo",{},{post:{method:"POST",isArray:!1}}),blob={url:scope.imgSrc,mimetype:"image/jpeg"};filepicker.remove(blob),removePhotoResource.post(null,{},function(data){scope.imgSrc=data.metadata.url,scope.$emit("onProfileImgChange",scope.imgSrc),scope.imgShow=!0,scope.isGravatar=!0})}},angular.element(document).on("click",function(e){0===angular.element(e.target).closest("#update-wrapper").length&&scope.$apply(function(){scope.showText=!1,scope.isShowUpdateOption=!1})})}}}).controller("cropImageModalCtrl",function($scope,$modalInstance,$timeout,imgMetadata){$scope.imgUrl=imgMetadata.url,$scope.showImg=!1;var finalTop=0,finalLeft=0,finalWidth=null,finalHeight=null;$timeout(function(){var wrapper=angular.element("#profile-wrapper")[0],imgElement=angular.element("#profile-image-crop")[0],imgFrame=angular.element("#profile-image-frame"),borderWidth=0,draggable=!1;imgElement.onload=function(){if(imgElement.width<imgElement.height){imgElement.height=Math.round(200*imgElement.height/imgElement.width),imgElement.width=200,borderWidth=Math.ceil(imgElement.height-200),imgFrame[0].style.borderWidth=borderWidth+"px 0px "+borderWidth+"px 0px",imgFrame[0].style.top=-borderWidth/2+"px",finalTop=borderWidth/2,finalWidth=200;var posY=0,startY=0;imgFrame.on("mousedown",function(){startY=posY-imgFrame[0].offsetTop,draggable=!0}),angular.element(document).on("mouseup",function(){draggable=!1}),angular.element(document).on("mousemove",function(e){if(posY=document.all?window.event.clientY:e.pageY,draggable){var diff=posY-startY;-borderWidth>diff?diff=-borderWidth:diff>0&&(diff=0),imgFrame[0].style.top=diff+"px",finalTop=diff+borderWidth}})}else{imgElement.width=Math.round(200*imgElement.width/imgElement.height),imgElement.height=200,borderWidth=Math.ceil(imgElement.width-200),imgFrame[0].style.borderWidth="0px "+borderWidth+"px 0px "+borderWidth+"px",imgFrame[0].style.left=-borderWidth/2+"px",wrapper.style.width=imgElement.width+"px",finalLeft=borderWidth/2,finalHeight=200;var posX=0,startX=0;imgFrame.on("mousedown",function(){startX=posX-imgFrame[0].offsetLeft,draggable=!0}),angular.element(document).on("mouseup",function(){draggable=!1}),angular.element(document).on("mousemove",function(e){if(posX=document.all?window.event.clientX:e.pageX,draggable){var diff=posX-startX;-borderWidth>diff?diff=-borderWidth:diff>0&&(diff=0),imgFrame[0].style.left=diff+"px",finalLeft=diff+borderWidth}})}$scope.$apply(function(){$scope.showImg=!0}),imgElement.onload=null}},0),$scope.ok=function(){$modalInstance.close({top:finalTop,left:finalLeft,width:finalWidth,height:finalHeight})},$scope.cancel=function(){$modalInstance.dismiss("cancel")}});